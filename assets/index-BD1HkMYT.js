(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const c of document.querySelectorAll('link[rel="modulepreload"]'))n(c);new MutationObserver(c=>{for(const s of c)if(s.type==="childList")for(const h of s.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&n(h)}).observe(document,{childList:!0,subtree:!0});function r(c){const s={};return c.integrity&&(s.integrity=c.integrity),c.referrerPolicy&&(s.referrerPolicy=c.referrerPolicy),c.crossOrigin==="use-credentials"?s.credentials="include":c.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(c){if(c.ep)return;c.ep=!0;const s=r(c);fetch(c.href,s)}})();function globPatternToRegex(t,e){let r;t.startsWith("/")?r=t:r=(e==="/"?"/":e+"/")+t;let n="^",c=0;for(;c<r.length;){const s=r[c];if(s==="*"&&r[c+1]==="*")r[c+2]==="/"?(n+="(?:.*/)?",c+=3):(n+=".*",c+=2);else if(s==="*")n+="[^/]*",c++;else if(s==="?")n+="[^/]",c++;else if(s===".")n+="\\.",c++;else if(s==="{"){const h=r.indexOf("}",c);if(h>c){const o=r.slice(c+1,h).split(",");n+="(?:"+o.map(a=>a.replace(/\./g,"\\.")).join("|")+")",c=h+1}else n+="\\{",c++}else n+=s.replace(/[[\]()\\^$|+]/g,"\\$&"),c++}return n+="$",new RegExp(n)}const DB_NAME="shiro-fs",DB_VERSION=1,STORE_NAME="files";function makeStat(t){return{type:t.type,mode:t.mode,size:t.size,mtime:new Date(t.mtime),ctime:new Date(t.ctime),isFile(){return t.type==="file"},isDirectory(){return t.type==="dir"},isSymbolicLink(){return t.type==="symlink"}}}function fsError(t,e){const r=new Error(e);r.code=t;const n={ENOENT:-2,EISDIR:-21,ENOTDIR:-20,EEXIST:-17,ENOTEMPTY:-39};return r.errno=n[t]||-1,r}class FileSystem{db=null;cache=new Map;cacheEnabled=!0;async init(){this.db=await new Promise((r,n)=>{const c=indexedDB.open(DB_NAME,DB_VERSION);c.onupgradeneeded=()=>{const s=c.result;s.objectStoreNames.contains(STORE_NAME)||s.createObjectStore(STORE_NAME,{keyPath:"path"})},c.onsuccess=()=>r(c.result),c.onerror=()=>n(c.error)}),await this._get("/")||await this._put(this._makeNode("/","dir"));for(const r of["/home","/tmp","/home/user"])await this._get(r)||await this._put(this._makeNode(r,"dir"))}_makeNode(e,r,n){const c=Date.now();return{path:e,type:r,content:n||null,mode:r==="dir"?493:420,mtime:c,ctime:c,size:n?n.length:0}}_store(e){return this.db.transaction(STORE_NAME,e).objectStore(STORE_NAME)}async _get(e){if(this.cacheEnabled&&this.cache.has(e))return this.cache.get(e);const r=await new Promise((n,c)=>{const s=this._store("readonly").get(e);s.onsuccess=()=>n(s.result),s.onerror=()=>c(s.error)});return this.cacheEnabled&&this.cache.set(e,r),r}async _put(e){await new Promise((r,n)=>{const c=this._store("readwrite").put(e);c.onsuccess=()=>r(),c.onerror=()=>n(c.error)}),this.cacheEnabled&&(this.cache.set(e.path,e),this._allKeysCache=null)}async _delete(e){await new Promise((r,n)=>{const c=this._store("readwrite").delete(e);c.onsuccess=()=>r(),c.onerror=()=>n(c.error)}),this.cacheEnabled&&(this.cache.delete(e),this._allKeysCache=null)}_allKeysCache=null;async _getAllKeys(){if(this.cacheEnabled&&this._allKeysCache)return this._allKeysCache;const e=await new Promise((r,n)=>{const c=this._store("readonly").getAllKeys();c.onsuccess=()=>r(c.result),c.onerror=()=>n(c.error)});return this.cacheEnabled&&(this._allKeysCache=e),e}clearCache(){this.cache.clear(),this._allKeysCache=null}resolvePath(e,r){let n;e.startsWith("/")?n=e:n=r==="/"?"/"+e:r+"/"+e;const c=n.split("/"),s=[];for(const h of c)h===""||h==="."||(h===".."?s.pop():s.push(h));return"/"+s.join("/")}async stat(e){const r=await this._get(e);if(!r)throw fsError("ENOENT",`ENOENT: no such file or directory, stat '${e}'`);return makeStat(r)}async lstat(e){return this.stat(e)}async exists(e){return!!await this._get(e)}async readFile(e,r){const n=await this._get(e);if(!n)throw fsError("ENOENT",`ENOENT: no such file or directory, open '${e}'`);if(n.type==="dir")throw fsError("EISDIR",`EISDIR: illegal operation on a directory, read '${e}'`);const c=n.content||new Uint8Array(0);return r==="utf8"?new TextDecoder().decode(c):c}async writeFile(e,r,n){const c=e.substring(0,e.lastIndexOf("/"))||"/",s=await this._get(c);if(!s)throw fsError("ENOENT",`ENOENT: no such file or directory, open '${e}'`);if(s.type!=="dir")throw fsError("ENOTDIR",`ENOTDIR: not a directory '${c}'`);const h=typeof r=="string"?new TextEncoder().encode(r):r,o=await this._get(e),a=Date.now();await this._put({path:e,type:"file",content:h,mode:n?.mode??o?.mode??420,mtime:a,ctime:o?.ctime??a,size:h.length})}async appendFile(e,r){let n;try{n=await this.readFile(e)}catch{n=new Uint8Array(0)}const c=typeof r=="string"?new TextEncoder().encode(r):r,s=new Uint8Array(n.length+c.length);s.set(n),s.set(c,n.length),await this.writeFile(e,s)}async mkdir(e,r){if(r?.recursive){const h=e.split("/").filter(Boolean);let o="";for(const a of h){o+="/"+a;const d=await this._get(o);if(!d)await this._put(this._makeNode(o,"dir"));else if(d.type!=="dir")throw fsError("ENOTDIR",`ENOTDIR: not a directory '${o}'`)}return}if(await this._get(e))throw fsError("EEXIST",`EEXIST: file already exists, mkdir '${e}'`);const c=e.substring(0,e.lastIndexOf("/"))||"/",s=await this._get(c);if(!s)throw fsError("ENOENT",`ENOENT: no such file or directory, mkdir '${e}'`);if(s.type!=="dir")throw fsError("ENOTDIR",`ENOTDIR: not a directory '${c}'`);await this._put(this._makeNode(e,"dir"))}async readdir(e){const r=await this._get(e);if(!r)throw fsError("ENOENT",`ENOENT: no such file or directory, readdir '${e}'`);if(r.type!=="dir")throw fsError("ENOTDIR",`ENOTDIR: not a directory '${e}'`);const n=await this._getAllKeys(),c=e==="/"?"/":e+"/",s=[];for(const h of n){if(h===e||!h.startsWith(c))continue;const o=h.slice(c.length);o.includes("/")||s.push(o)}return s.sort()}async unlink(e){const r=await this._get(e);if(!r)throw fsError("ENOENT",`ENOENT: no such file or directory, unlink '${e}'`);if(r.type==="dir")throw fsError("EISDIR",`EISDIR: illegal operation on a directory, unlink '${e}'`);await this._delete(e)}async rmdir(e){const r=await this._get(e);if(!r)throw fsError("ENOENT",`ENOENT: no such file or directory, rmdir '${e}'`);if(r.type!=="dir")throw fsError("ENOTDIR",`ENOTDIR: not a directory '${e}'`);if((await this.readdir(e)).length>0)throw fsError("ENOTEMPTY",`ENOTEMPTY: directory not empty, rmdir '${e}'`);await this._delete(e)}async rm(e,r){const n=await this._get(e);if(!n)throw fsError("ENOENT",`ENOENT: no such file or directory, rm '${e}'`);if(n.type==="dir"&&r?.recursive){const c=await this._getAllKeys(),s=e==="/"?"/":e+"/",h=c.filter(o=>o===e||o.startsWith(s));h.sort().reverse();for(const o of h)await this._delete(o)}else{if(n.type==="dir")throw fsError("EISDIR",`EISDIR: is a directory, rm '${e}'`);await this._delete(e)}}async rename(e,r){const n=await this._get(e);if(!n)throw fsError("ENOENT",`ENOENT: no such file or directory, rename '${e}'`);if(n.type==="dir"){const c=await this._getAllKeys(),s=e==="/"?"/":e+"/";for(const h of c)if(h===e||h.startsWith(s)){const o=await this._get(h);if(o){const a=r+h.slice(e.length);await this._put({...o,path:a}),await this._delete(h)}}}else await this._put({...n,path:r,mtime:Date.now()}),await this._delete(e)}async chmod(e,r){const n=await this._get(e);if(!n)throw fsError("ENOENT",`ENOENT: no such file or directory, chmod '${e}'`);await this._put({...n,mode:r})}async symlink(e,r){const n=r.substring(0,r.lastIndexOf("/"))||"/";if(!await this._get(n))throw fsError("ENOENT",`ENOENT: no such file or directory '${n}'`);const s=Date.now();await this._put({path:r,type:"symlink",content:new TextEncoder().encode(e),mode:40960,mtime:s,ctime:s,size:e.length,symlinkTarget:e})}async readlink(e){const r=await this._get(e);if(!r)throw fsError("ENOENT",`ENOENT: no such file or directory, readlink '${e}'`);if(r.type!=="symlink")throw fsError("EINVAL",`EINVAL: not a symlink '${e}'`);return r.symlinkTarget||new TextDecoder().decode(r.content)}async glob(e,r){const n=r||"/",c=await this._getAllKeys(),s=globPatternToRegex(e,n),h=[];for(const o of c){const a=await this._get(o);if(a&&a.type==="file"&&s.test(o))if(r&&o.startsWith(r)){const d=o.slice(r.length);h.push(d.startsWith("/")?d.slice(1):d)}else h.push(o)}return h.sort()}toIsomorphicGitFS(){const e=this,r=n=>n.includes("/.")||n.endsWith(".")?e.resolvePath(n,"/"):n;return{promises:{readFile:(n,c)=>c?.encoding==="utf8"||c==="utf8"?e.readFile(n,"utf8"):e.readFile(n),writeFile:(n,c,s)=>e.writeFile(n,c,typeof s=="object"?s:void 0),unlink:n=>e.unlink(n),readdir:n=>e.readdir(r(n)),mkdir:(n,c)=>e.mkdir(n,typeof c=="number"?void 0:c),rmdir:n=>e.rmdir(n),stat:async n=>{try{return await e.stat(r(n))}catch(c){throw c.code==="ENOENT"?c:fsError("ENOENT",`ENOENT: no such file or directory, stat '${n}'`)}},lstat:async n=>{try{return await e.lstat(r(n))}catch(c){throw c.code==="ENOENT"?c:fsError("ENOENT",`ENOENT: no such file or directory, lstat '${n}'`)}},rename:(n,c)=>e.rename(n,c),symlink:(n,c)=>e.symlink(n,c),readlink:n=>e.readlink(n),chmod:(n,c)=>e.chmod(n,c)}}}}class Shell{fs;cwd="/home/user";env={};history=[];commands;lastExitCode=0;functions={};backgroundJobs=new Map;nextJobId=1;terminal;constructor(e,r){this.fs=e,this.commands=r,this.env={HOME:"/home/user",USER:"user",SHELL:"/bin/sh",PATH:"/usr/bin:/bin",PWD:"/home/user",TERM:"xterm-256color"},this.loadHistory()}historyFile="/home/user/.bash_history";maxHistorySize=1e3;async loadHistory(){try{const e=await this.fs.readFile(this.historyFile),r=typeof e=="string"?e:new TextDecoder().decode(e);this.history=r.split(`
`).filter(n=>n.trim()),this.history.length>this.maxHistorySize&&(this.history=this.history.slice(-this.maxHistorySize))}catch{this.history=[]}}async saveHistory(){try{const e=this.history.slice(-this.maxHistorySize);await this.fs.writeFile(this.historyFile,e.join(`
`)+`
`)}catch{}}setTerminal(e){this.terminal=e}async exec(e){let r="",n="";const c=await this.execute(e,s=>{r+=s},s=>{n+=s});return{stdout:r,stderr:n,exitCode:c}}executeBackground(e,r,n){const c=this.nextJobId++,s=n||r,h={id:c,command:e,status:"running",exitCode:0,promise:this.execute(e,()=>{},s).then(o=>(h.status=o===0?"done":"failed",h.exitCode=o,o),o=>(h.status="failed",h.exitCode=1,1))};return this.backgroundJobs.set(c,h),r(`[${c}] started
`),0}async execute(e,r,n){const c=e.trim();if(!c||c.startsWith("#"))return 0;if(c.endsWith("&")&&!c.endsWith("&&")){const p=c.slice(0,-1).trim();if(p)return this.executeBackground(p,r,n)}const s=this.parseHeredoc(c),h=s?s.command:c,o=s?s.body:"";this.history.push(c),this.saveHistory();const a=n||r,d=this.parseFunctionDef(h);if(d)return this.functions[d.name]={body:d.body},0;if(this.isControlStructure(h))return this.execControlStructure(h,r,a);const l=this.parseCompound(h);let f=0;for(const p of l){if(p.operator==="&&"&&f!==0||p.operator==="||"&&f===0)continue;let S=this.expandArithmetic(p.command);S=await this.expandCommandSubstitution(S,a),S=this.expandVars(S);const k=this.parsePipeline(S);let A="";f=0;for(let w=0;w<k.length;w++){const v=k[w],{args:g,redirects:m}=this.parseSegment(v);if(g.length===0)continue;const $=g[0],I=g.slice(1),B=$==="."?"source":$;if(B.includes("=")&&!B.startsWith("=")){const Y=$.indexOf("="),ve=$.substring(0,Y),Be=$.substring(Y+1);this.env[ve]=Be,ve==="PWD"&&(this.cwd=Be);continue}let P=w>0?A:"";for(const Y of m)if(Y.type==="<"){if(Y.target==="/dev/null"){P="";continue}const ve=this.fs.resolvePath(Y.target,this.cwd);try{P=await this.fs.readFile(ve,"utf8")}catch(Be){a(`shiro: ${Y.target}: ${Be.message}\r
`),f=1;break}}if(f!==0&&w===0)break;o&&w===0&&!P&&(P=o);const x={args:I,fs:this.fs,cwd:this.cwd,env:this.env,stdin:P,stdout:"",stderr:"",shell:this,terminal:this.terminal};if(this.functions[B]){f=await this.execFunction(B,I,r,a),this.lastExitCode=f,this.env["?"]=String(f),A="";continue}const N=this.commands.get(B);if(N)try{f=await N.exec(x)}catch(Y){x.stderr+=Y.message+`
`,f=1}else{const Y=await this.findExecutableInPath(B);if(Y)try{f=await this.executeScript(Y,I,x,r,a)}catch(ve){x.stderr+=ve.message+`
`,f=1}else{a(`shiro: command not found: ${B}\r
`),f=127,this.lastExitCode=f,this.env["?"]=String(f);break}}const J=m.some(Y=>Y.type==="2>&1");let Q=x.stderr;for(const Y of m)if(Y.type==="2>"||Y.type==="2>>"){if(Y.target==="/dev/null"){Q="";continue}const ve=this.fs.resolvePath(Y.target,this.cwd);Y.type==="2>"?await this.fs.writeFile(ve,Q):await this.fs.appendFile(ve,Q),Q=""}let W=x.stdout;J&&Q&&(W+=Q,Q=""),Q&&a(Q.replace(/\n/g,`\r
`));for(const Y of m)if(Y.type===">"||Y.type===">>"){if(Y.target==="/dev/null"){W="";continue}const ve=this.fs.resolvePath(Y.target,this.cwd);Y.type===">"?await this.fs.writeFile(ve,W):await this.fs.appendFile(ve,W),W=""}w===k.length-1&&W&&r(W.replace(/\n/g,`\r
`)),A=W,this.cwd=this.env.PWD||this.cwd}this.lastExitCode=f,this.env["?"]=String(f)}return f}expandVars(e){let r=e.replace(/\$\?/g,String(this.lastExitCode));return r=r.replace(/\$\{([A-Za-z_][A-Za-z0-9_]*)\}/g,(n,c)=>this.env[c]??""),r=r.replace(/\$([A-Za-z_][A-Za-z0-9_]*)/g,(n,c)=>this.env[c]??""),r}parseHeredoc(e){const r=e.split(/\r?\n/);if(r.length<2)return null;const n=r[0].match(/<<-?\s*(?:'([^']+)'|"([^"]+)"|(\S+))/);if(!n)return null;const c=n[1]||n[2]||n[3],s=!!(n[1]||n[2]),h=r[0].match(/<<-/)!==null,o=r[0].replace(/<<-?\s*(?:'[^']+'|"[^"]+"|(\S+))/,"").trim(),a=[];let d=!1;for(let f=1;f<r.length;f++){const p=h?r[f].replace(/^\t+/,""):r[f];if(p.trim()===c){d=!0;break}a.push(p)}if(!d)return null;let l=a.join(`
`);return s||(l=this.expandVars(l)),l+=`
`,{command:o,body:l}}parseCompound(e){const r=[];let n="",c=!1,s=!1,h="",o=0;for(;o<e.length;){const a=e[o];if(a==="\\"&&!c&&o+1<e.length){n+=a+e[o+1],o+=2;continue}if(a==="'"&&!s){c=!c,n+=a,o++;continue}if(a==='"'&&!c){s=!s,n+=a,o++;continue}if(!c&&!s){if(a==="&"&&e[o+1]==="&"){n.trim()&&r.push({operator:h,command:n.trim()}),h="&&",n="",o+=2;continue}if(a==="|"&&e[o+1]==="|"){n.trim()&&r.push({operator:h,command:n.trim()}),h="||",n="",o+=2;continue}if(a===";"){n.trim()&&r.push({operator:h,command:n.trim()}),h=";",n="",o++;continue}}n+=a,o++}return n.trim()&&r.push({operator:h,command:n.trim()}),r}parsePipeline(e){const r=[];let n="",c=!1,s=!1;for(let h=0;h<e.length;h++){const o=e[h];if(o==="'"&&!s){c=!c,n+=o;continue}if(o==='"'&&!c){s=!s,n+=o;continue}if(o==="|"&&e[h+1]!=="|"&&!c&&!s){r.push(n),n="";continue}n+=o}return r.push(n),r}parseSegment(e){const r=this.tokenize(e),n=[],c=[];for(let s=0;s<r.length;s++)r[s]==="2>&1"?c.push({type:"2>&1",target:""}):(r[s]===">"||r[s]===">>"||r[s]==="<"||r[s]==="2>"||r[s]==="2>>")&&s+1<r.length?(c.push({type:r[s],target:r[s+1]}),s++):n.push(r[s]);return{args:n,redirects:c}}tokenize(e){const r=[];let n="",c=!1,s=!1,h=0;for(;h<e.length;){const o=e[h];if(o==="\\"&&!c&&h+1<e.length){n+=e[h+1],h+=2;continue}if(o==="'"&&!s){c=!c,h++;continue}if(o==='"'&&!c){s=!s,h++;continue}if((o===" "||o==="	")&&!c&&!s){n&&(r.push(n),n=""),h++;continue}if(o==="2"&&!c&&!s&&e[h+1]===">"){n&&(r.push(n),n=""),e[h+2]==="&"&&e[h+3]==="1"?(r.push("2>&1"),h+=4):e[h+2]===">"?(r.push("2>>"),h+=3):(r.push("2>"),h+=2);continue}if(o===">"&&!c&&!s){n&&(r.push(n),n=""),e[h+1]===">"?(r.push(">>"),h+=2):(r.push(">"),h++);continue}if(o==="<"&&!c&&!s){n&&(r.push(n),n=""),r.push("<"),h++;continue}n+=o,h++}return n&&r.push(n),r}async expandCommandSubstitution(e,r){const n=[];let c=0;for(;c<e.length;)if(e[c]==="$"&&e[c+1]==="("&&e[c+2]==="(")n.push(e[c]),c++;else if(e[c]==="$"&&e[c+1]==="("){let s=1,h=c+2;for(;h<e.length&&s>0;)e[h]==="("&&s++,e[h]===")"&&s--,h++;const o=e.slice(c+2,h-1),a=await this.exec(o);a.stderr&&r(a.stderr),n.push(a.stdout.replace(/[\r\n]+$/,"")),c=h}else if(e[c]==="`"){let s=e.indexOf("`",c+1);if(s===-1){n.push(e.slice(c));break}const h=e.slice(c+1,s),o=await this.exec(h);o.stderr&&r(o.stderr),n.push(o.stdout.replace(/[\r\n]+$/,"")),c=s+1}else n.push(e[c]),c++;return n.join("")}expandArithmetic(e){let r="",n=0;for(;n<e.length;)if(e[n]==="$"&&e[n+1]==="("&&e[n+2]==="("){let c=1,s=n+3;for(;s<e.length-1&&c>0;){if(e[s]==="("&&e[s+1]==="("){c++,s+=2;continue}if(e[s]===")"&&e[s+1]===")"){if(c--,c===0)break;s+=2;continue}s++}const h=e.slice(n+3,s);r+=String(this.evalArithmetic(h)),n=s+2}else r+=e[n],n++;return r}evalArithmetic(e){let r=e.replace(/\$\{?([A-Za-z_]\w*)\}?/g,(n,c)=>this.env[c]||"0");r=r.replace(/\b([A-Za-z_]\w*)\b/g,n=>/^\d+$/.test(n)?n:this.env[n]||"0");try{return this.safeArithEval(r.trim())}catch{return 0}}safeArithEval(e){const r=[];let n=0;for(;n<e.length;){if(/\s/.test(e[n])){n++;continue}if(/\d/.test(e[n])){let k="";for(;n<e.length&&/\d/.test(e[n]);)k+=e[n],n++;r.push({type:"num",value:parseInt(k)});continue}if(e[n]==="-"&&(r.length===0||r[r.length-1].type==="op"||r[r.length-1].value==="(")){let k="-";for(n++;n<e.length&&/\d/.test(e[n]);)k+=e[n],n++;r.push({type:"num",value:parseInt(k)});continue}const p=["**","<=",">=","==","!="];let S=!1;for(const k of p)if(e.slice(n,n+k.length)===k){r.push({type:"op",value:k}),n+=k.length,S=!0;break}if(!S){if("+-*/%<>".includes(e[n])){r.push({type:"op",value:e[n]}),n++;continue}if(e[n]==="("){r.push({type:"paren",value:"("}),n++;continue}if(e[n]===")"){r.push({type:"paren",value:")"}),n++;continue}n++}}let c=0;const s=()=>r[c],h=()=>r[c++],o=()=>{const p=s();if(!p)return 0;if(p.type==="num")return h(),p.value;if(p.value==="("){h();const S=f();return h(),S}return 0},a=()=>{let p=o();for(;s()&&s().value==="**";)h(),p=Math.pow(p,o());return p},d=()=>{let p=a();for(;s()&&["*","/","%"].includes(s().value);){const S=h().value,k=a();S==="*"?p*=k:S==="/"?p=k===0?0:Math.trunc(p/k):p=k===0?0:p%k}return p},l=()=>{let p=d();for(;s()&&["+","-"].includes(s().value);)p=h().value==="+"?p+d():p-d();return p},f=()=>{let p=l();for(;s()&&["<",">","<=",">=","==","!="].includes(s().value);){const S=h().value,k=l();S==="<"?p=p<k?1:0:S===">"?p=p>k?1:0:S==="<="?p=p<=k?1:0:S===">="?p=p>=k?1:0:S==="=="?p=p===k?1:0:S==="!="&&(p=p!==k?1:0)}return p};return f()}parseFunctionDef(e){let r=e.match(/^(\w+)\s*\(\)\s*\{([\s\S]*)\}$/);return r||(r=e.match(/^function\s+(\w+)\s*(?:\(\))?\s*\{([\s\S]*)\}$/)),r?{name:r[1],body:r[2].trim()}:null}async execFunction(e,r,n,c){const s=this.functions[e];if(!s)return 127;const h={};for(let d=0;d<=r.length;d++)h[String(d)]=this.env[String(d)];h["#"]=this.env["#"],h["@"]=this.env["@"],this.env[0]=e;for(let d=0;d<r.length;d++)this.env[String(d+1)]=r[d];this.env["#"]=String(r.length),this.env["@"]=r.join(" ");let o=0;const a=s.body.split(/\n|;/).map(d=>d.trim()).filter(d=>d&&!d.startsWith("#"));for(const d of a){if(d==="return"||d.startsWith("return ")){const l=d.match(/^return\s+(\d+)?/);o=l?.[1]?parseInt(l[1]):this.lastExitCode;break}o=await this.execute(d,n,c)}for(const d of Object.keys(h))h[d]===void 0?delete this.env[d]:this.env[d]=h[d];return o}isControlStructure(e){return/^if\s+/.test(e)||/^while\s+/.test(e)||/^for\s+/.test(e)||/^case\s+/.test(e)}async execControlStructure(e,r,n){return/^if\s+/.test(e)?this.execIf(e,r,n):/^while\s+/.test(e)?this.execWhile(e,r,n):/^for\s+/.test(e)?this.execFor(e,r,n):/^case\s+/.test(e)?this.execCase(e,r,n):0}async evalCondition(e,r,n){const c=e.trim();if(c.startsWith("[")&&c.endsWith("]"))return this.evalTest(c.slice(1,-1).trim());if(c.startsWith("test "))return this.evalTest(c.slice(5));const s=await this.exec(c);return s.stderr&&n(s.stderr),s.stdout&&r(s.stdout),s.exitCode}async evalTest(e){const r=e.split(/\s+/);if(r.length===0)return 1;if(r.length===2){const[n,c]=r,s=this.expandVars(c);switch(n){case"-z":return s===""?0:1;case"-n":return s!==""?0:1;case"-e":case"-r":case"-w":case"-x":try{return await this.fs.stat(this.fs.resolvePath(s,this.cwd)),0}catch{return 1}case"-f":try{return(await this.fs.stat(this.fs.resolvePath(s,this.cwd))).type==="file"?0:1}catch{return 1}case"-d":try{return(await this.fs.stat(this.fs.resolvePath(s,this.cwd))).type==="dir"?0:1}catch{return 1}case"!":return await this.evalTest(r.slice(1).join(" "))===0?1:0}}if(r.length===3){const n=this.expandVars(r[0]),c=r[1],s=this.expandVars(r[2]);switch(c){case"=":case"==":return n===s?0:1;case"!=":return n!==s?0:1;case"-eq":return parseInt(n)===parseInt(s)?0:1;case"-ne":return parseInt(n)!==parseInt(s)?0:1;case"-lt":return parseInt(n)<parseInt(s)?0:1;case"-le":return parseInt(n)<=parseInt(s)?0:1;case"-gt":return parseInt(n)>parseInt(s)?0:1;case"-ge":return parseInt(n)>=parseInt(s)?0:1}}return e.trim()!==""?0:1}async execIf(e,r,n){const c=e.split(/\r?\n/).map(l=>l.trim()).filter(l=>l&&!l.startsWith("#"));if(c.length===1){const l=c[0].match(/^if\s+(.+?);\s*then\s+(.+?)(?:;\s*else\s+(.+?))?;\s*fi$/);if(l)return await this.evalCondition(l[1],r,n)===0?this.execute(l[2],r,n):l[3]?this.execute(l[3],r,n):0}const s=c[0].match(/^if\s+(.+?)(?:;\s*then)?$/);if(!s)return n(`if: syntax error\r
`),1;let h=-1,o=-1,a=-1;for(let l=0;l<c.length;l++){const f=c[l];f==="then"||f.endsWith("; then")?h=l:f==="else"?o=l:f==="fi"&&(a=l)}if(await this.evalCondition(s[1],r,n)===0){const l=h+1,f=o>=0?o:a,p=c.slice(l,f).join(`
`);return p.trim()?this.execute(p,r,n):0}else if(o>=0){const l=c.slice(o+1,a).join(`
`);return l.trim()?this.execute(l,r,n):0}return 0}async execWhile(e,r,n){const c=e.split(/\r?\n/).map(l=>l.trim()).filter(l=>l&&!l.startsWith("#"));if(c.length===1){const l=c[0].match(/^while\s+(.+?);\s*do\s+(.+?);\s*done$/);if(l){let f=0;for(;f++<1e4&&await this.evalCondition(l[1],r,n)===0;)await this.execute(l[2],r,n);return 0}}const s=c[0].match(/^while\s+(.+?)(?:;\s*do)?$/);if(!s)return n(`while: syntax error\r
`),1;let h=-1,o=-1;for(let l=0;l<c.length;l++)(c[l]==="do"||c[l].endsWith("; do"))&&(h=l),c[l]==="done"&&(o=l);const a=c.slice((h>=0?h:0)+1,o>=0?o:c.length).join(`
`);let d=0;for(;d++<1e4&&await this.evalCondition(s[1],r,n)===0;)a.trim()&&await this.execute(a,r,n);return 0}async execFor(e,r,n){const c=e.split(/\r?\n/).map(l=>l.trim()).filter(l=>l&&!l.startsWith("#"));if(c.length===1){const l=c[0].match(/^for\s+(\w+)\s+in\s+(.+?);\s*do\s+(.+?);\s*done$/);if(l){const f=this.expandVars(l[2]).split(/\s+/).filter(Boolean);for(const p of f)this.env[l[1]]=p,await this.execute(l[3],r,n);return 0}}const s=c[0].match(/^for\s+(\w+)\s+in\s+(.+?)(?:;\s*do)?$/);if(!s)return n(`for: syntax error\r
`),1;let h=-1,o=-1;for(let l=0;l<c.length;l++)(c[l]==="do"||c[l].endsWith("; do"))&&(h=l),c[l]==="done"&&(o=l);const a=c.slice((h>=0?h:0)+1,o>=0?o:c.length).join(`
`),d=this.expandVars(s[2]).split(/\s+/).filter(Boolean);for(const l of d)this.env[s[1]]=l,a.trim()&&await this.execute(a,r,n);return 0}async execCase(e,r,n){const c=e.split(/\r?\n/).map(a=>a.trim()).filter(a=>a&&!a.startsWith("#")),s=c[0].match(/^case\s+(.+?)\s+in$/);if(!s)return n(`case: syntax error\r
`),1;const h=this.expandVars(s[1]);let o=c.findIndex(a=>a==="esac");o<0&&(o=c.length);for(let a=1;a<o;a++){const d=c[a].match(/^(.+?)\s*\)/);if(d){const l=d[1].split("|").map(p=>p.trim());let f=!1;for(const p of l){if(p==="*"||h===p){f=!0;break}if(new RegExp("^"+p.replace(/\*/g,".*").replace(/\?/g,".")+"$").test(h)){f=!0;break}}if(f){const p=[];for(a++;a<o&&!c[a].endsWith(";;");)p.push(c[a]),a++;if(a<o&&c[a].endsWith(";;")){const S=c[a].replace(/;;\s*$/,"").trim();S&&p.push(S)}return p.length>0?this.execute(p.join(`
`),r,n):0}}}return 0}async findExecutableInPath(e){if(e.includes("/")){const s=this.fs.resolvePath(e,this.cwd);try{if((await this.fs.stat(s)).type==="file")return s}catch{return null}return null}const r=[];let n=this.cwd;for(;n!=="/";){r.push(`${n}/node_modules/.bin`);const s=n.substring(0,n.lastIndexOf("/"))||"/";if(s===n)break;n=s}r.push("/node_modules/.bin");const c=this.env.PATH||"";c&&r.push(...c.split(":").filter(Boolean));for(const s of r){const h=`${s}/${e}`;try{const o=await this.fs.stat(h);if(o.type==="file"||o.type==="symlink")return h}catch{}}return null}async executeScript(e,r,n,c,s){let h=e;try{if((await this.fs.stat(e)).type==="symlink"){const l=await this.fs.readlink(e);if(l.startsWith("/"))h=l;else{const f=e.substring(0,e.lastIndexOf("/"))||"/";h=this.fs.resolvePath(l,f)}}}catch(d){return s(`shiro: ${e}: ${d.message}\r
`),1}let o;try{o=await this.fs.readFile(h,"utf8")}catch(d){return s(`shiro: ${h}: ${d.message}\r
`),1}const a=o.split(`
`)[0];if(a.startsWith("#!")){const d=a.substring(2).trim(),[l,...f]=d.split(/\s+/);if(l==="/usr/bin/env"||l==="/bin/env"){const p=f[0];return p==="node"||p==="nodejs"?this.executeNodeScript(h,o,r,n,c,s):p==="sh"||p==="bash"?this.executeShellScript(o,r,n,c,s):(s(`shiro: cannot execute ${p} scripts\r
`),126)}else{if(l.endsWith("/node")||l.endsWith("/nodejs"))return this.executeNodeScript(h,o,r,n,c,s);if(l.endsWith("/sh")||l.endsWith("/bash"))return this.executeShellScript(o,r,n,c,s)}return s(`shiro: cannot execute ${l} scripts\r
`),126}return h.endsWith(".js")||h.endsWith(".mjs")||o.trimStart().startsWith("const ")||o.trimStart().startsWith("import ")||o.trimStart().startsWith("var ")||o.trimStart().startsWith("let ")?this.executeNodeScript(h,o,r,n,c,s):this.executeShellScript(o,r,n,c,s)}async executeNodeScript(e,r,n,c,s,h){const o=this.commands.get("node");if(!o)return h(`shiro: node command not available\r
`),127;const a={args:[e,...n],fs:c.fs,cwd:c.cwd,env:c.env,stdin:c.stdin,stdout:"",stderr:"",shell:c.shell,terminal:c.terminal},d=await o.exec(a);return a.stdout&&s(a.stdout.replace(/\n/g,`\r
`)),a.stderr&&h(a.stderr.replace(/\n/g,`\r
`)),d}async executeShellScript(e,r,n,c,s){const h={};for(let d=0;d<=r.length;d++)h[String(d)]=this.env[String(d)];h["#"]=this.env["#"],h["@"]=this.env["@"];for(let d=0;d<r.length;d++)this.env[String(d+1)]=r[d];this.env["#"]=String(r.length),this.env["@"]=r.join(" ");const o=e.split(`
`);let a=0;for(const d of o){const l=d.trim();!l||l.startsWith("#")||(a=await this.execute(l,c,s))}for(const d of Object.keys(h))h[d]===void 0?delete this.env[d]:this.env[d]=h[d];return a}}class CommandRegistry{commands=new Map;register(e){this.commands.set(e.name,e)}registerAll(e){for(const r of e)this.register(r)}get(e){return this.commands.get(e)}list(){return Array.from(this.commands.values())}}class ModuleRegistry{modules=new Map;listeners=[];register(e,r,n){if(this.modules.has(e))throw new Error(`Module '${e}' already registered. Use replace() to update.`);const c={module:r,metadata:{version:1,registeredAt:Date.now(),lastUpdatedAt:Date.now(),source:n}};this.modules.set(e,c),this.notifyListeners(e,r,null)}get(e){return this.modules.get(e)?.module}require(e){const r=this.get(e);if(r===void 0)throw new Error(`Module '${e}' not found in registry`);return r}has(e){return this.modules.has(e)}replace(e,r,n){const c=this.modules.get(e),s=c?.module;let h=!1,o;if(r.migrateFrom&&s)try{r.migrateFrom(s),h=!0,console.log(`[Registry] Migrated state for '${e}'`)}catch(d){o=d instanceof Error?d:new Error(String(d)),console.warn(`[Registry] Migration failed for '${e}':`,o.message)}const a={module:r,metadata:{version:(c?.metadata.version??0)+1,registeredAt:c?.metadata.registeredAt??Date.now(),lastUpdatedAt:Date.now(),source:n}};return this.modules.set(e,a),this.notifyListeners(e,r,s??null),{migrated:h,error:o}}unregister(e){const r=this.modules.has(e);if(r){const n=this.modules.get(e);this.modules.delete(e),this.notifyListeners(e,null,n?.module??null)}return r}list(){return Array.from(this.modules.keys())}getMetadata(e){return this.modules.get(e)?.metadata}subscribe(e){return this.listeners.push(e),()=>{const r=this.listeners.indexOf(e);r!==-1&&this.listeners.splice(r,1)}}snapshot(){return new Map(this.modules)}notifyListeners(e,r,n){for(const c of this.listeners)try{c(e,r,n)}catch(s){console.error(`[Registry] Listener error for '${e}':`,s)}}}const registry=new ModuleRegistry,grepCmd={name:"grep",description:"Search for patterns in files",async exec(t){let e=!1,r=!1,n=!1,c=!1,s=!1,h=!1,o="";const a=[];let d=0;for(;d<t.args.length;){const A=t.args[d];if(A==="-i")e=!0;else if(A==="-v")r=!0;else if(A==="-n")n=!0;else if(A==="-c")c=!0;else if(A==="-l")s=!0;else if(A==="-r"||A==="-R")h=!0;else if(A==="-e"&&d+1<t.args.length)o=t.args[++d];else if(A.startsWith("-")&&A.length>1)for(const w of A.slice(1))w==="i"?e=!0:w==="v"?r=!0:w==="n"?n=!0:w==="c"?c=!0:w==="l"?s=!0:(w==="r"||w==="R")&&(h=!0);else o?a.push(A):o=A;d++}if(!o)return t.stderr=`grep: missing pattern
`,2;const l=e?"i":"";let f;try{f=new RegExp(o,l)}catch{return t.stderr=`grep: invalid pattern '${o}'
`,2}let p=!1;const S=async(A,w,v)=>{let g;try{g=await t.fs.readFile(A,"utf8")}catch{t.stderr+=`grep: ${w}: No such file or directory
`;return}const m=g.split(`
`);let $=0;for(let I=0;I<m.length;I++)if(f.test(m[I])!==r){if(p=!0,$++,s){t.stdout+=w+`
`;return}if(!c){const P=v?w+":":"",x=n?I+1+":":"";t.stdout+=P+x+m[I]+`
`}}if(c){const I=v?w+":":"";t.stdout+=I+$+`
`}},k=async A=>{const w=await t.fs.readdir(A);for(const v of w){const g=A==="/"?"/"+v:A+"/"+v;(await t.fs.stat(g)).isDirectory()?await k(g):await S(g,g,!0)}};if(a.length===0&&!h){const A=t.stdin.split(`
`);let w=0;for(let v=0;v<A.length;v++)if(f.test(A[v])!==r&&(p=!0,w++,!c)){const m=n?v+1+":":"";t.stdout+=m+A[v]+`
`}c&&(t.stdout+=w+`
`)}else if(h&&a.length===0)await k(t.cwd);else{const A=a.length>1||h;for(const w of a){const v=t.fs.resolvePath(w,t.cwd),g=await t.fs.stat(v).catch(()=>null);g?.isDirectory()&&h?await k(v):g?.isDirectory()?t.stderr+=`grep: ${w}: Is a directory
`:await S(v,w,A)}}return p?0:1}},sedCmd={name:"sed",description:"Stream editor for filtering and transforming text",async exec(t){let e=!1,r="";const n=[];let c=0;for(;c<t.args.length;){const o=t.args[c];o==="-i"?e=!0:o==="-e"&&c+1<t.args.length?r=t.args[++c]:r?n.push(o):r=o,c++}if(!r)return t.stderr=`sed: no expression provided
`,1;const s=parseSedExpression(r),h=o=>{const a=o.split(`
`),d=[];for(const l of a){let f=l,p=!1;for(const S of s)S.type==="s"?f=f.replace(S.regex,S.replacement):S.type==="d"&&(S.address?S.address instanceof RegExp&&S.address.test(f)?p=!0:S.address:p=!0);p||d.push(f)}return d.join(`
`)};if(n.length===0)return t.stdout=h(t.stdin),0;for(const o of n){const a=t.fs.resolvePath(o,t.cwd);try{const d=await t.fs.readFile(a,"utf8"),l=h(d);e?await t.fs.writeFile(a,l):t.stdout+=l}catch(d){return t.stderr+=`sed: ${o}: ${d.message}
`,1}}return 0}};function parseSedExpression(t){const e=[],r=t.match(/^s(.)(.+?)\1(.*?)\1([gimsy]*)$/);if(r){const[,,c,s,h]=r,o=h.includes("g")?"g":"",a=h.includes("i")?"i":"";return e.push({type:"s",regex:new RegExp(c,o+a),replacement:s.replace(/\\n/g,`
`).replace(/\\t/g,"	")}),e}if(t==="d")return e.push({type:"d"}),e;const n=t.match(/^\/(.*?)\/d$/);return n?(e.push({type:"d",address:new RegExp(n[1])}),e):(e.push({type:"noop"}),e)}const diffCmd={name:"diff",description:"Compare files line by line",async exec(t){let e=!1;const r=[];for(const l of t.args)l==="-u"||l==="--unified"?e=!0:r.push(l);if(r.length<2)return t.stderr=`diff: missing operand
`,2;const n=t.fs.resolvePath(r[0],t.cwd),c=t.fs.resolvePath(r[1],t.cwd);let s,h;try{s=await t.fs.readFile(n,"utf8")}catch{return t.stderr=`diff: ${r[0]}: No such file or directory
`,2}try{h=await t.fs.readFile(c,"utf8")}catch{return t.stderr=`diff: ${r[1]}: No such file or directory
`,2}if(s===h)return 0;const o=s.split(`
`),a=h.split(`
`);e&&(t.stdout+=`--- ${r[0]}
`,t.stdout+=`+++ ${r[1]}
`);const d=computeDiff$1(o,a);if(e)for(const l of d){t.stdout+=`@@ -${l.startA+1},${l.countA} +${l.startB+1},${l.countB} @@
`;for(const f of l.lines)t.stdout+=f+`
`}else for(const l of d){const f=l.countA===1?`${l.startA+1}`:`${l.startA+1},${l.startA+l.countA}`,p=l.countB===1?`${l.startB+1}`:`${l.startB+1},${l.startB+l.countB}`;l.countA===0?t.stdout+=`${l.startA}a${p}
`:l.countB===0?t.stdout+=`${f}d${l.startB}
`:t.stdout+=`${f}c${p}
`;for(const S of l.lines)S.startsWith("-")||S.startsWith("<")?t.stdout+=`< ${S.slice(1)}
`:S.startsWith("+")||S.startsWith(">")?t.stdout+=`> ${S.slice(1)}
`:S==="---"&&(t.stdout+=`---
`)}return 1}};function computeDiff$1(t,e){const r=t.length,n=e.length,c=computeLCS(t,e),s=[];let h=0,o=0,a=0,d=null;const l=()=>{d&&d.lines.length>0&&s.push(d),d=null};for(;h<r||o<n;)if(a<c.length&&h===c[a].ai&&o===c[a].bi)l(),h++,o++,a++;else if(a<c.length){for(d||(d={startA:h,countA:0,startB:o,countB:0,lines:[]});h<c[a].ai;)d.lines.push("-"+t[h]),d.countA++,h++;for(;o<c[a].bi;)d.lines.push("+"+e[o]),d.countB++,o++}else{for(d||(d={startA:h,countA:0,startB:o,countB:0,lines:[]});h<r;)d.lines.push("-"+t[h]),d.countA++,h++;for(;o<n;)d.lines.push("+"+e[o]),d.countB++,o++}return l(),s}function computeLCS(t,e){const r=t.length,n=e.length,c=Array.from({length:r+1},()=>Array(n+1).fill(0));for(let a=1;a<=r;a++)for(let d=1;d<=n;d++)t[a-1]===e[d-1]?c[a][d]=c[a-1][d-1]+1:c[a][d]=Math.max(c[a-1][d],c[a][d-1]);const s=[];let h=r,o=n;for(;h>0&&o>0;)t[h-1]===e[o-1]?(s.unshift({ai:h-1,bi:o-1}),h--,o--):c[h-1][o]>c[h][o-1]?h--:o--;return s}const cdCmd={name:"cd",description:"Change directory",async exec(t){const e=t.args[0]||t.env.HOME||"/",r=t.fs.resolvePath(e==="~"?t.env.HOME||"/":e,t.cwd),n=await t.fs.stat(r).catch(()=>null);return n?n.isDirectory()?(t.shell.cwd=r,t.shell.env.PWD=r,0):(t.stderr=`cd: not a directory: ${e}
`,1):(t.stderr=`cd: no such file or directory: ${e}
`,1)}},exportCmd$1={name:"export",description:"Set environment variables",async exec(t){for(const e of t.args){const r=e.indexOf("=");if(r===-1)continue;const n=e.substring(0,r),c=e.substring(r+1);t.shell.env[n]=c}return 0}},helpCmd={name:"help",description:"Show available commands",async exec(t){t.stdout=`shiro - available commands:

`;const e=t.shell.commands.list(),r=10;for(const n of e.sort((c,s)=>c.name.localeCompare(s.name)))n.name.length>r?(t.stdout+=` ${n.name}
`,t.stdout+=`${"".padEnd(r+5)}${n.description}
`):t.stdout+=` ${n.name.padEnd(r+4)}${n.description}
`;return t.stdout+=`
`,0}},whichCmd={name:"which",description:"Locate a command",async exec(t){return t.args.length===0?(t.stderr=`which: missing argument
`,1):t.shell.commands.get(t.args[0])?(t.stdout=`${t.args[0]}: shell built-in
`,0):(t.stderr=`which: no ${t.args[0]} in (built-in commands)
`,1)}},xargsCmd={name:"xargs",description:"Build and execute command lines from stdin",async exec(t){const e=t.args[0]||"echo",r=t.args.slice(1),n=t.stdin.split(/\s+/).filter(Boolean),c=t.shell.commands.get(e);if(!c)return t.stderr=`xargs: ${e}: command not found
`,127;const s={...t,args:[...r,...n],stdin:"",stdout:"",stderr:""},h=await c.exec(s);return t.stdout=s.stdout,t.stderr=s.stderr,h}},rmdirCmd={name:"rmdir",description:"Remove empty directories",async exec(t){for(const e of t.args){const r=t.fs.resolvePath(e,t.cwd);try{await t.fs.rmdir(r)}catch(n){return t.stderr+=`rmdir: ${n.message}
`,1}}return 0}},sleepCmd={name:"sleep",description:"Delay for a specified time",async exec(t){const e=parseFloat(t.args[0]||"0");return isNaN(e)||e<0?(t.stderr=`sleep: invalid time interval '${t.args[0]}'
`,1):(await new Promise(r=>setTimeout(r,e*1e3)),0)}},seqCmd={name:"seq",description:"Print a sequence of numbers",async exec(t){let e=1,r=1,n=1;if(t.args.length===1?n=parseInt(t.args[0]):t.args.length===2?(e=parseInt(t.args[0]),n=parseInt(t.args[1])):t.args.length>=3&&(e=parseInt(t.args[0]),r=parseInt(t.args[1]),n=parseInt(t.args[2])),r===0)return t.stderr=`seq: zero increment
`,1;const c=[];if(r>0)for(let s=e;s<=n;s+=r)c.push(String(s));else for(let s=e;s>=n;s+=r)c.push(String(s));return t.stdout=c.join(`
`)+`
`,0}},rmCmd={name:"rm",description:"Remove files or directories",async exec(t){let e=!1,r=!1;const n=[];for(const c of t.args)c.startsWith("-")?((c.includes("r")||c.includes("R"))&&(e=!0),c.includes("f")&&(r=!0)):n.push(c);for(const c of n){const s=t.fs.resolvePath(c,t.cwd);try{await t.fs.rm(s,{recursive:e})}catch(h){if(!r)return t.stderr+=`rm: ${h.message}
`,1}}return 0}},findCmd={name:"find",description:"Search for files in a directory hierarchy",async exec(t){let e="",r="",n=1/0;const c=[];for(let h=0;h<t.args.length;h++)t.args[h]==="-name"&&t.args[h+1]?e=t.args[++h]:t.args[h]==="-type"&&t.args[h+1]?r=t.args[++h]:t.args[h]==="-maxdepth"&&t.args[h+1]?n=parseInt(t.args[++h]):t.args[h].startsWith("-")||c.push(t.args[h]);c.length===0&&c.push(".");const s=e?globToRegex(e):null;for(const h of c){const o=t.fs.resolvePath(h,t.cwd);await walkFind(t,o,h,s,r,0,n)}return 0}};function globToRegex(t){const e=t.replace(/[.+^${}()|[\]\\]/g,"\\$&").replace(/\*/g,".*").replace(/\?/g,".");return new RegExp(`^${e}$`)}async function walkFind(t,e,r,n,c,s,h){if(s>h)return;let o;try{o=await t.fs.readdir(e)}catch{return}for(const a of o){const d=e==="/"?"/"+a:e+"/"+a,l=r+"/"+a,f=await t.fs.stat(d).catch(()=>null);if(!f)continue;const p=f.isDirectory();let S=!0;n&&!n.test(a)&&(S=!1),c==="f"&&p&&(S=!1),c==="d"&&!p&&(S=!1),S&&(t.stdout+=l+`
`),p&&await walkFind(t,d,l,n,c,s+1,h)}}const lnCmd={name:"ln",description:"Create links between files",async exec(t){let e=!1;const r=[];for(const s of t.args)s==="-s"?e=!0:r.push(s);if(r.length<2)return t.stderr=`ln: missing file operand
`,1;if(!e)return t.stderr=`ln: hard links not supported, use -s for symbolic
`,1;const n=r[0],c=t.fs.resolvePath(r[1],t.cwd);try{return await t.fs.symlink(n,c),0}catch(s){return t.stderr=`ln: ${s.message}
`,1}}},hostnameCmd={name:"hostname",description:"Show system hostname",async exec(t){return t.stdout=`shiro
`,0}},unameCmd={name:"uname",description:"Print system information",async exec(t){const e=t.args.filter(d=>d.startsWith("-")).join(""),r=e.includes("a"),n=e.includes("s")||!e&&t.args.length===0,c=e.includes("m"),s=e.includes("n"),h=e.includes("r"),o=e.includes("v");if(r)return t.stdout=`Shiro shiro 0.1.0 Shiro/WASM browser wasm
`,0;const a=[];return n&&a.push("Shiro"),s&&a.push("shiro"),h&&a.push("0.1.0"),o&&a.push("Shiro/WASM"),c&&a.push("wasm"),t.stdout=(a.length>0?a.join(" "):"Shiro")+`
`,0}},commandCmd={name:"command",description:"Run command or check if command exists",async exec(t){if(t.args[0]==="-v"&&t.args[1]){const e=t.args[1];if(t.shell.commands.get(e))return t.stdout=e+`
`,0;const n=await t.shell.findExecutableInPath?.(e);return n?(t.stdout=n+`
`,0):1}if(t.args[0]==="-V"&&t.args[1]){const e=t.args[1];return t.shell.commands.get(e)?(t.stdout=`${e} is a shell builtin
`,0):(t.stderr=`command: ${e}: not found
`,1)}if(t.args.length>0){const e=t.args[0],r=t.shell.commands.get(e);if(r){const n={...t,args:t.args.slice(1)};return await r.exec(n)}return t.stderr=`command: ${e}: not found
`,127}return 0}},cutCmd={name:"cut",description:"Remove sections from each line",async exec(t){let e="	",r=[],n=[],c=[];for(let o=0;o<t.args.length;o++){const a=t.args[o];a==="-d"&&t.args[o+1]?(e=t.args[++o],e.length===0&&(e=" ")):a.startsWith("-d")?e=a.slice(2)||" ":a==="-f"&&t.args[o+1]?r=parseRange(t.args[++o]):a.startsWith("-f")?r=parseRange(a.slice(2)):a==="-b"&&t.args[o+1]?n=parseRange(t.args[++o]):a.startsWith("-b")?n=parseRange(a.slice(2)):a==="-c"&&t.args[o+1]?c=parseRange(t.args[++o]):a.startsWith("-c")&&(c=parseRange(a.slice(2)))}const s=t.stdin.split(`
`),h=[];for(const o of s)if(!(!o&&s.indexOf(o)===s.length-1))if(r.length>0){const a=o.split(e),d=r.map(l=>a[l-1]||"").filter(Boolean);h.push(d.join(e))}else if(n.length>0||c.length>0){const d=(n.length>0?n:c).map(l=>o[l-1]||"").join("");h.push(d)}else h.push(o);return t.stdout=h.join(`
`)+`
`,0}};function parseRange(t){const e=[];for(const r of t.split(","))if(r.includes("-")){const[n,c]=r.split("-").map(Number);for(let s=n;s<=(c||n);s++)e.push(s)}else e.push(Number(r));return e.filter(r=>!isNaN(r)&&r>0)}const shasumCmd={name:"shasum",description:"Compute SHA checksums",async exec(t){let e="1";const r=[];for(let h=0;h<t.args.length;h++){const o=t.args[h];o==="-a"&&t.args[h+1]?e=t.args[++h]:o.startsWith("-")||r.push(o)}const c={1:"SHA-1",256:"SHA-256",384:"SHA-384",512:"SHA-512"}[e];if(!c)return t.stderr=`shasum: unrecognized algorithm: ${e}
`,1;const s=async(h,o)=>{const a=await crypto.subtle.digest(c,h),l=Array.from(new Uint8Array(a)).map(f=>f.toString(16).padStart(2,"0")).join("");t.stdout+=`${l}  ${o}
`};if(r.length===0||r.includes("-")){const h=new TextEncoder().encode(t.stdin);await s(h,"-")}for(const h of r){if(h==="-")continue;const o=t.fs.resolvePath(h,t.cwd);try{const a=await t.fs.readFile(o),d=typeof a=="string"?new TextEncoder().encode(a):a instanceof Uint8Array?a:new Uint8Array(a);await s(d,h)}catch(a){return t.stderr+=`shasum: ${h}: ${a.message}
`,1}}return 0}},sha256sumCmd={name:"sha256sum",description:"Compute SHA-256 checksums",async exec(t){const e={...t,args:["-a","256",...t.args]};return shasumCmd.exec(e)}},shiroOnlyCommands=[cdCmd,exportCmd$1,helpCmd,whichCmd,xargsCmd,rmdirCmd,sleepCmd,seqCmd,rmCmd,findCmd,lnCmd,hostnameCmd,unameCmd,grepCmd,sedCmd,diffCmd,commandCmd,cutCmd,shasumCmd,sha256sumCmd];var commonjsGlobal=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function getDefaultExportFromCjs$1(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var buffer={},base64Js={};base64Js.byteLength=byteLength;base64Js.toByteArray=toByteArray;base64Js.fromByteArray=fromByteArray;var lookup=[],revLookup=[],Arr=typeof Uint8Array<"u"?Uint8Array:Array,code="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(var i=0,len=code.length;i<len;++i)lookup[i]=code[i],revLookup[code.charCodeAt(i)]=i;revLookup[45]=62;revLookup[95]=63;function getLens(t){var e=t.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var r=t.indexOf("=");r===-1&&(r=e);var n=r===e?0:4-r%4;return[r,n]}function byteLength(t){var e=getLens(t),r=e[0],n=e[1];return(r+n)*3/4-n}function _byteLength(t,e,r){return(e+r)*3/4-r}function toByteArray(t){var e,r=getLens(t),n=r[0],c=r[1],s=new Arr(_byteLength(t,n,c)),h=0,o=c>0?n-4:n,a;for(a=0;a<o;a+=4)e=revLookup[t.charCodeAt(a)]<<18|revLookup[t.charCodeAt(a+1)]<<12|revLookup[t.charCodeAt(a+2)]<<6|revLookup[t.charCodeAt(a+3)],s[h++]=e>>16&255,s[h++]=e>>8&255,s[h++]=e&255;return c===2&&(e=revLookup[t.charCodeAt(a)]<<2|revLookup[t.charCodeAt(a+1)]>>4,s[h++]=e&255),c===1&&(e=revLookup[t.charCodeAt(a)]<<10|revLookup[t.charCodeAt(a+1)]<<4|revLookup[t.charCodeAt(a+2)]>>2,s[h++]=e>>8&255,s[h++]=e&255),s}function tripletToBase64(t){return lookup[t>>18&63]+lookup[t>>12&63]+lookup[t>>6&63]+lookup[t&63]}function encodeChunk(t,e,r){for(var n,c=[],s=e;s<r;s+=3)n=(t[s]<<16&16711680)+(t[s+1]<<8&65280)+(t[s+2]&255),c.push(tripletToBase64(n));return c.join("")}function fromByteArray(t){for(var e,r=t.length,n=r%3,c=[],s=16383,h=0,o=r-n;h<o;h+=s)c.push(encodeChunk(t,h,h+s>o?o:h+s));return n===1?(e=t[r-1],c.push(lookup[e>>2]+lookup[e<<4&63]+"==")):n===2&&(e=(t[r-2]<<8)+t[r-1],c.push(lookup[e>>10]+lookup[e>>4&63]+lookup[e<<2&63]+"=")),c.join("")}var ieee754={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */ieee754.read=function(t,e,r,n,c){var s,h,o=c*8-n-1,a=(1<<o)-1,d=a>>1,l=-7,f=r?c-1:0,p=r?-1:1,S=t[e+f];for(f+=p,s=S&(1<<-l)-1,S>>=-l,l+=o;l>0;s=s*256+t[e+f],f+=p,l-=8);for(h=s&(1<<-l)-1,s>>=-l,l+=n;l>0;h=h*256+t[e+f],f+=p,l-=8);if(s===0)s=1-d;else{if(s===a)return h?NaN:(S?-1:1)*(1/0);h=h+Math.pow(2,n),s=s-d}return(S?-1:1)*h*Math.pow(2,s-n)};ieee754.write=function(t,e,r,n,c,s){var h,o,a,d=s*8-c-1,l=(1<<d)-1,f=l>>1,p=c===23?Math.pow(2,-24)-Math.pow(2,-77):0,S=n?0:s-1,k=n?1:-1,A=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(o=isNaN(e)?1:0,h=l):(h=Math.floor(Math.log(e)/Math.LN2),e*(a=Math.pow(2,-h))<1&&(h--,a*=2),h+f>=1?e+=p/a:e+=p*Math.pow(2,1-f),e*a>=2&&(h++,a/=2),h+f>=l?(o=0,h=l):h+f>=1?(o=(e*a-1)*Math.pow(2,c),h=h+f):(o=e*Math.pow(2,f-1)*Math.pow(2,c),h=0));c>=8;t[r+S]=o&255,S+=k,o/=256,c-=8);for(h=h<<c|o,d+=c;d>0;t[r+S]=h&255,S+=k,h/=256,d-=8);t[r+S-k]|=A*128};/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */(function(t){const e=base64Js,r=ieee754,n=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;t.Buffer=l,t.SlowBuffer=I,t.INSPECT_MAX_BYTES=50;const c=2147483647;t.kMaxLength=c;const{Uint8Array:s,ArrayBuffer:h,SharedArrayBuffer:o}=globalThis;l.TYPED_ARRAY_SUPPORT=a(),!l.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function a(){try{const te=new s(1),C={foo:function(){return 42}};return Object.setPrototypeOf(C,s.prototype),Object.setPrototypeOf(te,C),te.foo()===42}catch{return!1}}Object.defineProperty(l.prototype,"parent",{enumerable:!0,get:function(){if(l.isBuffer(this))return this.buffer}}),Object.defineProperty(l.prototype,"offset",{enumerable:!0,get:function(){if(l.isBuffer(this))return this.byteOffset}});function d(te){if(te>c)throw new RangeError('The value "'+te+'" is invalid for option "size"');const C=new s(te);return Object.setPrototypeOf(C,l.prototype),C}function l(te,C,O){if(typeof te=="number"){if(typeof C=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return k(te)}return f(te,C,O)}l.poolSize=8192;function f(te,C,O){if(typeof te=="string")return A(te,C);if(h.isView(te))return v(te);if(te==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof te);if(wt(te,h)||te&&wt(te.buffer,h)||typeof o<"u"&&(wt(te,o)||te&&wt(te.buffer,o)))return g(te,C,O);if(typeof te=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');const ee=te.valueOf&&te.valueOf();if(ee!=null&&ee!==te)return l.from(ee,C,O);const ge=m(te);if(ge)return ge;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof te[Symbol.toPrimitive]=="function")return l.from(te[Symbol.toPrimitive]("string"),C,O);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof te)}l.from=function(te,C,O){return f(te,C,O)},Object.setPrototypeOf(l.prototype,s.prototype),Object.setPrototypeOf(l,s);function p(te){if(typeof te!="number")throw new TypeError('"size" argument must be of type number');if(te<0)throw new RangeError('The value "'+te+'" is invalid for option "size"')}function S(te,C,O){return p(te),te<=0?d(te):C!==void 0?typeof O=="string"?d(te).fill(C,O):d(te).fill(C):d(te)}l.alloc=function(te,C,O){return S(te,C,O)};function k(te){return p(te),d(te<0?0:$(te)|0)}l.allocUnsafe=function(te){return k(te)},l.allocUnsafeSlow=function(te){return k(te)};function A(te,C){if((typeof C!="string"||C==="")&&(C="utf8"),!l.isEncoding(C))throw new TypeError("Unknown encoding: "+C);const O=B(te,C)|0;let ee=d(O);const ge=ee.write(te,C);return ge!==O&&(ee=ee.slice(0,ge)),ee}function w(te){const C=te.length<0?0:$(te.length)|0,O=d(C);for(let ee=0;ee<C;ee+=1)O[ee]=te[ee]&255;return O}function v(te){if(wt(te,s)){const C=new s(te);return g(C.buffer,C.byteOffset,C.byteLength)}return w(te)}function g(te,C,O){if(C<0||te.byteLength<C)throw new RangeError('"offset" is outside of buffer bounds');if(te.byteLength<C+(O||0))throw new RangeError('"length" is outside of buffer bounds');let ee;return C===void 0&&O===void 0?ee=new s(te):O===void 0?ee=new s(te,C):ee=new s(te,C,O),Object.setPrototypeOf(ee,l.prototype),ee}function m(te){if(l.isBuffer(te)){const C=$(te.length)|0,O=d(C);return O.length===0||te.copy(O,0,0,C),O}if(te.length!==void 0)return typeof te.length!="number"||vt(te.length)?d(0):w(te);if(te.type==="Buffer"&&Array.isArray(te.data))return w(te.data)}function $(te){if(te>=c)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+c.toString(16)+" bytes");return te|0}function I(te){return+te!=te&&(te=0),l.alloc(+te)}l.isBuffer=function(C){return C!=null&&C._isBuffer===!0&&C!==l.prototype},l.compare=function(C,O){if(wt(C,s)&&(C=l.from(C,C.offset,C.byteLength)),wt(O,s)&&(O=l.from(O,O.offset,O.byteLength)),!l.isBuffer(C)||!l.isBuffer(O))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(C===O)return 0;let ee=C.length,ge=O.length;for(let ne=0,_e=Math.min(ee,ge);ne<_e;++ne)if(C[ne]!==O[ne]){ee=C[ne],ge=O[ne];break}return ee<ge?-1:ge<ee?1:0},l.isEncoding=function(C){switch(String(C).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},l.concat=function(C,O){if(!Array.isArray(C))throw new TypeError('"list" argument must be an Array of Buffers');if(C.length===0)return l.alloc(0);let ee;if(O===void 0)for(O=0,ee=0;ee<C.length;++ee)O+=C[ee].length;const ge=l.allocUnsafe(O);let ne=0;for(ee=0;ee<C.length;++ee){let _e=C[ee];if(wt(_e,s))ne+_e.length>ge.length?(l.isBuffer(_e)||(_e=l.from(_e)),_e.copy(ge,ne)):s.prototype.set.call(ge,_e,ne);else if(l.isBuffer(_e))_e.copy(ge,ne);else throw new TypeError('"list" argument must be an Array of Buffers');ne+=_e.length}return ge};function B(te,C){if(l.isBuffer(te))return te.length;if(h.isView(te)||wt(te,h))return te.byteLength;if(typeof te!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof te);const O=te.length,ee=arguments.length>2&&arguments[2]===!0;if(!ee&&O===0)return 0;let ge=!1;for(;;)switch(C){case"ascii":case"latin1":case"binary":return O;case"utf8":case"utf-8":return We(te).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return O*2;case"hex":return O>>>1;case"base64":return gt(te).length;default:if(ge)return ee?-1:We(te).length;C=(""+C).toLowerCase(),ge=!0}}l.byteLength=B;function P(te,C,O){let ee=!1;if((C===void 0||C<0)&&(C=0),C>this.length||((O===void 0||O>this.length)&&(O=this.length),O<=0)||(O>>>=0,C>>>=0,O<=C))return"";for(te||(te="utf8");;)switch(te){case"hex":return G(this,C,O);case"utf8":case"utf-8":return xe(this,C,O);case"ascii":return j(this,C,O);case"latin1":case"binary":return H(this,C,O);case"base64":return je(this,C,O);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return V(this,C,O);default:if(ee)throw new TypeError("Unknown encoding: "+te);te=(te+"").toLowerCase(),ee=!0}}l.prototype._isBuffer=!0;function x(te,C,O){const ee=te[C];te[C]=te[O],te[O]=ee}l.prototype.swap16=function(){const C=this.length;if(C%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let O=0;O<C;O+=2)x(this,O,O+1);return this},l.prototype.swap32=function(){const C=this.length;if(C%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let O=0;O<C;O+=4)x(this,O,O+3),x(this,O+1,O+2);return this},l.prototype.swap64=function(){const C=this.length;if(C%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let O=0;O<C;O+=8)x(this,O,O+7),x(this,O+1,O+6),x(this,O+2,O+5),x(this,O+3,O+4);return this},l.prototype.toString=function(){const C=this.length;return C===0?"":arguments.length===0?xe(this,0,C):P.apply(this,arguments)},l.prototype.toLocaleString=l.prototype.toString,l.prototype.equals=function(C){if(!l.isBuffer(C))throw new TypeError("Argument must be a Buffer");return this===C?!0:l.compare(this,C)===0},l.prototype.inspect=function(){let C="";const O=t.INSPECT_MAX_BYTES;return C=this.toString("hex",0,O).replace(/(.{2})/g,"$1 ").trim(),this.length>O&&(C+=" ... "),"<Buffer "+C+">"},n&&(l.prototype[n]=l.prototype.inspect),l.prototype.compare=function(C,O,ee,ge,ne){if(wt(C,s)&&(C=l.from(C,C.offset,C.byteLength)),!l.isBuffer(C))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof C);if(O===void 0&&(O=0),ee===void 0&&(ee=C?C.length:0),ge===void 0&&(ge=0),ne===void 0&&(ne=this.length),O<0||ee>C.length||ge<0||ne>this.length)throw new RangeError("out of range index");if(ge>=ne&&O>=ee)return 0;if(ge>=ne)return-1;if(O>=ee)return 1;if(O>>>=0,ee>>>=0,ge>>>=0,ne>>>=0,this===C)return 0;let _e=ne-ge,K=ee-O;const qe=Math.min(_e,K),lt=this.slice(ge,ne),L=C.slice(O,ee);for(let me=0;me<qe;++me)if(lt[me]!==L[me]){_e=lt[me],K=L[me];break}return _e<K?-1:K<_e?1:0};function N(te,C,O,ee,ge){if(te.length===0)return-1;if(typeof O=="string"?(ee=O,O=0):O>2147483647?O=2147483647:O<-2147483648&&(O=-2147483648),O=+O,vt(O)&&(O=ge?0:te.length-1),O<0&&(O=te.length+O),O>=te.length){if(ge)return-1;O=te.length-1}else if(O<0)if(ge)O=0;else return-1;if(typeof C=="string"&&(C=l.from(C,ee)),l.isBuffer(C))return C.length===0?-1:J(te,C,O,ee,ge);if(typeof C=="number")return C=C&255,typeof s.prototype.indexOf=="function"?ge?s.prototype.indexOf.call(te,C,O):s.prototype.lastIndexOf.call(te,C,O):J(te,[C],O,ee,ge);throw new TypeError("val must be string, number or Buffer")}function J(te,C,O,ee,ge){let ne=1,_e=te.length,K=C.length;if(ee!==void 0&&(ee=String(ee).toLowerCase(),ee==="ucs2"||ee==="ucs-2"||ee==="utf16le"||ee==="utf-16le")){if(te.length<2||C.length<2)return-1;ne=2,_e/=2,K/=2,O/=2}function qe(L,me){return ne===1?L[me]:L.readUInt16BE(me*ne)}let lt;if(ge){let L=-1;for(lt=O;lt<_e;lt++)if(qe(te,lt)===qe(C,L===-1?0:lt-L)){if(L===-1&&(L=lt),lt-L+1===K)return L*ne}else L!==-1&&(lt-=lt-L),L=-1}else for(O+K>_e&&(O=_e-K),lt=O;lt>=0;lt--){let L=!0;for(let me=0;me<K;me++)if(qe(te,lt+me)!==qe(C,me)){L=!1;break}if(L)return lt}return-1}l.prototype.includes=function(C,O,ee){return this.indexOf(C,O,ee)!==-1},l.prototype.indexOf=function(C,O,ee){return N(this,C,O,ee,!0)},l.prototype.lastIndexOf=function(C,O,ee){return N(this,C,O,ee,!1)};function Q(te,C,O,ee){O=Number(O)||0;const ge=te.length-O;ee?(ee=Number(ee),ee>ge&&(ee=ge)):ee=ge;const ne=C.length;ee>ne/2&&(ee=ne/2);let _e;for(_e=0;_e<ee;++_e){const K=parseInt(C.substr(_e*2,2),16);if(vt(K))return _e;te[O+_e]=K}return _e}function W(te,C,O,ee){return Dt(We(C,te.length-O),te,O,ee)}function Y(te,C,O,ee){return Dt(Ze(C),te,O,ee)}function ve(te,C,O,ee){return Dt(gt(C),te,O,ee)}function Be(te,C,O,ee){return Dt(st(C,te.length-O),te,O,ee)}l.prototype.write=function(C,O,ee,ge){if(O===void 0)ge="utf8",ee=this.length,O=0;else if(ee===void 0&&typeof O=="string")ge=O,ee=this.length,O=0;else if(isFinite(O))O=O>>>0,isFinite(ee)?(ee=ee>>>0,ge===void 0&&(ge="utf8")):(ge=ee,ee=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");const ne=this.length-O;if((ee===void 0||ee>ne)&&(ee=ne),C.length>0&&(ee<0||O<0)||O>this.length)throw new RangeError("Attempt to write outside buffer bounds");ge||(ge="utf8");let _e=!1;for(;;)switch(ge){case"hex":return Q(this,C,O,ee);case"utf8":case"utf-8":return W(this,C,O,ee);case"ascii":case"latin1":case"binary":return Y(this,C,O,ee);case"base64":return ve(this,C,O,ee);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Be(this,C,O,ee);default:if(_e)throw new TypeError("Unknown encoding: "+ge);ge=(""+ge).toLowerCase(),_e=!0}},l.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function je(te,C,O){return C===0&&O===te.length?e.fromByteArray(te):e.fromByteArray(te.slice(C,O))}function xe(te,C,O){O=Math.min(te.length,O);const ee=[];let ge=C;for(;ge<O;){const ne=te[ge];let _e=null,K=ne>239?4:ne>223?3:ne>191?2:1;if(ge+K<=O){let qe,lt,L,me;switch(K){case 1:ne<128&&(_e=ne);break;case 2:qe=te[ge+1],(qe&192)===128&&(me=(ne&31)<<6|qe&63,me>127&&(_e=me));break;case 3:qe=te[ge+1],lt=te[ge+2],(qe&192)===128&&(lt&192)===128&&(me=(ne&15)<<12|(qe&63)<<6|lt&63,me>2047&&(me<55296||me>57343)&&(_e=me));break;case 4:qe=te[ge+1],lt=te[ge+2],L=te[ge+3],(qe&192)===128&&(lt&192)===128&&(L&192)===128&&(me=(ne&15)<<18|(qe&63)<<12|(lt&63)<<6|L&63,me>65535&&me<1114112&&(_e=me))}}_e===null?(_e=65533,K=1):_e>65535&&(_e-=65536,ee.push(_e>>>10&1023|55296),_e=56320|_e&1023),ee.push(_e),ge+=K}return q(ee)}const ke=4096;function q(te){const C=te.length;if(C<=ke)return String.fromCharCode.apply(String,te);let O="",ee=0;for(;ee<C;)O+=String.fromCharCode.apply(String,te.slice(ee,ee+=ke));return O}function j(te,C,O){let ee="";O=Math.min(te.length,O);for(let ge=C;ge<O;++ge)ee+=String.fromCharCode(te[ge]&127);return ee}function H(te,C,O){let ee="";O=Math.min(te.length,O);for(let ge=C;ge<O;++ge)ee+=String.fromCharCode(te[ge]);return ee}function G(te,C,O){const ee=te.length;(!C||C<0)&&(C=0),(!O||O<0||O>ee)&&(O=ee);let ge="";for(let ne=C;ne<O;++ne)ge+=qt[te[ne]];return ge}function V(te,C,O){const ee=te.slice(C,O);let ge="";for(let ne=0;ne<ee.length-1;ne+=2)ge+=String.fromCharCode(ee[ne]+ee[ne+1]*256);return ge}l.prototype.slice=function(C,O){const ee=this.length;C=~~C,O=O===void 0?ee:~~O,C<0?(C+=ee,C<0&&(C=0)):C>ee&&(C=ee),O<0?(O+=ee,O<0&&(O=0)):O>ee&&(O=ee),O<C&&(O=C);const ge=this.subarray(C,O);return Object.setPrototypeOf(ge,l.prototype),ge};function oe(te,C,O){if(te%1!==0||te<0)throw new RangeError("offset is not uint");if(te+C>O)throw new RangeError("Trying to access beyond buffer length")}l.prototype.readUintLE=l.prototype.readUIntLE=function(C,O,ee){C=C>>>0,O=O>>>0,ee||oe(C,O,this.length);let ge=this[C],ne=1,_e=0;for(;++_e<O&&(ne*=256);)ge+=this[C+_e]*ne;return ge},l.prototype.readUintBE=l.prototype.readUIntBE=function(C,O,ee){C=C>>>0,O=O>>>0,ee||oe(C,O,this.length);let ge=this[C+--O],ne=1;for(;O>0&&(ne*=256);)ge+=this[C+--O]*ne;return ge},l.prototype.readUint8=l.prototype.readUInt8=function(C,O){return C=C>>>0,O||oe(C,1,this.length),this[C]},l.prototype.readUint16LE=l.prototype.readUInt16LE=function(C,O){return C=C>>>0,O||oe(C,2,this.length),this[C]|this[C+1]<<8},l.prototype.readUint16BE=l.prototype.readUInt16BE=function(C,O){return C=C>>>0,O||oe(C,2,this.length),this[C]<<8|this[C+1]},l.prototype.readUint32LE=l.prototype.readUInt32LE=function(C,O){return C=C>>>0,O||oe(C,4,this.length),(this[C]|this[C+1]<<8|this[C+2]<<16)+this[C+3]*16777216},l.prototype.readUint32BE=l.prototype.readUInt32BE=function(C,O){return C=C>>>0,O||oe(C,4,this.length),this[C]*16777216+(this[C+1]<<16|this[C+2]<<8|this[C+3])},l.prototype.readBigUInt64LE=Lt(function(C){C=C>>>0,dt(C,"offset");const O=this[C],ee=this[C+7];(O===void 0||ee===void 0)&&fe(C,this.length-8);const ge=O+this[++C]*2**8+this[++C]*2**16+this[++C]*2**24,ne=this[++C]+this[++C]*2**8+this[++C]*2**16+ee*2**24;return BigInt(ge)+(BigInt(ne)<<BigInt(32))}),l.prototype.readBigUInt64BE=Lt(function(C){C=C>>>0,dt(C,"offset");const O=this[C],ee=this[C+7];(O===void 0||ee===void 0)&&fe(C,this.length-8);const ge=O*2**24+this[++C]*2**16+this[++C]*2**8+this[++C],ne=this[++C]*2**24+this[++C]*2**16+this[++C]*2**8+ee;return(BigInt(ge)<<BigInt(32))+BigInt(ne)}),l.prototype.readIntLE=function(C,O,ee){C=C>>>0,O=O>>>0,ee||oe(C,O,this.length);let ge=this[C],ne=1,_e=0;for(;++_e<O&&(ne*=256);)ge+=this[C+_e]*ne;return ne*=128,ge>=ne&&(ge-=Math.pow(2,8*O)),ge},l.prototype.readIntBE=function(C,O,ee){C=C>>>0,O=O>>>0,ee||oe(C,O,this.length);let ge=O,ne=1,_e=this[C+--ge];for(;ge>0&&(ne*=256);)_e+=this[C+--ge]*ne;return ne*=128,_e>=ne&&(_e-=Math.pow(2,8*O)),_e},l.prototype.readInt8=function(C,O){return C=C>>>0,O||oe(C,1,this.length),this[C]&128?(255-this[C]+1)*-1:this[C]},l.prototype.readInt16LE=function(C,O){C=C>>>0,O||oe(C,2,this.length);const ee=this[C]|this[C+1]<<8;return ee&32768?ee|4294901760:ee},l.prototype.readInt16BE=function(C,O){C=C>>>0,O||oe(C,2,this.length);const ee=this[C+1]|this[C]<<8;return ee&32768?ee|4294901760:ee},l.prototype.readInt32LE=function(C,O){return C=C>>>0,O||oe(C,4,this.length),this[C]|this[C+1]<<8|this[C+2]<<16|this[C+3]<<24},l.prototype.readInt32BE=function(C,O){return C=C>>>0,O||oe(C,4,this.length),this[C]<<24|this[C+1]<<16|this[C+2]<<8|this[C+3]},l.prototype.readBigInt64LE=Lt(function(C){C=C>>>0,dt(C,"offset");const O=this[C],ee=this[C+7];(O===void 0||ee===void 0)&&fe(C,this.length-8);const ge=this[C+4]+this[C+5]*2**8+this[C+6]*2**16+(ee<<24);return(BigInt(ge)<<BigInt(32))+BigInt(O+this[++C]*2**8+this[++C]*2**16+this[++C]*2**24)}),l.prototype.readBigInt64BE=Lt(function(C){C=C>>>0,dt(C,"offset");const O=this[C],ee=this[C+7];(O===void 0||ee===void 0)&&fe(C,this.length-8);const ge=(O<<24)+this[++C]*2**16+this[++C]*2**8+this[++C];return(BigInt(ge)<<BigInt(32))+BigInt(this[++C]*2**24+this[++C]*2**16+this[++C]*2**8+ee)}),l.prototype.readFloatLE=function(C,O){return C=C>>>0,O||oe(C,4,this.length),r.read(this,C,!0,23,4)},l.prototype.readFloatBE=function(C,O){return C=C>>>0,O||oe(C,4,this.length),r.read(this,C,!1,23,4)},l.prototype.readDoubleLE=function(C,O){return C=C>>>0,O||oe(C,8,this.length),r.read(this,C,!0,52,8)},l.prototype.readDoubleBE=function(C,O){return C=C>>>0,O||oe(C,8,this.length),r.read(this,C,!1,52,8)};function Z(te,C,O,ee,ge,ne){if(!l.isBuffer(te))throw new TypeError('"buffer" argument must be a Buffer instance');if(C>ge||C<ne)throw new RangeError('"value" argument is out of bounds');if(O+ee>te.length)throw new RangeError("Index out of range")}l.prototype.writeUintLE=l.prototype.writeUIntLE=function(C,O,ee,ge){if(C=+C,O=O>>>0,ee=ee>>>0,!ge){const K=Math.pow(2,8*ee)-1;Z(this,C,O,ee,K,0)}let ne=1,_e=0;for(this[O]=C&255;++_e<ee&&(ne*=256);)this[O+_e]=C/ne&255;return O+ee},l.prototype.writeUintBE=l.prototype.writeUIntBE=function(C,O,ee,ge){if(C=+C,O=O>>>0,ee=ee>>>0,!ge){const K=Math.pow(2,8*ee)-1;Z(this,C,O,ee,K,0)}let ne=ee-1,_e=1;for(this[O+ne]=C&255;--ne>=0&&(_e*=256);)this[O+ne]=C/_e&255;return O+ee},l.prototype.writeUint8=l.prototype.writeUInt8=function(C,O,ee){return C=+C,O=O>>>0,ee||Z(this,C,O,1,255,0),this[O]=C&255,O+1},l.prototype.writeUint16LE=l.prototype.writeUInt16LE=function(C,O,ee){return C=+C,O=O>>>0,ee||Z(this,C,O,2,65535,0),this[O]=C&255,this[O+1]=C>>>8,O+2},l.prototype.writeUint16BE=l.prototype.writeUInt16BE=function(C,O,ee){return C=+C,O=O>>>0,ee||Z(this,C,O,2,65535,0),this[O]=C>>>8,this[O+1]=C&255,O+2},l.prototype.writeUint32LE=l.prototype.writeUInt32LE=function(C,O,ee){return C=+C,O=O>>>0,ee||Z(this,C,O,4,4294967295,0),this[O+3]=C>>>24,this[O+2]=C>>>16,this[O+1]=C>>>8,this[O]=C&255,O+4},l.prototype.writeUint32BE=l.prototype.writeUInt32BE=function(C,O,ee){return C=+C,O=O>>>0,ee||Z(this,C,O,4,4294967295,0),this[O]=C>>>24,this[O+1]=C>>>16,this[O+2]=C>>>8,this[O+3]=C&255,O+4};function pe(te,C,O,ee,ge){yt(C,ee,ge,te,O,7);let ne=Number(C&BigInt(4294967295));te[O++]=ne,ne=ne>>8,te[O++]=ne,ne=ne>>8,te[O++]=ne,ne=ne>>8,te[O++]=ne;let _e=Number(C>>BigInt(32)&BigInt(4294967295));return te[O++]=_e,_e=_e>>8,te[O++]=_e,_e=_e>>8,te[O++]=_e,_e=_e>>8,te[O++]=_e,O}function ce(te,C,O,ee,ge){yt(C,ee,ge,te,O,7);let ne=Number(C&BigInt(4294967295));te[O+7]=ne,ne=ne>>8,te[O+6]=ne,ne=ne>>8,te[O+5]=ne,ne=ne>>8,te[O+4]=ne;let _e=Number(C>>BigInt(32)&BigInt(4294967295));return te[O+3]=_e,_e=_e>>8,te[O+2]=_e,_e=_e>>8,te[O+1]=_e,_e=_e>>8,te[O]=_e,O+8}l.prototype.writeBigUInt64LE=Lt(function(C,O=0){return pe(this,C,O,BigInt(0),BigInt("0xffffffffffffffff"))}),l.prototype.writeBigUInt64BE=Lt(function(C,O=0){return ce(this,C,O,BigInt(0),BigInt("0xffffffffffffffff"))}),l.prototype.writeIntLE=function(C,O,ee,ge){if(C=+C,O=O>>>0,!ge){const qe=Math.pow(2,8*ee-1);Z(this,C,O,ee,qe-1,-qe)}let ne=0,_e=1,K=0;for(this[O]=C&255;++ne<ee&&(_e*=256);)C<0&&K===0&&this[O+ne-1]!==0&&(K=1),this[O+ne]=(C/_e>>0)-K&255;return O+ee},l.prototype.writeIntBE=function(C,O,ee,ge){if(C=+C,O=O>>>0,!ge){const qe=Math.pow(2,8*ee-1);Z(this,C,O,ee,qe-1,-qe)}let ne=ee-1,_e=1,K=0;for(this[O+ne]=C&255;--ne>=0&&(_e*=256);)C<0&&K===0&&this[O+ne+1]!==0&&(K=1),this[O+ne]=(C/_e>>0)-K&255;return O+ee},l.prototype.writeInt8=function(C,O,ee){return C=+C,O=O>>>0,ee||Z(this,C,O,1,127,-128),C<0&&(C=255+C+1),this[O]=C&255,O+1},l.prototype.writeInt16LE=function(C,O,ee){return C=+C,O=O>>>0,ee||Z(this,C,O,2,32767,-32768),this[O]=C&255,this[O+1]=C>>>8,O+2},l.prototype.writeInt16BE=function(C,O,ee){return C=+C,O=O>>>0,ee||Z(this,C,O,2,32767,-32768),this[O]=C>>>8,this[O+1]=C&255,O+2},l.prototype.writeInt32LE=function(C,O,ee){return C=+C,O=O>>>0,ee||Z(this,C,O,4,2147483647,-2147483648),this[O]=C&255,this[O+1]=C>>>8,this[O+2]=C>>>16,this[O+3]=C>>>24,O+4},l.prototype.writeInt32BE=function(C,O,ee){return C=+C,O=O>>>0,ee||Z(this,C,O,4,2147483647,-2147483648),C<0&&(C=4294967295+C+1),this[O]=C>>>24,this[O+1]=C>>>16,this[O+2]=C>>>8,this[O+3]=C&255,O+4},l.prototype.writeBigInt64LE=Lt(function(C,O=0){return pe(this,C,O,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),l.prototype.writeBigInt64BE=Lt(function(C,O=0){return ce(this,C,O,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function U(te,C,O,ee,ge,ne){if(O+ee>te.length)throw new RangeError("Index out of range");if(O<0)throw new RangeError("Index out of range")}function ye(te,C,O,ee,ge){return C=+C,O=O>>>0,ge||U(te,C,O,4),r.write(te,C,O,ee,23,4),O+4}l.prototype.writeFloatLE=function(C,O,ee){return ye(this,C,O,!0,ee)},l.prototype.writeFloatBE=function(C,O,ee){return ye(this,C,O,!1,ee)};function be(te,C,O,ee,ge){return C=+C,O=O>>>0,ge||U(te,C,O,8),r.write(te,C,O,ee,52,8),O+8}l.prototype.writeDoubleLE=function(C,O,ee){return be(this,C,O,!0,ee)},l.prototype.writeDoubleBE=function(C,O,ee){return be(this,C,O,!1,ee)},l.prototype.copy=function(C,O,ee,ge){if(!l.isBuffer(C))throw new TypeError("argument should be a Buffer");if(ee||(ee=0),!ge&&ge!==0&&(ge=this.length),O>=C.length&&(O=C.length),O||(O=0),ge>0&&ge<ee&&(ge=ee),ge===ee||C.length===0||this.length===0)return 0;if(O<0)throw new RangeError("targetStart out of bounds");if(ee<0||ee>=this.length)throw new RangeError("Index out of range");if(ge<0)throw new RangeError("sourceEnd out of bounds");ge>this.length&&(ge=this.length),C.length-O<ge-ee&&(ge=C.length-O+ee);const ne=ge-ee;return this===C&&typeof s.prototype.copyWithin=="function"?this.copyWithin(O,ee,ge):s.prototype.set.call(C,this.subarray(ee,ge),O),ne},l.prototype.fill=function(C,O,ee,ge){if(typeof C=="string"){if(typeof O=="string"?(ge=O,O=0,ee=this.length):typeof ee=="string"&&(ge=ee,ee=this.length),ge!==void 0&&typeof ge!="string")throw new TypeError("encoding must be a string");if(typeof ge=="string"&&!l.isEncoding(ge))throw new TypeError("Unknown encoding: "+ge);if(C.length===1){const _e=C.charCodeAt(0);(ge==="utf8"&&_e<128||ge==="latin1")&&(C=_e)}}else typeof C=="number"?C=C&255:typeof C=="boolean"&&(C=Number(C));if(O<0||this.length<O||this.length<ee)throw new RangeError("Out of range index");if(ee<=O)return this;O=O>>>0,ee=ee===void 0?this.length:ee>>>0,C||(C=0);let ne;if(typeof C=="number")for(ne=O;ne<ee;++ne)this[ne]=C;else{const _e=l.isBuffer(C)?C:l.from(C,ge),K=_e.length;if(K===0)throw new TypeError('The value "'+C+'" is invalid for argument "value"');for(ne=0;ne<ee-O;++ne)this[ne+O]=_e[ne%K]}return this};const Pe={};function Oe(te,C,O){Pe[te]=class extends O{constructor(){super(),Object.defineProperty(this,"message",{value:C.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${te}]`,this.stack,delete this.name}get code(){return te}set code(ge){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:ge,writable:!0})}toString(){return`${this.name} [${te}]: ${this.message}`}}}Oe("ERR_BUFFER_OUT_OF_BOUNDS",function(te){return te?`${te} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),Oe("ERR_INVALID_ARG_TYPE",function(te,C){return`The "${te}" argument must be of type number. Received type ${typeof C}`},TypeError),Oe("ERR_OUT_OF_RANGE",function(te,C,O){let ee=`The value of "${te}" is out of range.`,ge=O;return Number.isInteger(O)&&Math.abs(O)>2**32?ge=Ue(String(O)):typeof O=="bigint"&&(ge=String(O),(O>BigInt(2)**BigInt(32)||O<-(BigInt(2)**BigInt(32)))&&(ge=Ue(ge)),ge+="n"),ee+=` It must be ${C}. Received ${ge}`,ee},RangeError);function Ue(te){let C="",O=te.length;const ee=te[0]==="-"?1:0;for(;O>=ee+4;O-=3)C=`_${te.slice(O-3,O)}${C}`;return`${te.slice(0,O)}${C}`}function rt(te,C,O){dt(C,"offset"),(te[C]===void 0||te[C+O]===void 0)&&fe(C,te.length-(O+1))}function yt(te,C,O,ee,ge,ne){if(te>O||te<C){const _e=typeof C=="bigint"?"n":"";let K;throw C===0||C===BigInt(0)?K=`>= 0${_e} and < 2${_e} ** ${(ne+1)*8}${_e}`:K=`>= -(2${_e} ** ${(ne+1)*8-1}${_e}) and < 2 ** ${(ne+1)*8-1}${_e}`,new Pe.ERR_OUT_OF_RANGE("value",K,te)}rt(ee,ge,ne)}function dt(te,C){if(typeof te!="number")throw new Pe.ERR_INVALID_ARG_TYPE(C,"number",te)}function fe(te,C,O){throw Math.floor(te)!==te?(dt(te,O),new Pe.ERR_OUT_OF_RANGE("offset","an integer",te)):C<0?new Pe.ERR_BUFFER_OUT_OF_BOUNDS:new Pe.ERR_OUT_OF_RANGE("offset",`>= 0 and <= ${C}`,te)}const Re=/[^+/0-9A-Za-z-_]/g;function Ke(te){if(te=te.split("=")[0],te=te.trim().replace(Re,""),te.length<2)return"";for(;te.length%4!==0;)te=te+"=";return te}function We(te,C){C=C||1/0;let O;const ee=te.length;let ge=null;const ne=[];for(let _e=0;_e<ee;++_e){if(O=te.charCodeAt(_e),O>55295&&O<57344){if(!ge){if(O>56319){(C-=3)>-1&&ne.push(239,191,189);continue}else if(_e+1===ee){(C-=3)>-1&&ne.push(239,191,189);continue}ge=O;continue}if(O<56320){(C-=3)>-1&&ne.push(239,191,189),ge=O;continue}O=(ge-55296<<10|O-56320)+65536}else ge&&(C-=3)>-1&&ne.push(239,191,189);if(ge=null,O<128){if((C-=1)<0)break;ne.push(O)}else if(O<2048){if((C-=2)<0)break;ne.push(O>>6|192,O&63|128)}else if(O<65536){if((C-=3)<0)break;ne.push(O>>12|224,O>>6&63|128,O&63|128)}else if(O<1114112){if((C-=4)<0)break;ne.push(O>>18|240,O>>12&63|128,O>>6&63|128,O&63|128)}else throw new Error("Invalid code point")}return ne}function Ze(te){const C=[];for(let O=0;O<te.length;++O)C.push(te.charCodeAt(O)&255);return C}function st(te,C){let O,ee,ge;const ne=[];for(let _e=0;_e<te.length&&!((C-=2)<0);++_e)O=te.charCodeAt(_e),ee=O>>8,ge=O%256,ne.push(ge),ne.push(ee);return ne}function gt(te){return e.toByteArray(Ke(te))}function Dt(te,C,O,ee){let ge;for(ge=0;ge<ee&&!(ge+O>=C.length||ge>=te.length);++ge)C[ge+O]=te[ge];return ge}function wt(te,C){return te instanceof C||te!=null&&te.constructor!=null&&te.constructor.name!=null&&te.constructor.name===C.name}function vt(te){return te!==te}const qt=(function(){const te="0123456789abcdef",C=new Array(256);for(let O=0;O<16;++O){const ee=O*16;for(let ge=0;ge<16;++ge)C[ee+ge]=te[O]+te[ge]}return C})();function Lt(te){return typeof BigInt>"u"?Gt:te}function Gt(){throw new Error("BigInt not supported")}})(buffer);const Buffer=buffer.Buffer;function getDefaultExportFromCjs(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var browser$1={exports:{}},process=browser$1.exports={},cachedSetTimeout,cachedClearTimeout;function defaultSetTimout(){throw new Error("setTimeout has not been defined")}function defaultClearTimeout(){throw new Error("clearTimeout has not been defined")}(function(){try{typeof setTimeout=="function"?cachedSetTimeout=setTimeout:cachedSetTimeout=defaultSetTimout}catch{cachedSetTimeout=defaultSetTimout}try{typeof clearTimeout=="function"?cachedClearTimeout=clearTimeout:cachedClearTimeout=defaultClearTimeout}catch{cachedClearTimeout=defaultClearTimeout}})();function runTimeout(t){if(cachedSetTimeout===setTimeout)return setTimeout(t,0);if((cachedSetTimeout===defaultSetTimout||!cachedSetTimeout)&&setTimeout)return cachedSetTimeout=setTimeout,setTimeout(t,0);try{return cachedSetTimeout(t,0)}catch{try{return cachedSetTimeout.call(null,t,0)}catch{return cachedSetTimeout.call(this,t,0)}}}function runClearTimeout(t){if(cachedClearTimeout===clearTimeout)return clearTimeout(t);if((cachedClearTimeout===defaultClearTimeout||!cachedClearTimeout)&&clearTimeout)return cachedClearTimeout=clearTimeout,clearTimeout(t);try{return cachedClearTimeout(t)}catch{try{return cachedClearTimeout.call(null,t)}catch{return cachedClearTimeout.call(this,t)}}}var queue=[],draining=!1,currentQueue,queueIndex=-1;function cleanUpNextTick(){!draining||!currentQueue||(draining=!1,currentQueue.length?queue=currentQueue.concat(queue):queueIndex=-1,queue.length&&drainQueue())}function drainQueue(){if(!draining){var t=runTimeout(cleanUpNextTick);draining=!0;for(var e=queue.length;e;){for(currentQueue=queue,queue=[];++queueIndex<e;)currentQueue&&currentQueue[queueIndex].run();queueIndex=-1,e=queue.length}currentQueue=null,draining=!1,runClearTimeout(t)}}process.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)e[r-1]=arguments[r];queue.push(new Item(t,e)),queue.length===1&&!draining&&runTimeout(drainQueue)};function Item(t,e){this.fun=t,this.array=e}Item.prototype.run=function(){this.fun.apply(null,this.array)};process.title="browser";process.browser=!0;process.env={};process.argv=[];process.version="";process.versions={};function noop(){}process.on=noop;process.addListener=noop;process.once=noop;process.off=noop;process.removeListener=noop;process.removeAllListeners=noop;process.emit=noop;process.prependListener=noop;process.prependOnceListener=noop;process.listeners=function(t){return[]};process.binding=function(t){throw new Error("process.binding is not supported")};process.cwd=function(){return"/"};process.chdir=function(t){throw new Error("process.chdir is not supported")};process.umask=function(){return 0};var browserExports$1=browser$1.exports;const process$1=getDefaultExportFromCjs(browserExports$1);var isomorphicGit={},lib$1,hasRequiredLib$1;function requireLib$1(){if(hasRequiredLib$1)return lib$1;hasRequiredLib$1=1;var t=function(e){if(e=e||{},this.Promise=e.Promise||Promise,this.queues=Object.create(null),this.domainReentrant=e.domainReentrant||!1,this.domainReentrant){if(typeof process$1>"u"||typeof process$1.domain>"u")throw new Error("Domain-reentrant locks require `process.domain` to exist. Please flip `opts.domainReentrant = false`, use a NodeJS version that still implements Domain, or install a browser polyfill.");this.domains=Object.create(null)}this.timeout=e.timeout||t.DEFAULT_TIMEOUT,this.maxOccupationTime=e.maxOccupationTime||t.DEFAULT_MAX_OCCUPATION_TIME,this.maxExecutionTime=e.maxExecutionTime||t.DEFAULT_MAX_EXECUTION_TIME,e.maxPending===1/0||Number.isInteger(e.maxPending)&&e.maxPending>=0?this.maxPending=e.maxPending:this.maxPending=t.DEFAULT_MAX_PENDING};return t.DEFAULT_TIMEOUT=0,t.DEFAULT_MAX_OCCUPATION_TIME=0,t.DEFAULT_MAX_EXECUTION_TIME=0,t.DEFAULT_MAX_PENDING=1e3,t.prototype.acquire=function(e,r,n,c){if(Array.isArray(e))return this._acquireBatch(e,r,n,c);if(typeof r!="function")throw new Error("You must pass a function to execute");var s=null,h=null,o=null;typeof n!="function"&&(c=n,n=null,o=new this.Promise(function(m,$){s=m,h=$})),c=c||{};var a=!1,d=null,l=null,f=null,p=this,S=function(m,$,I){l&&(clearTimeout(l),l=null),f&&(clearTimeout(f),f=null),m&&(p.queues[e]&&p.queues[e].length===0&&delete p.queues[e],p.domainReentrant&&delete p.domains[e]),a||(o?$?h($):s(I):typeof n=="function"&&n($,I),a=!0),m&&p.queues[e]&&p.queues[e].length>0&&p.queues[e].shift()()},k=function(m){if(a)return S(m);d&&(clearTimeout(d),d=null),p.domainReentrant&&m&&(p.domains[e]=process$1.domain);var $=c.maxExecutionTime||p.maxExecutionTime;if($&&(f=setTimeout(function(){p.queues[e]&&S(m,new Error("Maximum execution time is exceeded "+e))},$)),r.length===1){var I=!1;try{r(function(B,P){I||(I=!0,S(m,B,P))})}catch(B){I||(I=!0,S(m,B))}}else p._promiseTry(function(){return r()}).then(function(B){S(m,void 0,B)},function(B){S(m,B)})};p.domainReentrant&&process$1.domain&&(k=process$1.domain.bind(k));var A=c.maxPending||p.maxPending;if(!p.queues[e])p.queues[e]=[],k(!0);else if(p.domainReentrant&&process$1.domain&&process$1.domain===p.domains[e])k(!1);else if(p.queues[e].length>=A)S(!1,new Error("Too many pending tasks in queue "+e));else{var w=function(){k(!0)};c.skipQueue?p.queues[e].unshift(w):p.queues[e].push(w);var v=c.timeout||p.timeout;v&&(d=setTimeout(function(){d=null,S(!1,new Error("async-lock timed out in queue "+e))},v))}var g=c.maxOccupationTime||p.maxOccupationTime;if(g&&(l=setTimeout(function(){p.queues[e]&&S(!1,new Error("Maximum occupation time is exceeded in queue "+e))},g)),o)return o},t.prototype._acquireBatch=function(e,r,n,c){typeof n!="function"&&(c=n,n=null);var s=this,h=function(a,d){return function(l){s.acquire(a,d,l,c)}},o=e.reduceRight(function(a,d){return h(d,a)},r);if(typeof n=="function")o(n);else return new this.Promise(function(a,d){o.length===1?o(function(l,f){l?d(l):a(f)}):a(o())})},t.prototype.isBusy=function(e){return e?!!this.queues[e]:Object.keys(this.queues).length>0},t.prototype._promiseTry=function(e){try{return this.Promise.resolve(e())}catch(r){return this.Promise.reject(r)}},lib$1=t,lib$1}var asyncLock,hasRequiredAsyncLock;function requireAsyncLock(){return hasRequiredAsyncLock||(hasRequiredAsyncLock=1,asyncLock=requireLib$1()),asyncLock}var inherits_browser={exports:{}},hasRequiredInherits_browser;function requireInherits_browser(){return hasRequiredInherits_browser||(hasRequiredInherits_browser=1,typeof Object.create=="function"?inherits_browser.exports=function(e,r){r&&(e.super_=r,e.prototype=Object.create(r.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}))}:inherits_browser.exports=function(e,r){if(r){e.super_=r;var n=function(){};n.prototype=r.prototype,e.prototype=new n,e.prototype.constructor=e}}),inherits_browser.exports}var safeBuffer={exports:{}},dist={},hasRequiredDist;function requireDist(){return hasRequiredDist||(hasRequiredDist=1,(function(t){Object.defineProperties(t,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});var e={},r={};r.byteLength=l,r.toByteArray=p,r.fromByteArray=A;for(var n=[],c=[],s=typeof Uint8Array<"u"?Uint8Array:Array,h="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o=0,a=h.length;o<a;++o)n[o]=h[o],c[h.charCodeAt(o)]=o;c[45]=62,c[95]=63;function d(g){var m=g.length;if(m%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var $=g.indexOf("=");$===-1&&($=m);var I=$===m?0:4-$%4;return[$,I]}function l(g){var m=d(g),$=m[0],I=m[1];return($+I)*3/4-I}function f(g,m,$){return(m+$)*3/4-$}function p(g){var m,$=d(g),I=$[0],B=$[1],P=new s(f(g,I,B)),x=0,N=B>0?I-4:I,J;for(J=0;J<N;J+=4)m=c[g.charCodeAt(J)]<<18|c[g.charCodeAt(J+1)]<<12|c[g.charCodeAt(J+2)]<<6|c[g.charCodeAt(J+3)],P[x++]=m>>16&255,P[x++]=m>>8&255,P[x++]=m&255;return B===2&&(m=c[g.charCodeAt(J)]<<2|c[g.charCodeAt(J+1)]>>4,P[x++]=m&255),B===1&&(m=c[g.charCodeAt(J)]<<10|c[g.charCodeAt(J+1)]<<4|c[g.charCodeAt(J+2)]>>2,P[x++]=m>>8&255,P[x++]=m&255),P}function S(g){return n[g>>18&63]+n[g>>12&63]+n[g>>6&63]+n[g&63]}function k(g,m,$){for(var I,B=[],P=m;P<$;P+=3)I=(g[P]<<16&16711680)+(g[P+1]<<8&65280)+(g[P+2]&255),B.push(S(I));return B.join("")}function A(g){for(var m,$=g.length,I=$%3,B=[],P=16383,x=0,N=$-I;x<N;x+=P)B.push(k(g,x,x+P>N?N:x+P));return I===1?(m=g[$-1],B.push(n[m>>2]+n[m<<4&63]+"==")):I===2&&(m=(g[$-2]<<8)+g[$-1],B.push(n[m>>10]+n[m>>4&63]+n[m<<2&63]+"=")),B.join("")}var w={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */w.read=function(g,m,$,I,B){var P,x,N=B*8-I-1,J=(1<<N)-1,Q=J>>1,W=-7,Y=$?B-1:0,ve=$?-1:1,Be=g[m+Y];for(Y+=ve,P=Be&(1<<-W)-1,Be>>=-W,W+=N;W>0;P=P*256+g[m+Y],Y+=ve,W-=8);for(x=P&(1<<-W)-1,P>>=-W,W+=I;W>0;x=x*256+g[m+Y],Y+=ve,W-=8);if(P===0)P=1-Q;else{if(P===J)return x?NaN:(Be?-1:1)*(1/0);x=x+Math.pow(2,I),P=P-Q}return(Be?-1:1)*x*Math.pow(2,P-I)},w.write=function(g,m,$,I,B,P){var x,N,J,Q=P*8-B-1,W=(1<<Q)-1,Y=W>>1,ve=B===23?Math.pow(2,-24)-Math.pow(2,-77):0,Be=I?0:P-1,je=I?1:-1,xe=m<0||m===0&&1/m<0?1:0;for(m=Math.abs(m),isNaN(m)||m===1/0?(N=isNaN(m)?1:0,x=W):(x=Math.floor(Math.log(m)/Math.LN2),m*(J=Math.pow(2,-x))<1&&(x--,J*=2),x+Y>=1?m+=ve/J:m+=ve*Math.pow(2,1-Y),m*J>=2&&(x++,J/=2),x+Y>=W?(N=0,x=W):x+Y>=1?(N=(m*J-1)*Math.pow(2,B),x=x+Y):(N=m*Math.pow(2,Y-1)*Math.pow(2,B),x=0));B>=8;g[$+Be]=N&255,Be+=je,N/=256,B-=8);for(x=x<<B|N,Q+=B;Q>0;g[$+Be]=x&255,Be+=je,x/=256,Q-=8);g[$+Be-je]|=xe*128};/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */(function(g){const m=r,$=w,I=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;g.Buffer=W,g.SlowBuffer=V,g.INSPECT_MAX_BYTES=50;const B=2147483647;g.kMaxLength=B;const{Uint8Array:P,ArrayBuffer:x,SharedArrayBuffer:N}=globalThis;W.TYPED_ARRAY_SUPPORT=J(),!W.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function J(){try{const M=new P(1),R={foo:function(){return 42}};return Object.setPrototypeOf(R,P.prototype),Object.setPrototypeOf(M,R),M.foo()===42}catch{return!1}}Object.defineProperty(W.prototype,"parent",{enumerable:!0,get:function(){if(W.isBuffer(this))return this.buffer}}),Object.defineProperty(W.prototype,"offset",{enumerable:!0,get:function(){if(W.isBuffer(this))return this.byteOffset}});function Q(M){if(M>B)throw new RangeError('The value "'+M+'" is invalid for option "size"');const R=new P(M);return Object.setPrototypeOf(R,W.prototype),R}function W(M,R,D){if(typeof M=="number"){if(typeof R=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return je(M)}return Y(M,R,D)}W.poolSize=8192;function Y(M,R,D){if(typeof M=="string")return xe(M,R);if(x.isView(M))return q(M);if(M==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof M);if(ie(M,x)||M&&ie(M.buffer,x)||typeof N<"u"&&(ie(M,N)||M&&ie(M.buffer,N)))return j(M,R,D);if(typeof M=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');const X=M.valueOf&&M.valueOf();if(X!=null&&X!==M)return W.from(X,R,D);const he=H(M);if(he)return he;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof M[Symbol.toPrimitive]=="function")return W.from(M[Symbol.toPrimitive]("string"),R,D);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof M)}W.from=function(M,R,D){return Y(M,R,D)},Object.setPrototypeOf(W.prototype,P.prototype),Object.setPrototypeOf(W,P);function ve(M){if(typeof M!="number")throw new TypeError('"size" argument must be of type number');if(M<0)throw new RangeError('The value "'+M+'" is invalid for option "size"')}function Be(M,R,D){return ve(M),M<=0?Q(M):R!==void 0?typeof D=="string"?Q(M).fill(R,D):Q(M).fill(R):Q(M)}W.alloc=function(M,R,D){return Be(M,R,D)};function je(M){return ve(M),Q(M<0?0:G(M)|0)}W.allocUnsafe=function(M){return je(M)},W.allocUnsafeSlow=function(M){return je(M)};function xe(M,R){if((typeof R!="string"||R==="")&&(R="utf8"),!W.isEncoding(R))throw new TypeError("Unknown encoding: "+R);const D=oe(M,R)|0;let X=Q(D);const he=X.write(M,R);return he!==D&&(X=X.slice(0,he)),X}function ke(M){const R=M.length<0?0:G(M.length)|0,D=Q(R);for(let X=0;X<R;X+=1)D[X]=M[X]&255;return D}function q(M){if(ie(M,P)){const R=new P(M);return j(R.buffer,R.byteOffset,R.byteLength)}return ke(M)}function j(M,R,D){if(R<0||M.byteLength<R)throw new RangeError('"offset" is outside of buffer bounds');if(M.byteLength<R+(D||0))throw new RangeError('"length" is outside of buffer bounds');let X;return R===void 0&&D===void 0?X=new P(M):D===void 0?X=new P(M,R):X=new P(M,R,D),Object.setPrototypeOf(X,W.prototype),X}function H(M){if(W.isBuffer(M)){const R=G(M.length)|0,D=Q(R);return D.length===0||M.copy(D,0,0,R),D}if(M.length!==void 0)return typeof M.length!="number"||Se(M.length)?Q(0):ke(M);if(M.type==="Buffer"&&Array.isArray(M.data))return ke(M.data)}function G(M){if(M>=B)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+B.toString(16)+" bytes");return M|0}function V(M){return+M!=M&&(M=0),W.alloc(+M)}W.isBuffer=function(R){return R!=null&&R._isBuffer===!0&&R!==W.prototype},W.compare=function(R,D){if(ie(R,P)&&(R=W.from(R,R.offset,R.byteLength)),ie(D,P)&&(D=W.from(D,D.offset,D.byteLength)),!W.isBuffer(R)||!W.isBuffer(D))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(R===D)return 0;let X=R.length,he=D.length;for(let we=0,Ae=Math.min(X,he);we<Ae;++we)if(R[we]!==D[we]){X=R[we],he=D[we];break}return X<he?-1:he<X?1:0},W.isEncoding=function(R){switch(String(R).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},W.concat=function(R,D){if(!Array.isArray(R))throw new TypeError('"list" argument must be an Array of Buffers');if(R.length===0)return W.alloc(0);let X;if(D===void 0)for(D=0,X=0;X<R.length;++X)D+=R[X].length;const he=W.allocUnsafe(D);let we=0;for(X=0;X<R.length;++X){let Ae=R[X];if(ie(Ae,P))we+Ae.length>he.length?(W.isBuffer(Ae)||(Ae=W.from(Ae)),Ae.copy(he,we)):P.prototype.set.call(he,Ae,we);else if(W.isBuffer(Ae))Ae.copy(he,we);else throw new TypeError('"list" argument must be an Array of Buffers');we+=Ae.length}return he};function oe(M,R){if(W.isBuffer(M))return M.length;if(x.isView(M)||ie(M,x))return M.byteLength;if(typeof M!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof M);const D=M.length,X=arguments.length>2&&arguments[2]===!0;if(!X&&D===0)return 0;let he=!1;for(;;)switch(R){case"ascii":case"latin1":case"binary":return D;case"utf8":case"utf-8":return qe(M).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return D*2;case"hex":return D>>>1;case"base64":return me(M).length;default:if(he)return X?-1:qe(M).length;R=(""+R).toLowerCase(),he=!0}}W.byteLength=oe;function Z(M,R,D){let X=!1;if((R===void 0||R<0)&&(R=0),R>this.length||((D===void 0||D>this.length)&&(D=this.length),D<=0)||(D>>>=0,R>>>=0,D<=R))return"";for(M||(M="utf8");;)switch(M){case"hex":return We(this,R,D);case"utf8":case"utf-8":return yt(this,R,D);case"ascii":return Re(this,R,D);case"latin1":case"binary":return Ke(this,R,D);case"base64":return rt(this,R,D);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Ze(this,R,D);default:if(X)throw new TypeError("Unknown encoding: "+M);M=(M+"").toLowerCase(),X=!0}}W.prototype._isBuffer=!0;function pe(M,R,D){const X=M[R];M[R]=M[D],M[D]=X}W.prototype.swap16=function(){const R=this.length;if(R%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let D=0;D<R;D+=2)pe(this,D,D+1);return this},W.prototype.swap32=function(){const R=this.length;if(R%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let D=0;D<R;D+=4)pe(this,D,D+3),pe(this,D+1,D+2);return this},W.prototype.swap64=function(){const R=this.length;if(R%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let D=0;D<R;D+=8)pe(this,D,D+7),pe(this,D+1,D+6),pe(this,D+2,D+5),pe(this,D+3,D+4);return this},W.prototype.toString=function(){const R=this.length;return R===0?"":arguments.length===0?yt(this,0,R):Z.apply(this,arguments)},W.prototype.toLocaleString=W.prototype.toString,W.prototype.equals=function(R){if(!W.isBuffer(R))throw new TypeError("Argument must be a Buffer");return this===R?!0:W.compare(this,R)===0},W.prototype.inspect=function(){let R="";const D=g.INSPECT_MAX_BYTES;return R=this.toString("hex",0,D).replace(/(.{2})/g,"$1 ").trim(),this.length>D&&(R+=" ... "),"<Buffer "+R+">"},I&&(W.prototype[I]=W.prototype.inspect),W.prototype.compare=function(R,D,X,he,we){if(ie(R,P)&&(R=W.from(R,R.offset,R.byteLength)),!W.isBuffer(R))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof R);if(D===void 0&&(D=0),X===void 0&&(X=R?R.length:0),he===void 0&&(he=0),we===void 0&&(we=this.length),D<0||X>R.length||he<0||we>this.length)throw new RangeError("out of range index");if(he>=we&&D>=X)return 0;if(he>=we)return-1;if(D>=X)return 1;if(D>>>=0,X>>>=0,he>>>=0,we>>>=0,this===R)return 0;let Ae=we-he,De=X-D;const Et=Math.min(Ae,De),St=this.slice(he,we),Qe=R.slice(D,X);for(let mt=0;mt<Et;++mt)if(St[mt]!==Qe[mt]){Ae=St[mt],De=Qe[mt];break}return Ae<De?-1:De<Ae?1:0};function ce(M,R,D,X,he){if(M.length===0)return-1;if(typeof D=="string"?(X=D,D=0):D>2147483647?D=2147483647:D<-2147483648&&(D=-2147483648),D=+D,Se(D)&&(D=he?0:M.length-1),D<0&&(D=M.length+D),D>=M.length){if(he)return-1;D=M.length-1}else if(D<0)if(he)D=0;else return-1;if(typeof R=="string"&&(R=W.from(R,X)),W.isBuffer(R))return R.length===0?-1:U(M,R,D,X,he);if(typeof R=="number")return R=R&255,typeof P.prototype.indexOf=="function"?he?P.prototype.indexOf.call(M,R,D):P.prototype.lastIndexOf.call(M,R,D):U(M,[R],D,X,he);throw new TypeError("val must be string, number or Buffer")}function U(M,R,D,X,he){let we=1,Ae=M.length,De=R.length;if(X!==void 0&&(X=String(X).toLowerCase(),X==="ucs2"||X==="ucs-2"||X==="utf16le"||X==="utf-16le")){if(M.length<2||R.length<2)return-1;we=2,Ae/=2,De/=2,D/=2}function Et(Qe,mt){return we===1?Qe[mt]:Qe.readUInt16BE(mt*we)}let St;if(he){let Qe=-1;for(St=D;St<Ae;St++)if(Et(M,St)===Et(R,Qe===-1?0:St-Qe)){if(Qe===-1&&(Qe=St),St-Qe+1===De)return Qe*we}else Qe!==-1&&(St-=St-Qe),Qe=-1}else for(D+De>Ae&&(D=Ae-De),St=D;St>=0;St--){let Qe=!0;for(let mt=0;mt<De;mt++)if(Et(M,St+mt)!==Et(R,mt)){Qe=!1;break}if(Qe)return St}return-1}W.prototype.includes=function(R,D,X){return this.indexOf(R,D,X)!==-1},W.prototype.indexOf=function(R,D,X){return ce(this,R,D,X,!0)},W.prototype.lastIndexOf=function(R,D,X){return ce(this,R,D,X,!1)};function ye(M,R,D,X){D=Number(D)||0;const he=M.length-D;X?(X=Number(X),X>he&&(X=he)):X=he;const we=R.length;X>we/2&&(X=we/2);let Ae;for(Ae=0;Ae<X;++Ae){const De=parseInt(R.substr(Ae*2,2),16);if(Se(De))return Ae;M[D+Ae]=De}return Ae}function be(M,R,D,X){return Me(qe(R,M.length-D),M,D,X)}function Pe(M,R,D,X){return Me(lt(R),M,D,X)}function Oe(M,R,D,X){return Me(me(R),M,D,X)}function Ue(M,R,D,X){return Me(L(R,M.length-D),M,D,X)}W.prototype.write=function(R,D,X,he){if(D===void 0)he="utf8",X=this.length,D=0;else if(X===void 0&&typeof D=="string")he=D,X=this.length,D=0;else if(isFinite(D))D=D>>>0,isFinite(X)?(X=X>>>0,he===void 0&&(he="utf8")):(he=X,X=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");const we=this.length-D;if((X===void 0||X>we)&&(X=we),R.length>0&&(X<0||D<0)||D>this.length)throw new RangeError("Attempt to write outside buffer bounds");he||(he="utf8");let Ae=!1;for(;;)switch(he){case"hex":return ye(this,R,D,X);case"utf8":case"utf-8":return be(this,R,D,X);case"ascii":case"latin1":case"binary":return Pe(this,R,D,X);case"base64":return Oe(this,R,D,X);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Ue(this,R,D,X);default:if(Ae)throw new TypeError("Unknown encoding: "+he);he=(""+he).toLowerCase(),Ae=!0}},W.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function rt(M,R,D){return R===0&&D===M.length?m.fromByteArray(M):m.fromByteArray(M.slice(R,D))}function yt(M,R,D){D=Math.min(M.length,D);const X=[];let he=R;for(;he<D;){const we=M[he];let Ae=null,De=we>239?4:we>223?3:we>191?2:1;if(he+De<=D){let Et,St,Qe,mt;switch(De){case 1:we<128&&(Ae=we);break;case 2:Et=M[he+1],(Et&192)===128&&(mt=(we&31)<<6|Et&63,mt>127&&(Ae=mt));break;case 3:Et=M[he+1],St=M[he+2],(Et&192)===128&&(St&192)===128&&(mt=(we&15)<<12|(Et&63)<<6|St&63,mt>2047&&(mt<55296||mt>57343)&&(Ae=mt));break;case 4:Et=M[he+1],St=M[he+2],Qe=M[he+3],(Et&192)===128&&(St&192)===128&&(Qe&192)===128&&(mt=(we&15)<<18|(Et&63)<<12|(St&63)<<6|Qe&63,mt>65535&&mt<1114112&&(Ae=mt))}}Ae===null?(Ae=65533,De=1):Ae>65535&&(Ae-=65536,X.push(Ae>>>10&1023|55296),Ae=56320|Ae&1023),X.push(Ae),he+=De}return fe(X)}const dt=4096;function fe(M){const R=M.length;if(R<=dt)return String.fromCharCode.apply(String,M);let D="",X=0;for(;X<R;)D+=String.fromCharCode.apply(String,M.slice(X,X+=dt));return D}function Re(M,R,D){let X="";D=Math.min(M.length,D);for(let he=R;he<D;++he)X+=String.fromCharCode(M[he]&127);return X}function Ke(M,R,D){let X="";D=Math.min(M.length,D);for(let he=R;he<D;++he)X+=String.fromCharCode(M[he]);return X}function We(M,R,D){const X=M.length;(!R||R<0)&&(R=0),(!D||D<0||D>X)&&(D=X);let he="";for(let we=R;we<D;++we)he+=Le[M[we]];return he}function Ze(M,R,D){const X=M.slice(R,D);let he="";for(let we=0;we<X.length-1;we+=2)he+=String.fromCharCode(X[we]+X[we+1]*256);return he}W.prototype.slice=function(R,D){const X=this.length;R=~~R,D=D===void 0?X:~~D,R<0?(R+=X,R<0&&(R=0)):R>X&&(R=X),D<0?(D+=X,D<0&&(D=0)):D>X&&(D=X),D<R&&(D=R);const he=this.subarray(R,D);return Object.setPrototypeOf(he,W.prototype),he};function st(M,R,D){if(M%1!==0||M<0)throw new RangeError("offset is not uint");if(M+R>D)throw new RangeError("Trying to access beyond buffer length")}W.prototype.readUintLE=W.prototype.readUIntLE=function(R,D,X){R=R>>>0,D=D>>>0,X||st(R,D,this.length);let he=this[R],we=1,Ae=0;for(;++Ae<D&&(we*=256);)he+=this[R+Ae]*we;return he},W.prototype.readUintBE=W.prototype.readUIntBE=function(R,D,X){R=R>>>0,D=D>>>0,X||st(R,D,this.length);let he=this[R+--D],we=1;for(;D>0&&(we*=256);)he+=this[R+--D]*we;return he},W.prototype.readUint8=W.prototype.readUInt8=function(R,D){return R=R>>>0,D||st(R,1,this.length),this[R]},W.prototype.readUint16LE=W.prototype.readUInt16LE=function(R,D){return R=R>>>0,D||st(R,2,this.length),this[R]|this[R+1]<<8},W.prototype.readUint16BE=W.prototype.readUInt16BE=function(R,D){return R=R>>>0,D||st(R,2,this.length),this[R]<<8|this[R+1]},W.prototype.readUint32LE=W.prototype.readUInt32LE=function(R,D){return R=R>>>0,D||st(R,4,this.length),(this[R]|this[R+1]<<8|this[R+2]<<16)+this[R+3]*16777216},W.prototype.readUint32BE=W.prototype.readUInt32BE=function(R,D){return R=R>>>0,D||st(R,4,this.length),this[R]*16777216+(this[R+1]<<16|this[R+2]<<8|this[R+3])},W.prototype.readBigUInt64LE=bt(function(R){R=R>>>0,ge(R,"offset");const D=this[R],X=this[R+7];(D===void 0||X===void 0)&&ne(R,this.length-8);const he=D+this[++R]*2**8+this[++R]*2**16+this[++R]*2**24,we=this[++R]+this[++R]*2**8+this[++R]*2**16+X*2**24;return BigInt(he)+(BigInt(we)<<BigInt(32))}),W.prototype.readBigUInt64BE=bt(function(R){R=R>>>0,ge(R,"offset");const D=this[R],X=this[R+7];(D===void 0||X===void 0)&&ne(R,this.length-8);const he=D*2**24+this[++R]*2**16+this[++R]*2**8+this[++R],we=this[++R]*2**24+this[++R]*2**16+this[++R]*2**8+X;return(BigInt(he)<<BigInt(32))+BigInt(we)}),W.prototype.readIntLE=function(R,D,X){R=R>>>0,D=D>>>0,X||st(R,D,this.length);let he=this[R],we=1,Ae=0;for(;++Ae<D&&(we*=256);)he+=this[R+Ae]*we;return we*=128,he>=we&&(he-=Math.pow(2,8*D)),he},W.prototype.readIntBE=function(R,D,X){R=R>>>0,D=D>>>0,X||st(R,D,this.length);let he=D,we=1,Ae=this[R+--he];for(;he>0&&(we*=256);)Ae+=this[R+--he]*we;return we*=128,Ae>=we&&(Ae-=Math.pow(2,8*D)),Ae},W.prototype.readInt8=function(R,D){return R=R>>>0,D||st(R,1,this.length),this[R]&128?(255-this[R]+1)*-1:this[R]},W.prototype.readInt16LE=function(R,D){R=R>>>0,D||st(R,2,this.length);const X=this[R]|this[R+1]<<8;return X&32768?X|4294901760:X},W.prototype.readInt16BE=function(R,D){R=R>>>0,D||st(R,2,this.length);const X=this[R+1]|this[R]<<8;return X&32768?X|4294901760:X},W.prototype.readInt32LE=function(R,D){return R=R>>>0,D||st(R,4,this.length),this[R]|this[R+1]<<8|this[R+2]<<16|this[R+3]<<24},W.prototype.readInt32BE=function(R,D){return R=R>>>0,D||st(R,4,this.length),this[R]<<24|this[R+1]<<16|this[R+2]<<8|this[R+3]},W.prototype.readBigInt64LE=bt(function(R){R=R>>>0,ge(R,"offset");const D=this[R],X=this[R+7];(D===void 0||X===void 0)&&ne(R,this.length-8);const he=this[R+4]+this[R+5]*2**8+this[R+6]*2**16+(X<<24);return(BigInt(he)<<BigInt(32))+BigInt(D+this[++R]*2**8+this[++R]*2**16+this[++R]*2**24)}),W.prototype.readBigInt64BE=bt(function(R){R=R>>>0,ge(R,"offset");const D=this[R],X=this[R+7];(D===void 0||X===void 0)&&ne(R,this.length-8);const he=(D<<24)+this[++R]*2**16+this[++R]*2**8+this[++R];return(BigInt(he)<<BigInt(32))+BigInt(this[++R]*2**24+this[++R]*2**16+this[++R]*2**8+X)}),W.prototype.readFloatLE=function(R,D){return R=R>>>0,D||st(R,4,this.length),$.read(this,R,!0,23,4)},W.prototype.readFloatBE=function(R,D){return R=R>>>0,D||st(R,4,this.length),$.read(this,R,!1,23,4)},W.prototype.readDoubleLE=function(R,D){return R=R>>>0,D||st(R,8,this.length),$.read(this,R,!0,52,8)},W.prototype.readDoubleBE=function(R,D){return R=R>>>0,D||st(R,8,this.length),$.read(this,R,!1,52,8)};function gt(M,R,D,X,he,we){if(!W.isBuffer(M))throw new TypeError('"buffer" argument must be a Buffer instance');if(R>he||R<we)throw new RangeError('"value" argument is out of bounds');if(D+X>M.length)throw new RangeError("Index out of range")}W.prototype.writeUintLE=W.prototype.writeUIntLE=function(R,D,X,he){if(R=+R,D=D>>>0,X=X>>>0,!he){const De=Math.pow(2,8*X)-1;gt(this,R,D,X,De,0)}let we=1,Ae=0;for(this[D]=R&255;++Ae<X&&(we*=256);)this[D+Ae]=R/we&255;return D+X},W.prototype.writeUintBE=W.prototype.writeUIntBE=function(R,D,X,he){if(R=+R,D=D>>>0,X=X>>>0,!he){const De=Math.pow(2,8*X)-1;gt(this,R,D,X,De,0)}let we=X-1,Ae=1;for(this[D+we]=R&255;--we>=0&&(Ae*=256);)this[D+we]=R/Ae&255;return D+X},W.prototype.writeUint8=W.prototype.writeUInt8=function(R,D,X){return R=+R,D=D>>>0,X||gt(this,R,D,1,255,0),this[D]=R&255,D+1},W.prototype.writeUint16LE=W.prototype.writeUInt16LE=function(R,D,X){return R=+R,D=D>>>0,X||gt(this,R,D,2,65535,0),this[D]=R&255,this[D+1]=R>>>8,D+2},W.prototype.writeUint16BE=W.prototype.writeUInt16BE=function(R,D,X){return R=+R,D=D>>>0,X||gt(this,R,D,2,65535,0),this[D]=R>>>8,this[D+1]=R&255,D+2},W.prototype.writeUint32LE=W.prototype.writeUInt32LE=function(R,D,X){return R=+R,D=D>>>0,X||gt(this,R,D,4,4294967295,0),this[D+3]=R>>>24,this[D+2]=R>>>16,this[D+1]=R>>>8,this[D]=R&255,D+4},W.prototype.writeUint32BE=W.prototype.writeUInt32BE=function(R,D,X){return R=+R,D=D>>>0,X||gt(this,R,D,4,4294967295,0),this[D]=R>>>24,this[D+1]=R>>>16,this[D+2]=R>>>8,this[D+3]=R&255,D+4};function Dt(M,R,D,X,he){ee(R,X,he,M,D,7);let we=Number(R&BigInt(4294967295));M[D++]=we,we=we>>8,M[D++]=we,we=we>>8,M[D++]=we,we=we>>8,M[D++]=we;let Ae=Number(R>>BigInt(32)&BigInt(4294967295));return M[D++]=Ae,Ae=Ae>>8,M[D++]=Ae,Ae=Ae>>8,M[D++]=Ae,Ae=Ae>>8,M[D++]=Ae,D}function wt(M,R,D,X,he){ee(R,X,he,M,D,7);let we=Number(R&BigInt(4294967295));M[D+7]=we,we=we>>8,M[D+6]=we,we=we>>8,M[D+5]=we,we=we>>8,M[D+4]=we;let Ae=Number(R>>BigInt(32)&BigInt(4294967295));return M[D+3]=Ae,Ae=Ae>>8,M[D+2]=Ae,Ae=Ae>>8,M[D+1]=Ae,Ae=Ae>>8,M[D]=Ae,D+8}W.prototype.writeBigUInt64LE=bt(function(R,D=0){return Dt(this,R,D,BigInt(0),BigInt("0xffffffffffffffff"))}),W.prototype.writeBigUInt64BE=bt(function(R,D=0){return wt(this,R,D,BigInt(0),BigInt("0xffffffffffffffff"))}),W.prototype.writeIntLE=function(R,D,X,he){if(R=+R,D=D>>>0,!he){const Et=Math.pow(2,8*X-1);gt(this,R,D,X,Et-1,-Et)}let we=0,Ae=1,De=0;for(this[D]=R&255;++we<X&&(Ae*=256);)R<0&&De===0&&this[D+we-1]!==0&&(De=1),this[D+we]=(R/Ae>>0)-De&255;return D+X},W.prototype.writeIntBE=function(R,D,X,he){if(R=+R,D=D>>>0,!he){const Et=Math.pow(2,8*X-1);gt(this,R,D,X,Et-1,-Et)}let we=X-1,Ae=1,De=0;for(this[D+we]=R&255;--we>=0&&(Ae*=256);)R<0&&De===0&&this[D+we+1]!==0&&(De=1),this[D+we]=(R/Ae>>0)-De&255;return D+X},W.prototype.writeInt8=function(R,D,X){return R=+R,D=D>>>0,X||gt(this,R,D,1,127,-128),R<0&&(R=255+R+1),this[D]=R&255,D+1},W.prototype.writeInt16LE=function(R,D,X){return R=+R,D=D>>>0,X||gt(this,R,D,2,32767,-32768),this[D]=R&255,this[D+1]=R>>>8,D+2},W.prototype.writeInt16BE=function(R,D,X){return R=+R,D=D>>>0,X||gt(this,R,D,2,32767,-32768),this[D]=R>>>8,this[D+1]=R&255,D+2},W.prototype.writeInt32LE=function(R,D,X){return R=+R,D=D>>>0,X||gt(this,R,D,4,2147483647,-2147483648),this[D]=R&255,this[D+1]=R>>>8,this[D+2]=R>>>16,this[D+3]=R>>>24,D+4},W.prototype.writeInt32BE=function(R,D,X){return R=+R,D=D>>>0,X||gt(this,R,D,4,2147483647,-2147483648),R<0&&(R=4294967295+R+1),this[D]=R>>>24,this[D+1]=R>>>16,this[D+2]=R>>>8,this[D+3]=R&255,D+4},W.prototype.writeBigInt64LE=bt(function(R,D=0){return Dt(this,R,D,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),W.prototype.writeBigInt64BE=bt(function(R,D=0){return wt(this,R,D,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function vt(M,R,D,X,he,we){if(D+X>M.length)throw new RangeError("Index out of range");if(D<0)throw new RangeError("Index out of range")}function qt(M,R,D,X,he){return R=+R,D=D>>>0,he||vt(M,R,D,4),$.write(M,R,D,X,23,4),D+4}W.prototype.writeFloatLE=function(R,D,X){return qt(this,R,D,!0,X)},W.prototype.writeFloatBE=function(R,D,X){return qt(this,R,D,!1,X)};function Lt(M,R,D,X,he){return R=+R,D=D>>>0,he||vt(M,R,D,8),$.write(M,R,D,X,52,8),D+8}W.prototype.writeDoubleLE=function(R,D,X){return Lt(this,R,D,!0,X)},W.prototype.writeDoubleBE=function(R,D,X){return Lt(this,R,D,!1,X)},W.prototype.copy=function(R,D,X,he){if(!W.isBuffer(R))throw new TypeError("argument should be a Buffer");if(X||(X=0),!he&&he!==0&&(he=this.length),D>=R.length&&(D=R.length),D||(D=0),he>0&&he<X&&(he=X),he===X||R.length===0||this.length===0)return 0;if(D<0)throw new RangeError("targetStart out of bounds");if(X<0||X>=this.length)throw new RangeError("Index out of range");if(he<0)throw new RangeError("sourceEnd out of bounds");he>this.length&&(he=this.length),R.length-D<he-X&&(he=R.length-D+X);const we=he-X;return this===R&&typeof P.prototype.copyWithin=="function"?this.copyWithin(D,X,he):P.prototype.set.call(R,this.subarray(X,he),D),we},W.prototype.fill=function(R,D,X,he){if(typeof R=="string"){if(typeof D=="string"?(he=D,D=0,X=this.length):typeof X=="string"&&(he=X,X=this.length),he!==void 0&&typeof he!="string")throw new TypeError("encoding must be a string");if(typeof he=="string"&&!W.isEncoding(he))throw new TypeError("Unknown encoding: "+he);if(R.length===1){const Ae=R.charCodeAt(0);(he==="utf8"&&Ae<128||he==="latin1")&&(R=Ae)}}else typeof R=="number"?R=R&255:typeof R=="boolean"&&(R=Number(R));if(D<0||this.length<D||this.length<X)throw new RangeError("Out of range index");if(X<=D)return this;D=D>>>0,X=X===void 0?this.length:X>>>0,R||(R=0);let we;if(typeof R=="number")for(we=D;we<X;++we)this[we]=R;else{const Ae=W.isBuffer(R)?R:W.from(R,he),De=Ae.length;if(De===0)throw new TypeError('The value "'+R+'" is invalid for argument "value"');for(we=0;we<X-D;++we)this[we+D]=Ae[we%De]}return this};const Gt={};function te(M,R,D){Gt[M]=class extends D{constructor(){super(),Object.defineProperty(this,"message",{value:R.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${M}]`,this.stack,delete this.name}get code(){return M}set code(he){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:he,writable:!0})}toString(){return`${this.name} [${M}]: ${this.message}`}}}te("ERR_BUFFER_OUT_OF_BOUNDS",function(M){return M?`${M} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),te("ERR_INVALID_ARG_TYPE",function(M,R){return`The "${M}" argument must be of type number. Received type ${typeof R}`},TypeError),te("ERR_OUT_OF_RANGE",function(M,R,D){let X=`The value of "${M}" is out of range.`,he=D;return Number.isInteger(D)&&Math.abs(D)>2**32?he=C(String(D)):typeof D=="bigint"&&(he=String(D),(D>BigInt(2)**BigInt(32)||D<-(BigInt(2)**BigInt(32)))&&(he=C(he)),he+="n"),X+=` It must be ${R}. Received ${he}`,X},RangeError);function C(M){let R="",D=M.length;const X=M[0]==="-"?1:0;for(;D>=X+4;D-=3)R=`_${M.slice(D-3,D)}${R}`;return`${M.slice(0,D)}${R}`}function O(M,R,D){ge(R,"offset"),(M[R]===void 0||M[R+D]===void 0)&&ne(R,M.length-(D+1))}function ee(M,R,D,X,he,we){if(M>D||M<R){const Ae=typeof R=="bigint"?"n":"";let De;throw R===0||R===BigInt(0)?De=`>= 0${Ae} and < 2${Ae} ** ${(we+1)*8}${Ae}`:De=`>= -(2${Ae} ** ${(we+1)*8-1}${Ae}) and < 2 ** ${(we+1)*8-1}${Ae}`,new Gt.ERR_OUT_OF_RANGE("value",De,M)}O(X,he,we)}function ge(M,R){if(typeof M!="number")throw new Gt.ERR_INVALID_ARG_TYPE(R,"number",M)}function ne(M,R,D){throw Math.floor(M)!==M?(ge(M,D),new Gt.ERR_OUT_OF_RANGE("offset","an integer",M)):R<0?new Gt.ERR_BUFFER_OUT_OF_BOUNDS:new Gt.ERR_OUT_OF_RANGE("offset",`>= 0 and <= ${R}`,M)}const _e=/[^+/0-9A-Za-z-_]/g;function K(M){if(M=M.split("=")[0],M=M.trim().replace(_e,""),M.length<2)return"";for(;M.length%4!==0;)M=M+"=";return M}function qe(M,R){R=R||1/0;let D;const X=M.length;let he=null;const we=[];for(let Ae=0;Ae<X;++Ae){if(D=M.charCodeAt(Ae),D>55295&&D<57344){if(!he){if(D>56319){(R-=3)>-1&&we.push(239,191,189);continue}else if(Ae+1===X){(R-=3)>-1&&we.push(239,191,189);continue}he=D;continue}if(D<56320){(R-=3)>-1&&we.push(239,191,189),he=D;continue}D=(he-55296<<10|D-56320)+65536}else he&&(R-=3)>-1&&we.push(239,191,189);if(he=null,D<128){if((R-=1)<0)break;we.push(D)}else if(D<2048){if((R-=2)<0)break;we.push(D>>6|192,D&63|128)}else if(D<65536){if((R-=3)<0)break;we.push(D>>12|224,D>>6&63|128,D&63|128)}else if(D<1114112){if((R-=4)<0)break;we.push(D>>18|240,D>>12&63|128,D>>6&63|128,D&63|128)}else throw new Error("Invalid code point")}return we}function lt(M){const R=[];for(let D=0;D<M.length;++D)R.push(M.charCodeAt(D)&255);return R}function L(M,R){let D,X,he;const we=[];for(let Ae=0;Ae<M.length&&!((R-=2)<0);++Ae)D=M.charCodeAt(Ae),X=D>>8,he=D%256,we.push(he),we.push(X);return we}function me(M){return m.toByteArray(K(M))}function Me(M,R,D,X){let he;for(he=0;he<X&&!(he+D>=R.length||he>=M.length);++he)R[he+D]=M[he];return he}function ie(M,R){return M instanceof R||M!=null&&M.constructor!=null&&M.constructor.name!=null&&M.constructor.name===R.name}function Se(M){return M!==M}const Le=(function(){const M="0123456789abcdef",R=new Array(256);for(let D=0;D<16;++D){const X=D*16;for(let he=0;he<16;++he)R[X+he]=M[D]+M[he]}return R})();function bt(M){return typeof BigInt>"u"?le:M}function le(){throw new Error("BigInt not supported")}})(e);const v=e.Buffer;t.Blob=e.Blob,t.BlobOptions=e.BlobOptions,t.Buffer=e.Buffer,t.File=e.File,t.FileOptions=e.FileOptions,t.INSPECT_MAX_BYTES=e.INSPECT_MAX_BYTES,t.SlowBuffer=e.SlowBuffer,t.TranscodeEncoding=e.TranscodeEncoding,t.atob=e.atob,t.btoa=e.btoa,t.constants=e.constants,t.default=v,t.isAscii=e.isAscii,t.isUtf8=e.isUtf8,t.kMaxLength=e.kMaxLength,t.kStringMaxLength=e.kStringMaxLength,t.resolveObjectURL=e.resolveObjectURL,t.transcode=e.transcode})(dist)),dist}/*! safe-buffer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */var hasRequiredSafeBuffer;function requireSafeBuffer(){return hasRequiredSafeBuffer||(hasRequiredSafeBuffer=1,(function(t,e){var r=requireDist(),n=r.Buffer;function c(h,o){for(var a in h)o[a]=h[a]}n.from&&n.alloc&&n.allocUnsafe&&n.allocUnsafeSlow?t.exports=r:(c(r,e),e.Buffer=s);function s(h,o,a){return n(h,o,a)}s.prototype=Object.create(n.prototype),c(n,s),s.from=function(h,o,a){if(typeof h=="number")throw new TypeError("Argument must not be a number");return n(h,o,a)},s.alloc=function(h,o,a){if(typeof h!="number")throw new TypeError("Argument must be a number");var d=n(h);return o!==void 0?typeof a=="string"?d.fill(o,a):d.fill(o):d.fill(0),d},s.allocUnsafe=function(h){if(typeof h!="number")throw new TypeError("Argument must be a number");return n(h)},s.allocUnsafeSlow=function(h){if(typeof h!="number")throw new TypeError("Argument must be a number");return r.SlowBuffer(h)}})(safeBuffer,safeBuffer.exports)),safeBuffer.exports}var isarray,hasRequiredIsarray;function requireIsarray(){if(hasRequiredIsarray)return isarray;hasRequiredIsarray=1;var t={}.toString;return isarray=Array.isArray||function(e){return t.call(e)=="[object Array]"},isarray}var type$1,hasRequiredType;function requireType(){return hasRequiredType||(hasRequiredType=1,type$1=TypeError),type$1}var esObjectAtoms,hasRequiredEsObjectAtoms;function requireEsObjectAtoms(){return hasRequiredEsObjectAtoms||(hasRequiredEsObjectAtoms=1,esObjectAtoms=Object),esObjectAtoms}var esErrors,hasRequiredEsErrors;function requireEsErrors(){return hasRequiredEsErrors||(hasRequiredEsErrors=1,esErrors=Error),esErrors}var _eval,hasRequired_eval;function require_eval(){return hasRequired_eval||(hasRequired_eval=1,_eval=EvalError),_eval}var range,hasRequiredRange;function requireRange(){return hasRequiredRange||(hasRequiredRange=1,range=RangeError),range}var ref,hasRequiredRef;function requireRef(){return hasRequiredRef||(hasRequiredRef=1,ref=ReferenceError),ref}var syntax,hasRequiredSyntax;function requireSyntax(){return hasRequiredSyntax||(hasRequiredSyntax=1,syntax=SyntaxError),syntax}var uri,hasRequiredUri;function requireUri(){return hasRequiredUri||(hasRequiredUri=1,uri=URIError),uri}var abs,hasRequiredAbs;function requireAbs(){return hasRequiredAbs||(hasRequiredAbs=1,abs=Math.abs),abs}var floor,hasRequiredFloor;function requireFloor(){return hasRequiredFloor||(hasRequiredFloor=1,floor=Math.floor),floor}var max,hasRequiredMax;function requireMax(){return hasRequiredMax||(hasRequiredMax=1,max=Math.max),max}var min,hasRequiredMin;function requireMin(){return hasRequiredMin||(hasRequiredMin=1,min=Math.min),min}var pow,hasRequiredPow;function requirePow(){return hasRequiredPow||(hasRequiredPow=1,pow=Math.pow),pow}var round,hasRequiredRound;function requireRound(){return hasRequiredRound||(hasRequiredRound=1,round=Math.round),round}var _isNaN,hasRequired_isNaN;function require_isNaN(){return hasRequired_isNaN||(hasRequired_isNaN=1,_isNaN=Number.isNaN||function(e){return e!==e}),_isNaN}var sign,hasRequiredSign;function requireSign(){if(hasRequiredSign)return sign;hasRequiredSign=1;var t=require_isNaN();return sign=function(r){return t(r)||r===0?r:r<0?-1:1},sign}var gOPD,hasRequiredGOPD;function requireGOPD(){return hasRequiredGOPD||(hasRequiredGOPD=1,gOPD=Object.getOwnPropertyDescriptor),gOPD}var gopd,hasRequiredGopd;function requireGopd(){if(hasRequiredGopd)return gopd;hasRequiredGopd=1;var t=requireGOPD();if(t)try{t([],"length")}catch{t=null}return gopd=t,gopd}var esDefineProperty,hasRequiredEsDefineProperty;function requireEsDefineProperty(){if(hasRequiredEsDefineProperty)return esDefineProperty;hasRequiredEsDefineProperty=1;var t=Object.defineProperty||!1;if(t)try{t({},"a",{value:1})}catch{t=!1}return esDefineProperty=t,esDefineProperty}var shams$1,hasRequiredShams$1;function requireShams$1(){return hasRequiredShams$1||(hasRequiredShams$1=1,shams$1=function(){if(typeof Symbol!="function"||typeof Object.getOwnPropertySymbols!="function")return!1;if(typeof Symbol.iterator=="symbol")return!0;var e={},r=Symbol("test"),n=Object(r);if(typeof r=="string"||Object.prototype.toString.call(r)!=="[object Symbol]"||Object.prototype.toString.call(n)!=="[object Symbol]")return!1;var c=42;e[r]=c;for(var s in e)return!1;if(typeof Object.keys=="function"&&Object.keys(e).length!==0||typeof Object.getOwnPropertyNames=="function"&&Object.getOwnPropertyNames(e).length!==0)return!1;var h=Object.getOwnPropertySymbols(e);if(h.length!==1||h[0]!==r||!Object.prototype.propertyIsEnumerable.call(e,r))return!1;if(typeof Object.getOwnPropertyDescriptor=="function"){var o=Object.getOwnPropertyDescriptor(e,r);if(o.value!==c||o.enumerable!==!0)return!1}return!0}),shams$1}var hasSymbols,hasRequiredHasSymbols;function requireHasSymbols(){if(hasRequiredHasSymbols)return hasSymbols;hasRequiredHasSymbols=1;var t=typeof Symbol<"u"&&Symbol,e=requireShams$1();return hasSymbols=function(){return typeof t!="function"||typeof Symbol!="function"||typeof t("foo")!="symbol"||typeof Symbol("bar")!="symbol"?!1:e()},hasSymbols}var Reflect_getPrototypeOf,hasRequiredReflect_getPrototypeOf;function requireReflect_getPrototypeOf(){return hasRequiredReflect_getPrototypeOf||(hasRequiredReflect_getPrototypeOf=1,Reflect_getPrototypeOf=typeof Reflect<"u"&&Reflect.getPrototypeOf||null),Reflect_getPrototypeOf}var Object_getPrototypeOf,hasRequiredObject_getPrototypeOf;function requireObject_getPrototypeOf(){if(hasRequiredObject_getPrototypeOf)return Object_getPrototypeOf;hasRequiredObject_getPrototypeOf=1;var t=requireEsObjectAtoms();return Object_getPrototypeOf=t.getPrototypeOf||null,Object_getPrototypeOf}var implementation,hasRequiredImplementation;function requireImplementation(){if(hasRequiredImplementation)return implementation;hasRequiredImplementation=1;var t="Function.prototype.bind called on incompatible ",e=Object.prototype.toString,r=Math.max,n="[object Function]",c=function(a,d){for(var l=[],f=0;f<a.length;f+=1)l[f]=a[f];for(var p=0;p<d.length;p+=1)l[p+a.length]=d[p];return l},s=function(a,d){for(var l=[],f=d,p=0;f<a.length;f+=1,p+=1)l[p]=a[f];return l},h=function(o,a){for(var d="",l=0;l<o.length;l+=1)d+=o[l],l+1<o.length&&(d+=a);return d};return implementation=function(a){var d=this;if(typeof d!="function"||e.apply(d)!==n)throw new TypeError(t+d);for(var l=s(arguments,1),f,p=function(){if(this instanceof f){var v=d.apply(this,c(l,arguments));return Object(v)===v?v:this}return d.apply(a,c(l,arguments))},S=r(0,d.length-l.length),k=[],A=0;A<S;A++)k[A]="$"+A;if(f=Function("binder","return function ("+h(k,",")+"){ return binder.apply(this,arguments); }")(p),d.prototype){var w=function(){};w.prototype=d.prototype,f.prototype=new w,w.prototype=null}return f},implementation}var functionBind,hasRequiredFunctionBind;function requireFunctionBind(){if(hasRequiredFunctionBind)return functionBind;hasRequiredFunctionBind=1;var t=requireImplementation();return functionBind=Function.prototype.bind||t,functionBind}var functionCall,hasRequiredFunctionCall;function requireFunctionCall(){return hasRequiredFunctionCall||(hasRequiredFunctionCall=1,functionCall=Function.prototype.call),functionCall}var functionApply,hasRequiredFunctionApply;function requireFunctionApply(){return hasRequiredFunctionApply||(hasRequiredFunctionApply=1,functionApply=Function.prototype.apply),functionApply}var reflectApply,hasRequiredReflectApply;function requireReflectApply(){return hasRequiredReflectApply||(hasRequiredReflectApply=1,reflectApply=typeof Reflect<"u"&&Reflect&&Reflect.apply),reflectApply}var actualApply,hasRequiredActualApply;function requireActualApply(){if(hasRequiredActualApply)return actualApply;hasRequiredActualApply=1;var t=requireFunctionBind(),e=requireFunctionApply(),r=requireFunctionCall(),n=requireReflectApply();return actualApply=n||t.call(r,e),actualApply}var callBindApplyHelpers,hasRequiredCallBindApplyHelpers;function requireCallBindApplyHelpers(){if(hasRequiredCallBindApplyHelpers)return callBindApplyHelpers;hasRequiredCallBindApplyHelpers=1;var t=requireFunctionBind(),e=requireType(),r=requireFunctionCall(),n=requireActualApply();return callBindApplyHelpers=function(s){if(s.length<1||typeof s[0]!="function")throw new e("a function is required");return n(t,r,s)},callBindApplyHelpers}var get,hasRequiredGet;function requireGet(){if(hasRequiredGet)return get;hasRequiredGet=1;var t=requireCallBindApplyHelpers(),e=requireGopd(),r;try{r=[].__proto__===Array.prototype}catch(h){if(!h||typeof h!="object"||!("code"in h)||h.code!=="ERR_PROTO_ACCESS")throw h}var n=!!r&&e&&e(Object.prototype,"__proto__"),c=Object,s=c.getPrototypeOf;return get=n&&typeof n.get=="function"?t([n.get]):typeof s=="function"?function(o){return s(o==null?o:c(o))}:!1,get}var getProto,hasRequiredGetProto;function requireGetProto(){if(hasRequiredGetProto)return getProto;hasRequiredGetProto=1;var t=requireReflect_getPrototypeOf(),e=requireObject_getPrototypeOf(),r=requireGet();return getProto=t?function(c){return t(c)}:e?function(c){if(!c||typeof c!="object"&&typeof c!="function")throw new TypeError("getProto: not an object");return e(c)}:r?function(c){return r(c)}:null,getProto}var hasown,hasRequiredHasown;function requireHasown(){if(hasRequiredHasown)return hasown;hasRequiredHasown=1;var t=Function.prototype.call,e=Object.prototype.hasOwnProperty,r=requireFunctionBind();return hasown=r.call(t,e),hasown}var getIntrinsic,hasRequiredGetIntrinsic;function requireGetIntrinsic(){if(hasRequiredGetIntrinsic)return getIntrinsic;hasRequiredGetIntrinsic=1;var t,e=requireEsObjectAtoms(),r=requireEsErrors(),n=require_eval(),c=requireRange(),s=requireRef(),h=requireSyntax(),o=requireType(),a=requireUri(),d=requireAbs(),l=requireFloor(),f=requireMax(),p=requireMin(),S=requirePow(),k=requireRound(),A=requireSign(),w=Function,v=function(ye){try{return w('"use strict"; return ('+ye+").constructor;")()}catch{}},g=requireGopd(),m=requireEsDefineProperty(),$=function(){throw new o},I=g?(function(){try{return arguments.callee,$}catch{try{return g(arguments,"callee").get}catch{return $}}})():$,B=requireHasSymbols()(),P=requireGetProto(),x=requireObject_getPrototypeOf(),N=requireReflect_getPrototypeOf(),J=requireFunctionApply(),Q=requireFunctionCall(),W={},Y=typeof Uint8Array>"u"||!P?t:P(Uint8Array),ve={__proto__:null,"%AggregateError%":typeof AggregateError>"u"?t:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?t:ArrayBuffer,"%ArrayIteratorPrototype%":B&&P?P([][Symbol.iterator]()):t,"%AsyncFromSyncIteratorPrototype%":t,"%AsyncFunction%":W,"%AsyncGenerator%":W,"%AsyncGeneratorFunction%":W,"%AsyncIteratorPrototype%":W,"%Atomics%":typeof Atomics>"u"?t:Atomics,"%BigInt%":typeof BigInt>"u"?t:BigInt,"%BigInt64Array%":typeof BigInt64Array>"u"?t:BigInt64Array,"%BigUint64Array%":typeof BigUint64Array>"u"?t:BigUint64Array,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?t:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":r,"%eval%":eval,"%EvalError%":n,"%Float16Array%":typeof Float16Array>"u"?t:Float16Array,"%Float32Array%":typeof Float32Array>"u"?t:Float32Array,"%Float64Array%":typeof Float64Array>"u"?t:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?t:FinalizationRegistry,"%Function%":w,"%GeneratorFunction%":W,"%Int8Array%":typeof Int8Array>"u"?t:Int8Array,"%Int16Array%":typeof Int16Array>"u"?t:Int16Array,"%Int32Array%":typeof Int32Array>"u"?t:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":B&&P?P(P([][Symbol.iterator]())):t,"%JSON%":typeof JSON=="object"?JSON:t,"%Map%":typeof Map>"u"?t:Map,"%MapIteratorPrototype%":typeof Map>"u"||!B||!P?t:P(new Map()[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":e,"%Object.getOwnPropertyDescriptor%":g,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?t:Promise,"%Proxy%":typeof Proxy>"u"?t:Proxy,"%RangeError%":c,"%ReferenceError%":s,"%Reflect%":typeof Reflect>"u"?t:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?t:Set,"%SetIteratorPrototype%":typeof Set>"u"||!B||!P?t:P(new Set()[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?t:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":B&&P?P(""[Symbol.iterator]()):t,"%Symbol%":B?Symbol:t,"%SyntaxError%":h,"%ThrowTypeError%":I,"%TypedArray%":Y,"%TypeError%":o,"%Uint8Array%":typeof Uint8Array>"u"?t:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?t:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?t:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?t:Uint32Array,"%URIError%":a,"%WeakMap%":typeof WeakMap>"u"?t:WeakMap,"%WeakRef%":typeof WeakRef>"u"?t:WeakRef,"%WeakSet%":typeof WeakSet>"u"?t:WeakSet,"%Function.prototype.call%":Q,"%Function.prototype.apply%":J,"%Object.defineProperty%":m,"%Object.getPrototypeOf%":x,"%Math.abs%":d,"%Math.floor%":l,"%Math.max%":f,"%Math.min%":p,"%Math.pow%":S,"%Math.round%":k,"%Math.sign%":A,"%Reflect.getPrototypeOf%":N};if(P)try{null.error}catch(ye){var Be=P(P(ye));ve["%Error.prototype%"]=Be}var je=function ye(be){var Pe;if(be==="%AsyncFunction%")Pe=v("async function () {}");else if(be==="%GeneratorFunction%")Pe=v("function* () {}");else if(be==="%AsyncGeneratorFunction%")Pe=v("async function* () {}");else if(be==="%AsyncGenerator%"){var Oe=ye("%AsyncGeneratorFunction%");Oe&&(Pe=Oe.prototype)}else if(be==="%AsyncIteratorPrototype%"){var Ue=ye("%AsyncGenerator%");Ue&&P&&(Pe=P(Ue.prototype))}return ve[be]=Pe,Pe},xe={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},ke=requireFunctionBind(),q=requireHasown(),j=ke.call(Q,Array.prototype.concat),H=ke.call(J,Array.prototype.splice),G=ke.call(Q,String.prototype.replace),V=ke.call(Q,String.prototype.slice),oe=ke.call(Q,RegExp.prototype.exec),Z=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,pe=/\\(\\)?/g,ce=function(be){var Pe=V(be,0,1),Oe=V(be,-1);if(Pe==="%"&&Oe!=="%")throw new h("invalid intrinsic syntax, expected closing `%`");if(Oe==="%"&&Pe!=="%")throw new h("invalid intrinsic syntax, expected opening `%`");var Ue=[];return G(be,Z,function(rt,yt,dt,fe){Ue[Ue.length]=dt?G(fe,pe,"$1"):yt||rt}),Ue},U=function(be,Pe){var Oe=be,Ue;if(q(xe,Oe)&&(Ue=xe[Oe],Oe="%"+Ue[0]+"%"),q(ve,Oe)){var rt=ve[Oe];if(rt===W&&(rt=je(Oe)),typeof rt>"u"&&!Pe)throw new o("intrinsic "+be+" exists, but is not available. Please file an issue!");return{alias:Ue,name:Oe,value:rt}}throw new h("intrinsic "+be+" does not exist!")};return getIntrinsic=function(be,Pe){if(typeof be!="string"||be.length===0)throw new o("intrinsic name must be a non-empty string");if(arguments.length>1&&typeof Pe!="boolean")throw new o('"allowMissing" argument must be a boolean');if(oe(/^%?[^%]*%?$/,be)===null)throw new h("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var Oe=ce(be),Ue=Oe.length>0?Oe[0]:"",rt=U("%"+Ue+"%",Pe),yt=rt.name,dt=rt.value,fe=!1,Re=rt.alias;Re&&(Ue=Re[0],H(Oe,j([0,1],Re)));for(var Ke=1,We=!0;Ke<Oe.length;Ke+=1){var Ze=Oe[Ke],st=V(Ze,0,1),gt=V(Ze,-1);if((st==='"'||st==="'"||st==="`"||gt==='"'||gt==="'"||gt==="`")&&st!==gt)throw new h("property names with quotes must have matching quotes");if((Ze==="constructor"||!We)&&(fe=!0),Ue+="."+Ze,yt="%"+Ue+"%",q(ve,yt))dt=ve[yt];else if(dt!=null){if(!(Ze in dt)){if(!Pe)throw new o("base intrinsic for "+be+" exists, but the property is not available.");return}if(g&&Ke+1>=Oe.length){var Dt=g(dt,Ze);We=!!Dt,We&&"get"in Dt&&!("originalValue"in Dt.get)?dt=Dt.get:dt=dt[Ze]}else We=q(dt,Ze),dt=dt[Ze];We&&!fe&&(ve[yt]=dt)}}return dt},getIntrinsic}var callBound,hasRequiredCallBound;function requireCallBound(){if(hasRequiredCallBound)return callBound;hasRequiredCallBound=1;var t=requireGetIntrinsic(),e=requireCallBindApplyHelpers(),r=e([t("%String.prototype.indexOf%")]);return callBound=function(c,s){var h=t(c,!!s);return typeof h=="function"&&r(c,".prototype.")>-1?e([h]):h},callBound}var isCallable,hasRequiredIsCallable;function requireIsCallable(){if(hasRequiredIsCallable)return isCallable;hasRequiredIsCallable=1;var t=Function.prototype.toString,e=typeof Reflect=="object"&&Reflect!==null&&Reflect.apply,r,n;if(typeof e=="function"&&typeof Object.defineProperty=="function")try{r=Object.defineProperty({},"length",{get:function(){throw n}}),n={},e(function(){throw 42},null,r)}catch(g){g!==n&&(e=null)}else e=null;var c=/^\s*class\b/,s=function(m){try{var $=t.call(m);return c.test($)}catch{return!1}},h=function(m){try{return s(m)?!1:(t.call(m),!0)}catch{return!1}},o=Object.prototype.toString,a="[object Object]",d="[object Function]",l="[object GeneratorFunction]",f="[object HTMLAllCollection]",p="[object HTML document.all class]",S="[object HTMLCollection]",k=typeof Symbol=="function"&&!!Symbol.toStringTag,A=!(0 in[,]),w=function(){return!1};if(typeof document=="object"){var v=document.all;o.call(v)===o.call(document.all)&&(w=function(m){if((A||!m)&&(typeof m>"u"||typeof m=="object"))try{var $=o.call(m);return($===f||$===p||$===S||$===a)&&m("")==null}catch{}return!1})}return isCallable=e?function(m){if(w(m))return!0;if(!m||typeof m!="function"&&typeof m!="object")return!1;try{e(m,null,r)}catch($){if($!==n)return!1}return!s(m)&&h(m)}:function(m){if(w(m))return!0;if(!m||typeof m!="function"&&typeof m!="object")return!1;if(k)return h(m);if(s(m))return!1;var $=o.call(m);return $!==d&&$!==l&&!/^\[object HTML/.test($)?!1:h(m)},isCallable}var forEach,hasRequiredForEach;function requireForEach(){if(hasRequiredForEach)return forEach;hasRequiredForEach=1;var t=requireIsCallable(),e=Object.prototype.toString,r=Object.prototype.hasOwnProperty,n=function(a,d,l){for(var f=0,p=a.length;f<p;f++)r.call(a,f)&&(l==null?d(a[f],f,a):d.call(l,a[f],f,a))},c=function(a,d,l){for(var f=0,p=a.length;f<p;f++)l==null?d(a.charAt(f),f,a):d.call(l,a.charAt(f),f,a)},s=function(a,d,l){for(var f in a)r.call(a,f)&&(l==null?d(a[f],f,a):d.call(l,a[f],f,a))};function h(o){return e.call(o)==="[object Array]"}return forEach=function(a,d,l){if(!t(d))throw new TypeError("iterator must be a function");var f;arguments.length>=3&&(f=l),h(a)?n(a,d,f):typeof a=="string"?c(a,d,f):s(a,d,f)},forEach}var possibleTypedArrayNames,hasRequiredPossibleTypedArrayNames;function requirePossibleTypedArrayNames(){return hasRequiredPossibleTypedArrayNames||(hasRequiredPossibleTypedArrayNames=1,possibleTypedArrayNames=["Float16Array","Float32Array","Float64Array","Int8Array","Int16Array","Int32Array","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","BigInt64Array","BigUint64Array"]),possibleTypedArrayNames}var availableTypedArrays,hasRequiredAvailableTypedArrays;function requireAvailableTypedArrays(){if(hasRequiredAvailableTypedArrays)return availableTypedArrays;hasRequiredAvailableTypedArrays=1;var t=requirePossibleTypedArrayNames(),e=typeof globalThis>"u"?commonjsGlobal:globalThis;return availableTypedArrays=function(){for(var n=[],c=0;c<t.length;c++)typeof e[t[c]]=="function"&&(n[n.length]=t[c]);return n},availableTypedArrays}var callBind={exports:{}},defineDataProperty,hasRequiredDefineDataProperty;function requireDefineDataProperty(){if(hasRequiredDefineDataProperty)return defineDataProperty;hasRequiredDefineDataProperty=1;var t=requireEsDefineProperty(),e=requireSyntax(),r=requireType(),n=requireGopd();return defineDataProperty=function(s,h,o){if(!s||typeof s!="object"&&typeof s!="function")throw new r("`obj` must be an object or a function`");if(typeof h!="string"&&typeof h!="symbol")throw new r("`property` must be a string or a symbol`");if(arguments.length>3&&typeof arguments[3]!="boolean"&&arguments[3]!==null)throw new r("`nonEnumerable`, if provided, must be a boolean or null");if(arguments.length>4&&typeof arguments[4]!="boolean"&&arguments[4]!==null)throw new r("`nonWritable`, if provided, must be a boolean or null");if(arguments.length>5&&typeof arguments[5]!="boolean"&&arguments[5]!==null)throw new r("`nonConfigurable`, if provided, must be a boolean or null");if(arguments.length>6&&typeof arguments[6]!="boolean")throw new r("`loose`, if provided, must be a boolean");var a=arguments.length>3?arguments[3]:null,d=arguments.length>4?arguments[4]:null,l=arguments.length>5?arguments[5]:null,f=arguments.length>6?arguments[6]:!1,p=!!n&&n(s,h);if(t)t(s,h,{configurable:l===null&&p?p.configurable:!l,enumerable:a===null&&p?p.enumerable:!a,value:o,writable:d===null&&p?p.writable:!d});else if(f||!a&&!d&&!l)s[h]=o;else throw new e("This environment does not support defining a property as non-configurable, non-writable, or non-enumerable.")},defineDataProperty}var hasPropertyDescriptors_1,hasRequiredHasPropertyDescriptors;function requireHasPropertyDescriptors(){if(hasRequiredHasPropertyDescriptors)return hasPropertyDescriptors_1;hasRequiredHasPropertyDescriptors=1;var t=requireEsDefineProperty(),e=function(){return!!t};return e.hasArrayLengthDefineBug=function(){if(!t)return null;try{return t([],"length",{value:1}).length!==1}catch{return!0}},hasPropertyDescriptors_1=e,hasPropertyDescriptors_1}var setFunctionLength,hasRequiredSetFunctionLength;function requireSetFunctionLength(){if(hasRequiredSetFunctionLength)return setFunctionLength;hasRequiredSetFunctionLength=1;var t=requireGetIntrinsic(),e=requireDefineDataProperty(),r=requireHasPropertyDescriptors()(),n=requireGopd(),c=requireType(),s=t("%Math.floor%");return setFunctionLength=function(o,a){if(typeof o!="function")throw new c("`fn` is not a function");if(typeof a!="number"||a<0||a>4294967295||s(a)!==a)throw new c("`length` must be a positive 32-bit integer");var d=arguments.length>2&&!!arguments[2],l=!0,f=!0;if("length"in o&&n){var p=n(o,"length");p&&!p.configurable&&(l=!1),p&&!p.writable&&(f=!1)}return(l||f||!d)&&(r?e(o,"length",a,!0,!0):e(o,"length",a)),o},setFunctionLength}var applyBind,hasRequiredApplyBind;function requireApplyBind(){if(hasRequiredApplyBind)return applyBind;hasRequiredApplyBind=1;var t=requireFunctionBind(),e=requireFunctionApply(),r=requireActualApply();return applyBind=function(){return r(t,e,arguments)},applyBind}var hasRequiredCallBind;function requireCallBind(){return hasRequiredCallBind||(hasRequiredCallBind=1,(function(t){var e=requireSetFunctionLength(),r=requireEsDefineProperty(),n=requireCallBindApplyHelpers(),c=requireApplyBind();t.exports=function(h){var o=n(arguments),a=h.length-(arguments.length-1);return e(o,1+(a>0?a:0),!0)},r?r(t.exports,"apply",{value:c}):t.exports.apply=c})(callBind)),callBind.exports}var shams,hasRequiredShams;function requireShams(){if(hasRequiredShams)return shams;hasRequiredShams=1;var t=requireShams$1();return shams=function(){return t()&&!!Symbol.toStringTag},shams}var whichTypedArray,hasRequiredWhichTypedArray;function requireWhichTypedArray(){if(hasRequiredWhichTypedArray)return whichTypedArray;hasRequiredWhichTypedArray=1;var t=requireForEach(),e=requireAvailableTypedArrays(),r=requireCallBind(),n=requireCallBound(),c=requireGopd(),s=requireGetProto(),h=n("Object.prototype.toString"),o=requireShams()(),a=typeof globalThis>"u"?commonjsGlobal:globalThis,d=e(),l=n("String.prototype.slice"),f=n("Array.prototype.indexOf",!0)||function(w,v){for(var g=0;g<w.length;g+=1)if(w[g]===v)return g;return-1},p={__proto__:null};o&&c&&s?t(d,function(A){var w=new a[A];if(Symbol.toStringTag in w&&s){var v=s(w),g=c(v,Symbol.toStringTag);if(!g&&v){var m=s(v);g=c(m,Symbol.toStringTag)}if(g&&g.get){var $=r(g.get);p["$"+A]=$}}}):t(d,function(A){var w=new a[A],v=w.slice||w.set;if(v){var g=r(v);p["$"+A]=g}});var S=function(w){var v=!1;return t(p,function(g,m){if(!v)try{"$"+g(w)===m&&(v=l(m,1))}catch{}}),v},k=function(w){var v=!1;return t(p,function(g,m){if(!v)try{g(w),v=l(m,1)}catch{}}),v};return whichTypedArray=function(w){if(!w||typeof w!="object")return!1;if(!o){var v=l(h(w),8,-1);return f(d,v)>-1?v:v!=="Object"?!1:k(w)}return c?S(w):null},whichTypedArray}var isTypedArray,hasRequiredIsTypedArray;function requireIsTypedArray(){if(hasRequiredIsTypedArray)return isTypedArray;hasRequiredIsTypedArray=1;var t=requireWhichTypedArray();return isTypedArray=function(r){return!!t(r)},isTypedArray}var typedArrayBuffer,hasRequiredTypedArrayBuffer;function requireTypedArrayBuffer(){if(hasRequiredTypedArrayBuffer)return typedArrayBuffer;hasRequiredTypedArrayBuffer=1;var t=requireType(),e=requireCallBound(),r=e("TypedArray.prototype.buffer",!0),n=requireIsTypedArray();return typedArrayBuffer=r||function(s){if(!n(s))throw new t("Not a Typed Array");return s.buffer},typedArrayBuffer}var toBuffer,hasRequiredToBuffer;function requireToBuffer(){if(hasRequiredToBuffer)return toBuffer;hasRequiredToBuffer=1;var t=requireSafeBuffer().Buffer,e=requireIsarray(),r=requireTypedArrayBuffer(),n=ArrayBuffer.isView||function(a){try{return r(a),!0}catch{return!1}},c=typeof Uint8Array<"u",s=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",h=s&&(t.prototype instanceof Uint8Array||t.TYPED_ARRAY_SUPPORT);return toBuffer=function(a,d){if(t.isBuffer(a))return a.constructor&&!("isBuffer"in a)?t.from(a):a;if(typeof a=="string")return t.from(a,d);if(s&&n(a)){if(a.byteLength===0)return t.alloc(0);if(h){var l=t.from(a.buffer,a.byteOffset,a.byteLength);if(l.byteLength===a.byteLength)return l}var f=a instanceof Uint8Array?a:new Uint8Array(a.buffer,a.byteOffset,a.byteLength),p=t.from(f);if(p.length===a.byteLength)return p}if(c&&a instanceof Uint8Array)return t.from(a);var S=e(a);if(S)for(var k=0;k<a.length;k+=1){var A=a[k];if(typeof A!="number"||A<0||A>255||~~A!==A)throw new RangeError("Array items must be numbers in the range 0-255.")}if(S||t.isBuffer(a)&&a.constructor&&typeof a.constructor.isBuffer=="function"&&a.constructor.isBuffer(a))return t.from(a);throw new TypeError('The "data" argument must be a string, an Array, a Buffer, a Uint8Array, or a DataView.')},toBuffer}var hash$1,hasRequiredHash;function requireHash(){if(hasRequiredHash)return hash$1;hasRequiredHash=1;var t=requireSafeBuffer().Buffer,e=requireToBuffer();function r(n,c){this._block=t.alloc(n),this._finalSize=c,this._blockSize=n,this._len=0}return r.prototype.update=function(n,c){n=e(n,c||"utf8");for(var s=this._block,h=this._blockSize,o=n.length,a=this._len,d=0;d<o;){for(var l=a%h,f=Math.min(o-d,h-l),p=0;p<f;p++)s[l+p]=n[d+p];a+=f,d+=f,a%h===0&&this._update(s)}return this._len+=o,this},r.prototype.digest=function(n){var c=this._len%this._blockSize;this._block[c]=128,this._block.fill(0,c+1),c>=this._finalSize&&(this._update(this._block),this._block.fill(0));var s=this._len*8;if(s<=4294967295)this._block.writeUInt32BE(s,this._blockSize-4);else{var h=(s&4294967295)>>>0,o=(s-h)/4294967296;this._block.writeUInt32BE(o,this._blockSize-8),this._block.writeUInt32BE(h,this._blockSize-4)}this._update(this._block);var a=this._hash();return n?a.toString(n):a},r.prototype._update=function(){throw new Error("_update must be implemented by subclass")},hash$1=r,hash$1}var sha1,hasRequiredSha1;function requireSha1(){if(hasRequiredSha1)return sha1;hasRequiredSha1=1;var t=requireInherits_browser(),e=requireHash(),r=requireSafeBuffer().Buffer,n=[1518500249,1859775393,-1894007588,-899497514],c=new Array(80);function s(){this.init(),this._w=c,e.call(this,64,56)}t(s,e),s.prototype.init=function(){return this._a=1732584193,this._b=4023233417,this._c=2562383102,this._d=271733878,this._e=3285377520,this};function h(l){return l<<1|l>>>31}function o(l){return l<<5|l>>>27}function a(l){return l<<30|l>>>2}function d(l,f,p,S){return l===0?f&p|~f&S:l===2?f&p|f&S|p&S:f^p^S}return s.prototype._update=function(l){for(var f=this._w,p=this._a|0,S=this._b|0,k=this._c|0,A=this._d|0,w=this._e|0,v=0;v<16;++v)f[v]=l.readInt32BE(v*4);for(;v<80;++v)f[v]=h(f[v-3]^f[v-8]^f[v-14]^f[v-16]);for(var g=0;g<80;++g){var m=~~(g/20),$=o(p)+d(m,S,k,A)+w+f[g]+n[m]|0;w=A,A=k,k=a(S),S=p,p=$}this._a=p+this._a|0,this._b=S+this._b|0,this._c=k+this._c|0,this._d=A+this._d|0,this._e=w+this._e|0},s.prototype._hash=function(){var l=r.allocUnsafe(20);return l.writeInt32BE(this._a|0,0),l.writeInt32BE(this._b|0,4),l.writeInt32BE(this._c|0,8),l.writeInt32BE(this._d|0,12),l.writeInt32BE(this._e|0,16),l},sha1=s,sha1}var crc32={};/*! crc32.js (C) 2014-present SheetJS -- http://sheetjs.com */var hasRequiredCrc32$1;function requireCrc32$1(){return hasRequiredCrc32$1||(hasRequiredCrc32$1=1,(function(t){(function(e){e(typeof DO_NOT_EXPORT_CRC>"u"?t:{})})(function(e){e.version="1.2.2";function r(){for(var x=0,N=new Array(256),J=0;J!=256;++J)x=J,x=x&1?-306674912^x>>>1:x>>>1,x=x&1?-306674912^x>>>1:x>>>1,x=x&1?-306674912^x>>>1:x>>>1,x=x&1?-306674912^x>>>1:x>>>1,x=x&1?-306674912^x>>>1:x>>>1,x=x&1?-306674912^x>>>1:x>>>1,x=x&1?-306674912^x>>>1:x>>>1,x=x&1?-306674912^x>>>1:x>>>1,N[J]=x;return typeof Int32Array<"u"?new Int32Array(N):N}var n=r();function c(x){var N=0,J=0,Q=0,W=typeof Int32Array<"u"?new Int32Array(4096):new Array(4096);for(Q=0;Q!=256;++Q)W[Q]=x[Q];for(Q=0;Q!=256;++Q)for(J=x[Q],N=256+Q;N<4096;N+=256)J=W[N]=J>>>8^x[J&255];var Y=[];for(Q=1;Q!=16;++Q)Y[Q-1]=typeof Int32Array<"u"?W.subarray(Q*256,Q*256+256):W.slice(Q*256,Q*256+256);return Y}var s=c(n),h=s[0],o=s[1],a=s[2],d=s[3],l=s[4],f=s[5],p=s[6],S=s[7],k=s[8],A=s[9],w=s[10],v=s[11],g=s[12],m=s[13],$=s[14];function I(x,N){for(var J=N^-1,Q=0,W=x.length;Q<W;)J=J>>>8^n[(J^x.charCodeAt(Q++))&255];return~J}function B(x,N){for(var J=N^-1,Q=x.length-15,W=0;W<Q;)J=$[x[W++]^J&255]^m[x[W++]^J>>8&255]^g[x[W++]^J>>16&255]^v[x[W++]^J>>>24]^w[x[W++]]^A[x[W++]]^k[x[W++]]^S[x[W++]]^p[x[W++]]^f[x[W++]]^l[x[W++]]^d[x[W++]]^a[x[W++]]^o[x[W++]]^h[x[W++]]^n[x[W++]];for(Q+=15;W<Q;)J=J>>>8^n[(J^x[W++])&255];return~J}function P(x,N){for(var J=N^-1,Q=0,W=x.length,Y=0,ve=0;Q<W;)Y=x.charCodeAt(Q++),Y<128?J=J>>>8^n[(J^Y)&255]:Y<2048?(J=J>>>8^n[(J^(192|Y>>6&31))&255],J=J>>>8^n[(J^(128|Y&63))&255]):Y>=55296&&Y<57344?(Y=(Y&1023)+64,ve=x.charCodeAt(Q++)&1023,J=J>>>8^n[(J^(240|Y>>8&7))&255],J=J>>>8^n[(J^(128|Y>>2&63))&255],J=J>>>8^n[(J^(128|ve>>6&15|(Y&3)<<4))&255],J=J>>>8^n[(J^(128|ve&63))&255]):(J=J>>>8^n[(J^(224|Y>>12&15))&255],J=J>>>8^n[(J^(128|Y>>6&63))&255],J=J>>>8^n[(J^(128|Y&63))&255]);return~J}e.table=n,e.bstr=I,e.buf=B,e.str=P})})(crc32)),crc32}var common={},hasRequiredCommon;function requireCommon(){return hasRequiredCommon||(hasRequiredCommon=1,(function(t){var e=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";function r(s,h){return Object.prototype.hasOwnProperty.call(s,h)}t.assign=function(s){for(var h=Array.prototype.slice.call(arguments,1);h.length;){var o=h.shift();if(o){if(typeof o!="object")throw new TypeError(o+"must be non-object");for(var a in o)r(o,a)&&(s[a]=o[a])}}return s},t.shrinkBuf=function(s,h){return s.length===h?s:s.subarray?s.subarray(0,h):(s.length=h,s)};var n={arraySet:function(s,h,o,a,d){if(h.subarray&&s.subarray){s.set(h.subarray(o,o+a),d);return}for(var l=0;l<a;l++)s[d+l]=h[o+l]},flattenChunks:function(s){var h,o,a,d,l,f;for(a=0,h=0,o=s.length;h<o;h++)a+=s[h].length;for(f=new Uint8Array(a),d=0,h=0,o=s.length;h<o;h++)l=s[h],f.set(l,d),d+=l.length;return f}},c={arraySet:function(s,h,o,a,d){for(var l=0;l<a;l++)s[d+l]=h[o+l]},flattenChunks:function(s){return[].concat.apply([],s)}};t.setTyped=function(s){s?(t.Buf8=Uint8Array,t.Buf16=Uint16Array,t.Buf32=Int32Array,t.assign(t,n)):(t.Buf8=Array,t.Buf16=Array,t.Buf32=Array,t.assign(t,c))},t.setTyped(e)})(common)),common}var deflate$1={},deflate={},trees={},hasRequiredTrees;function requireTrees(){if(hasRequiredTrees)return trees;hasRequiredTrees=1;var t=requireCommon(),e=4,r=0,n=1,c=2;function s(C){for(var O=C.length;--O>=0;)C[O]=0}var h=0,o=1,a=2,d=3,l=258,f=29,p=256,S=p+1+f,k=30,A=19,w=2*S+1,v=15,g=16,m=7,$=256,I=16,B=17,P=18,x=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],N=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],J=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],Q=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],W=512,Y=new Array((S+2)*2);s(Y);var ve=new Array(k*2);s(ve);var Be=new Array(W);s(Be);var je=new Array(l-d+1);s(je);var xe=new Array(f);s(xe);var ke=new Array(k);s(ke);function q(C,O,ee,ge,ne){this.static_tree=C,this.extra_bits=O,this.extra_base=ee,this.elems=ge,this.max_length=ne,this.has_stree=C&&C.length}var j,H,G;function V(C,O){this.dyn_tree=C,this.max_code=0,this.stat_desc=O}function oe(C){return C<256?Be[C]:Be[256+(C>>>7)]}function Z(C,O){C.pending_buf[C.pending++]=O&255,C.pending_buf[C.pending++]=O>>>8&255}function pe(C,O,ee){C.bi_valid>g-ee?(C.bi_buf|=O<<C.bi_valid&65535,Z(C,C.bi_buf),C.bi_buf=O>>g-C.bi_valid,C.bi_valid+=ee-g):(C.bi_buf|=O<<C.bi_valid&65535,C.bi_valid+=ee)}function ce(C,O,ee){pe(C,ee[O*2],ee[O*2+1])}function U(C,O){var ee=0;do ee|=C&1,C>>>=1,ee<<=1;while(--O>0);return ee>>>1}function ye(C){C.bi_valid===16?(Z(C,C.bi_buf),C.bi_buf=0,C.bi_valid=0):C.bi_valid>=8&&(C.pending_buf[C.pending++]=C.bi_buf&255,C.bi_buf>>=8,C.bi_valid-=8)}function be(C,O){var ee=O.dyn_tree,ge=O.max_code,ne=O.stat_desc.static_tree,_e=O.stat_desc.has_stree,K=O.stat_desc.extra_bits,qe=O.stat_desc.extra_base,lt=O.stat_desc.max_length,L,me,Me,ie,Se,Le,bt=0;for(ie=0;ie<=v;ie++)C.bl_count[ie]=0;for(ee[C.heap[C.heap_max]*2+1]=0,L=C.heap_max+1;L<w;L++)me=C.heap[L],ie=ee[ee[me*2+1]*2+1]+1,ie>lt&&(ie=lt,bt++),ee[me*2+1]=ie,!(me>ge)&&(C.bl_count[ie]++,Se=0,me>=qe&&(Se=K[me-qe]),Le=ee[me*2],C.opt_len+=Le*(ie+Se),_e&&(C.static_len+=Le*(ne[me*2+1]+Se)));if(bt!==0){do{for(ie=lt-1;C.bl_count[ie]===0;)ie--;C.bl_count[ie]--,C.bl_count[ie+1]+=2,C.bl_count[lt]--,bt-=2}while(bt>0);for(ie=lt;ie!==0;ie--)for(me=C.bl_count[ie];me!==0;)Me=C.heap[--L],!(Me>ge)&&(ee[Me*2+1]!==ie&&(C.opt_len+=(ie-ee[Me*2+1])*ee[Me*2],ee[Me*2+1]=ie),me--)}}function Pe(C,O,ee){var ge=new Array(v+1),ne=0,_e,K;for(_e=1;_e<=v;_e++)ge[_e]=ne=ne+ee[_e-1]<<1;for(K=0;K<=O;K++){var qe=C[K*2+1];qe!==0&&(C[K*2]=U(ge[qe]++,qe))}}function Oe(){var C,O,ee,ge,ne,_e=new Array(v+1);for(ee=0,ge=0;ge<f-1;ge++)for(xe[ge]=ee,C=0;C<1<<x[ge];C++)je[ee++]=ge;for(je[ee-1]=ge,ne=0,ge=0;ge<16;ge++)for(ke[ge]=ne,C=0;C<1<<N[ge];C++)Be[ne++]=ge;for(ne>>=7;ge<k;ge++)for(ke[ge]=ne<<7,C=0;C<1<<N[ge]-7;C++)Be[256+ne++]=ge;for(O=0;O<=v;O++)_e[O]=0;for(C=0;C<=143;)Y[C*2+1]=8,C++,_e[8]++;for(;C<=255;)Y[C*2+1]=9,C++,_e[9]++;for(;C<=279;)Y[C*2+1]=7,C++,_e[7]++;for(;C<=287;)Y[C*2+1]=8,C++,_e[8]++;for(Pe(Y,S+1,_e),C=0;C<k;C++)ve[C*2+1]=5,ve[C*2]=U(C,5);j=new q(Y,x,p+1,S,v),H=new q(ve,N,0,k,v),G=new q(new Array(0),J,0,A,m)}function Ue(C){var O;for(O=0;O<S;O++)C.dyn_ltree[O*2]=0;for(O=0;O<k;O++)C.dyn_dtree[O*2]=0;for(O=0;O<A;O++)C.bl_tree[O*2]=0;C.dyn_ltree[$*2]=1,C.opt_len=C.static_len=0,C.last_lit=C.matches=0}function rt(C){C.bi_valid>8?Z(C,C.bi_buf):C.bi_valid>0&&(C.pending_buf[C.pending++]=C.bi_buf),C.bi_buf=0,C.bi_valid=0}function yt(C,O,ee,ge){rt(C),Z(C,ee),Z(C,~ee),t.arraySet(C.pending_buf,C.window,O,ee,C.pending),C.pending+=ee}function dt(C,O,ee,ge){var ne=O*2,_e=ee*2;return C[ne]<C[_e]||C[ne]===C[_e]&&ge[O]<=ge[ee]}function fe(C,O,ee){for(var ge=C.heap[ee],ne=ee<<1;ne<=C.heap_len&&(ne<C.heap_len&&dt(O,C.heap[ne+1],C.heap[ne],C.depth)&&ne++,!dt(O,ge,C.heap[ne],C.depth));)C.heap[ee]=C.heap[ne],ee=ne,ne<<=1;C.heap[ee]=ge}function Re(C,O,ee){var ge,ne,_e=0,K,qe;if(C.last_lit!==0)do ge=C.pending_buf[C.d_buf+_e*2]<<8|C.pending_buf[C.d_buf+_e*2+1],ne=C.pending_buf[C.l_buf+_e],_e++,ge===0?ce(C,ne,O):(K=je[ne],ce(C,K+p+1,O),qe=x[K],qe!==0&&(ne-=xe[K],pe(C,ne,qe)),ge--,K=oe(ge),ce(C,K,ee),qe=N[K],qe!==0&&(ge-=ke[K],pe(C,ge,qe)));while(_e<C.last_lit);ce(C,$,O)}function Ke(C,O){var ee=O.dyn_tree,ge=O.stat_desc.static_tree,ne=O.stat_desc.has_stree,_e=O.stat_desc.elems,K,qe,lt=-1,L;for(C.heap_len=0,C.heap_max=w,K=0;K<_e;K++)ee[K*2]!==0?(C.heap[++C.heap_len]=lt=K,C.depth[K]=0):ee[K*2+1]=0;for(;C.heap_len<2;)L=C.heap[++C.heap_len]=lt<2?++lt:0,ee[L*2]=1,C.depth[L]=0,C.opt_len--,ne&&(C.static_len-=ge[L*2+1]);for(O.max_code=lt,K=C.heap_len>>1;K>=1;K--)fe(C,ee,K);L=_e;do K=C.heap[1],C.heap[1]=C.heap[C.heap_len--],fe(C,ee,1),qe=C.heap[1],C.heap[--C.heap_max]=K,C.heap[--C.heap_max]=qe,ee[L*2]=ee[K*2]+ee[qe*2],C.depth[L]=(C.depth[K]>=C.depth[qe]?C.depth[K]:C.depth[qe])+1,ee[K*2+1]=ee[qe*2+1]=L,C.heap[1]=L++,fe(C,ee,1);while(C.heap_len>=2);C.heap[--C.heap_max]=C.heap[1],be(C,O),Pe(ee,lt,C.bl_count)}function We(C,O,ee){var ge,ne=-1,_e,K=O[1],qe=0,lt=7,L=4;for(K===0&&(lt=138,L=3),O[(ee+1)*2+1]=65535,ge=0;ge<=ee;ge++)_e=K,K=O[(ge+1)*2+1],!(++qe<lt&&_e===K)&&(qe<L?C.bl_tree[_e*2]+=qe:_e!==0?(_e!==ne&&C.bl_tree[_e*2]++,C.bl_tree[I*2]++):qe<=10?C.bl_tree[B*2]++:C.bl_tree[P*2]++,qe=0,ne=_e,K===0?(lt=138,L=3):_e===K?(lt=6,L=3):(lt=7,L=4))}function Ze(C,O,ee){var ge,ne=-1,_e,K=O[1],qe=0,lt=7,L=4;for(K===0&&(lt=138,L=3),ge=0;ge<=ee;ge++)if(_e=K,K=O[(ge+1)*2+1],!(++qe<lt&&_e===K)){if(qe<L)do ce(C,_e,C.bl_tree);while(--qe!==0);else _e!==0?(_e!==ne&&(ce(C,_e,C.bl_tree),qe--),ce(C,I,C.bl_tree),pe(C,qe-3,2)):qe<=10?(ce(C,B,C.bl_tree),pe(C,qe-3,3)):(ce(C,P,C.bl_tree),pe(C,qe-11,7));qe=0,ne=_e,K===0?(lt=138,L=3):_e===K?(lt=6,L=3):(lt=7,L=4)}}function st(C){var O;for(We(C,C.dyn_ltree,C.l_desc.max_code),We(C,C.dyn_dtree,C.d_desc.max_code),Ke(C,C.bl_desc),O=A-1;O>=3&&C.bl_tree[Q[O]*2+1]===0;O--);return C.opt_len+=3*(O+1)+5+5+4,O}function gt(C,O,ee,ge){var ne;for(pe(C,O-257,5),pe(C,ee-1,5),pe(C,ge-4,4),ne=0;ne<ge;ne++)pe(C,C.bl_tree[Q[ne]*2+1],3);Ze(C,C.dyn_ltree,O-1),Ze(C,C.dyn_dtree,ee-1)}function Dt(C){var O=4093624447,ee;for(ee=0;ee<=31;ee++,O>>>=1)if(O&1&&C.dyn_ltree[ee*2]!==0)return r;if(C.dyn_ltree[18]!==0||C.dyn_ltree[20]!==0||C.dyn_ltree[26]!==0)return n;for(ee=32;ee<p;ee++)if(C.dyn_ltree[ee*2]!==0)return n;return r}var wt=!1;function vt(C){wt||(Oe(),wt=!0),C.l_desc=new V(C.dyn_ltree,j),C.d_desc=new V(C.dyn_dtree,H),C.bl_desc=new V(C.bl_tree,G),C.bi_buf=0,C.bi_valid=0,Ue(C)}function qt(C,O,ee,ge){pe(C,(h<<1)+(ge?1:0),3),yt(C,O,ee)}function Lt(C){pe(C,o<<1,3),ce(C,$,Y),ye(C)}function Gt(C,O,ee,ge){var ne,_e,K=0;C.level>0?(C.strm.data_type===c&&(C.strm.data_type=Dt(C)),Ke(C,C.l_desc),Ke(C,C.d_desc),K=st(C),ne=C.opt_len+3+7>>>3,_e=C.static_len+3+7>>>3,_e<=ne&&(ne=_e)):ne=_e=ee+5,ee+4<=ne&&O!==-1?qt(C,O,ee,ge):C.strategy===e||_e===ne?(pe(C,(o<<1)+(ge?1:0),3),Re(C,Y,ve)):(pe(C,(a<<1)+(ge?1:0),3),gt(C,C.l_desc.max_code+1,C.d_desc.max_code+1,K+1),Re(C,C.dyn_ltree,C.dyn_dtree)),Ue(C),ge&&rt(C)}function te(C,O,ee){return C.pending_buf[C.d_buf+C.last_lit*2]=O>>>8&255,C.pending_buf[C.d_buf+C.last_lit*2+1]=O&255,C.pending_buf[C.l_buf+C.last_lit]=ee&255,C.last_lit++,O===0?C.dyn_ltree[ee*2]++:(C.matches++,O--,C.dyn_ltree[(je[ee]+p+1)*2]++,C.dyn_dtree[oe(O)*2]++),C.last_lit===C.lit_bufsize-1}return trees._tr_init=vt,trees._tr_stored_block=qt,trees._tr_flush_block=Gt,trees._tr_tally=te,trees._tr_align=Lt,trees}var adler32_1,hasRequiredAdler32;function requireAdler32(){if(hasRequiredAdler32)return adler32_1;hasRequiredAdler32=1;function t(e,r,n,c){for(var s=e&65535|0,h=e>>>16&65535|0,o=0;n!==0;){o=n>2e3?2e3:n,n-=o;do s=s+r[c++]|0,h=h+s|0;while(--o);s%=65521,h%=65521}return s|h<<16|0}return adler32_1=t,adler32_1}var crc32_1,hasRequiredCrc32;function requireCrc32(){if(hasRequiredCrc32)return crc32_1;hasRequiredCrc32=1;function t(){for(var n,c=[],s=0;s<256;s++){n=s;for(var h=0;h<8;h++)n=n&1?3988292384^n>>>1:n>>>1;c[s]=n}return c}var e=t();function r(n,c,s,h){var o=e,a=h+s;n^=-1;for(var d=h;d<a;d++)n=n>>>8^o[(n^c[d])&255];return n^-1}return crc32_1=r,crc32_1}var messages,hasRequiredMessages;function requireMessages(){return hasRequiredMessages||(hasRequiredMessages=1,messages={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}),messages}var hasRequiredDeflate$1;function requireDeflate$1(){if(hasRequiredDeflate$1)return deflate;hasRequiredDeflate$1=1;var t=requireCommon(),e=requireTrees(),r=requireAdler32(),n=requireCrc32(),c=requireMessages(),s=0,h=1,o=3,a=4,d=5,l=0,f=1,p=-2,S=-3,k=-5,A=-1,w=1,v=2,g=3,m=4,$=0,I=2,B=8,P=9,x=15,N=8,J=29,Q=256,W=Q+1+J,Y=30,ve=19,Be=2*W+1,je=15,xe=3,ke=258,q=ke+xe+1,j=32,H=42,G=69,V=73,oe=91,Z=103,pe=113,ce=666,U=1,ye=2,be=3,Pe=4,Oe=3;function Ue(L,me){return L.msg=c[me],me}function rt(L){return(L<<1)-(L>4?9:0)}function yt(L){for(var me=L.length;--me>=0;)L[me]=0}function dt(L){var me=L.state,Me=me.pending;Me>L.avail_out&&(Me=L.avail_out),Me!==0&&(t.arraySet(L.output,me.pending_buf,me.pending_out,Me,L.next_out),L.next_out+=Me,me.pending_out+=Me,L.total_out+=Me,L.avail_out-=Me,me.pending-=Me,me.pending===0&&(me.pending_out=0))}function fe(L,me){e._tr_flush_block(L,L.block_start>=0?L.block_start:-1,L.strstart-L.block_start,me),L.block_start=L.strstart,dt(L.strm)}function Re(L,me){L.pending_buf[L.pending++]=me}function Ke(L,me){L.pending_buf[L.pending++]=me>>>8&255,L.pending_buf[L.pending++]=me&255}function We(L,me,Me,ie){var Se=L.avail_in;return Se>ie&&(Se=ie),Se===0?0:(L.avail_in-=Se,t.arraySet(me,L.input,L.next_in,Se,Me),L.state.wrap===1?L.adler=r(L.adler,me,Se,Me):L.state.wrap===2&&(L.adler=n(L.adler,me,Se,Me)),L.next_in+=Se,L.total_in+=Se,Se)}function Ze(L,me){var Me=L.max_chain_length,ie=L.strstart,Se,Le,bt=L.prev_length,le=L.nice_match,M=L.strstart>L.w_size-q?L.strstart-(L.w_size-q):0,R=L.window,D=L.w_mask,X=L.prev,he=L.strstart+ke,we=R[ie+bt-1],Ae=R[ie+bt];L.prev_length>=L.good_match&&(Me>>=2),le>L.lookahead&&(le=L.lookahead);do if(Se=me,!(R[Se+bt]!==Ae||R[Se+bt-1]!==we||R[Se]!==R[ie]||R[++Se]!==R[ie+1])){ie+=2,Se++;do;while(R[++ie]===R[++Se]&&R[++ie]===R[++Se]&&R[++ie]===R[++Se]&&R[++ie]===R[++Se]&&R[++ie]===R[++Se]&&R[++ie]===R[++Se]&&R[++ie]===R[++Se]&&R[++ie]===R[++Se]&&ie<he);if(Le=ke-(he-ie),ie=he-ke,Le>bt){if(L.match_start=me,bt=Le,Le>=le)break;we=R[ie+bt-1],Ae=R[ie+bt]}}while((me=X[me&D])>M&&--Me!==0);return bt<=L.lookahead?bt:L.lookahead}function st(L){var me=L.w_size,Me,ie,Se,Le,bt;do{if(Le=L.window_size-L.lookahead-L.strstart,L.strstart>=me+(me-q)){t.arraySet(L.window,L.window,me,me,0),L.match_start-=me,L.strstart-=me,L.block_start-=me,ie=L.hash_size,Me=ie;do Se=L.head[--Me],L.head[Me]=Se>=me?Se-me:0;while(--ie);ie=me,Me=ie;do Se=L.prev[--Me],L.prev[Me]=Se>=me?Se-me:0;while(--ie);Le+=me}if(L.strm.avail_in===0)break;if(ie=We(L.strm,L.window,L.strstart+L.lookahead,Le),L.lookahead+=ie,L.lookahead+L.insert>=xe)for(bt=L.strstart-L.insert,L.ins_h=L.window[bt],L.ins_h=(L.ins_h<<L.hash_shift^L.window[bt+1])&L.hash_mask;L.insert&&(L.ins_h=(L.ins_h<<L.hash_shift^L.window[bt+xe-1])&L.hash_mask,L.prev[bt&L.w_mask]=L.head[L.ins_h],L.head[L.ins_h]=bt,bt++,L.insert--,!(L.lookahead+L.insert<xe)););}while(L.lookahead<q&&L.strm.avail_in!==0)}function gt(L,me){var Me=65535;for(Me>L.pending_buf_size-5&&(Me=L.pending_buf_size-5);;){if(L.lookahead<=1){if(st(L),L.lookahead===0&&me===s)return U;if(L.lookahead===0)break}L.strstart+=L.lookahead,L.lookahead=0;var ie=L.block_start+Me;if((L.strstart===0||L.strstart>=ie)&&(L.lookahead=L.strstart-ie,L.strstart=ie,fe(L,!1),L.strm.avail_out===0)||L.strstart-L.block_start>=L.w_size-q&&(fe(L,!1),L.strm.avail_out===0))return U}return L.insert=0,me===a?(fe(L,!0),L.strm.avail_out===0?be:Pe):(L.strstart>L.block_start&&(fe(L,!1),L.strm.avail_out===0),U)}function Dt(L,me){for(var Me,ie;;){if(L.lookahead<q){if(st(L),L.lookahead<q&&me===s)return U;if(L.lookahead===0)break}if(Me=0,L.lookahead>=xe&&(L.ins_h=(L.ins_h<<L.hash_shift^L.window[L.strstart+xe-1])&L.hash_mask,Me=L.prev[L.strstart&L.w_mask]=L.head[L.ins_h],L.head[L.ins_h]=L.strstart),Me!==0&&L.strstart-Me<=L.w_size-q&&(L.match_length=Ze(L,Me)),L.match_length>=xe)if(ie=e._tr_tally(L,L.strstart-L.match_start,L.match_length-xe),L.lookahead-=L.match_length,L.match_length<=L.max_lazy_match&&L.lookahead>=xe){L.match_length--;do L.strstart++,L.ins_h=(L.ins_h<<L.hash_shift^L.window[L.strstart+xe-1])&L.hash_mask,Me=L.prev[L.strstart&L.w_mask]=L.head[L.ins_h],L.head[L.ins_h]=L.strstart;while(--L.match_length!==0);L.strstart++}else L.strstart+=L.match_length,L.match_length=0,L.ins_h=L.window[L.strstart],L.ins_h=(L.ins_h<<L.hash_shift^L.window[L.strstart+1])&L.hash_mask;else ie=e._tr_tally(L,0,L.window[L.strstart]),L.lookahead--,L.strstart++;if(ie&&(fe(L,!1),L.strm.avail_out===0))return U}return L.insert=L.strstart<xe-1?L.strstart:xe-1,me===a?(fe(L,!0),L.strm.avail_out===0?be:Pe):L.last_lit&&(fe(L,!1),L.strm.avail_out===0)?U:ye}function wt(L,me){for(var Me,ie,Se;;){if(L.lookahead<q){if(st(L),L.lookahead<q&&me===s)return U;if(L.lookahead===0)break}if(Me=0,L.lookahead>=xe&&(L.ins_h=(L.ins_h<<L.hash_shift^L.window[L.strstart+xe-1])&L.hash_mask,Me=L.prev[L.strstart&L.w_mask]=L.head[L.ins_h],L.head[L.ins_h]=L.strstart),L.prev_length=L.match_length,L.prev_match=L.match_start,L.match_length=xe-1,Me!==0&&L.prev_length<L.max_lazy_match&&L.strstart-Me<=L.w_size-q&&(L.match_length=Ze(L,Me),L.match_length<=5&&(L.strategy===w||L.match_length===xe&&L.strstart-L.match_start>4096)&&(L.match_length=xe-1)),L.prev_length>=xe&&L.match_length<=L.prev_length){Se=L.strstart+L.lookahead-xe,ie=e._tr_tally(L,L.strstart-1-L.prev_match,L.prev_length-xe),L.lookahead-=L.prev_length-1,L.prev_length-=2;do++L.strstart<=Se&&(L.ins_h=(L.ins_h<<L.hash_shift^L.window[L.strstart+xe-1])&L.hash_mask,Me=L.prev[L.strstart&L.w_mask]=L.head[L.ins_h],L.head[L.ins_h]=L.strstart);while(--L.prev_length!==0);if(L.match_available=0,L.match_length=xe-1,L.strstart++,ie&&(fe(L,!1),L.strm.avail_out===0))return U}else if(L.match_available){if(ie=e._tr_tally(L,0,L.window[L.strstart-1]),ie&&fe(L,!1),L.strstart++,L.lookahead--,L.strm.avail_out===0)return U}else L.match_available=1,L.strstart++,L.lookahead--}return L.match_available&&(ie=e._tr_tally(L,0,L.window[L.strstart-1]),L.match_available=0),L.insert=L.strstart<xe-1?L.strstart:xe-1,me===a?(fe(L,!0),L.strm.avail_out===0?be:Pe):L.last_lit&&(fe(L,!1),L.strm.avail_out===0)?U:ye}function vt(L,me){for(var Me,ie,Se,Le,bt=L.window;;){if(L.lookahead<=ke){if(st(L),L.lookahead<=ke&&me===s)return U;if(L.lookahead===0)break}if(L.match_length=0,L.lookahead>=xe&&L.strstart>0&&(Se=L.strstart-1,ie=bt[Se],ie===bt[++Se]&&ie===bt[++Se]&&ie===bt[++Se])){Le=L.strstart+ke;do;while(ie===bt[++Se]&&ie===bt[++Se]&&ie===bt[++Se]&&ie===bt[++Se]&&ie===bt[++Se]&&ie===bt[++Se]&&ie===bt[++Se]&&ie===bt[++Se]&&Se<Le);L.match_length=ke-(Le-Se),L.match_length>L.lookahead&&(L.match_length=L.lookahead)}if(L.match_length>=xe?(Me=e._tr_tally(L,1,L.match_length-xe),L.lookahead-=L.match_length,L.strstart+=L.match_length,L.match_length=0):(Me=e._tr_tally(L,0,L.window[L.strstart]),L.lookahead--,L.strstart++),Me&&(fe(L,!1),L.strm.avail_out===0))return U}return L.insert=0,me===a?(fe(L,!0),L.strm.avail_out===0?be:Pe):L.last_lit&&(fe(L,!1),L.strm.avail_out===0)?U:ye}function qt(L,me){for(var Me;;){if(L.lookahead===0&&(st(L),L.lookahead===0)){if(me===s)return U;break}if(L.match_length=0,Me=e._tr_tally(L,0,L.window[L.strstart]),L.lookahead--,L.strstart++,Me&&(fe(L,!1),L.strm.avail_out===0))return U}return L.insert=0,me===a?(fe(L,!0),L.strm.avail_out===0?be:Pe):L.last_lit&&(fe(L,!1),L.strm.avail_out===0)?U:ye}function Lt(L,me,Me,ie,Se){this.good_length=L,this.max_lazy=me,this.nice_length=Me,this.max_chain=ie,this.func=Se}var Gt;Gt=[new Lt(0,0,0,0,gt),new Lt(4,4,8,4,Dt),new Lt(4,5,16,8,Dt),new Lt(4,6,32,32,Dt),new Lt(4,4,16,16,wt),new Lt(8,16,32,32,wt),new Lt(8,16,128,128,wt),new Lt(8,32,128,256,wt),new Lt(32,128,258,1024,wt),new Lt(32,258,258,4096,wt)];function te(L){L.window_size=2*L.w_size,yt(L.head),L.max_lazy_match=Gt[L.level].max_lazy,L.good_match=Gt[L.level].good_length,L.nice_match=Gt[L.level].nice_length,L.max_chain_length=Gt[L.level].max_chain,L.strstart=0,L.block_start=0,L.lookahead=0,L.insert=0,L.match_length=L.prev_length=xe-1,L.match_available=0,L.ins_h=0}function C(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=B,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new t.Buf16(Be*2),this.dyn_dtree=new t.Buf16((2*Y+1)*2),this.bl_tree=new t.Buf16((2*ve+1)*2),yt(this.dyn_ltree),yt(this.dyn_dtree),yt(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new t.Buf16(je+1),this.heap=new t.Buf16(2*W+1),yt(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new t.Buf16(2*W+1),yt(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function O(L){var me;return!L||!L.state?Ue(L,p):(L.total_in=L.total_out=0,L.data_type=I,me=L.state,me.pending=0,me.pending_out=0,me.wrap<0&&(me.wrap=-me.wrap),me.status=me.wrap?H:pe,L.adler=me.wrap===2?0:1,me.last_flush=s,e._tr_init(me),l)}function ee(L){var me=O(L);return me===l&&te(L.state),me}function ge(L,me){return!L||!L.state||L.state.wrap!==2?p:(L.state.gzhead=me,l)}function ne(L,me,Me,ie,Se,Le){if(!L)return p;var bt=1;if(me===A&&(me=6),ie<0?(bt=0,ie=-ie):ie>15&&(bt=2,ie-=16),Se<1||Se>P||Me!==B||ie<8||ie>15||me<0||me>9||Le<0||Le>m)return Ue(L,p);ie===8&&(ie=9);var le=new C;return L.state=le,le.strm=L,le.wrap=bt,le.gzhead=null,le.w_bits=ie,le.w_size=1<<le.w_bits,le.w_mask=le.w_size-1,le.hash_bits=Se+7,le.hash_size=1<<le.hash_bits,le.hash_mask=le.hash_size-1,le.hash_shift=~~((le.hash_bits+xe-1)/xe),le.window=new t.Buf8(le.w_size*2),le.head=new t.Buf16(le.hash_size),le.prev=new t.Buf16(le.w_size),le.lit_bufsize=1<<Se+6,le.pending_buf_size=le.lit_bufsize*4,le.pending_buf=new t.Buf8(le.pending_buf_size),le.d_buf=1*le.lit_bufsize,le.l_buf=3*le.lit_bufsize,le.level=me,le.strategy=Le,le.method=Me,ee(L)}function _e(L,me){return ne(L,me,B,x,N,$)}function K(L,me){var Me,ie,Se,Le;if(!L||!L.state||me>d||me<0)return L?Ue(L,p):p;if(ie=L.state,!L.output||!L.input&&L.avail_in!==0||ie.status===ce&&me!==a)return Ue(L,L.avail_out===0?k:p);if(ie.strm=L,Me=ie.last_flush,ie.last_flush=me,ie.status===H)if(ie.wrap===2)L.adler=0,Re(ie,31),Re(ie,139),Re(ie,8),ie.gzhead?(Re(ie,(ie.gzhead.text?1:0)+(ie.gzhead.hcrc?2:0)+(ie.gzhead.extra?4:0)+(ie.gzhead.name?8:0)+(ie.gzhead.comment?16:0)),Re(ie,ie.gzhead.time&255),Re(ie,ie.gzhead.time>>8&255),Re(ie,ie.gzhead.time>>16&255),Re(ie,ie.gzhead.time>>24&255),Re(ie,ie.level===9?2:ie.strategy>=v||ie.level<2?4:0),Re(ie,ie.gzhead.os&255),ie.gzhead.extra&&ie.gzhead.extra.length&&(Re(ie,ie.gzhead.extra.length&255),Re(ie,ie.gzhead.extra.length>>8&255)),ie.gzhead.hcrc&&(L.adler=n(L.adler,ie.pending_buf,ie.pending,0)),ie.gzindex=0,ie.status=G):(Re(ie,0),Re(ie,0),Re(ie,0),Re(ie,0),Re(ie,0),Re(ie,ie.level===9?2:ie.strategy>=v||ie.level<2?4:0),Re(ie,Oe),ie.status=pe);else{var bt=B+(ie.w_bits-8<<4)<<8,le=-1;ie.strategy>=v||ie.level<2?le=0:ie.level<6?le=1:ie.level===6?le=2:le=3,bt|=le<<6,ie.strstart!==0&&(bt|=j),bt+=31-bt%31,ie.status=pe,Ke(ie,bt),ie.strstart!==0&&(Ke(ie,L.adler>>>16),Ke(ie,L.adler&65535)),L.adler=1}if(ie.status===G)if(ie.gzhead.extra){for(Se=ie.pending;ie.gzindex<(ie.gzhead.extra.length&65535)&&!(ie.pending===ie.pending_buf_size&&(ie.gzhead.hcrc&&ie.pending>Se&&(L.adler=n(L.adler,ie.pending_buf,ie.pending-Se,Se)),dt(L),Se=ie.pending,ie.pending===ie.pending_buf_size));)Re(ie,ie.gzhead.extra[ie.gzindex]&255),ie.gzindex++;ie.gzhead.hcrc&&ie.pending>Se&&(L.adler=n(L.adler,ie.pending_buf,ie.pending-Se,Se)),ie.gzindex===ie.gzhead.extra.length&&(ie.gzindex=0,ie.status=V)}else ie.status=V;if(ie.status===V)if(ie.gzhead.name){Se=ie.pending;do{if(ie.pending===ie.pending_buf_size&&(ie.gzhead.hcrc&&ie.pending>Se&&(L.adler=n(L.adler,ie.pending_buf,ie.pending-Se,Se)),dt(L),Se=ie.pending,ie.pending===ie.pending_buf_size)){Le=1;break}ie.gzindex<ie.gzhead.name.length?Le=ie.gzhead.name.charCodeAt(ie.gzindex++)&255:Le=0,Re(ie,Le)}while(Le!==0);ie.gzhead.hcrc&&ie.pending>Se&&(L.adler=n(L.adler,ie.pending_buf,ie.pending-Se,Se)),Le===0&&(ie.gzindex=0,ie.status=oe)}else ie.status=oe;if(ie.status===oe)if(ie.gzhead.comment){Se=ie.pending;do{if(ie.pending===ie.pending_buf_size&&(ie.gzhead.hcrc&&ie.pending>Se&&(L.adler=n(L.adler,ie.pending_buf,ie.pending-Se,Se)),dt(L),Se=ie.pending,ie.pending===ie.pending_buf_size)){Le=1;break}ie.gzindex<ie.gzhead.comment.length?Le=ie.gzhead.comment.charCodeAt(ie.gzindex++)&255:Le=0,Re(ie,Le)}while(Le!==0);ie.gzhead.hcrc&&ie.pending>Se&&(L.adler=n(L.adler,ie.pending_buf,ie.pending-Se,Se)),Le===0&&(ie.status=Z)}else ie.status=Z;if(ie.status===Z&&(ie.gzhead.hcrc?(ie.pending+2>ie.pending_buf_size&&dt(L),ie.pending+2<=ie.pending_buf_size&&(Re(ie,L.adler&255),Re(ie,L.adler>>8&255),L.adler=0,ie.status=pe)):ie.status=pe),ie.pending!==0){if(dt(L),L.avail_out===0)return ie.last_flush=-1,l}else if(L.avail_in===0&&rt(me)<=rt(Me)&&me!==a)return Ue(L,k);if(ie.status===ce&&L.avail_in!==0)return Ue(L,k);if(L.avail_in!==0||ie.lookahead!==0||me!==s&&ie.status!==ce){var M=ie.strategy===v?qt(ie,me):ie.strategy===g?vt(ie,me):Gt[ie.level].func(ie,me);if((M===be||M===Pe)&&(ie.status=ce),M===U||M===be)return L.avail_out===0&&(ie.last_flush=-1),l;if(M===ye&&(me===h?e._tr_align(ie):me!==d&&(e._tr_stored_block(ie,0,0,!1),me===o&&(yt(ie.head),ie.lookahead===0&&(ie.strstart=0,ie.block_start=0,ie.insert=0))),dt(L),L.avail_out===0))return ie.last_flush=-1,l}return me!==a?l:ie.wrap<=0?f:(ie.wrap===2?(Re(ie,L.adler&255),Re(ie,L.adler>>8&255),Re(ie,L.adler>>16&255),Re(ie,L.adler>>24&255),Re(ie,L.total_in&255),Re(ie,L.total_in>>8&255),Re(ie,L.total_in>>16&255),Re(ie,L.total_in>>24&255)):(Ke(ie,L.adler>>>16),Ke(ie,L.adler&65535)),dt(L),ie.wrap>0&&(ie.wrap=-ie.wrap),ie.pending!==0?l:f)}function qe(L){var me;return!L||!L.state?p:(me=L.state.status,me!==H&&me!==G&&me!==V&&me!==oe&&me!==Z&&me!==pe&&me!==ce?Ue(L,p):(L.state=null,me===pe?Ue(L,S):l))}function lt(L,me){var Me=me.length,ie,Se,Le,bt,le,M,R,D;if(!L||!L.state||(ie=L.state,bt=ie.wrap,bt===2||bt===1&&ie.status!==H||ie.lookahead))return p;for(bt===1&&(L.adler=r(L.adler,me,Me,0)),ie.wrap=0,Me>=ie.w_size&&(bt===0&&(yt(ie.head),ie.strstart=0,ie.block_start=0,ie.insert=0),D=new t.Buf8(ie.w_size),t.arraySet(D,me,Me-ie.w_size,ie.w_size,0),me=D,Me=ie.w_size),le=L.avail_in,M=L.next_in,R=L.input,L.avail_in=Me,L.next_in=0,L.input=me,st(ie);ie.lookahead>=xe;){Se=ie.strstart,Le=ie.lookahead-(xe-1);do ie.ins_h=(ie.ins_h<<ie.hash_shift^ie.window[Se+xe-1])&ie.hash_mask,ie.prev[Se&ie.w_mask]=ie.head[ie.ins_h],ie.head[ie.ins_h]=Se,Se++;while(--Le);ie.strstart=Se,ie.lookahead=xe-1,st(ie)}return ie.strstart+=ie.lookahead,ie.block_start=ie.strstart,ie.insert=ie.lookahead,ie.lookahead=0,ie.match_length=ie.prev_length=xe-1,ie.match_available=0,L.next_in=M,L.input=R,L.avail_in=le,ie.wrap=bt,l}return deflate.deflateInit=_e,deflate.deflateInit2=ne,deflate.deflateReset=ee,deflate.deflateResetKeep=O,deflate.deflateSetHeader=ge,deflate.deflate=K,deflate.deflateEnd=qe,deflate.deflateSetDictionary=lt,deflate.deflateInfo="pako deflate (from Nodeca project)",deflate}var strings$1={},hasRequiredStrings;function requireStrings(){if(hasRequiredStrings)return strings$1;hasRequiredStrings=1;var t=requireCommon(),e=!0,r=!0;try{String.fromCharCode.apply(null,[0])}catch{e=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{r=!1}for(var n=new t.Buf8(256),c=0;c<256;c++)n[c]=c>=252?6:c>=248?5:c>=240?4:c>=224?3:c>=192?2:1;n[254]=n[254]=1,strings$1.string2buf=function(h){var o,a,d,l,f,p=h.length,S=0;for(l=0;l<p;l++)a=h.charCodeAt(l),(a&64512)===55296&&l+1<p&&(d=h.charCodeAt(l+1),(d&64512)===56320&&(a=65536+(a-55296<<10)+(d-56320),l++)),S+=a<128?1:a<2048?2:a<65536?3:4;for(o=new t.Buf8(S),f=0,l=0;f<S;l++)a=h.charCodeAt(l),(a&64512)===55296&&l+1<p&&(d=h.charCodeAt(l+1),(d&64512)===56320&&(a=65536+(a-55296<<10)+(d-56320),l++)),a<128?o[f++]=a:a<2048?(o[f++]=192|a>>>6,o[f++]=128|a&63):a<65536?(o[f++]=224|a>>>12,o[f++]=128|a>>>6&63,o[f++]=128|a&63):(o[f++]=240|a>>>18,o[f++]=128|a>>>12&63,o[f++]=128|a>>>6&63,o[f++]=128|a&63);return o};function s(h,o){if(o<65534&&(h.subarray&&r||!h.subarray&&e))return String.fromCharCode.apply(null,t.shrinkBuf(h,o));for(var a="",d=0;d<o;d++)a+=String.fromCharCode(h[d]);return a}return strings$1.buf2binstring=function(h){return s(h,h.length)},strings$1.binstring2buf=function(h){for(var o=new t.Buf8(h.length),a=0,d=o.length;a<d;a++)o[a]=h.charCodeAt(a);return o},strings$1.buf2string=function(h,o){var a,d,l,f,p=o||h.length,S=new Array(p*2);for(d=0,a=0;a<p;){if(l=h[a++],l<128){S[d++]=l;continue}if(f=n[l],f>4){S[d++]=65533,a+=f-1;continue}for(l&=f===2?31:f===3?15:7;f>1&&a<p;)l=l<<6|h[a++]&63,f--;if(f>1){S[d++]=65533;continue}l<65536?S[d++]=l:(l-=65536,S[d++]=55296|l>>10&1023,S[d++]=56320|l&1023)}return s(S,d)},strings$1.utf8border=function(h,o){var a;for(o=o||h.length,o>h.length&&(o=h.length),a=o-1;a>=0&&(h[a]&192)===128;)a--;return a<0||a===0?o:a+n[h[a]]>o?a:o},strings$1}var zstream,hasRequiredZstream;function requireZstream(){if(hasRequiredZstream)return zstream;hasRequiredZstream=1;function t(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}return zstream=t,zstream}var hasRequiredDeflate;function requireDeflate(){if(hasRequiredDeflate)return deflate$1;hasRequiredDeflate=1;var t=requireDeflate$1(),e=requireCommon(),r=requireStrings(),n=requireMessages(),c=requireZstream(),s=Object.prototype.toString,h=0,o=4,a=0,d=1,l=2,f=-1,p=0,S=8;function k(g){if(!(this instanceof k))return new k(g);this.options=e.assign({level:f,method:S,chunkSize:16384,windowBits:15,memLevel:8,strategy:p,to:""},g||{});var m=this.options;m.raw&&m.windowBits>0?m.windowBits=-m.windowBits:m.gzip&&m.windowBits>0&&m.windowBits<16&&(m.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new c,this.strm.avail_out=0;var $=t.deflateInit2(this.strm,m.level,m.method,m.windowBits,m.memLevel,m.strategy);if($!==a)throw new Error(n[$]);if(m.header&&t.deflateSetHeader(this.strm,m.header),m.dictionary){var I;if(typeof m.dictionary=="string"?I=r.string2buf(m.dictionary):s.call(m.dictionary)==="[object ArrayBuffer]"?I=new Uint8Array(m.dictionary):I=m.dictionary,$=t.deflateSetDictionary(this.strm,I),$!==a)throw new Error(n[$]);this._dict_set=!0}}k.prototype.push=function(g,m){var $=this.strm,I=this.options.chunkSize,B,P;if(this.ended)return!1;P=m===~~m?m:m===!0?o:h,typeof g=="string"?$.input=r.string2buf(g):s.call(g)==="[object ArrayBuffer]"?$.input=new Uint8Array(g):$.input=g,$.next_in=0,$.avail_in=$.input.length;do{if($.avail_out===0&&($.output=new e.Buf8(I),$.next_out=0,$.avail_out=I),B=t.deflate($,P),B!==d&&B!==a)return this.onEnd(B),this.ended=!0,!1;($.avail_out===0||$.avail_in===0&&(P===o||P===l))&&(this.options.to==="string"?this.onData(r.buf2binstring(e.shrinkBuf($.output,$.next_out))):this.onData(e.shrinkBuf($.output,$.next_out)))}while(($.avail_in>0||$.avail_out===0)&&B!==d);return P===o?(B=t.deflateEnd(this.strm),this.onEnd(B),this.ended=!0,B===a):(P===l&&(this.onEnd(a),$.avail_out=0),!0)},k.prototype.onData=function(g){this.chunks.push(g)},k.prototype.onEnd=function(g){g===a&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=e.flattenChunks(this.chunks)),this.chunks=[],this.err=g,this.msg=this.strm.msg};function A(g,m){var $=new k(m);if($.push(g,!0),$.err)throw $.msg||n[$.err];return $.result}function w(g,m){return m=m||{},m.raw=!0,A(g,m)}function v(g,m){return m=m||{},m.gzip=!0,A(g,m)}return deflate$1.Deflate=k,deflate$1.deflate=A,deflate$1.deflateRaw=w,deflate$1.gzip=v,deflate$1}var inflate$1={},inflate={},inffast,hasRequiredInffast;function requireInffast(){if(hasRequiredInffast)return inffast;hasRequiredInffast=1;var t=30,e=12;return inffast=function(n,c){var s,h,o,a,d,l,f,p,S,k,A,w,v,g,m,$,I,B,P,x,N,J,Q,W,Y;s=n.state,h=n.next_in,W=n.input,o=h+(n.avail_in-5),a=n.next_out,Y=n.output,d=a-(c-n.avail_out),l=a+(n.avail_out-257),f=s.dmax,p=s.wsize,S=s.whave,k=s.wnext,A=s.window,w=s.hold,v=s.bits,g=s.lencode,m=s.distcode,$=(1<<s.lenbits)-1,I=(1<<s.distbits)-1;e:do{v<15&&(w+=W[h++]<<v,v+=8,w+=W[h++]<<v,v+=8),B=g[w&$];t:for(;;){if(P=B>>>24,w>>>=P,v-=P,P=B>>>16&255,P===0)Y[a++]=B&65535;else if(P&16){x=B&65535,P&=15,P&&(v<P&&(w+=W[h++]<<v,v+=8),x+=w&(1<<P)-1,w>>>=P,v-=P),v<15&&(w+=W[h++]<<v,v+=8,w+=W[h++]<<v,v+=8),B=m[w&I];r:for(;;){if(P=B>>>24,w>>>=P,v-=P,P=B>>>16&255,P&16){if(N=B&65535,P&=15,v<P&&(w+=W[h++]<<v,v+=8,v<P&&(w+=W[h++]<<v,v+=8)),N+=w&(1<<P)-1,N>f){n.msg="invalid distance too far back",s.mode=t;break e}if(w>>>=P,v-=P,P=a-d,N>P){if(P=N-P,P>S&&s.sane){n.msg="invalid distance too far back",s.mode=t;break e}if(J=0,Q=A,k===0){if(J+=p-P,P<x){x-=P;do Y[a++]=A[J++];while(--P);J=a-N,Q=Y}}else if(k<P){if(J+=p+k-P,P-=k,P<x){x-=P;do Y[a++]=A[J++];while(--P);if(J=0,k<x){P=k,x-=P;do Y[a++]=A[J++];while(--P);J=a-N,Q=Y}}}else if(J+=k-P,P<x){x-=P;do Y[a++]=A[J++];while(--P);J=a-N,Q=Y}for(;x>2;)Y[a++]=Q[J++],Y[a++]=Q[J++],Y[a++]=Q[J++],x-=3;x&&(Y[a++]=Q[J++],x>1&&(Y[a++]=Q[J++]))}else{J=a-N;do Y[a++]=Y[J++],Y[a++]=Y[J++],Y[a++]=Y[J++],x-=3;while(x>2);x&&(Y[a++]=Y[J++],x>1&&(Y[a++]=Y[J++]))}}else if((P&64)===0){B=m[(B&65535)+(w&(1<<P)-1)];continue r}else{n.msg="invalid distance code",s.mode=t;break e}break}}else if((P&64)===0){B=g[(B&65535)+(w&(1<<P)-1)];continue t}else if(P&32){s.mode=e;break e}else{n.msg="invalid literal/length code",s.mode=t;break e}break}}while(h<o&&a<l);x=v>>3,h-=x,v-=x<<3,w&=(1<<v)-1,n.next_in=h,n.next_out=a,n.avail_in=h<o?5+(o-h):5-(h-o),n.avail_out=a<l?257+(l-a):257-(a-l),s.hold=w,s.bits=v},inffast}var inftrees,hasRequiredInftrees;function requireInftrees(){if(hasRequiredInftrees)return inftrees;hasRequiredInftrees=1;var t=requireCommon(),e=15,r=852,n=592,c=0,s=1,h=2,o=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],a=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],d=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],l=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];return inftrees=function(p,S,k,A,w,v,g,m){var $=m.bits,I=0,B=0,P=0,x=0,N=0,J=0,Q=0,W=0,Y=0,ve=0,Be,je,xe,ke,q,j=null,H=0,G,V=new t.Buf16(e+1),oe=new t.Buf16(e+1),Z=null,pe=0,ce,U,ye;for(I=0;I<=e;I++)V[I]=0;for(B=0;B<A;B++)V[S[k+B]]++;for(N=$,x=e;x>=1&&V[x]===0;x--);if(N>x&&(N=x),x===0)return w[v++]=1<<24|64<<16|0,w[v++]=1<<24|64<<16|0,m.bits=1,0;for(P=1;P<x&&V[P]===0;P++);for(N<P&&(N=P),W=1,I=1;I<=e;I++)if(W<<=1,W-=V[I],W<0)return-1;if(W>0&&(p===c||x!==1))return-1;for(oe[1]=0,I=1;I<e;I++)oe[I+1]=oe[I]+V[I];for(B=0;B<A;B++)S[k+B]!==0&&(g[oe[S[k+B]]++]=B);if(p===c?(j=Z=g,G=19):p===s?(j=o,H-=257,Z=a,pe-=257,G=256):(j=d,Z=l,G=-1),ve=0,B=0,I=P,q=v,J=N,Q=0,xe=-1,Y=1<<N,ke=Y-1,p===s&&Y>r||p===h&&Y>n)return 1;for(;;){ce=I-Q,g[B]<G?(U=0,ye=g[B]):g[B]>G?(U=Z[pe+g[B]],ye=j[H+g[B]]):(U=96,ye=0),Be=1<<I-Q,je=1<<J,P=je;do je-=Be,w[q+(ve>>Q)+je]=ce<<24|U<<16|ye|0;while(je!==0);for(Be=1<<I-1;ve&Be;)Be>>=1;if(Be!==0?(ve&=Be-1,ve+=Be):ve=0,B++,--V[I]===0){if(I===x)break;I=S[k+g[B]]}if(I>N&&(ve&ke)!==xe){for(Q===0&&(Q=N),q+=P,J=I-Q,W=1<<J;J+Q<x&&(W-=V[J+Q],!(W<=0));)J++,W<<=1;if(Y+=1<<J,p===s&&Y>r||p===h&&Y>n)return 1;xe=ve&ke,w[xe]=N<<24|J<<16|q-v|0}}return ve!==0&&(w[q+ve]=I-Q<<24|64<<16|0),m.bits=N,0},inftrees}var hasRequiredInflate$1;function requireInflate$1(){if(hasRequiredInflate$1)return inflate;hasRequiredInflate$1=1;var t=requireCommon(),e=requireAdler32(),r=requireCrc32(),n=requireInffast(),c=requireInftrees(),s=0,h=1,o=2,a=4,d=5,l=6,f=0,p=1,S=2,k=-2,A=-3,w=-4,v=-5,g=8,m=1,$=2,I=3,B=4,P=5,x=6,N=7,J=8,Q=9,W=10,Y=11,ve=12,Be=13,je=14,xe=15,ke=16,q=17,j=18,H=19,G=20,V=21,oe=22,Z=23,pe=24,ce=25,U=26,ye=27,be=28,Pe=29,Oe=30,Ue=31,rt=32,yt=852,dt=592,fe=15,Re=fe;function Ke(ne){return(ne>>>24&255)+(ne>>>8&65280)+((ne&65280)<<8)+((ne&255)<<24)}function We(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new t.Buf16(320),this.work=new t.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function Ze(ne){var _e;return!ne||!ne.state?k:(_e=ne.state,ne.total_in=ne.total_out=_e.total=0,ne.msg="",_e.wrap&&(ne.adler=_e.wrap&1),_e.mode=m,_e.last=0,_e.havedict=0,_e.dmax=32768,_e.head=null,_e.hold=0,_e.bits=0,_e.lencode=_e.lendyn=new t.Buf32(yt),_e.distcode=_e.distdyn=new t.Buf32(dt),_e.sane=1,_e.back=-1,f)}function st(ne){var _e;return!ne||!ne.state?k:(_e=ne.state,_e.wsize=0,_e.whave=0,_e.wnext=0,Ze(ne))}function gt(ne,_e){var K,qe;return!ne||!ne.state||(qe=ne.state,_e<0?(K=0,_e=-_e):(K=(_e>>4)+1,_e<48&&(_e&=15)),_e&&(_e<8||_e>15))?k:(qe.window!==null&&qe.wbits!==_e&&(qe.window=null),qe.wrap=K,qe.wbits=_e,st(ne))}function Dt(ne,_e){var K,qe;return ne?(qe=new We,ne.state=qe,qe.window=null,K=gt(ne,_e),K!==f&&(ne.state=null),K):k}function wt(ne){return Dt(ne,Re)}var vt=!0,qt,Lt;function Gt(ne){if(vt){var _e;for(qt=new t.Buf32(512),Lt=new t.Buf32(32),_e=0;_e<144;)ne.lens[_e++]=8;for(;_e<256;)ne.lens[_e++]=9;for(;_e<280;)ne.lens[_e++]=7;for(;_e<288;)ne.lens[_e++]=8;for(c(h,ne.lens,0,288,qt,0,ne.work,{bits:9}),_e=0;_e<32;)ne.lens[_e++]=5;c(o,ne.lens,0,32,Lt,0,ne.work,{bits:5}),vt=!1}ne.lencode=qt,ne.lenbits=9,ne.distcode=Lt,ne.distbits=5}function te(ne,_e,K,qe){var lt,L=ne.state;return L.window===null&&(L.wsize=1<<L.wbits,L.wnext=0,L.whave=0,L.window=new t.Buf8(L.wsize)),qe>=L.wsize?(t.arraySet(L.window,_e,K-L.wsize,L.wsize,0),L.wnext=0,L.whave=L.wsize):(lt=L.wsize-L.wnext,lt>qe&&(lt=qe),t.arraySet(L.window,_e,K-qe,lt,L.wnext),qe-=lt,qe?(t.arraySet(L.window,_e,K-qe,qe,0),L.wnext=qe,L.whave=L.wsize):(L.wnext+=lt,L.wnext===L.wsize&&(L.wnext=0),L.whave<L.wsize&&(L.whave+=lt))),0}function C(ne,_e){var K,qe,lt,L,me,Me,ie,Se,Le,bt,le,M,R,D,X=0,he,we,Ae,De,Et,St,Qe,mt,It=new t.Buf8(4),Ft,Nt,kt=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!ne||!ne.state||!ne.output||!ne.input&&ne.avail_in!==0)return k;K=ne.state,K.mode===ve&&(K.mode=Be),me=ne.next_out,lt=ne.output,ie=ne.avail_out,L=ne.next_in,qe=ne.input,Me=ne.avail_in,Se=K.hold,Le=K.bits,bt=Me,le=ie,mt=f;e:for(;;)switch(K.mode){case m:if(K.wrap===0){K.mode=Be;break}for(;Le<16;){if(Me===0)break e;Me--,Se+=qe[L++]<<Le,Le+=8}if(K.wrap&2&&Se===35615){K.check=0,It[0]=Se&255,It[1]=Se>>>8&255,K.check=r(K.check,It,2,0),Se=0,Le=0,K.mode=$;break}if(K.flags=0,K.head&&(K.head.done=!1),!(K.wrap&1)||(((Se&255)<<8)+(Se>>8))%31){ne.msg="incorrect header check",K.mode=Oe;break}if((Se&15)!==g){ne.msg="unknown compression method",K.mode=Oe;break}if(Se>>>=4,Le-=4,Qe=(Se&15)+8,K.wbits===0)K.wbits=Qe;else if(Qe>K.wbits){ne.msg="invalid window size",K.mode=Oe;break}K.dmax=1<<Qe,ne.adler=K.check=1,K.mode=Se&512?W:ve,Se=0,Le=0;break;case $:for(;Le<16;){if(Me===0)break e;Me--,Se+=qe[L++]<<Le,Le+=8}if(K.flags=Se,(K.flags&255)!==g){ne.msg="unknown compression method",K.mode=Oe;break}if(K.flags&57344){ne.msg="unknown header flags set",K.mode=Oe;break}K.head&&(K.head.text=Se>>8&1),K.flags&512&&(It[0]=Se&255,It[1]=Se>>>8&255,K.check=r(K.check,It,2,0)),Se=0,Le=0,K.mode=I;case I:for(;Le<32;){if(Me===0)break e;Me--,Se+=qe[L++]<<Le,Le+=8}K.head&&(K.head.time=Se),K.flags&512&&(It[0]=Se&255,It[1]=Se>>>8&255,It[2]=Se>>>16&255,It[3]=Se>>>24&255,K.check=r(K.check,It,4,0)),Se=0,Le=0,K.mode=B;case B:for(;Le<16;){if(Me===0)break e;Me--,Se+=qe[L++]<<Le,Le+=8}K.head&&(K.head.xflags=Se&255,K.head.os=Se>>8),K.flags&512&&(It[0]=Se&255,It[1]=Se>>>8&255,K.check=r(K.check,It,2,0)),Se=0,Le=0,K.mode=P;case P:if(K.flags&1024){for(;Le<16;){if(Me===0)break e;Me--,Se+=qe[L++]<<Le,Le+=8}K.length=Se,K.head&&(K.head.extra_len=Se),K.flags&512&&(It[0]=Se&255,It[1]=Se>>>8&255,K.check=r(K.check,It,2,0)),Se=0,Le=0}else K.head&&(K.head.extra=null);K.mode=x;case x:if(K.flags&1024&&(M=K.length,M>Me&&(M=Me),M&&(K.head&&(Qe=K.head.extra_len-K.length,K.head.extra||(K.head.extra=new Array(K.head.extra_len)),t.arraySet(K.head.extra,qe,L,M,Qe)),K.flags&512&&(K.check=r(K.check,qe,M,L)),Me-=M,L+=M,K.length-=M),K.length))break e;K.length=0,K.mode=N;case N:if(K.flags&2048){if(Me===0)break e;M=0;do Qe=qe[L+M++],K.head&&Qe&&K.length<65536&&(K.head.name+=String.fromCharCode(Qe));while(Qe&&M<Me);if(K.flags&512&&(K.check=r(K.check,qe,M,L)),Me-=M,L+=M,Qe)break e}else K.head&&(K.head.name=null);K.length=0,K.mode=J;case J:if(K.flags&4096){if(Me===0)break e;M=0;do Qe=qe[L+M++],K.head&&Qe&&K.length<65536&&(K.head.comment+=String.fromCharCode(Qe));while(Qe&&M<Me);if(K.flags&512&&(K.check=r(K.check,qe,M,L)),Me-=M,L+=M,Qe)break e}else K.head&&(K.head.comment=null);K.mode=Q;case Q:if(K.flags&512){for(;Le<16;){if(Me===0)break e;Me--,Se+=qe[L++]<<Le,Le+=8}if(Se!==(K.check&65535)){ne.msg="header crc mismatch",K.mode=Oe;break}Se=0,Le=0}K.head&&(K.head.hcrc=K.flags>>9&1,K.head.done=!0),ne.adler=K.check=0,K.mode=ve;break;case W:for(;Le<32;){if(Me===0)break e;Me--,Se+=qe[L++]<<Le,Le+=8}ne.adler=K.check=Ke(Se),Se=0,Le=0,K.mode=Y;case Y:if(K.havedict===0)return ne.next_out=me,ne.avail_out=ie,ne.next_in=L,ne.avail_in=Me,K.hold=Se,K.bits=Le,S;ne.adler=K.check=1,K.mode=ve;case ve:if(_e===d||_e===l)break e;case Be:if(K.last){Se>>>=Le&7,Le-=Le&7,K.mode=ye;break}for(;Le<3;){if(Me===0)break e;Me--,Se+=qe[L++]<<Le,Le+=8}switch(K.last=Se&1,Se>>>=1,Le-=1,Se&3){case 0:K.mode=je;break;case 1:if(Gt(K),K.mode=G,_e===l){Se>>>=2,Le-=2;break e}break;case 2:K.mode=q;break;case 3:ne.msg="invalid block type",K.mode=Oe}Se>>>=2,Le-=2;break;case je:for(Se>>>=Le&7,Le-=Le&7;Le<32;){if(Me===0)break e;Me--,Se+=qe[L++]<<Le,Le+=8}if((Se&65535)!==(Se>>>16^65535)){ne.msg="invalid stored block lengths",K.mode=Oe;break}if(K.length=Se&65535,Se=0,Le=0,K.mode=xe,_e===l)break e;case xe:K.mode=ke;case ke:if(M=K.length,M){if(M>Me&&(M=Me),M>ie&&(M=ie),M===0)break e;t.arraySet(lt,qe,L,M,me),Me-=M,L+=M,ie-=M,me+=M,K.length-=M;break}K.mode=ve;break;case q:for(;Le<14;){if(Me===0)break e;Me--,Se+=qe[L++]<<Le,Le+=8}if(K.nlen=(Se&31)+257,Se>>>=5,Le-=5,K.ndist=(Se&31)+1,Se>>>=5,Le-=5,K.ncode=(Se&15)+4,Se>>>=4,Le-=4,K.nlen>286||K.ndist>30){ne.msg="too many length or distance symbols",K.mode=Oe;break}K.have=0,K.mode=j;case j:for(;K.have<K.ncode;){for(;Le<3;){if(Me===0)break e;Me--,Se+=qe[L++]<<Le,Le+=8}K.lens[kt[K.have++]]=Se&7,Se>>>=3,Le-=3}for(;K.have<19;)K.lens[kt[K.have++]]=0;if(K.lencode=K.lendyn,K.lenbits=7,Ft={bits:K.lenbits},mt=c(s,K.lens,0,19,K.lencode,0,K.work,Ft),K.lenbits=Ft.bits,mt){ne.msg="invalid code lengths set",K.mode=Oe;break}K.have=0,K.mode=H;case H:for(;K.have<K.nlen+K.ndist;){for(;X=K.lencode[Se&(1<<K.lenbits)-1],he=X>>>24,we=X>>>16&255,Ae=X&65535,!(he<=Le);){if(Me===0)break e;Me--,Se+=qe[L++]<<Le,Le+=8}if(Ae<16)Se>>>=he,Le-=he,K.lens[K.have++]=Ae;else{if(Ae===16){for(Nt=he+2;Le<Nt;){if(Me===0)break e;Me--,Se+=qe[L++]<<Le,Le+=8}if(Se>>>=he,Le-=he,K.have===0){ne.msg="invalid bit length repeat",K.mode=Oe;break}Qe=K.lens[K.have-1],M=3+(Se&3),Se>>>=2,Le-=2}else if(Ae===17){for(Nt=he+3;Le<Nt;){if(Me===0)break e;Me--,Se+=qe[L++]<<Le,Le+=8}Se>>>=he,Le-=he,Qe=0,M=3+(Se&7),Se>>>=3,Le-=3}else{for(Nt=he+7;Le<Nt;){if(Me===0)break e;Me--,Se+=qe[L++]<<Le,Le+=8}Se>>>=he,Le-=he,Qe=0,M=11+(Se&127),Se>>>=7,Le-=7}if(K.have+M>K.nlen+K.ndist){ne.msg="invalid bit length repeat",K.mode=Oe;break}for(;M--;)K.lens[K.have++]=Qe}}if(K.mode===Oe)break;if(K.lens[256]===0){ne.msg="invalid code -- missing end-of-block",K.mode=Oe;break}if(K.lenbits=9,Ft={bits:K.lenbits},mt=c(h,K.lens,0,K.nlen,K.lencode,0,K.work,Ft),K.lenbits=Ft.bits,mt){ne.msg="invalid literal/lengths set",K.mode=Oe;break}if(K.distbits=6,K.distcode=K.distdyn,Ft={bits:K.distbits},mt=c(o,K.lens,K.nlen,K.ndist,K.distcode,0,K.work,Ft),K.distbits=Ft.bits,mt){ne.msg="invalid distances set",K.mode=Oe;break}if(K.mode=G,_e===l)break e;case G:K.mode=V;case V:if(Me>=6&&ie>=258){ne.next_out=me,ne.avail_out=ie,ne.next_in=L,ne.avail_in=Me,K.hold=Se,K.bits=Le,n(ne,le),me=ne.next_out,lt=ne.output,ie=ne.avail_out,L=ne.next_in,qe=ne.input,Me=ne.avail_in,Se=K.hold,Le=K.bits,K.mode===ve&&(K.back=-1);break}for(K.back=0;X=K.lencode[Se&(1<<K.lenbits)-1],he=X>>>24,we=X>>>16&255,Ae=X&65535,!(he<=Le);){if(Me===0)break e;Me--,Se+=qe[L++]<<Le,Le+=8}if(we&&(we&240)===0){for(De=he,Et=we,St=Ae;X=K.lencode[St+((Se&(1<<De+Et)-1)>>De)],he=X>>>24,we=X>>>16&255,Ae=X&65535,!(De+he<=Le);){if(Me===0)break e;Me--,Se+=qe[L++]<<Le,Le+=8}Se>>>=De,Le-=De,K.back+=De}if(Se>>>=he,Le-=he,K.back+=he,K.length=Ae,we===0){K.mode=U;break}if(we&32){K.back=-1,K.mode=ve;break}if(we&64){ne.msg="invalid literal/length code",K.mode=Oe;break}K.extra=we&15,K.mode=oe;case oe:if(K.extra){for(Nt=K.extra;Le<Nt;){if(Me===0)break e;Me--,Se+=qe[L++]<<Le,Le+=8}K.length+=Se&(1<<K.extra)-1,Se>>>=K.extra,Le-=K.extra,K.back+=K.extra}K.was=K.length,K.mode=Z;case Z:for(;X=K.distcode[Se&(1<<K.distbits)-1],he=X>>>24,we=X>>>16&255,Ae=X&65535,!(he<=Le);){if(Me===0)break e;Me--,Se+=qe[L++]<<Le,Le+=8}if((we&240)===0){for(De=he,Et=we,St=Ae;X=K.distcode[St+((Se&(1<<De+Et)-1)>>De)],he=X>>>24,we=X>>>16&255,Ae=X&65535,!(De+he<=Le);){if(Me===0)break e;Me--,Se+=qe[L++]<<Le,Le+=8}Se>>>=De,Le-=De,K.back+=De}if(Se>>>=he,Le-=he,K.back+=he,we&64){ne.msg="invalid distance code",K.mode=Oe;break}K.offset=Ae,K.extra=we&15,K.mode=pe;case pe:if(K.extra){for(Nt=K.extra;Le<Nt;){if(Me===0)break e;Me--,Se+=qe[L++]<<Le,Le+=8}K.offset+=Se&(1<<K.extra)-1,Se>>>=K.extra,Le-=K.extra,K.back+=K.extra}if(K.offset>K.dmax){ne.msg="invalid distance too far back",K.mode=Oe;break}K.mode=ce;case ce:if(ie===0)break e;if(M=le-ie,K.offset>M){if(M=K.offset-M,M>K.whave&&K.sane){ne.msg="invalid distance too far back",K.mode=Oe;break}M>K.wnext?(M-=K.wnext,R=K.wsize-M):R=K.wnext-M,M>K.length&&(M=K.length),D=K.window}else D=lt,R=me-K.offset,M=K.length;M>ie&&(M=ie),ie-=M,K.length-=M;do lt[me++]=D[R++];while(--M);K.length===0&&(K.mode=V);break;case U:if(ie===0)break e;lt[me++]=K.length,ie--,K.mode=V;break;case ye:if(K.wrap){for(;Le<32;){if(Me===0)break e;Me--,Se|=qe[L++]<<Le,Le+=8}if(le-=ie,ne.total_out+=le,K.total+=le,le&&(ne.adler=K.check=K.flags?r(K.check,lt,le,me-le):e(K.check,lt,le,me-le)),le=ie,(K.flags?Se:Ke(Se))!==K.check){ne.msg="incorrect data check",K.mode=Oe;break}Se=0,Le=0}K.mode=be;case be:if(K.wrap&&K.flags){for(;Le<32;){if(Me===0)break e;Me--,Se+=qe[L++]<<Le,Le+=8}if(Se!==(K.total&4294967295)){ne.msg="incorrect length check",K.mode=Oe;break}Se=0,Le=0}K.mode=Pe;case Pe:mt=p;break e;case Oe:mt=A;break e;case Ue:return w;case rt:default:return k}return ne.next_out=me,ne.avail_out=ie,ne.next_in=L,ne.avail_in=Me,K.hold=Se,K.bits=Le,(K.wsize||le!==ne.avail_out&&K.mode<Oe&&(K.mode<ye||_e!==a))&&te(ne,ne.output,ne.next_out,le-ne.avail_out),bt-=ne.avail_in,le-=ne.avail_out,ne.total_in+=bt,ne.total_out+=le,K.total+=le,K.wrap&&le&&(ne.adler=K.check=K.flags?r(K.check,lt,le,ne.next_out-le):e(K.check,lt,le,ne.next_out-le)),ne.data_type=K.bits+(K.last?64:0)+(K.mode===ve?128:0)+(K.mode===G||K.mode===xe?256:0),(bt===0&&le===0||_e===a)&&mt===f&&(mt=v),mt}function O(ne){if(!ne||!ne.state)return k;var _e=ne.state;return _e.window&&(_e.window=null),ne.state=null,f}function ee(ne,_e){var K;return!ne||!ne.state||(K=ne.state,(K.wrap&2)===0)?k:(K.head=_e,_e.done=!1,f)}function ge(ne,_e){var K=_e.length,qe,lt,L;return!ne||!ne.state||(qe=ne.state,qe.wrap!==0&&qe.mode!==Y)?k:qe.mode===Y&&(lt=1,lt=e(lt,_e,K,0),lt!==qe.check)?A:(L=te(ne,_e,K,K),L?(qe.mode=Ue,w):(qe.havedict=1,f))}return inflate.inflateReset=st,inflate.inflateReset2=gt,inflate.inflateResetKeep=Ze,inflate.inflateInit=wt,inflate.inflateInit2=Dt,inflate.inflate=C,inflate.inflateEnd=O,inflate.inflateGetHeader=ee,inflate.inflateSetDictionary=ge,inflate.inflateInfo="pako inflate (from Nodeca project)",inflate}var constants,hasRequiredConstants;function requireConstants(){return hasRequiredConstants||(hasRequiredConstants=1,constants={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}),constants}var gzheader,hasRequiredGzheader;function requireGzheader(){if(hasRequiredGzheader)return gzheader;hasRequiredGzheader=1;function t(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}return gzheader=t,gzheader}var hasRequiredInflate;function requireInflate(){if(hasRequiredInflate)return inflate$1;hasRequiredInflate=1;var t=requireInflate$1(),e=requireCommon(),r=requireStrings(),n=requireConstants(),c=requireMessages(),s=requireZstream(),h=requireGzheader(),o=Object.prototype.toString;function a(f){if(!(this instanceof a))return new a(f);this.options=e.assign({chunkSize:16384,windowBits:0,to:""},f||{});var p=this.options;p.raw&&p.windowBits>=0&&p.windowBits<16&&(p.windowBits=-p.windowBits,p.windowBits===0&&(p.windowBits=-15)),p.windowBits>=0&&p.windowBits<16&&!(f&&f.windowBits)&&(p.windowBits+=32),p.windowBits>15&&p.windowBits<48&&(p.windowBits&15)===0&&(p.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new s,this.strm.avail_out=0;var S=t.inflateInit2(this.strm,p.windowBits);if(S!==n.Z_OK)throw new Error(c[S]);if(this.header=new h,t.inflateGetHeader(this.strm,this.header),p.dictionary&&(typeof p.dictionary=="string"?p.dictionary=r.string2buf(p.dictionary):o.call(p.dictionary)==="[object ArrayBuffer]"&&(p.dictionary=new Uint8Array(p.dictionary)),p.raw&&(S=t.inflateSetDictionary(this.strm,p.dictionary),S!==n.Z_OK)))throw new Error(c[S])}a.prototype.push=function(f,p){var S=this.strm,k=this.options.chunkSize,A=this.options.dictionary,w,v,g,m,$,I=!1;if(this.ended)return!1;v=p===~~p?p:p===!0?n.Z_FINISH:n.Z_NO_FLUSH,typeof f=="string"?S.input=r.binstring2buf(f):o.call(f)==="[object ArrayBuffer]"?S.input=new Uint8Array(f):S.input=f,S.next_in=0,S.avail_in=S.input.length;do{if(S.avail_out===0&&(S.output=new e.Buf8(k),S.next_out=0,S.avail_out=k),w=t.inflate(S,n.Z_NO_FLUSH),w===n.Z_NEED_DICT&&A&&(w=t.inflateSetDictionary(this.strm,A)),w===n.Z_BUF_ERROR&&I===!0&&(w=n.Z_OK,I=!1),w!==n.Z_STREAM_END&&w!==n.Z_OK)return this.onEnd(w),this.ended=!0,!1;S.next_out&&(S.avail_out===0||w===n.Z_STREAM_END||S.avail_in===0&&(v===n.Z_FINISH||v===n.Z_SYNC_FLUSH))&&(this.options.to==="string"?(g=r.utf8border(S.output,S.next_out),m=S.next_out-g,$=r.buf2string(S.output,g),S.next_out=m,S.avail_out=k-m,m&&e.arraySet(S.output,S.output,g,m,0),this.onData($)):this.onData(e.shrinkBuf(S.output,S.next_out))),S.avail_in===0&&S.avail_out===0&&(I=!0)}while((S.avail_in>0||S.avail_out===0)&&w!==n.Z_STREAM_END);return w===n.Z_STREAM_END&&(v=n.Z_FINISH),v===n.Z_FINISH?(w=t.inflateEnd(this.strm),this.onEnd(w),this.ended=!0,w===n.Z_OK):(v===n.Z_SYNC_FLUSH&&(this.onEnd(n.Z_OK),S.avail_out=0),!0)},a.prototype.onData=function(f){this.chunks.push(f)},a.prototype.onEnd=function(f){f===n.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=e.flattenChunks(this.chunks)),this.chunks=[],this.err=f,this.msg=this.strm.msg};function d(f,p){var S=new a(p);if(S.push(f,!0),S.err)throw S.msg||c[S.err];return S.result}function l(f,p){return p=p||{},p.raw=!0,d(f,p)}return inflate$1.Inflate=a,inflate$1.inflate=d,inflate$1.inflateRaw=l,inflate$1.ungzip=d,inflate$1}var pako_1,hasRequiredPako;function requirePako(){if(hasRequiredPako)return pako_1;hasRequiredPako=1;var t=requireCommon().assign,e=requireDeflate(),r=requireInflate(),n=requireConstants(),c={};return t(c,e,r,n),pako_1=c,pako_1}var pify,hasRequiredPify;function requirePify(){if(hasRequiredPify)return pify;hasRequiredPify=1;const t=(e,r)=>function(...n){const c=r.promiseModule;return new c((s,h)=>{r.multiArgs?n.push((...o)=>{r.errorFirst?o[0]?h(o):(o.shift(),s(o)):s(o)}):r.errorFirst?n.push((o,a)=>{o?h(o):s(a)}):n.push(s),e.apply(this,n)})};return pify=(e,r)=>{r=Object.assign({exclude:[/.+(Sync|Stream)$/],errorFirst:!0,promiseModule:Promise},r);const n=typeof e;if(!(e!==null&&(n==="object"||n==="function")))throw new TypeError(`Expected \`input\` to be a \`Function\` or \`Object\`, got \`${e===null?"null":n}\``);const c=h=>{const o=a=>typeof a=="string"?h===a:a.test(h);return r.include?r.include.some(o):!r.exclude.some(o)};let s;n==="function"?s=function(...h){return r.excludeMain?e(...h):t(e,r).apply(this,h)}:s=Object.create(Object.getPrototypeOf(e));for(const h in e){const o=e[h];s[h]=typeof o=="function"&&c(h)?t(o,r):o}return s},pify}var ignore,hasRequiredIgnore;function requireIgnore(){if(hasRequiredIgnore)return ignore;hasRequiredIgnore=1;var t={};function e(xe){return Array.isArray(xe)?xe:[xe]}const r="",n=" ",c="\\",s=/^\s+$/,h=/(?:[^\\]|^)\\$/,o=/^\\!/,a=/^\\#/,d=/\r?\n/g,l=/^\.*\/|^\.+$/,f="/";let p="node-ignore";typeof Symbol<"u"&&(p=Symbol.for("node-ignore"));const S=p,k=(xe,ke,q)=>Object.defineProperty(xe,ke,{value:q}),A=/([0-z])-([0-z])/g,w=()=>!1,v=xe=>xe.replace(A,(ke,q,j)=>q.charCodeAt(0)<=j.charCodeAt(0)?ke:r),g=xe=>{const{length:ke}=xe;return xe.slice(0,ke-ke%2)},m=[[/^\uFEFF/,()=>r],[/((?:\\\\)*?)(\\?\s+)$/,(xe,ke,q)=>ke+(q.indexOf("\\")===0?n:r)],[/(\\+?)\s/g,(xe,ke)=>{const{length:q}=ke;return ke.slice(0,q-q%2)+n}],[/[\\$.|*+(){^]/g,xe=>`\\${xe}`],[/(?!\\)\?/g,()=>"[^/]"],[/^\//,()=>"^"],[/\//g,()=>"\\/"],[/^\^*\\\*\\\*\\\//,()=>"^(?:.*\\/)?"],[/^(?=[^^])/,function(){return/\/(?!$)/.test(this)?"^":"(?:^|\\/)"}],[/\\\/\\\*\\\*(?=\\\/|$)/g,(xe,ke,q)=>ke+6<q.length?"(?:\\/[^\\/]+)*":"\\/.+"],[/(^|[^\\]+)(\\\*)+(?=.+)/g,(xe,ke,q)=>{const j=q.replace(/\\\*/g,"[^\\/]*");return ke+j}],[/\\\\\\(?=[$.|*+(){^])/g,()=>c],[/\\\\/g,()=>c],[/(\\)?\[([^\]/]*?)(\\*)($|\])/g,(xe,ke,q,j,H)=>ke===c?`\\[${q}${g(j)}${H}`:H==="]"&&j.length%2===0?`[${v(q)}${j}]`:"[]"],[/(?:[^*])$/,xe=>/\/$/.test(xe)?`${xe}$`:`${xe}(?=$|\\/$)`],[/(\^|\\\/)?\\\*$/,(xe,ke)=>`${ke?`${ke}[^/]+`:"[^/]*"}(?=$|\\/$)`]],$=Object.create(null),I=(xe,ke)=>{let q=$[xe];return q||(q=m.reduce((j,[H,G])=>j.replace(H,G.bind(xe)),xe),$[xe]=q),ke?new RegExp(q,"i"):new RegExp(q)},B=xe=>typeof xe=="string",P=xe=>xe&&B(xe)&&!s.test(xe)&&!h.test(xe)&&xe.indexOf("#")!==0,x=xe=>xe.split(d);class N{constructor(ke,q,j,H){this.origin=ke,this.pattern=q,this.negative=j,this.regex=H}}const J=(xe,ke)=>{const q=xe;let j=!1;xe.indexOf("!")===0&&(j=!0,xe=xe.substr(1)),xe=xe.replace(o,"!").replace(a,"#");const H=I(xe,ke);return new N(q,xe,j,H)},Q=(xe,ke)=>{throw new ke(xe)},W=(xe,ke,q)=>B(xe)?xe?W.isNotRelative(xe)?q(`path should be a \`path.relative()\`d string, but got "${ke}"`,RangeError):!0:q("path must not be empty",TypeError):q(`path must be a string, but got \`${ke}\``,TypeError),Y=xe=>l.test(xe);W.isNotRelative=Y,W.convert=xe=>xe;class ve{constructor({ignorecase:ke=!0,ignoreCase:q=ke,allowRelativePaths:j=!1}={}){k(this,S,!0),this._rules=[],this._ignoreCase=q,this._allowRelativePaths=j,this._initCache()}_initCache(){this._ignoreCache=Object.create(null),this._testCache=Object.create(null)}_addPattern(ke){if(ke&&ke[S]){this._rules=this._rules.concat(ke._rules),this._added=!0;return}if(P(ke)){const q=J(ke,this._ignoreCase);this._added=!0,this._rules.push(q)}}add(ke){return this._added=!1,e(B(ke)?x(ke):ke).forEach(this._addPattern,this),this._added&&this._initCache(),this}addPattern(ke){return this.add(ke)}_testOne(ke,q){let j=!1,H=!1;return this._rules.forEach(G=>{const{negative:V}=G;if(H===V&&j!==H||V&&!j&&!H&&!q)return;G.regex.test(ke)&&(j=!V,H=V)}),{ignored:j,unignored:H}}_test(ke,q,j,H){const G=ke&&W.convert(ke);return W(G,ke,this._allowRelativePaths?w:Q),this._t(G,q,j,H)}_t(ke,q,j,H){if(ke in q)return q[ke];if(H||(H=ke.split(f)),H.pop(),!H.length)return q[ke]=this._testOne(ke,j);const G=this._t(H.join(f)+f,q,j,H);return q[ke]=G.ignored?G:this._testOne(ke,j)}ignores(ke){return this._test(ke,this._ignoreCache,!1).ignored}createFilter(){return ke=>!this.ignores(ke)}filter(ke){return e(ke).filter(this.createFilter())}test(ke){return this._test(ke,this._testCache,!0)}}const Be=xe=>new ve(xe),je=xe=>W(xe&&W.convert(xe),xe,w);if(Be.isPathValid=je,Be.default=Be,ignore=Be,typeof process$1<"u"&&(t&&t.IGNORE_TEST_WIN32||process$1.platform==="win32")){const xe=q=>/^\\\\\?\\/.test(q)||/["<>|\u0000-\u001F]+/u.test(q)?q:q.replace(/\\/g,"/");W.convert=xe;const ke=/^[a-z]:\//i;W.isNotRelative=q=>ke.test(q)||Y(q)}return ignore}var lib,hasRequiredLib;function requireLib(){if(hasRequiredLib)return lib;hasRequiredLib=1;function t(n){return n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function e(n,c,s){return c=c instanceof RegExp?c:new RegExp(t(c),"g"),n.replace(c,s)}var r={clean:function(c){if(typeof c!="string")throw new Error("Expected a string, received: "+c);return c=e(c,"./","/"),c=e(c,"..","."),c=e(c," ","-"),c=e(c,/^[~^:?*\\\-]/g,""),c=e(c,/[~^:?*\\]/g,"-"),c=e(c,/[~^:?*\\\-]$/g,""),c=e(c,"@{","-"),c=e(c,/\.$/g,""),c=e(c,/\/$/g,""),c=e(c,/\.lock$/g,""),c}};return lib=r,lib}var onp,hasRequiredOnp;function requireOnp(){return hasRequiredOnp||(hasRequiredOnp=1,onp=function(t,e){var r=t,n=e,c=r.length,s=n.length,h=!1,o=null,a=c+1,d=[],l=[],f=[],p="",S=-1,k=0,A=1,w,v,g=function(){c>=s&&(w=r,v=c,r=n,n=w,c=s,s=v,h=!0,a=c+1)},m=function(P,x,N){return{x:P,y:x,k:N}},$=function(P,x){return{elem:P,t:x}},I=function(P,x,N){var J,Q,W;for(x>N?J=d[P-1+a]:J=d[P+1+a],W=Math.max(x,N),Q=W-P;Q<c&&W<s&&r[Q]===n[W];)++Q,++W;return d[P+a]=l.length,l[l.length]=new m(Q,W,J),W},B=function(P){var x,N,J;for(x=N=0,J=P.length-1;J>=0;--J)for(;x<P[J].x||N<P[J].y;)P[J].y-P[J].x>N-x?(h?f[f.length]=new $(n[N],S):f[f.length]=new $(n[N],A),++N):P[J].y-P[J].x<N-x?(h?f[f.length]=new $(r[x],A):f[f.length]=new $(r[x],S),++x):(f[f.length]=new $(r[x],k),p+=r[x],++x,++N)};return g(),{SES_DELETE:-1,SES_COMMON:0,SES_ADD:1,editdistance:function(){return o},getlcs:function(){return p},getses:function(){return f},compose:function(){var P,x,N,J,Q,W,Y,ve;for(P=s-c,x=c+s+3,N={},Y=0;Y<x;++Y)N[Y]=-1,d[Y]=-1;J=-1;do{for(++J,ve=-J;ve<=P-1;++ve)N[ve+a]=I(ve,N[ve-1+a]+1,N[ve+1+a]);for(ve=P+J;ve>=P+1;--ve)N[ve+a]=I(ve,N[ve-1+a]+1,N[ve+1+a]);N[P+a]=I(P,N[P-1+a]+1,N[P+1+a])}while(N[P+a]!==s);for(o=P+2*J,Q=d[P+a],W=[];Q!==-1;)W[W.length]=new m(l[Q].x,l[Q].y,null),Q=l[Q].k;B(W)}}}),onp}var diff3,hasRequiredDiff3;function requireDiff3(){if(hasRequiredDiff3)return diff3;hasRequiredDiff3=1;var t=requireOnp();function e(s,h){var o=new t(s,h);o.compose();for(var a=o.getses(),d,l,f=s.length-1,p=h.length-1,S=a.length-1;S>=0;--S)a[S].t===o.SES_COMMON?(l?(l.chain={file1index:f,file2index:p,chain:null},l=l.chain):(d={file1index:f,file2index:p,chain:null},l=d),f--,p--):a[S].t===o.SES_DELETE?f--:a[S].t===o.SES_ADD&&p--;var k={file1index:-1,file2index:-1,chain:null};return l?(l.chain=k,d):k}function r(s,h){for(var o=[],a=s.length,d=h.length,l=e(s,h);l!==null;l=l.chain){var f=a-l.file1index-1,p=d-l.file2index-1;a=l.file1index,d=l.file2index,(f||p)&&o.push({file1:[a+1,f],file2:[d+1,p]})}return o.reverse(),o}function n(s,h,o){var a,d=r(h,s),l=r(h,o),f=[];function p(ke,q){f.push([ke.file1[0],q,ke.file1[1],ke.file2[0],ke.file2[1]])}for(a=0;a<d.length;a++)p(d[a],0);for(a=0;a<l.length;a++)p(l[a],2);f.sort(function(ke,q){return ke[0]-q[0]});var S=[],k=0;function A(ke){ke>k&&(S.push([1,k,ke-k]),k=ke)}for(var w=0;w<f.length;w++){for(var v=w,g=f[w],m=g[0],$=m+g[2];w<f.length-1;){var I=f[w+1],B=I[0];if(B>$)break;$=Math.max($,B+I[2]),w++}if(A(m),v==w)g[4]>0&&S.push([g[1],g[3],g[4]]);else{var P={0:[s.length,-1,h.length,-1],2:[o.length,-1,h.length,-1]};for(a=v;a<=w;a++){g=f[a];var x=g[1],N=P[x],J=g[0],Q=J+g[2],W=g[3],Y=W+g[4];N[0]=Math.min(W,N[0]),N[1]=Math.max(Y,N[1]),N[2]=Math.min(J,N[2]),N[3]=Math.max(Q,N[3])}var ve=P[0][0]+(m-P[0][2]),Be=P[0][1]+($-P[0][3]),je=P[2][0]+(m-P[2][2]),xe=P[2][1]+($-P[2][3]);S.push([-1,ve,Be-ve,m,$-m,je,xe-je])}k=$}return A(h.length),S}function c(s,h,o){var a=[],d=[s,h,o],l=n(s,h,o),f=[];function p(){f.length&&a.push({ok:f}),f=[]}function S(g){for(var m=0;m<g.length;m++)f.push(g[m])}function k(g){if(g[2]!=g[6])return!0;for(var m=g[1],$=g[5],I=0;I<g[2];I++)if(s[I+m]!=o[I+$])return!0;return!1}for(var A=0;A<l.length;A++){var w=l[A],v=w[0];v==-1?k(w)?(p(),a.push({conflict:{a:s.slice(w[1],w[1]+w[2]),aIndex:w[1],o:h.slice(w[3],w[3]+w[4]),oIndex:w[3],b:o.slice(w[5],w[5]+w[6]),bIndex:w[5]}})):S(d[0].slice(w[1],w[1]+w[2])):S(d[v].slice(w[1],w[1]+w[2]))}return p(),a}return diff3=c,diff3}var hasRequiredIsomorphicGit;function requireIsomorphicGit(){if(hasRequiredIsomorphicGit)return isomorphicGit;hasRequiredIsomorphicGit=1,Object.defineProperty(isomorphicGit,"__esModule",{value:!0});function t(y){return y&&typeof y=="object"&&"default"in y?y.default:y}var e=t(requireAsyncLock()),r=t(requireSha1()),n=t(requireCrc32$1()),c=t(requirePako()),s=t(requirePify()),h=t(requireIgnore()),o=t(requireLib()),a=t(requireDiff3());class d extends Error{constructor(u){super(u),this.caller=""}toJSON(){return{code:this.code,data:this.data,caller:this.caller,message:this.message,stack:this.stack}}fromJSON(u){const _=new d(u.message);return _.code=u.code,_.data=u.data,_.caller=u.caller,_.stack=u.stack,_}get isIsomorphicGitError(){return!0}}class l extends d{constructor(u){super(`Modifying the index is not possible because you have unmerged files: ${u.toString}. Fix them up in the work tree, and then use 'git add/rm as appropriate to mark resolution and make a commit.`),this.code=this.name=l.code,this.data={filepaths:u}}}l.code="UnmergedPathsError";class f extends d{constructor(u){super(`An internal error caused this command to fail.

If you're not a developer, report the bug to the developers of the application you're using. If this is a bug in isomorphic-git then you should create a proper bug yourselves. The bug should include a minimal reproduction and details about the version and environment.

Please file a bug report at https://github.com/isomorphic-git/isomorphic-git/issues with this error message: ${u}`),this.code=this.name=f.code,this.data={message:u}}}f.code="InternalError";class p extends d{constructor(u){super(`The filepath "${u}" contains unsafe character sequences`),this.code=this.name=p.code,this.data={filepath:u}}}p.code="UnsafeFilepathError";class S{constructor(u){this.buffer=u,this._start=0}eof(){return this._start>=this.buffer.length}tell(){return this._start}seek(u){this._start=u}slice(u){const _=this.buffer.slice(this._start,this._start+u);return this._start+=u,_}toString(u,_){const b=this.buffer.toString(u,this._start,this._start+_);return this._start+=_,b}write(u,_,b){const E=this.buffer.write(u,this._start,_,b);return this._start+=_,E}copy(u,_,b){const E=u.copy(this.buffer,this._start,_,b);return this._start+=E,E}readUInt8(){const u=this.buffer.readUInt8(this._start);return this._start+=1,u}writeUInt8(u){const _=this.buffer.writeUInt8(u,this._start);return this._start+=1,_}readUInt16BE(){const u=this.buffer.readUInt16BE(this._start);return this._start+=2,u}writeUInt16BE(u){const _=this.buffer.writeUInt16BE(u,this._start);return this._start+=2,_}readUInt32BE(){const u=this.buffer.readUInt32BE(this._start);return this._start+=4,u}writeUInt32BE(u){const _=this.buffer.writeUInt32BE(u,this._start);return this._start+=4,_}}function k(y,u){return-(y<u)||+(y>u)}function A(y,u){return k(y.path,u.path)}function w(y){let u=y>0?y>>12:0;u!==4&&u!==8&&u!==10&&u!==14&&(u=8);let _=y&511;return _&73?_=493:_=420,u!==8&&(_=0),(u<<12)+_}const v=2**32;function g(y,u,_,b){if(y!==void 0&&u!==void 0)return[y,u];_===void 0&&(_=b.valueOf());const E=Math.floor(_/1e3),T=(_-E*1e3)*1e6;return[E,T]}function m(y){const[u,_]=g(y.ctimeSeconds,y.ctimeNanoseconds,y.ctimeMs,y.ctime),[b,E]=g(y.mtimeSeconds,y.mtimeNanoseconds,y.mtimeMs,y.mtime);return{ctimeSeconds:u%v,ctimeNanoseconds:_%v,mtimeSeconds:b%v,mtimeNanoseconds:E%v,dev:y.dev%v,ino:y.ino%v,mode:w(y.mode%v),uid:y.uid%v,gid:y.gid%v,size:y.size>-1?y.size%v:0}}function $(y){let u="";for(const _ of new Uint8Array(y))_<16&&(u+="0"),u+=_.toString(16);return u}let I=null;async function B(y){return I===null&&(I=await N()),I?x(y):P(y)}function P(y){return new r().update(y).digest("hex")}async function x(y){const u=await crypto.subtle.digest("SHA-1",y);return $(u)}async function N(){try{return await x(new Uint8Array([]))==="da39a3ee5e6b4b0d3255bfef95601890afd80709"}catch{}return!1}function J(y){return{assumeValid:!!(y&32768),extended:!!(y&16384),stage:(y&12288)>>12,nameLength:y&4095}}function Q(y){const u=y.flags;return u.extended=!1,u.nameLength=Math.min(Buffer.from(y.path).length,4095),(u.assumeValid?32768:0)+(u.extended?16384:0)+((u.stage&3)<<12)+(u.nameLength&4095)}class W{constructor(u,_){this._dirty=!1,this._unmergedPaths=_||new Set,this._entries=u||new Map}_addEntry(u){if(u.flags.stage===0)u.stages=[u],this._entries.set(u.path,u),this._unmergedPaths.delete(u.path);else{let _=this._entries.get(u.path);_||(this._entries.set(u.path,u),_=u),_.stages[u.flags.stage]=u,this._unmergedPaths.add(u.path)}}static async from(u){if(Buffer.isBuffer(u))return W.fromBuffer(u);if(u===null)return new W(null);throw new f("invalid type passed to GitIndex.from")}static async fromBuffer(u){if(u.length===0)throw new f("Index file is empty (.git/index)");const _=new W,b=new S(u),E=b.toString("utf8",4);if(E!=="DIRC")throw new f(`Invalid dircache magic file number: ${E}`);const T=await B(u.slice(0,-20)),F=u.slice(-20).toString("hex");if(F!==T)throw new f(`Invalid checksum in GitIndex buffer: expected ${F} but saw ${T}`);const z=b.readUInt32BE();if(z!==2)throw new f(`Unsupported dircache version: ${z}`);const se=b.readUInt32BE();let ae=0;for(;!b.eof()&&ae<se;){const re={};re.ctimeSeconds=b.readUInt32BE(),re.ctimeNanoseconds=b.readUInt32BE(),re.mtimeSeconds=b.readUInt32BE(),re.mtimeNanoseconds=b.readUInt32BE(),re.dev=b.readUInt32BE(),re.ino=b.readUInt32BE(),re.mode=b.readUInt32BE(),re.uid=b.readUInt32BE(),re.gid=b.readUInt32BE(),re.size=b.readUInt32BE(),re.oid=b.slice(20).toString("hex");const ue=b.readUInt16BE();re.flags=J(ue);const de=u.indexOf(0,b.tell()+1)-b.tell();if(de<1)throw new f(`Got a path length of: ${de}`);if(re.path=b.toString("utf8",de),re.path.includes("..\\")||re.path.includes("../"))throw new p(re.path);let Ee=8-(b.tell()-12)%8;for(Ee===0&&(Ee=8);Ee--;){const Te=b.readUInt8();if(Te!==0)throw new f(`Expected 1-8 null characters but got '${Te}' after ${re.path}`);if(b.eof())throw new f("Unexpected end of file")}re.stages=[],_._addEntry(re),ae++}return _}get unmergedPaths(){return[...this._unmergedPaths]}get entries(){return[...this._entries.values()].sort(A)}get entriesMap(){return this._entries}get entriesFlat(){return[...this.entries].flatMap(u=>u.stages.length>1?u.stages.filter(_=>_):u)}*[Symbol.iterator](){for(const u of this.entries)yield u}insert({filepath:u,stats:_,oid:b,stage:E=0}){_||(_={ctimeSeconds:0,ctimeNanoseconds:0,mtimeSeconds:0,mtimeNanoseconds:0,dev:0,ino:0,mode:0,uid:0,gid:0,size:0}),_=m(_);const T=Buffer.from(u),F={ctimeSeconds:_.ctimeSeconds,ctimeNanoseconds:_.ctimeNanoseconds,mtimeSeconds:_.mtimeSeconds,mtimeNanoseconds:_.mtimeNanoseconds,dev:_.dev,ino:_.ino,mode:_.mode||33188,uid:_.uid,gid:_.gid,size:_.size,path:u,oid:b,flags:{assumeValid:!1,extended:!1,stage:E,nameLength:T.length<4095?T.length:4095},stages:[]};this._addEntry(F),this._dirty=!0}delete({filepath:u}){if(this._entries.has(u))this._entries.delete(u);else for(const _ of this._entries.keys())_.startsWith(u+"/")&&this._entries.delete(_);this._unmergedPaths.has(u)&&this._unmergedPaths.delete(u),this._dirty=!0}clear(){this._entries.clear(),this._dirty=!0}has({filepath:u}){return this._entries.has(u)}render(){return this.entries.map(u=>`${u.mode.toString(8)} ${u.oid}    ${u.path}`).join(`
`)}static async _entryToBuffer(u){const _=Buffer.from(u.path),b=Math.ceil((62+_.length+1)/8)*8,E=Buffer.alloc(b),T=new S(E),F=m(u);return T.writeUInt32BE(F.ctimeSeconds),T.writeUInt32BE(F.ctimeNanoseconds),T.writeUInt32BE(F.mtimeSeconds),T.writeUInt32BE(F.mtimeNanoseconds),T.writeUInt32BE(F.dev),T.writeUInt32BE(F.ino),T.writeUInt32BE(F.mode),T.writeUInt32BE(F.uid),T.writeUInt32BE(F.gid),T.writeUInt32BE(F.size),T.write(u.oid,20,"hex"),T.writeUInt16BE(Q(u)),T.write(u.path,_.length,"utf8"),E}async toObject(){const u=Buffer.alloc(12),_=new S(u);_.write("DIRC",4,"utf8"),_.writeUInt32BE(2),_.writeUInt32BE(this.entriesFlat.length);let b=[];for(const z of this.entries)if(b.push(W._entryToBuffer(z)),z.stages.length>1)for(const se of z.stages)se&&se!==z&&b.push(W._entryToBuffer(se));b=await Promise.all(b);const E=Buffer.concat(b),T=Buffer.concat([u,E]),F=await B(T);return Buffer.concat([T,Buffer.from(F,"hex")])}}function Y(y,u,_=!0,b=!0){const E=m(y),T=m(u);return _&&E.mode!==T.mode||E.mtimeSeconds!==T.mtimeSeconds||E.ctimeSeconds!==T.ctimeSeconds||E.uid!==T.uid||E.gid!==T.gid||b&&E.ino!==T.ino||E.size!==T.size}let ve=null;const Be=Symbol("IndexCache");function je(){return{map:new Map,stats:new Map}}async function xe(y,u,_){const[b,E]=await Promise.all([y.lstat(u),y.read(u)]),T=await W.from(E);_.map.set(u,T),_.stats.set(u,b)}async function ke(y,u,_){const b=_.stats.get(u);if(b===void 0)return!0;if(b===null)return!1;const E=await y.lstat(u);return E===null?!1:Y(b,E)}class q{static async acquire({fs:u,gitdir:_,cache:b,allowUnmerged:E=!0},T){b[Be]||(b[Be]=je());const F=`${_}/index`;ve===null&&(ve=new e({maxPending:1/0}));let z,se=[];return await ve.acquire(F,async()=>{const ae=b[Be];await ke(u,F,ae)&&await xe(u,F,ae);const re=ae.map.get(F);if(se=re.unmergedPaths,se.length&&!E)throw new l(se);if(z=await T(re),re._dirty){const ue=await re.toObject();await u.write(F,ue),ae.stats.set(F,await u.lstat(F)),re._dirty=!1}}),z}}function j(y){const u=Math.max(y.lastIndexOf("/"),y.lastIndexOf("\\"));return u>-1&&(y=y.slice(u+1)),y}function H(y){const u=Math.max(y.lastIndexOf("/"),y.lastIndexOf("\\"));return u===-1?".":u===0?"/":y.slice(0,u)}function G(y){const u=new Map,_=function(E){if(!u.has(E)){const T={type:"tree",fullpath:E,basename:j(E),metadata:{},children:[]};u.set(E,T),T.parent=_(H(E)),T.parent&&T.parent!==T&&T.parent.children.push(T)}return u.get(E)},b=function(E,T){if(!u.has(E)){const F={type:"blob",fullpath:E,basename:j(E),metadata:T,parent:_(H(E)),children:[]};F.parent&&F.parent.children.push(F),u.set(E,F)}return u.get(E)};_(".");for(const E of y)b(E.path,E);return u}function V(y){switch(y){case 16384:return"tree";case 33188:return"blob";case 33261:return"blob";case 40960:return"blob";case 57344:return"commit"}throw new f(`Unexpected GitTree entry mode: ${y.toString(8)}`)}class oe{constructor({fs:u,gitdir:_,cache:b}){this.treePromise=q.acquire({fs:u,gitdir:_,cache:b},async function(T){return G(T.entries)});const E=this;this.ConstructEntry=class{constructor(F){this._fullpath=F,this._type=!1,this._mode=!1,this._stat=!1,this._oid=!1}async type(){return E.type(this)}async mode(){return E.mode(this)}async stat(){return E.stat(this)}async content(){return E.content(this)}async oid(){return E.oid(this)}}}async readdir(u){const _=u._fullpath,E=(await this.treePromise).get(_);if(!E||E.type==="blob")return null;if(E.type!=="tree")throw new Error(`ENOTDIR: not a directory, scandir '${_}'`);const T=E.children.map(F=>F.fullpath);return T.sort(k),T}async type(u){return u._type===!1&&await u.stat(),u._type}async mode(u){return u._mode===!1&&await u.stat(),u._mode}async stat(u){if(u._stat===!1){const b=(await this.treePromise).get(u._fullpath);if(!b)throw new Error(`ENOENT: no such file or directory, lstat '${u._fullpath}'`);const E=b.type==="tree"?{}:m(b.metadata);u._type=b.type==="tree"?"tree":V(E.mode),u._mode=E.mode,b.type==="tree"?u._stat=void 0:u._stat=E}return u._stat}async content(u){}async oid(u){if(u._oid===!1){const b=(await this.treePromise).get(u._fullpath);u._oid=b.metadata.oid}return u._oid}}const Z=Symbol("GitWalkSymbol");function pe(){const y=Object.create(null);return Object.defineProperty(y,Z,{value:function({fs:u,gitdir:_,cache:b}){return new oe({fs:u,gitdir:_,cache:b})}}),Object.freeze(y),y}class ce extends d{constructor(u){super(`Could not find ${u}.`),this.code=this.name=ce.code,this.data={what:u}}}ce.code="NotFoundError";class U extends d{constructor(u,_,b,E){super(`Object ${u} ${E?`at ${E}`:""}was anticipated to be a ${b} but it is a ${_}.`),this.code=this.name=U.code,this.data={oid:u,actual:_,expected:b,filepath:E}}}U.code="ObjectTypeError";class ye extends d{constructor(u){super(`Expected a 40-char hex object id but saw "${u}".`),this.code=this.name=ye.code,this.data={value:u}}}ye.code="InvalidOidError";class be extends d{constructor(u){super(`Could not find a fetch refspec for remote "${u}". Make sure the config file has an entry like the following:
[remote "${u}"]
	fetch = +refs/heads/*:refs/remotes/origin/*
`),this.code=this.name=be.code,this.data={remote:u}}}be.code="NoRefspecError";class Pe{constructor(u){if(this.refs=new Map,this.parsedConfig=[],u){let _=null;this.parsedConfig=u.trim().split(`
`).map(b=>{if(/^\s*#/.test(b))return{line:b,comment:!0};const E=b.indexOf(" ");if(b.startsWith("^")){const T=b.slice(1);return this.refs.set(_+"^{}",T),{line:b,ref:_,peeled:T}}else{const T=b.slice(0,E);return _=b.slice(E+1),this.refs.set(_,T),{line:b,ref:_,oid:T}}})}return this}static from(u){return new Pe(u)}delete(u){this.parsedConfig=this.parsedConfig.filter(_=>_.ref!==u),this.refs.delete(u)}toString(){return this.parsedConfig.map(({line:u})=>u).join(`
`)+`
`}}class Oe{constructor({remotePath:u,localPath:_,force:b,matchPrefix:E}){Object.assign(this,{remotePath:u,localPath:_,force:b,matchPrefix:E})}static from(u){const[_,b,E,T,F]=u.match(/^(\+?)(.*?)(\*?):(.*?)(\*?)$/).slice(1),z=_==="+",se=E==="*";if(se!==(F==="*"))throw new f("Invalid refspec");return new Oe({remotePath:b,localPath:T,force:z,matchPrefix:se})}translate(u){if(this.matchPrefix){if(u.startsWith(this.remotePath))return this.localPath+u.replace(this.remotePath,"")}else if(u===this.remotePath)return this.localPath;return null}reverseTranslate(u){if(this.matchPrefix){if(u.startsWith(this.localPath))return this.remotePath+u.replace(this.localPath,"")}else if(u===this.localPath)return this.remotePath;return null}}class Ue{constructor(u=[]){this.rules=u}static from(u){const _=[];for(const b of u)_.push(Oe.from(b));return new Ue(_)}add(u){const _=Oe.from(u);this.rules.push(_)}translate(u){const _=[];for(const b of this.rules)for(const E of u){const T=b.translate(E);T&&_.push([E,T])}return _}translateOne(u){let _=null;for(const b of this.rules){const E=b.translate(u);E&&(_=E)}return _}localNamespaces(){return this.rules.filter(u=>u.matchPrefix).map(u=>u.localPath.replace(/\/$/,""))}}function rt(y,u){const _=y.replace(/\^\{\}$/,""),b=u.replace(/\^\{\}$/,""),E=-(_<b)||+(_>b);return E===0?y.endsWith("^{}")?1:-1:E}/*!
 * This code for `path.join` is directly copied from @zenfs/core/path for bundle size improvements.
 * SPDX-License-Identifier: LGPL-3.0-or-later
 * Copyright (c) James Prevett and other ZenFS contributors.
 */function yt(y,u){let _="",b=0,E=-1,T=0,F="\0";for(let z=0;z<=y.length;++z){if(z<y.length)F=y[z];else{if(F==="/")break;F="/"}if(F==="/"){if(!(E===z-1||T===1))if(T===2){if(_.length<2||b!==2||_.at(-1)!=="."||_.at(-2)!=="."){if(_.length>2){const se=_.lastIndexOf("/");se===-1?(_="",b=0):(_=_.slice(0,se),b=_.length-1-_.lastIndexOf("/")),E=z,T=0;continue}else if(_.length!==0){_="",b=0,E=z,T=0;continue}}u&&(_+=_.length>0?"/..":"..",b=2)}else _.length>0?_+="/"+y.slice(E+1,z):_=y.slice(E+1,z),b=z-E-1;E=z,T=0}else F==="."&&T!==-1?++T:T=-1}return _}function dt(y){if(!y.length)return".";const u=y[0]==="/",_=y.at(-1)==="/";return y=yt(y,!u),y.length?(_&&(y+="/"),u?`/${y}`:y):u?"/":_?"./":"."}function fe(...y){if(y.length===0)return".";let u;for(let _=0;_<y.length;++_){const b=y[_];b.length>0&&(u===void 0?u=b:u+="/"+b)}return u===void 0?".":dt(u)}const Re=y=>{if(typeof y=="number")return y;y=y.toLowerCase();let u=parseInt(y);return y.endsWith("k")&&(u*=1024),y.endsWith("m")&&(u*=1024*1024),y.endsWith("g")&&(u*=1024*1024*1024),u},Ke=y=>{if(typeof y=="boolean")return y;if(y=y.trim().toLowerCase(),y==="true"||y==="yes"||y==="on")return!0;if(y==="false"||y==="no"||y==="off")return!1;throw Error(`Expected 'true', 'false', 'yes', 'no', 'on', or 'off', but got ${y}`)},We={core:{filemode:Ke,bare:Ke,logallrefupdates:Ke,symlinks:Ke,ignorecase:Ke,bigFileThreshold:Re}},Ze=/^\[([A-Za-z0-9-.]+)(?: "(.*)")?\]$/,st=/^[A-Za-z0-9-.]+$/,gt=/^([A-Za-z][A-Za-z-]*)(?: *= *(.*))?$/,Dt=/^[A-Za-z][A-Za-z-]*$/,wt=/^(.*?)( *[#;].*)$/,vt=y=>{const u=Ze.exec(y);if(u!=null){const[_,b]=u.slice(1);return[_,b]}return null},qt=y=>{const u=gt.exec(y);if(u!=null){const[_,b="true"]=u.slice(1),E=Lt(b),T=te(E);return[_,T]}return null},Lt=y=>{const u=wt.exec(y);if(u==null)return y;const[_,b]=u.slice(1);return Gt(_)&&Gt(b)?`${_}${b}`:_},Gt=y=>(y.match(/(?:^|[^\\])"/g)||[]).length%2!==0,te=y=>y.split("").reduce((u,_,b,E)=>{const T=_==='"'&&E[b-1]!=="\\",F=_==="\\"&&E[b+1]==='"';return T||F?u:u+_},""),C=y=>y!=null?y.toLowerCase():null,O=(y,u,_)=>[C(y),u,C(_)].filter(b=>b!=null).join("."),ee=y=>{const u=y.split("."),_=u.shift(),b=u.pop(),E=u.length?u.join("."):void 0;return{section:_,subsection:E,name:b,path:O(_,E,b),sectionPath:O(_,E,null),isSection:!!_}},ge=(y,u)=>y.reduce((_,b,E)=>u(b)?E:_,-1);class ne{constructor(u){let _=null,b=null;this.parsedConfig=u?u.split(`
`).map(E=>{let T=null,F=null;const z=E.trim(),se=vt(z),ae=se!=null;if(ae)[_,b]=se;else{const ue=qt(z);ue!=null&&([T,F]=ue)}const re=O(_,b,T);return{line:E,isSection:ae,section:_,subsection:b,name:T,value:F,path:re}}):[]}static from(u){return new ne(u)}async get(u,_=!1){const b=ee(u).path,E=this.parsedConfig.filter(T=>T.path===b).map(({section:T,name:F,value:z})=>{const se=We[T]&&We[T][F];return se?se(z):z});return _?E:E.pop()}async getall(u){return this.get(u,!0)}async getSubsections(u){return this.parsedConfig.filter(_=>_.isSection&&_.section===u).map(_=>_.subsection)}async deleteSection(u,_){this.parsedConfig=this.parsedConfig.filter(b=>!(b.section===u&&b.subsection===_))}async append(u,_){return this.set(u,_,!0)}async set(u,_,b=!1){const{section:E,subsection:T,name:F,path:z,sectionPath:se,isSection:ae}=ee(u),re=ge(this.parsedConfig,ue=>ue.path===z);if(_==null)re!==-1&&this.parsedConfig.splice(re,1);else if(re!==-1){const ue=this.parsedConfig[re],de=Object.assign({},ue,{name:F,value:_,modified:!0});b?this.parsedConfig.splice(re+1,0,de):this.parsedConfig[re]=de}else{const ue=this.parsedConfig.findIndex(Ee=>Ee.path===se),de={section:E,subsection:T,name:F,value:_,modified:!0,path:z};if(st.test(E)&&Dt.test(F))if(ue>=0)this.parsedConfig.splice(ue+1,0,de);else{const Ee={isSection:ae,section:E,subsection:T,modified:!0,path:se};this.parsedConfig.push(Ee,de)}}}toString(){return this.parsedConfig.map(({line:u,section:_,subsection:b,name:E,value:T,modified:F=!1})=>F?E!=null&&T!=null?typeof T=="string"&&/[#;]/.test(T)?`	${E} = "${T}"`:`	${E} = ${T}`:b!=null?`[${_} "${b}"]`:`[${_}]`:u).join(`
`)}}class _e{static async get({fs:u,gitdir:_}){const b=await u.read(`${_}/config`,{encoding:"utf8"});return ne.from(b)}static async save({fs:u,gitdir:_,config:b}){await u.write(`${_}/config`,b.toString(),{encoding:"utf8"})}}const K=y=>[`${y}`,`refs/${y}`,`refs/tags/${y}`,`refs/heads/${y}`,`refs/remotes/${y}`,`refs/remotes/${y}/HEAD`],qe=["config","description","index","shallow","commondir"];let lt;async function L(y,u){return lt===void 0&&(lt=new e),lt.acquire(y,u)}class me{static async updateRemoteRefs({fs:u,gitdir:_,remote:b,refs:E,symrefs:T,tags:F,refspecs:z=void 0,prune:se=!1,pruneTags:ae=!1}){for(const Fe of E.values())if(!Fe.match(/[0-9a-f]{40}/))throw new ye(Fe);const re=await _e.get({fs:u,gitdir:_});if(!z){if(z=await re.getall(`remote.${b}.fetch`),z.length===0)throw new be(b);z.unshift(`+HEAD:refs/remotes/${b}/HEAD`)}const ue=Ue.from(z),de=new Map;if(ae){const Fe=await me.listRefs({fs:u,gitdir:_,filepath:"refs/tags"});await me.deleteRefs({fs:u,gitdir:_,refs:Fe.map(Ge=>`refs/tags/${Ge}`)})}if(F){for(const Fe of E.keys())if(Fe.startsWith("refs/tags")&&!Fe.endsWith("^{}")&&!await me.exists({fs:u,gitdir:_,ref:Fe})){const Ge=E.get(Fe);de.set(Fe,Ge)}}const Ee=ue.translate([...E.keys()]);for(const[Fe,Ge]of Ee){const Je=E.get(Fe);de.set(Ge,Je)}const Te=ue.translate([...T.keys()]);for(const[Fe,Ge]of Te){const Je=T.get(Fe),ct=ue.translateOne(Je);ct&&de.set(Ge,`ref: ${ct}`)}const Ne=[];if(se){for(const Fe of ue.localNamespaces()){const Ge=(await me.listRefs({fs:u,gitdir:_,filepath:Fe})).map(Je=>`${Fe}/${Je}`);for(const Je of Ge)de.has(Je)||Ne.push(Je)}Ne.length>0&&await me.deleteRefs({fs:u,gitdir:_,refs:Ne})}for(const[Fe,Ge]of de)await L(Fe,async()=>u.write(fe(_,Fe),`${Ge.trim()}
`,"utf8"));return{pruned:Ne}}static async writeRef({fs:u,gitdir:_,ref:b,value:E}){if(!E.match(/[0-9a-f]{40}/))throw new ye(E);await L(b,async()=>u.write(fe(_,b),`${E.trim()}
`,"utf8"))}static async writeSymbolicRef({fs:u,gitdir:_,ref:b,value:E}){await L(b,async()=>u.write(fe(_,b),`ref: ${E.trim()}
`,"utf8"))}static async deleteRef({fs:u,gitdir:_,ref:b}){return me.deleteRefs({fs:u,gitdir:_,refs:[b]})}static async deleteRefs({fs:u,gitdir:_,refs:b}){await Promise.all(b.map(z=>u.rm(fe(_,z))));let E=await L("packed-refs",async()=>u.read(`${_}/packed-refs`,{encoding:"utf8"}));const T=Pe.from(E),F=T.refs.size;for(const z of b)T.refs.has(z)&&T.delete(z);T.refs.size<F&&(E=T.toString(),await L("packed-refs",async()=>u.write(`${_}/packed-refs`,E,{encoding:"utf8"})))}static async resolve({fs:u,gitdir:_,ref:b,depth:E=void 0}){if(E!==void 0&&(E--,E===-1))return b;if(b.startsWith("ref: "))return b=b.slice(5),me.resolve({fs:u,gitdir:_,ref:b,depth:E});if(b.length===40&&/[0-9a-f]{40}/.test(b))return b;const T=await me.packedRefs({fs:u,gitdir:_}),F=K(b).filter(z=>!qe.includes(z));for(const z of F){const se=await L(z,async()=>await u.read(`${_}/${z}`,{encoding:"utf8"})||T.get(z));if(se)return me.resolve({fs:u,gitdir:_,ref:se.trim(),depth:E})}throw new ce(b)}static async exists({fs:u,gitdir:_,ref:b}){try{return await me.expand({fs:u,gitdir:_,ref:b}),!0}catch{return!1}}static async expand({fs:u,gitdir:_,ref:b}){if(b.length===40&&/[0-9a-f]{40}/.test(b))return b;const E=await me.packedRefs({fs:u,gitdir:_}),T=K(b);for(const F of T)if(await L(F,async()=>u.exists(`${_}/${F}`))||E.has(F))return F;throw new ce(b)}static async expandAgainstMap({ref:u,map:_}){const b=K(u);for(const E of b)if(await _.has(E))return E;throw new ce(u)}static resolveAgainstMap({ref:u,fullref:_=u,depth:b=void 0,map:E}){if(b!==void 0&&(b--,b===-1))return{fullref:_,oid:u};if(u.startsWith("ref: "))return u=u.slice(5),me.resolveAgainstMap({ref:u,fullref:_,depth:b,map:E});if(u.length===40&&/[0-9a-f]{40}/.test(u))return{fullref:_,oid:u};const T=K(u);for(const F of T){const z=E.get(F);if(z)return me.resolveAgainstMap({ref:z.trim(),fullref:F,depth:b,map:E})}throw new ce(u)}static async packedRefs({fs:u,gitdir:_}){const b=await L("packed-refs",async()=>u.read(`${_}/packed-refs`,{encoding:"utf8"}));return Pe.from(b).refs}static async listRefs({fs:u,gitdir:_,filepath:b}){const E=me.packedRefs({fs:u,gitdir:_});let T=null;try{T=await u.readdirDeep(`${_}/${b}`),T=T.map(F=>F.replace(`${_}/${b}/`,""))}catch{T=[]}for(let F of(await E).keys())F.startsWith(b)&&(F=F.replace(b+"/",""),T.includes(F)||T.push(F));return T.sort(rt),T}static async listBranches({fs:u,gitdir:_,remote:b}){return b?me.listRefs({fs:u,gitdir:_,filepath:`refs/remotes/${b}`}):me.listRefs({fs:u,gitdir:_,filepath:"refs/heads"})}static async listTags({fs:u,gitdir:_}){return(await me.listRefs({fs:u,gitdir:_,filepath:"refs/tags"})).filter(E=>!E.endsWith("^{}"))}}function Me(y,u){return k(ie(y),ie(u))}function ie(y){return y.mode==="040000"?y.path+"/":y.path}function Se(y){switch(y){case"040000":return"tree";case"100644":return"blob";case"100755":return"blob";case"120000":return"blob";case"160000":return"commit"}throw new f(`Unexpected GitTree entry mode: ${y}`)}function Le(y){const u=[];let _=0;for(;_<y.length;){const b=y.indexOf(32,_);if(b===-1)throw new f(`GitTree: Error parsing buffer at byte location ${_}: Could not find the next space character.`);const E=y.indexOf(0,_);if(E===-1)throw new f(`GitTree: Error parsing buffer at byte location ${_}: Could not find the next null character.`);let T=y.slice(_,b).toString("utf8");T==="40000"&&(T="040000");const F=Se(T),z=y.slice(b+1,E).toString("utf8");if(z.includes("\\")||z.includes("/"))throw new p(z);const se=y.slice(E+1,E+21).toString("hex");_=E+21,u.push({mode:T,path:z,oid:se,type:F})}return u}function bt(y){if(typeof y=="number"&&(y=y.toString(8)),y.match(/^0?4.*/))return"040000";if(y.match(/^1006.*/))return"100644";if(y.match(/^1007.*/))return"100755";if(y.match(/^120.*/))return"120000";if(y.match(/^160.*/))return"160000";throw new f(`Could not understand file mode: ${y}`)}function le(y){return!y.oid&&y.sha&&(y.oid=y.sha),y.mode=bt(y.mode),y.type||(y.type=Se(y.mode)),y}class M{constructor(u){if(Buffer.isBuffer(u))this._entries=Le(u);else if(Array.isArray(u))this._entries=u.map(le);else throw new f("invalid type passed to GitTree constructor");this._entries.sort(A)}static from(u){return new M(u)}render(){return this._entries.map(u=>`${u.mode} ${u.type} ${u.oid}    ${u.path}`).join(`
`)}toObject(){const u=[...this._entries];return u.sort(Me),Buffer.concat(u.map(_=>{const b=Buffer.from(_.mode.replace(/^0/,"")),E=Buffer.from(" "),T=Buffer.from(_.path,"utf8"),F=Buffer.from([0]),z=Buffer.from(_.oid,"hex");return Buffer.concat([b,E,T,F,z])}))}entries(){return this._entries}*[Symbol.iterator](){for(const u of this._entries)yield u}}class R{static wrap({type:u,object:_}){const b=`${u} ${_.length}\0`,E=b.length,T=E+_.length,F=new Uint8Array(T);for(let z=0;z<E;z++)F[z]=b.charCodeAt(z);return F.set(_,E),F}static unwrap(u){const _=u.indexOf(32),b=u.indexOf(0),E=u.slice(0,_).toString("utf8"),T=u.slice(_+1,b).toString("utf8"),F=u.length-(b+1);if(parseInt(T)!==F)throw new f(`Length mismatch: expected ${T} bytes but got ${F} instead.`);return{type:E,object:Buffer.from(u.slice(b+1))}}}async function D({fs:y,gitdir:u,oid:_}){const b=`objects/${_.slice(0,2)}/${_.slice(2)}`,E=await y.read(`${u}/${b}`);return E?{object:E,format:"deflated",source:b}:null}function X(y,u){const _=new S(y),b=he(_);if(b!==u.byteLength)throw new f(`applyDelta expected source buffer to be ${b} bytes but the provided buffer was ${u.length} bytes`);const E=he(_);let T;const F=Ae(_,u);if(F.byteLength===E)T=F;else{T=Buffer.alloc(E);const z=new S(T);for(z.copy(F);!_.eof();)z.copy(Ae(_,u));const se=z.tell();if(E!==se)throw new f(`applyDelta expected target buffer to be ${E} bytes but the resulting buffer was ${se} bytes`)}return T}function he(y){let u=0,_=0,b=null;do b=y.readUInt8(),u|=(b&127)<<_,_+=7;while(b&128);return u}function we(y,u,_){let b=0,E=0;for(;_--;)u&1&&(b|=y.readUInt8()<<E),u>>=1,E+=8;return b}function Ae(y,u){const _=y.readUInt8(),b=128,E=15,T=112;if(_&b){const F=we(y,_&E,4);let z=we(y,(_&T)>>4,3);return z===0&&(z=65536),u.slice(F,F+z)}else return y.slice(_)}function De(y){let u=[y];return{next(){return Promise.resolve({done:u.length===0,value:u.pop()})},return(){return u=[],{}},[Symbol.asyncIterator](){return this}}}function Et(y){return y[Symbol.asyncIterator]?y[Symbol.asyncIterator]():y[Symbol.iterator]?y[Symbol.iterator]():y.next?y:De(y)}class St{constructor(u){if(typeof Buffer>"u")throw new Error("Missing Buffer dependency");this.stream=Et(u),this.buffer=null,this.cursor=0,this.undoCursor=0,this.started=!1,this._ended=!1,this._discardedBytes=0}eof(){return this._ended&&this.cursor===this.buffer.length}tell(){return this._discardedBytes+this.cursor}async byte(){if(!this.eof()&&(this.started||await this._init(),!(this.cursor===this.buffer.length&&(await this._loadnext(),this._ended))))return this._moveCursor(1),this.buffer[this.undoCursor]}async chunk(){if(!this.eof()&&(this.started||await this._init(),!(this.cursor===this.buffer.length&&(await this._loadnext(),this._ended))))return this._moveCursor(this.buffer.length),this.buffer.slice(this.undoCursor,this.cursor)}async read(u){if(!this.eof())return this.started||await this._init(),this.cursor+u>this.buffer.length&&(this._trim(),await this._accumulate(u)),this._moveCursor(u),this.buffer.slice(this.undoCursor,this.cursor)}async skip(u){this.eof()||(this.started||await this._init(),this.cursor+u>this.buffer.length&&(this._trim(),await this._accumulate(u)),this._moveCursor(u))}async undo(){this.cursor=this.undoCursor}async _next(){this.started=!0;let{done:u,value:_}=await this.stream.next();return u&&(this._ended=!0,!_)?Buffer.alloc(0):(_&&(_=Buffer.from(_)),_)}_trim(){this.buffer=this.buffer.slice(this.undoCursor),this.cursor-=this.undoCursor,this._discardedBytes+=this.undoCursor,this.undoCursor=0}_moveCursor(u){this.undoCursor=this.cursor,this.cursor+=u,this.cursor>this.buffer.length&&(this.cursor=this.buffer.length)}async _accumulate(u){if(this._ended)return;const _=[this.buffer];for(;this.cursor+u>Qe(_);){const b=await this._next();if(this._ended)break;_.push(b)}this.buffer=Buffer.concat(_)}async _loadnext(){this._discardedBytes+=this.buffer.length,this.undoCursor=0,this.cursor=0,this.buffer=await this._next()}async _init(){this.buffer=await this._next()}}function Qe(y){return y.reduce((u,_)=>u+_.length,0)}async function mt(y,u){const _=new St(y);let b=await _.read(4);if(b=b.toString("utf8"),b!=="PACK")throw new f(`Invalid PACK header '${b}'`);let E=await _.read(4);if(E=E.readUInt32BE(0),E!==2)throw new f(`Invalid packfile version: ${E}`);let T=await _.read(4);if(T=T.readUInt32BE(0),!(T<1))for(;!_.eof()&&T--;){const F=_.tell(),{type:z,length:se,ofs:ae,reference:re}=await It(_),ue=new c.Inflate;for(;!ue.result;){const de=await _.chunk();if(!de)break;if(ue.push(de,!1),ue.err)throw new f(`Pako error: ${ue.msg}`);if(ue.result){if(ue.result.length!==se)throw new f("Inflated object size is different from that stated in packfile.");await _.undo(),await _.read(de.length-ue.strm.avail_in);const Ee=_.tell();await u({data:ue.result,type:z,num:T,offset:F,end:Ee,reference:re,ofs:ae})}}}}async function It(y){let u=await y.byte();const _=u>>4&7;let b=u&15;if(u&128){let F=4;do u=await y.byte(),b|=(u&127)<<F,F+=7;while(u&128)}let E,T;if(_===6){let F=0;E=0;const z=[];do u=await y.byte(),E|=(u&127)<<F,F+=7,z.push(u);while(u&128);T=Buffer.from(z)}return _===7&&(T=await y.read(20)),{type:_,length:b,ofs:E,reference:T}}async function Ft(y){return c.inflate(y)}function Nt(y){const u=[];let _=0,b=0;do{_=y.readUInt8();const E=_&127;u.push(E),b=_&128}while(b);return u.reduce((E,T)=>E+1<<7|T,-1)}function kt(y,u){let _=u,b=4,E=null;do E=y.readUInt8(),_|=(E&127)<<b,b+=7;while(E&128);return _}class Kt{constructor(u){Object.assign(this,u),this.offsetCache={}}static async fromIdx({idx:u,getExternalRefDelta:_}){const b=new S(u);if(b.slice(4).toString("hex")!=="ff744f63")return;const T=b.readUInt32BE();if(T!==2)throw new f(`Unable to read version ${T} packfile IDX. (Only version 2 supported)`);if(u.byteLength>2048*1024*1024)throw new f("To keep implementation simple, I haven't implemented the layer 5 feature needed to support packfiles > 2GB in size.");b.seek(b.tell()+1020);const F=b.readUInt32BE(),z=[];for(let re=0;re<F;re++){const ue=b.slice(20).toString("hex");z[re]=ue}b.seek(b.tell()+4*F);const se=new Map;for(let re=0;re<F;re++)se.set(z[re],b.readUInt32BE());const ae=b.slice(20).toString("hex");return new Kt({hashes:z,crcs:{},offsets:se,packfileSha:ae,getExternalRefDelta:_})}static async fromPack({pack:u,getExternalRefDelta:_,onProgress:b}){const E={1:"commit",2:"tree",3:"blob",4:"tag",6:"ofs-delta",7:"ref-delta"},T={},F=u.slice(-20).toString("hex"),z=[],se={},ae=new Map;let re=null,ue=null;await mt([u],async({data:Fe,type:Ge,reference:Je,offset:ct,num:Ct})=>{re===null&&(re=Ct);const Rt=Math.floor((re-Ct)*100/re);Rt!==ue&&b&&await b({phase:"Receiving objects",loaded:re-Ct,total:re}),ue=Rt,Ge=E[Ge],["commit","tree","blob","tag"].includes(Ge)?T[ct]={type:Ge,offset:ct}:Ge==="ofs-delta"?T[ct]={type:Ge,offset:ct}:Ge==="ref-delta"&&(T[ct]={type:Ge,offset:ct})});const de=Object.keys(T).map(Number);for(const[Fe,Ge]of de.entries()){const Je=Fe+1===de.length?u.byteLength-20:de[Fe+1],ct=T[Ge],Ct=n.buf(u.slice(Ge,Je))>>>0;ct.end=Je,ct.crc=Ct}const Ee=new Kt({pack:Promise.resolve(u),packfileSha:F,crcs:se,hashes:z,offsets:ae,getExternalRefDelta:_});ue=null;let Te=0;const Ne=[0,0,0,0,0,0,0,0,0,0,0,0];for(let Fe in T){Fe=Number(Fe);const Ge=Math.floor(Te*100/re);Ge!==ue&&b&&await b({phase:"Resolving deltas",loaded:Te,total:re}),Te++,ue=Ge;const Je=T[Fe];if(!Je.oid)try{Ee.readDepth=0,Ee.externalReadDepth=0;const{type:ct,object:Ct}=await Ee.readSlice({start:Fe});Ne[Ee.readDepth]+=1;const Rt=await B(R.wrap({type:ct,object:Ct}));Je.oid=Rt,z.push(Rt),ae.set(Rt,Fe),se[Rt]=Je.crc}catch{continue}}return z.sort(),Ee}async toBuffer(){const u=[],_=(ae,re)=>{u.push(Buffer.from(ae,re))};_("ff744f63","hex"),_("00000002","hex");const b=new S(Buffer.alloc(256*4));for(let ae=0;ae<256;ae++){let re=0;for(const ue of this.hashes)parseInt(ue.slice(0,2),16)<=ae&&re++;b.writeUInt32BE(re)}u.push(b.buffer);for(const ae of this.hashes)_(ae,"hex");const E=new S(Buffer.alloc(this.hashes.length*4));for(const ae of this.hashes)E.writeUInt32BE(this.crcs[ae]);u.push(E.buffer);const T=new S(Buffer.alloc(this.hashes.length*4));for(const ae of this.hashes)T.writeUInt32BE(this.offsets.get(ae));u.push(T.buffer),_(this.packfileSha,"hex");const F=Buffer.concat(u),z=await B(F),se=Buffer.alloc(20);return se.write(z,"hex"),Buffer.concat([F,se])}async load({pack:u}){this.pack=u}async unload(){this.pack=null}async read({oid:u}){if(!this.offsets.get(u)){if(this.getExternalRefDelta)return this.externalReadDepth++,this.getExternalRefDelta(u);throw new f(`Could not read object ${u} from packfile`)}const _=this.offsets.get(u);return this.readSlice({start:_})}async readSlice({start:u}){if(this.offsetCache[u])return Object.assign({},this.offsetCache[u]);this.readDepth++;const _={16:"commit",32:"tree",48:"blob",64:"tag",96:"ofs_delta",112:"ref_delta"};if(!this.pack)throw new f("Tried to read from a GitPackIndex with no packfile loaded into memory");const b=(await this.pack).slice(u),E=new S(b),T=E.readUInt8(),F=T&112;let z=_[F];if(z===void 0)throw new f("Unrecognized type: 0b"+F.toString(2));const se=T&15;let ae=se;T&128&&(ae=kt(E,se));let ue=null,de=null;if(z==="ofs_delta"){const Te=Nt(E),Ne=u-Te;({object:ue,type:z}=await this.readSlice({start:Ne}))}if(z==="ref_delta"){const Te=E.slice(20).toString("hex");({object:ue,type:z}=await this.read({oid:Te}))}const Ee=b.slice(E.tell());if(de=Buffer.from(await Ft(Ee)),de.byteLength!==ae)throw new f(`Packfile told us object would have length ${ae} but it had length ${de.byteLength}`);return ue&&(de=Buffer.from(X(de,ue))),this.readDepth>3&&(this.offsetCache[u]={type:z,object:de}),{type:z,format:"content",object:de}}}const xt=Symbol("PackfileCache");async function At({fs:y,filename:u,getExternalRefDelta:_,emitter:b,emitterPrefix:E}){const T=await y.read(u);return Kt.fromIdx({idx:T,getExternalRefDelta:_})}function nt({fs:y,cache:u,filename:_,getExternalRefDelta:b,emitter:E,emitterPrefix:T}){u[xt]||(u[xt]=new Map);let F=u[xt].get(_);return F||(F=At({fs:y,filename:_,getExternalRefDelta:b,emitter:E,emitterPrefix:T}),u[xt].set(_,F)),F}async function Ye({fs:y,cache:u,gitdir:_,oid:b,format:E="content",getExternalRefDelta:T}){let F=await y.readdir(fe(_,"objects/pack"));F=F.filter(z=>z.endsWith(".idx"));for(const z of F){const se=`${_}/objects/pack/${z}`,ae=await nt({fs:y,cache:u,filename:se,getExternalRefDelta:T});if(ae.error)throw new f(ae.error);if(ae.offsets.has(b)){if(!ae.pack){const ue=se.replace(/idx$/,"pack");ae.pack=y.read(ue)}const re=await ae.read({oid:b,getExternalRefDelta:T});return re.format="content",re.source=`objects/pack/${z.replace(/idx$/,"pack")}`,re}}return null}async function Ie({fs:y,cache:u,gitdir:_,oid:b,format:E="content"}){const T=re=>Ie({fs:y,cache:u,gitdir:_,oid:re});let F;if(b==="4b825dc642cb6eb9a060e54bf8d69288fbee4904"&&(F={format:"wrapped",object:Buffer.from("tree 0\0")}),F||(F=await D({fs:y,gitdir:_,oid:b})),!F){if(F=await Ye({fs:y,cache:u,gitdir:_,oid:b,getExternalRefDelta:T}),!F)throw new ce(b);return F}if(E==="deflated"||(F.format==="deflated"&&(F.object=Buffer.from(await Ft(F.object)),F.format="wrapped"),E==="wrapped"))return F;const z=await B(F.object);if(z!==b)throw new f(`SHA check failed! Expected ${b}, computed ${z}`);const{object:se,type:ae}=R.unwrap(F.object);if(F.type=ae,F.object=se,F.format="content",E==="content")return F;throw new f(`invalid requested format "${E}"`)}class ze extends d{constructor(u,_,b=!0){super(`Failed to create ${u} at ${_} because it already exists.${b?` (Hint: use 'force: true' parameter to overwrite existing ${u}.)`:""}`),this.code=this.name=ze.code,this.data={noun:u,where:_,canForce:b}}}ze.code="AlreadyExistsError";class Xe extends d{constructor(u,_,b){super(`Found multiple ${u} matching "${_}" (${b.join(", ")}). Use a longer abbreviation length to disambiguate them.`),this.code=this.name=Xe.code,this.data={nouns:u,short:_,matches:b}}}Xe.code="AmbiguousError";class ft extends d{constructor(u){super(`Your local changes to the following files would be overwritten by checkout: ${u.join(", ")}`),this.code=this.name=ft.code,this.data={filepaths:u}}}ft.code="CheckoutConflictError";class _t extends d{constructor(u,_){super(`Failed to checkout "${u}" because commit ${_} is not available locally. Do a git fetch to make the branch available locally.`),this.code=this.name=_t.code,this.data={ref:u,oid:_}}}_t.code="CommitNotFetchedError";class Ve extends d{constructor(){super("Empty response from git server."),this.code=this.name=Ve.code,this.data={}}}Ve.code="EmptyServerResponseError";class et extends d{constructor(){super("A simple fast-forward merge was not possible."),this.code=this.name=et.code,this.data={}}}et.code="FastForwardError";class pt extends d{constructor(u,_){super(`One or more branches were not updated: ${u}`),this.code=this.name=pt.code,this.data={prettyDetails:u,result:_}}}pt.code="GitPushError";class Ce extends d{constructor(u,_,b){super(`HTTP Error: ${u} ${_}`),this.code=this.name=Ce.code,this.data={statusCode:u,statusMessage:_,response:b}}}Ce.code="HttpError";class He extends d{constructor(u){let _="invalid filepath";u==="leading-slash"||u==="trailing-slash"?_='"filepath" parameter should not include leading or trailing directory separators because these can cause problems on some platforms.':u==="directory"&&(_='"filepath" should not be a directory.'),super(_),this.code=this.name=He.code,this.data={reason:u}}}He.code="InvalidFilepathError";class ot extends d{constructor(u,_){super(`"${u}" would be an invalid git reference. (Hint: a valid alternative would be "${_}".)`),this.code=this.name=ot.code,this.data={ref:u,suggestion:_}}}ot.code="InvalidRefNameError";class ht extends d{constructor(u){super(`Maximum search depth of ${u} exceeded.`),this.code=this.name=ht.code,this.data={depth:u}}}ht.code="MaxDepthError";class Pt extends d{constructor(){super("Merges with conflicts are not supported yet."),this.code=this.name=Pt.code,this.data={}}}Pt.code="MergeNotSupportedError";class zt extends d{constructor(u,_,b,E){super(`Automatic merge failed with one or more merge conflicts in the following files: ${u.toString()}. Fix conflicts then commit the result.`),this.code=this.name=zt.code,this.data={filepaths:u,bothModified:_,deleteByUs:b,deleteByTheirs:E}}}zt.code="MergeConflictError";class at extends d{constructor(u){super(`No name was provided for ${u} in the argument or in the .git/config file.`),this.code=this.name=at.code,this.data={role:u}}}at.code="MissingNameError";class Mt extends d{constructor(u){super(`The function requires a "${u}" parameter but none was provided.`),this.code=this.name=Mt.code,this.data={parameter:u}}}Mt.code="MissingParameterError";class Ht extends d{constructor(u){super('There are multiple errors that were thrown by the method. Please refer to the "errors" property to see more'),this.code=this.name=Ht.code,this.data={errors:u},this.errors=u}}Ht.code="MultipleGitError";class jt extends d{constructor(u,_){super(`Expected "${u}" but received "${_}".`),this.code=this.name=jt.code,this.data={expected:u,actual:_}}}jt.code="ParseError";class Qt extends d{constructor(u){let _="";u==="not-fast-forward"?_=" because it was not a simple fast-forward":u==="tag-exists"&&(_=" because tag already exists"),super(`Push rejected${_}. Use "force: true" to override.`),this.code=this.name=Qt.code,this.data={reason:u}}}Qt.code="PushRejectedError";class Vt extends d{constructor(u,_){super(`Remote does not support the "${u}" so the "${_}" parameter cannot be used.`),this.code=this.name=Vt.code,this.data={capability:u,parameter:_}}}Vt.code="RemoteCapabilityError";class hr extends d{constructor(u,_){super(`Remote did not reply using the "smart" HTTP protocol. Expected "001e# service=git-upload-pack" but received: ${u}`),this.code=this.name=hr.code,this.data={preview:u,response:_}}}hr.code="SmartHttpError";class Tt extends d{constructor(u,_,b){super(`Git remote "${u}" uses an unrecognized transport protocol: "${_}"`),this.code=this.name=Tt.code,this.data={url:u,transport:_,suggestion:b}}}Tt.code="UnknownTransportError";class ur extends d{constructor(u){super(`Cannot parse remote URL: "${u}"`),this.code=this.name=ur.code,this.data={url:u}}}ur.code="UrlParseError";class rr extends d{constructor(){super("The operation was canceled."),this.code=this.name=rr.code,this.data={}}}rr.code="UserCanceledError";class cr extends d{constructor(u){super(`Could not merge index: Entry for '${u}' is not up to date. Either reset the index entry to HEAD, or stage your unstaged changes.`),this.code=this.name=cr.code,this.data={filepath:u}}}cr.code="IndexResetError";class fr extends d{constructor(u){super(`"${u}" does not point to any commit. You're maybe working on a repository with no commits yet. `),this.code=this.name=fr.code,this.data={ref:u}}}fr.code="NoCommitError";var dr=Object.freeze({__proto__:null,AlreadyExistsError:ze,AmbiguousError:Xe,CheckoutConflictError:ft,CommitNotFetchedError:_t,EmptyServerResponseError:Ve,FastForwardError:et,GitPushError:pt,HttpError:Ce,InternalError:f,InvalidFilepathError:He,InvalidOidError:ye,InvalidRefNameError:ot,MaxDepthError:ht,MergeNotSupportedError:Pt,MergeConflictError:zt,MissingNameError:at,MissingParameterError:Mt,MultipleGitError:Ht,NoRefspecError:be,NotFoundError:ce,ObjectTypeError:U,ParseError:jt,PushRejectedError:Qt,RemoteCapabilityError:Vt,SmartHttpError:hr,UnknownTransportError:Tt,UnsafeFilepathError:p,UrlParseError:ur,UserCanceledError:rr,UnmergedPathsError:l,IndexResetError:cr,NoCommitError:fr});function Sr({name:y,email:u,timestamp:_,timezoneOffset:b}){return b=xr(b),`${y} <${u}> ${_} ${b}`}function xr(y){const u=as(cs(y));y=Math.abs(y);const _=Math.floor(y/60);y-=_*60;let b=String(_),E=String(y);return b.length<2&&(b="0"+b),E.length<2&&(E="0"+E),(u===-1?"-":"+")+b+E}function as(y){return Math.sign(y)||(Object.is(y,-0)?-1:1)}function cs(y){return y===0?y:-y}function Cr(y){return y=y.replace(/\r/g,""),y=y.replace(/^\n+/,""),y=y.replace(/\n+$/,"")+`
`,y}function Zr(y){const[,u,_,b,E]=y.match(/^(.*) <(.*)> (.*) (.*)$/);return{name:u,email:_,timestamp:Number(b),timezoneOffset:Pn(E)}}function Pn(y){let[,u,_,b]=y.match(/(\+|-)(\d\d)(\d\d)/);return b=(u==="+"?1:-1)*(Number(_)*60+Number(b)),On(b)}function On(y){return y===0?y:-y}class mr{constructor(u){if(typeof u=="string")this._tag=u;else if(Buffer.isBuffer(u))this._tag=u.toString("utf8");else if(typeof u=="object")this._tag=mr.render(u);else throw new f("invalid type passed to GitAnnotatedTag constructor")}static from(u){return new mr(u)}static render(u){return`object ${u.object}
type ${u.type}
tag ${u.tag}
tagger ${Sr(u.tagger)}

${u.message}
${u.gpgsig?u.gpgsig:""}`}justHeaders(){return this._tag.slice(0,this._tag.indexOf(`

`))}message(){const u=this.withoutSignature();return u.slice(u.indexOf(`

`)+2)}parse(){return Object.assign(this.headers(),{message:this.message(),gpgsig:this.gpgsig()})}render(){return this._tag}headers(){const u=this.justHeaders().split(`
`),_=[];for(const E of u)E[0]===" "?_[_.length-1]+=`
`+E.slice(1):_.push(E);const b={};for(const E of _){const T=E.slice(0,E.indexOf(" ")),F=E.slice(E.indexOf(" ")+1);Array.isArray(b[T])?b[T].push(F):b[T]=F}return b.tagger&&(b.tagger=Zr(b.tagger)),b.committer&&(b.committer=Zr(b.committer)),b}withoutSignature(){const u=Cr(this._tag);return u.indexOf(`
-----BEGIN PGP SIGNATURE-----`)===-1?u:u.slice(0,u.lastIndexOf(`
-----BEGIN PGP SIGNATURE-----`))}gpgsig(){if(this._tag.indexOf(`
-----BEGIN PGP SIGNATURE-----`)===-1)return;const u=this._tag.slice(this._tag.indexOf("-----BEGIN PGP SIGNATURE-----"),this._tag.indexOf("-----END PGP SIGNATURE-----")+27);return Cr(u)}payload(){return this.withoutSignature()+`
`}toObject(){return Buffer.from(this._tag,"utf8")}static async sign(u,_,b){const E=u.payload();let{signature:T}=await _({payload:E,secretKey:b});T=Cr(T);const F=E+T;return mr.from(F)}}function hs(y){return y.trim().split(`
`).map(u=>" "+u).join(`
`)+`
`}function Dn(y){return y.split(`
`).map(u=>u.replace(/^ /,"")).join(`
`)}class Zt{constructor(u){if(typeof u=="string")this._commit=u;else if(Buffer.isBuffer(u))this._commit=u.toString("utf8");else if(typeof u=="object")this._commit=Zt.render(u);else throw new f("invalid type passed to GitCommit constructor")}static fromPayloadSignature({payload:u,signature:_}){const b=Zt.justHeaders(u),E=Zt.justMessage(u),T=Cr(b+`
gpgsig`+hs(_)+`
`+E);return new Zt(T)}static from(u){return new Zt(u)}toObject(){return Buffer.from(this._commit,"utf8")}headers(){return this.parseHeaders()}message(){return Zt.justMessage(this._commit)}parse(){return Object.assign({message:this.message()},this.headers())}static justMessage(u){return Cr(u.slice(u.indexOf(`

`)+2))}static justHeaders(u){return u.slice(0,u.indexOf(`

`))}parseHeaders(){const u=Zt.justHeaders(this._commit).split(`
`),_=[];for(const E of u)E[0]===" "?_[_.length-1]+=`
`+E.slice(1):_.push(E);const b={parent:[]};for(const E of _){const T=E.slice(0,E.indexOf(" ")),F=E.slice(E.indexOf(" ")+1);Array.isArray(b[T])?b[T].push(F):b[T]=F}return b.author&&(b.author=Zr(b.author)),b.committer&&(b.committer=Zr(b.committer)),b}static renderHeaders(u){let _="";if(u.tree?_+=`tree ${u.tree}
`:_+=`tree 4b825dc642cb6eb9a060e54bf8d69288fbee4904
`,u.parent){if(u.parent.length===void 0)throw new f("commit 'parent' property should be an array");for(const T of u.parent)_+=`parent ${T}
`}const b=u.author;_+=`author ${Sr(b)}
`;const E=u.committer||u.author;return _+=`committer ${Sr(E)}
`,u.gpgsig&&(_+="gpgsig"+hs(u.gpgsig)),_}static render(u){return Zt.renderHeaders(u)+`
`+Cr(u.message)}render(){return this._commit}withoutSignature(){const u=Cr(this._commit);if(u.indexOf(`
gpgsig`)===-1)return u;const _=u.slice(0,u.indexOf(`
gpgsig`)),b=u.slice(u.indexOf(`-----END PGP SIGNATURE-----
`)+28);return Cr(_+`
`+b)}isolateSignature(){const u=this._commit.slice(this._commit.indexOf("-----BEGIN PGP SIGNATURE-----"),this._commit.indexOf("-----END PGP SIGNATURE-----")+27);return Dn(u)}static async sign(u,_,b){const E=u.withoutSignature(),T=Zt.justMessage(u._commit);let{signature:F}=await _({payload:E,secretKey:b});F=Cr(F);const se=Zt.justHeaders(u._commit)+`
gpgsig`+hs(F)+`
`+T;return Zt.from(se)}}async function Or({fs:y,cache:u,gitdir:_,oid:b}){if(b==="4b825dc642cb6eb9a060e54bf8d69288fbee4904")return{tree:M.from([]),oid:b};const{type:E,object:T}=await Ie({fs:y,cache:u,gitdir:_,oid:b});if(E==="tag")return b=mr.from(T).parse().object,Or({fs:y,cache:u,gitdir:_,oid:b});if(E==="commit")return b=Zt.from(T).parse().tree,Or({fs:y,cache:u,gitdir:_,oid:b});if(E!=="tree")throw new U(b,E,"tree");return{tree:M.from(T),oid:b}}class Ln{constructor({fs:u,gitdir:_,ref:b,cache:E}){this.fs=u,this.cache=E,this.gitdir=_,this.mapPromise=(async()=>{const F=new Map;let z;try{z=await me.resolve({fs:u,gitdir:_,ref:b})}catch(ae){ae instanceof ce&&(z="4b825dc642cb6eb9a060e54bf8d69288fbee4904")}const se=await Or({fs:u,cache:this.cache,gitdir:_,oid:z});return se.type="tree",se.mode="40000",F.set(".",se),F})();const T=this;this.ConstructEntry=class{constructor(z){this._fullpath=z,this._type=!1,this._mode=!1,this._stat=!1,this._content=!1,this._oid=!1}async type(){return T.type(this)}async mode(){return T.mode(this)}async stat(){return T.stat(this)}async content(){return T.content(this)}async oid(){return T.oid(this)}}}async readdir(u){const _=u._fullpath,{fs:b,cache:E,gitdir:T}=this,F=await this.mapPromise,z=F.get(_);if(!z)throw new Error(`No obj for ${_}`);const se=z.oid;if(!se)throw new Error(`No oid for obj ${JSON.stringify(z)}`);if(z.type!=="tree")return null;const{type:ae,object:re}=await Ie({fs:b,cache:E,gitdir:T,oid:se});if(ae!==z.type)throw new U(se,ae,z.type);const ue=M.from(re);for(const de of ue)F.set(fe(_,de.path),de);return ue.entries().map(de=>fe(_,de.path))}async type(u){if(u._type===!1){const _=await this.mapPromise,{type:b}=_.get(u._fullpath);u._type=b}return u._type}async mode(u){if(u._mode===!1){const _=await this.mapPromise,{mode:b}=_.get(u._fullpath);u._mode=w(parseInt(b,8))}return u._mode}async stat(u){}async content(u){if(u._content===!1){const _=await this.mapPromise,{fs:b,cache:E,gitdir:T}=this,z=_.get(u._fullpath).oid,{type:se,object:ae}=await Ie({fs:b,cache:E,gitdir:T,oid:z});se!=="blob"?u._content=void 0:u._content=new Uint8Array(ae)}return u._content}async oid(u){if(u._oid===!1){const b=(await this.mapPromise).get(u._fullpath);u._oid=b.oid}return u._oid}}function _r({ref:y="HEAD"}={}){const u=Object.create(null);return Object.defineProperty(u,Z,{value:function({fs:_,gitdir:b,cache:E}){return new Ln({fs:_,gitdir:b,ref:y,cache:E})}}),Object.freeze(u),u}class Mn{constructor({fs:u,dir:_,gitdir:b,cache:E}){this.fs=u,this.cache=E,this.dir=_,this.gitdir=b,this.config=null;const T=this;this.ConstructEntry=class{constructor(z){this._fullpath=z,this._type=!1,this._mode=!1,this._stat=!1,this._content=!1,this._oid=!1}async type(){return T.type(this)}async mode(){return T.mode(this)}async stat(){return T.stat(this)}async content(){return T.content(this)}async oid(){return T.oid(this)}}}async readdir(u){const _=u._fullpath,{fs:b,dir:E}=this,T=await b.readdir(fe(E,_));return T===null?null:T.map(F=>fe(_,F))}async type(u){return u._type===!1&&await u.stat(),u._type}async mode(u){return u._mode===!1&&await u.stat(),u._mode}async stat(u){if(u._stat===!1){const{fs:_,dir:b}=this;let E=await _.lstat(`${b}/${u._fullpath}`);if(!E)throw new Error(`ENOENT: no such file or directory, lstat '${u._fullpath}'`);let T=E.isDirectory()?"tree":"blob";T==="blob"&&!E.isFile()&&!E.isSymbolicLink()&&(T="special"),u._type=T,E=m(E),u._mode=E.mode,E.size===-1&&u._actualSize&&(E.size=u._actualSize),u._stat=E}return u._stat}async content(u){if(u._content===!1){const{fs:_,dir:b,gitdir:E}=this;if(await u.type()==="tree")u._content=void 0;else{let T;if(await u.mode()>>12===10)T=await _.readlink(`${b}/${u._fullpath}`);else{const z=await(await this._getGitConfig(_,E)).get("core.autocrlf");T=await _.read(`${b}/${u._fullpath}`,{autocrlf:z})}u._actualSize=T.length,u._stat&&u._stat.size===-1&&(u._stat.size=u._actualSize),u._content=new Uint8Array(T)}}return u._content}async oid(u){if(u._oid===!1){const _=this,{fs:b,gitdir:E,cache:T}=this;let F;await q.acquire({fs:b,gitdir:E,cache:T},async function(z){const se=z.entriesMap.get(u._fullpath),ae=await u.stat(),ue=await(await _._getGitConfig(b,E)).get("core.filemode"),de=typeof process$1<"u"?process$1.platform!=="win32":!0;if(!se||Y(ae,se,ue,de)){const Ee=await u.content();Ee===void 0?F=void 0:(F=await B(R.wrap({type:"blob",object:Ee})),se&&F===se.oid&&(!ue||ae.mode===se.mode)&&Y(ae,se,ue,de)&&z.insert({filepath:u._fullpath,stats:ae,oid:F}))}else F=se.oid}),u._oid=F}return u._oid}async _getGitConfig(u,_){return this.config?this.config:(this.config=await _e.get({fs:u,gitdir:_}),this.config)}}function Dr(){const y=Object.create(null);return Object.defineProperty(y,Z,{value:function({fs:u,dir:_,gitdir:b,cache:E}){return new Mn({fs:u,dir:_,gitdir:b,cache:E})}}),Object.freeze(y),y}function Fn(y,u){const _=u-y;return Array.from({length:_},(b,E)=>y+E)}const $s=typeof Array.prototype.flat>"u"?y=>y.reduce((u,_)=>u.concat(_),[]):y=>y.flat();class Nn{constructor(){this.value=null}consider(u){u!=null&&(this.value===null?this.value=u:u<this.value&&(this.value=u))}reset(){this.value=null}}function*jn(y){const u=new Nn;let _;const b=[],E=y.length;for(let T=0;T<E;T++)b[T]=y[T].next().value,b[T]!==void 0&&u.consider(b[T]);if(u.value!==null)for(;;){const T=[];_=u.value,u.reset();for(let F=0;F<E;F++)b[F]!==void 0&&b[F]===_?(T[F]=b[F],b[F]=y[F].next().value):T[F]=null,b[F]!==void 0&&u.consider(b[F]);if(yield T,u.value===null)return}}async function kr({fs:y,cache:u,dir:_,gitdir:b,trees:E,map:T=async(se,ae)=>ae,reduce:F=async(se,ae)=>{const re=$s(ae);return se!==void 0&&re.unshift(se),re},iterate:z=(se,ae)=>Promise.all([...ae].map(se))}){const se=E.map(Ee=>Ee[Z]({fs:y,dir:_,gitdir:b,cache:u})),ae=new Array(se.length).fill("."),re=Fn(0,se.length),ue=async Ee=>{re.forEach(Fe=>{const Ge=Ee[Fe];Ee[Fe]=Ge&&new se[Fe].ConstructEntry(Ge)});const Ne=(await Promise.all(re.map(Fe=>{const Ge=Ee[Fe];return Ge?se[Fe].readdir(Ge):[]}))).map(Fe=>(Fe===null?[]:Fe)[Symbol.iterator]());return{entries:Ee,children:jn(Ne)}},de=async Ee=>{const{entries:Te,children:Ne}=await ue(Ee),Fe=Te.find(Je=>Je&&Je._fullpath)._fullpath,Ge=await T(Fe,Te);if(Ge!==null){let Je=await z(de,Ne);return Je=Je.filter(ct=>ct!==void 0),F(Ge,Je)}};return de(ae)}async function us(y,u){const _=await y.readdir(u);_==null?await y.rm(u):_.length?await Promise.all(_.map(b=>{const E=fe(u,b);return y.lstat(E).then(T=>{if(T)return T.isDirectory()?us(y,E):y.rm(E)})})).then(()=>y.rmdir(u)):await y.rmdir(u)}function Un(y){return Hn(y)&&Ts(y.then)&&Ts(y.catch)}function Hn(y){return y&&typeof y=="object"}function Ts(y){return typeof y=="function"}function Is(y){return Un((_=>{try{return _.readFile().catch(b=>b)}catch(b){return b}})(y))}const Bs=["readFile","writeFile","mkdir","rmdir","unlink","stat","lstat","readdir","readlink","symlink"];function Ps(y,u){if(Is(u))for(const _ of Bs)y[`_${_}`]=u[_].bind(u);else for(const _ of Bs)y[`_${_}`]=s(u[_].bind(u));Is(u)?(u.cp&&(y._cp=u.cp.bind(u)),u.rm?y._rm=u.rm.bind(u):u.rmdir.length>1?y._rm=u.rmdir.bind(u):y._rm=us.bind(null,y)):(u.cp&&(y._cp=s(u.cp.bind(u))),u.rm?y._rm=s(u.rm.bind(u)):u.rmdir.length>2?y._rm=s(u.rmdir.bind(u)):y._rm=us.bind(null,y))}class Bt{constructor(u){if(typeof u._original_unwrapped_fs<"u")return u;const _=Object.getOwnPropertyDescriptor(u,"promises");_&&_.enumerable?Ps(this,u.promises):Ps(this,u),this._original_unwrapped_fs=u}async exists(u,_={}){try{return await this._stat(u),!0}catch(b){if(b.code==="ENOENT"||b.code==="ENOTDIR"||(b.code||"").includes("ENS"))return!1;throw console.log('Unhandled error in "FileSystem.exists()" function',b),b}}async read(u,_={}){try{let b=await this._readFile(u,_);if(_.autocrlf==="true")try{b=new TextDecoder("utf8",{fatal:!0}).decode(b),b=b.replace(/\r\n/g,`
`),b=new TextEncoder().encode(b)}catch{}return typeof b!="string"&&(b=Buffer.from(b)),b}catch{return null}}async write(u,_,b={}){try{await this._writeFile(u,_,b)}catch{await this.mkdir(H(u)),await this._writeFile(u,_,b)}}async mkdir(u,_=!1){try{await this._mkdir(u)}catch(b){if(b===null||b.code==="EEXIST")return;if(_)throw b;if(b.code==="ENOENT"){const E=H(u);if(E==="."||E==="/"||E===u)throw b;await this.mkdir(E),await this.mkdir(u,!0)}}}async rm(u){try{await this._unlink(u)}catch(_){if(_.code!=="ENOENT")throw _}}async rmdir(u,_){try{_&&_.recursive?await this._rm(u,_):await this._rmdir(u)}catch(b){if(b.code!=="ENOENT")throw b}}async readdir(u){try{const _=await this._readdir(u);return _.sort(k),_}catch(_){return _.code==="ENOTDIR"?null:[]}}async readdirDeep(u){const _=await this._readdir(u);return(await Promise.all(_.map(async E=>{const T=u+"/"+E;return(await this._stat(T)).isDirectory()?this.readdirDeep(T):T}))).reduce((E,T)=>E.concat(T),[])}async lstat(u){try{return await this._lstat(u)}catch(_){if(_.code==="ENOENT"||(_.code||"").includes("ENS"))return null;throw _}}async readlink(u,_={encoding:"buffer"}){try{const b=await this._readlink(u,_);return Buffer.isBuffer(b)?b:Buffer.from(b)}catch(b){if(b.code==="ENOENT"||(b.code||"").includes("ENS"))return null;throw b}}async writelink(u,_){return this._symlink(_.toString("utf8"),u)}}function $e(y,u){if(u===void 0)throw new Mt(y)}async function Ot({fsp:y,dotgit:u}){$e("fsp",y),$e("dotgit",u);const _=await y._stat(u).catch(()=>({isFile:()=>!1,isDirectory:()=>!1}));return _.isDirectory()?u:_.isFile()?y._readFile(u,"utf8").then(b=>b.trimRight().substr(8)).then(b=>fe(H(u),b)):u}async function Xr(y,u){return!y&&!u?!1:y&&!u||!y&&u?!0:!(await y.type()==="tree"&&await u.type()==="tree"||await y.type()===await u.type()&&await y.mode()===await u.mode()&&await y.oid()===await u.oid())}async function Os({fs:y,dir:u,gitdir:_=fe(u,".git"),commit:b="HEAD",cache:E={}}){try{$e("fs",y),$e("dir",u),$e("gitdir",_);const T=new Bt(y),F=[_r({ref:b}),Dr(),pe()];let z=[];const se=await Ot({fsp:T,dotgit:_});await q.acquire({fs:T,gitdir:se,cache:E},async function(re){z=re.unmergedPaths});const ae=await kr({fs:T,cache:E,dir:u,gitdir:se,trees:F,map:async function(re,[ue,de,Ee]){const Te=!await Xr(de,Ee),Ne=z.includes(re),Fe=!await Xr(Ee,ue);if(Te||Ne)return ue?{path:re,mode:await ue.mode(),oid:await ue.oid(),type:await ue.type(),content:await ue.content()}:void 0;if(Fe)return!1;throw new cr(re)}});await q.acquire({fs:T,gitdir:se,cache:E},async function(re){for(const ue of ae)if(ue!==!1){if(!ue){await T.rmdir(`${u}/${ue.path}`,{recursive:!0}),re.delete({filepath:ue.path});continue}if(ue.type==="blob"){const de=new TextDecoder().decode(ue.content);await T.write(`${u}/${ue.path}`,de,{mode:ue.mode}),re.insert({filepath:ue.path,oid:ue.oid,stage:0})}}})}catch(T){throw T.caller="git.abortMerge",T}}class Lr{static async isIgnored({fs:u,dir:_,gitdir:b=fe(_,".git"),filepath:E}){if(j(E)===".git")return!0;if(E===".")return!1;let T="";const F=fe(b,"info","exclude");await u.exists(F)&&(T=await u.read(F,"utf8"));const z=[{gitignore:fe(_,".gitignore"),filepath:E}],se=E.split("/").filter(Boolean);for(let re=1;re<se.length;re++){const ue=se.slice(0,re).join("/"),de=se.slice(re).join("/");z.push({gitignore:fe(_,ue,".gitignore"),filepath:de})}let ae=!1;for(const re of z){let ue;try{ue=await u.read(re.gitignore,"utf8")}catch(Te){if(Te.code==="NOENT")continue}const de=h().add(T);de.add(ue);const Ee=H(re.filepath);if(Ee!=="."&&de.ignores(Ee))return!0;ae?ae=!de.test(re.filepath).unignored:ae=de.test(re.filepath).ignored}return ae}}async function qn({fs:y,gitdir:u,object:_,format:b,oid:E}){const T=`objects/${E.slice(0,2)}/${E.slice(2)}`,F=`${u}/${T}`;await y.exists(F)||await y.write(F,_)}let fs=null;async function Ds(y){return fs===null&&(fs=zn()),fs?Wn(y):c.deflate(y)}async function Wn(y){const u=new CompressionStream("deflate"),_=new Blob([y]).stream().pipeThrough(u);return new Uint8Array(await new Response(_).arrayBuffer())}function zn(){try{return new CompressionStream("deflate").writable.close(),new Blob([]).stream().cancel(),!0}catch{return!1}}async function gr({fs:y,gitdir:u,type:_,object:b,format:E="content",oid:T=void 0,dryRun:F=!1}){return E!=="deflated"&&(E!=="wrapped"&&(b=R.wrap({type:_,object:b})),T=await B(b),b=Buffer.from(await Ds(b))),F||await qn({fs:y,gitdir:u,object:b,format:"deflated",oid:T}),T}function Ls(y){let u;for(;~(u=y.indexOf(92));)y[u]=47;return y}async function Ms({fs:y,dir:u,gitdir:_=fe(u,".git"),filepath:b,cache:E={},force:T=!1,parallel:F=!0}){try{$e("fs",y),$e("dir",u),$e("gitdir",_),$e("filepath",b);const z=new Bt(y),se=await Ot({fsp:z,dotgit:_});await q.acquire({fs:z,gitdir:se,cache:E},async ae=>{const ue=await(await _e.get({fs:z,gitdir:se})).get("core.autocrlf");return ds({dir:u,gitdir:se,fs:z,filepath:b,index:ae,force:T,parallel:F,autocrlf:ue})})}catch(z){throw z.caller="git.add",z}}async function ds({dir:y,gitdir:u,fs:_,filepath:b,index:E,force:T,parallel:F,autocrlf:z}){b=Array.isArray(b)?b:[b];const se=b.map(async de=>{if(!T&&await Lr.isIgnored({fs:_,dir:y,gitdir:u,filepath:de}))return;const Ee=await _.lstat(fe(y,de));if(!Ee)throw new ce(de);if(Ee.isDirectory()){const Te=await _.readdir(fe(y,de));if(F){const Ne=Te.map(Fe=>ds({dir:y,gitdir:u,fs:_,filepath:[fe(de,Fe)],index:E,force:T,parallel:F,autocrlf:z}));await Promise.all(Ne)}else for(const Ne of Te)await ds({dir:y,gitdir:u,fs:_,filepath:[fe(de,Ne)],index:E,force:T,parallel:F,autocrlf:z})}else{const Te=Ee.isSymbolicLink()?await _.readlink(fe(y,de)).then(Ls):await _.read(fe(y,de),{autocrlf:z});if(Te===null)throw new ce(de);const Ne=await gr({fs:_,gitdir:u,type:"blob",object:Te});E.insert({filepath:de,stats:Ee,oid:Ne})}}),ae=await Promise.allSettled(se),re=ae.filter(de=>de.status==="rejected").map(de=>de.reason);if(re.length>1)throw new Ht(re);if(re.length===1)throw re[0];return ae.filter(de=>de.status==="fulfilled"&&de.value).map(de=>de.value)}async function Hr({fs:y,gitdir:u,path:_}){return(await _e.get({fs:y,gitdir:u})).get(_)}function Fs(y,...u){for(const _ of u)if(_)for(const b of Object.keys(_)){const E=_[b];E!==void 0&&(y[b]=E)}return y}async function Ar({fs:y,gitdir:u,author:_,commit:b}){const E=Math.floor(Date.now()/1e3),T={name:await Hr({fs:y,gitdir:u,path:"user.name"}),email:await Hr({fs:y,gitdir:u,path:"user.email"})||"",timestamp:E,timezoneOffset:new Date(E*1e3).getTimezoneOffset()},F=Fs({},T,b?b.author:void 0,_);if(F.name!==void 0)return F}async function Mr({fs:y,gitdir:u,author:_,committer:b,commit:E}){const T=Math.floor(Date.now()/1e3),F={name:await Hr({fs:y,gitdir:u,path:"user.name"}),email:await Hr({fs:y,gitdir:u,path:"user.email"})||"",timestamp:T,timezoneOffset:new Date(T*1e3).getTimezoneOffset()},z=Fs({},F,E?E.committer:void 0,_,b);if(z.name!==void 0)return z}async function Ns({fs:y,cache:u,gitdir:_,oid:b}){const{type:E,object:T}=await Ie({fs:y,cache:u,gitdir:_,oid:b});if(E==="tag")return b=mr.from(T).parse().object,Ns({fs:y,cache:u,gitdir:_,oid:b});if(E!=="commit")throw new U(b,E,"commit");return{commit:Zt.from(T),oid:b}}async function Fr({fs:y,cache:u,gitdir:_,oid:b}){const{commit:E,oid:T}=await Ns({fs:y,cache:u,gitdir:_,oid:b});return{oid:T,commit:E.parse(),payload:E.withoutSignature()}}async function Qr({fs:y,cache:u,onSign:_,gitdir:b,message:E,author:T,committer:F,signingKey:z,amend:se=!1,dryRun:ae=!1,noUpdateBranch:re=!1,ref:ue,parent:de,tree:Ee}){let Te=!1,Ne=!1;ue||(Ne=!(await y.read(`${b}/HEAD`,{encoding:"utf8"})).startsWith("ref:"),ue=await me.resolve({fs:y,gitdir:b,ref:"HEAD",depth:2}));let Fe,Ge;try{Fe=await me.resolve({fs:y,gitdir:b,ref:ue}),Ge=await Fr({fs:y,gitdir:b,oid:Fe,cache:{}})}catch{Te=!0}if(se&&Te)throw new fr(ue);const Je=se?await Ar({fs:y,gitdir:b,author:T,commit:Ge.commit}):await Ar({fs:y,gitdir:b,author:T});if(!Je)throw new at("author");const ct=se?await Mr({fs:y,gitdir:b,author:Je,committer:F,commit:Ge.commit}):await Mr({fs:y,gitdir:b,author:Je,committer:F});if(!ct)throw new at("committer");return q.acquire({fs:y,gitdir:b,cache:u,allowUnmerged:!1},async function(Ct){const $t=G(Ct.entries).get(".");if(Ee||(Ee=await js({fs:y,gitdir:b,inode:$t,dryRun:ae})),de?de=await Promise.all(de.map(ut=>me.resolve({fs:y,gitdir:b,ref:ut}))):se?de=Ge.commit.parent:de=Fe?[Fe]:[],!E)if(se)E=Ge.commit.message;else throw new Mt("message");let tt=Zt.from({tree:Ee,parent:de,author:Je,committer:ct,message:E});z&&(tt=await Zt.sign(tt,_,z));const it=await gr({fs:y,gitdir:b,type:"commit",object:tt.toObject(),dryRun:ae});return!re&&!ae&&await me.writeRef({fs:y,gitdir:b,ref:Ne?"HEAD":ue,value:it}),it})}async function js({fs:y,gitdir:u,inode:_,dryRun:b}){const E=_.children;for(const se of E)se.type==="tree"&&(se.metadata.mode="040000",se.metadata.oid=await js({fs:y,gitdir:u,inode:se,dryRun:b}));const T=E.map(se=>({mode:se.metadata.mode,path:se.basename,oid:se.metadata.oid,type:se.type})),F=M.from(T);return await gr({fs:y,gitdir:u,type:"tree",object:F.toObject(),dryRun:b})}async function qr({fs:y,cache:u,gitdir:_,oid:b,filepath:E}){if(E.startsWith("/"))throw new He("leading-slash");if(E.endsWith("/"))throw new He("trailing-slash");const T=b,F=await Or({fs:y,cache:u,gitdir:_,oid:b}),z=F.tree;if(E==="")b=F.oid;else{const se=E.split("/");b=await Us({fs:y,cache:u,gitdir:_,tree:z,pathArray:se,oid:T,filepath:E})}return b}async function Us({fs:y,cache:u,gitdir:_,tree:b,pathArray:E,oid:T,filepath:F}){const z=E.shift();for(const se of b)if(se.path===z){if(E.length===0)return se.oid;{const{type:ae,object:re}=await Ie({fs:y,cache:u,gitdir:_,oid:se.oid});if(ae!=="tree")throw new U(T,ae,"tree",F);return b=M.from(re),Us({fs:y,cache:u,gitdir:_,tree:b,pathArray:E,oid:T,filepath:F})}}throw new ce(`file or directory found at "${T}:${F}"`)}async function Nr({fs:y,cache:u,gitdir:_,oid:b,filepath:E=void 0}){E!==void 0&&(b=await qr({fs:y,cache:u,gitdir:_,oid:b,filepath:E}));const{tree:T,oid:F}=await Or({fs:y,cache:u,gitdir:_,oid:b});return{oid:F,tree:T.entries()}}async function Wr({fs:y,gitdir:u,tree:_}){const b=M.from(_).toObject();return await gr({fs:y,gitdir:u,type:"tree",object:b,format:"content"})}async function Gn({fs:y,cache:u,onSign:_,gitdir:b,ref:E,oid:T,note:F,force:z,author:se,committer:ae,signingKey:re}){let ue;try{ue=await me.resolve({gitdir:b,fs:y,ref:E})}catch(Ge){if(!(Ge instanceof ce))throw Ge}let Ee=(await Nr({fs:y,cache:u,gitdir:b,oid:ue||"4b825dc642cb6eb9a060e54bf8d69288fbee4904"})).tree;if(z)Ee=Ee.filter(Ge=>Ge.path!==T);else for(const Ge of Ee)if(Ge.path===T)throw new ze("note",T);typeof F=="string"&&(F=Buffer.from(F,"utf8"));const Te=await gr({fs:y,gitdir:b,type:"blob",object:F,format:"content"});Ee.push({mode:"100644",path:T,oid:Te,type:"blob"});const Ne=await Wr({fs:y,gitdir:b,tree:Ee});return await Qr({fs:y,cache:u,onSign:_,gitdir:b,ref:E,tree:Ne,parent:ue&&[ue],message:`Note added by 'isomorphic-git addNote'
`,author:se,committer:ae,signingKey:re})}async function Hs({fs:y,onSign:u,dir:_,gitdir:b=fe(_,".git"),ref:E="refs/notes/commits",oid:T,note:F,force:z,author:se,committer:ae,signingKey:re,cache:ue={}}){try{$e("fs",y),$e("gitdir",b),$e("oid",T),$e("note",F),re&&$e("onSign",u);const de=new Bt(y),Ee=await Ar({fs:de,gitdir:b,author:se});if(!Ee)throw new at("author");const Te=await Mr({fs:de,gitdir:b,author:Ee,committer:ae});if(!Te)throw new at("committer");const Ne=await Ot({fsp:de,dotgit:b});return await Gn({fs:de,cache:ue,onSign:u,gitdir:Ne,ref:E,oid:T,note:F,force:z,author:Ee,committer:Te,signingKey:re})}catch(de){throw de.caller="git.addNote",de}}const Kn=/(^|[/.])([/.]|$)|^@$|@{|[\x00-\x20\x7f~^:?*[\\]|\.lock(\/|$)/;function zr(y,u){if(typeof y!="string")throw new TypeError("Reference name must be a string");return!Kn.test(y)&&!0}async function qs({fs:y,gitdir:u,remote:_,url:b,force:E}){if(!zr(_))throw new ot(_,o.clean(_));const T=await _e.get({fs:y,gitdir:u});if(!E&&(await T.getSubsections("remote")).includes(_)&&b!==await T.get(`remote.${_}.url`))throw new ze("remote",_);await T.set(`remote.${_}.url`,b),await T.set(`remote.${_}.fetch`,`+refs/heads/*:refs/remotes/${_}/*`),await _e.save({fs:y,gitdir:u,config:T})}async function Ws({fs:y,dir:u,gitdir:_=fe(u,".git"),remote:b,url:E,force:T=!1}){try{$e("fs",y),$e("gitdir",_),$e("remote",b),$e("url",E);const F=new Bt(y),z=await Ot({fsp:F,dotgit:_});return await qs({fs:F,gitdir:z,remote:b,url:E,force:T})}catch(F){throw F.caller="git.addRemote",F}}async function Vn({fs:y,cache:u,onSign:_,gitdir:b,ref:E,tagger:T,message:F=E,gpgsig:z,object:se,signingKey:ae,force:re=!1}){if(E=E.startsWith("refs/tags/")?E:`refs/tags/${E}`,!re&&await me.exists({fs:y,gitdir:b,ref:E}))throw new ze("tag",E);const ue=await me.resolve({fs:y,gitdir:b,ref:se||"HEAD"}),{type:de}=await Ie({fs:y,cache:u,gitdir:b,oid:ue});let Ee=mr.from({object:ue,type:de,tag:E.replace("refs/tags/",""),tagger:T,message:F,gpgsig:z});ae&&(Ee=await mr.sign(Ee,_,ae));const Te=await gr({fs:y,gitdir:b,type:"tag",object:Ee.toObject()});await me.writeRef({fs:y,gitdir:b,ref:E,value:Te})}async function zs({fs:y,onSign:u,dir:_,gitdir:b=fe(_,".git"),ref:E,tagger:T,message:F=E,gpgsig:z,object:se,signingKey:ae,force:re=!1,cache:ue={}}){try{$e("fs",y),$e("gitdir",b),$e("ref",E),ae&&$e("onSign",u);const de=new Bt(y),Ee=await Ot({fsp:de,dotgit:b}),Te=await Ar({fs:de,gitdir:Ee,author:T});if(!Te)throw new at("tagger");return await Vn({fs:de,cache:ue,onSign:u,gitdir:Ee,ref:E,tagger:Te,message:F,gpgsig:z,object:se,signingKey:ae,force:re})}catch(de){throw de.caller="git.annotatedTag",de}}async function Jn({fs:y,gitdir:u,ref:_,object:b,checkout:E=!1,force:T=!1}){if(!zr(_))throw new ot(_,o.clean(_));const F=`refs/heads/${_}`;if(!T&&await me.exists({fs:y,gitdir:u,ref:F}))throw new ze("branch",_,!1);let z;try{z=await me.resolve({fs:y,gitdir:u,ref:b||"HEAD"})}catch{}z&&await me.writeRef({fs:y,gitdir:u,ref:F,value:z}),E&&await me.writeSymbolicRef({fs:y,gitdir:u,ref:"HEAD",value:F})}async function Gs({fs:y,dir:u,gitdir:_=fe(u,".git"),ref:b,object:E,checkout:T=!1,force:F=!1}){try{$e("fs",y),$e("gitdir",_),$e("ref",b);const z=new Bt(y),se=await Ot({fsp:z,dotgit:_});return await Jn({fs:z,gitdir:se,ref:b,object:E,checkout:T,force:F})}catch(z){throw z.caller="git.branch",z}}const Ks=(y,u)=>y==="."||u==null||u.length===0||u==="."?!0:u.length>=y.length?u.startsWith(y):y.startsWith(u);async function ps({fs:y,cache:u,onProgress:_,onPostCheckout:b,dir:E,gitdir:T,remote:F,ref:z,filepaths:se,noCheckout:ae,noUpdateHead:re,dryRun:ue,force:de,track:Ee=!0,nonBlocking:Te=!1,batchSize:Ne=100}){let Fe;if(b)try{Fe=await me.resolve({fs:y,gitdir:T,ref:"HEAD"})}catch{Fe="0000000000000000000000000000000000000000"}let Ge;try{Ge=await me.resolve({fs:y,gitdir:T,ref:z})}catch(Je){if(z==="HEAD")throw Je;const ct=`${F}/${z}`;if(Ge=await me.resolve({fs:y,gitdir:T,ref:ct}),Ee){const Ct=await _e.get({fs:y,gitdir:T});await Ct.set(`branch.${z}.remote`,F),await Ct.set(`branch.${z}.merge`,`refs/heads/${z}`),await _e.save({fs:y,gitdir:T,config:Ct})}await me.writeRef({fs:y,gitdir:T,ref:`refs/heads/${z}`,value:Ge})}if(!ae){let Je;try{Je=await Yn({fs:y,cache:u,onProgress:_,dir:E,gitdir:T,ref:z,force:de,filepaths:se})}catch(tt){throw tt instanceof ce&&tt.data.what===Ge?new _t(z,Ge):tt}const ct=Je.filter(([tt])=>tt==="conflict").map(([tt,it])=>it);if(ct.length>0)throw new ft(ct);const Ct=Je.filter(([tt])=>tt==="error").map(([tt,it])=>it);if(Ct.length>0)throw new f(Ct.join(", "));if(ue){b&&await b({previousHead:Fe,newHead:Ge,type:se!=null&&se.length>0?"file":"branch"});return}let Rt=0;const $t=Je.length;if(await q.acquire({fs:y,gitdir:T,cache:u},async function(tt){await Promise.all(Je.filter(([it])=>it==="delete"||it==="delete-index").map(async function([it,ut]){const Ut=`${E}/${ut}`;it==="delete"&&await y.rm(Ut),tt.delete({filepath:ut}),_&&await _({phase:"Updating workdir",loaded:++Rt,total:$t})}))}),await q.acquire({fs:y,gitdir:T,cache:u},async function(tt){for(const[it,ut]of Je)if(it==="rmdir"||it==="rmdir-index"){const Ut=`${E}/${ut}`;try{it==="rmdir"&&await y.rmdir(Ut),tt.delete({filepath:ut}),_&&await _({phase:"Updating workdir",loaded:++Rt,total:$t})}catch(Wt){if(Wt.code==="ENOTEMPTY")console.log(`Did not delete ${ut} because directory is not empty`);else throw Wt}}}),await Promise.all(Je.filter(([tt])=>tt==="mkdir"||tt==="mkdir-index").map(async function([tt,it]){const ut=`${E}/${it}`;await y.mkdir(ut),_&&await _({phase:"Updating workdir",loaded:++Rt,total:$t})})),Te){const tt=Je.filter(([ut])=>ut==="create"||ut==="create-index"||ut==="update"||ut==="mkdir-index"),it=await Vs("Update Working Dir",tt.map(([ut,Ut,Wt,sr,Jt])=>()=>Xn({fs:y,cache:u,gitdir:T,dir:E},[ut,Ut,Wt,sr,Jt])),_,Ne);await q.acquire({fs:y,gitdir:T,cache:u,allowUnmerged:!0},async function(ut){await Vs("Update Index",it.map(([Ut,Wt,sr])=>()=>Zn({index:ut,fullpath:Ut,oid:Wt,stats:sr})),_,Ne)})}else await q.acquire({fs:y,gitdir:T,cache:u,allowUnmerged:!0},async function(tt){await Promise.all(Je.filter(([it])=>it==="create"||it==="create-index"||it==="update"||it==="mkdir-index").map(async function([it,ut,Ut,Wt,sr]){const Jt=`${E}/${ut}`;try{if(it!=="create-index"&&it!=="mkdir-index"){const{object:or}=await Ie({fs:y,cache:u,gitdir:T,oid:Ut});if(sr&&await y.rm(Jt),Wt===33188)await y.write(Jt,or);else if(Wt===33261)await y.write(Jt,or,{mode:511});else if(Wt===40960)await y.writelink(Jt,or);else throw new f(`Invalid mode 0o${Wt.toString(8)} detected in blob ${Ut}`)}const ir=await y.lstat(Jt);Wt===33261&&(ir.mode=493),it==="mkdir-index"&&(ir.mode=57344),tt.insert({filepath:ut,stats:ir,oid:Ut}),_&&await _({phase:"Updating workdir",loaded:++Rt,total:$t})}catch(ir){console.log(ir)}}))});b&&await b({previousHead:Fe,newHead:Ge,type:se!=null&&se.length>0?"file":"branch"})}if(!re){const Je=await me.expand({fs:y,gitdir:T,ref:z});Je.startsWith("refs/heads")?await me.writeSymbolicRef({fs:y,gitdir:T,ref:"HEAD",value:Je}):await me.writeRef({fs:y,gitdir:T,ref:"HEAD",value:Ge})}}async function Yn({fs:y,cache:u,onProgress:_,dir:b,gitdir:E,ref:T,force:F,filepaths:z}){let se=0;return kr({fs:y,cache:u,dir:b,gitdir:E,trees:[_r({ref:T}),Dr(),pe()],map:async function(ae,[re,ue,de]){if(ae===".")return;if(z&&!z.some(Te=>Ks(ae,Te)))return null;switch(_&&await _({phase:"Analyzing workdir",loaded:++se}),[!!de,!!re,!!ue].map(Number).join("")){case"000":return;case"001":return F&&z&&z.includes(ae)?["delete",ae]:void 0;case"010":switch(await re.type()){case"tree":return["mkdir",ae];case"blob":return["create",ae,await re.oid(),await re.mode()];case"commit":return["mkdir-index",ae,await re.oid(),await re.mode()];default:return["error",`new entry Unhandled type ${await re.type()}`]}case"011":switch(`${await re.type()}-${await ue.type()}`){case"tree-tree":return;case"tree-blob":case"blob-tree":return["conflict",ae];case"blob-blob":return await re.oid()!==await ue.oid()?F?["update",ae,await re.oid(),await re.mode(),await re.mode()!==await ue.mode()]:["conflict",ae]:await re.mode()!==await ue.mode()?F?["update",ae,await re.oid(),await re.mode(),!0]:["conflict",ae]:["create-index",ae,await re.oid(),await re.mode()];case"commit-tree":return;case"commit-blob":return["conflict",ae];default:return["error",`new entry Unhandled type ${re.type}`]}case"100":return["delete-index",ae];case"101":switch(await de.type()){case"tree":return["rmdir-index",ae];case"blob":return await de.oid()!==await ue.oid()?F?["delete",ae]:["conflict",ae]:["delete",ae];case"commit":return["rmdir-index",ae];default:return["error",`delete entry Unhandled type ${await de.type()}`]}case"110":case"111":switch(`${await de.type()}-${await re.type()}`){case"tree-tree":return;case"blob-blob":{if(await de.oid()===await re.oid()&&await de.mode()===await re.mode()&&!F)return;if(ue){if(await ue.oid()!==await de.oid()&&await ue.oid()!==await re.oid())return F?["update",ae,await re.oid(),await re.mode(),await re.mode()!==await ue.mode()]:["conflict",ae]}else if(F)return["update",ae,await re.oid(),await re.mode(),await re.mode()!==await de.mode()];return await re.mode()!==await de.mode()?["update",ae,await re.oid(),await re.mode(),!0]:await re.oid()!==await de.oid()?["update",ae,await re.oid(),await re.mode(),!1]:void 0}case"tree-blob":return["update-dir-to-blob",ae,await re.oid()];case"blob-tree":return["update-blob-to-tree",ae];case"commit-commit":return["mkdir-index",ae,await re.oid(),await re.mode()];default:return["error",`update entry Unhandled type ${await de.type()}-${await re.type()}`]}}},reduce:async function(ae,re){return re=$s(re),ae?ae&&ae[0]==="rmdir"?(re.push(ae),re):(re.unshift(ae),re):re}})}async function Zn({index:y,fullpath:u,stats:_,oid:b}){try{y.insert({filepath:u,stats:_,oid:b})}catch(E){console.warn(`Error inserting ${u} into index:`,E)}}async function Xn({fs:y,cache:u,gitdir:_,dir:b},[E,T,F,z,se]){const ae=`${b}/${T}`;if(E!=="create-index"&&E!=="mkdir-index"){const{object:ue}=await Ie({fs:y,cache:u,gitdir:_,oid:F});if(se&&await y.rm(ae),z===33188)await y.write(ae,ue);else if(z===33261)await y.write(ae,ue,{mode:511});else if(z===40960)await y.writelink(ae,ue);else throw new f(`Invalid mode 0o${z.toString(8)} detected in blob ${F}`)}const re=await y.lstat(ae);return z===33261&&(re.mode=493),E==="mkdir-index"&&(re.mode=57344),[T,F,re]}async function Vs(y,u,_,b){const E=[];try{for(let T=0;T<u.length;T+=b){const F=u.slice(T,T+b).map(se=>se());(await Promise.allSettled(F)).forEach(se=>{se.status==="fulfilled"&&E.push(se.value)}),_&&await _({phase:"Updating workdir",loaded:T+F.length,total:u.length})}return E}catch(T){console.error(`Error during ${y}: ${T}`)}return E}async function ms({fs:y,onProgress:u,onPostCheckout:_,dir:b,gitdir:E=fe(b,".git"),remote:T="origin",ref:F,filepaths:z,noCheckout:se=!1,noUpdateHead:ae=F===void 0,dryRun:re=!1,force:ue=!1,track:de=!0,cache:Ee={},nonBlocking:Te=!1,batchSize:Ne=100}){try{$e("fs",y),$e("dir",b),$e("gitdir",E);const Fe=F||"HEAD",Ge=new Bt(y),Je=await Ot({fsp:Ge,dotgit:E});return await ps({fs:Ge,cache:Ee,onProgress:u,onPostCheckout:_,dir:b,gitdir:Je,remote:T,ref:Fe,filepaths:z,noCheckout:se,noUpdateHead:ae,dryRun:re,force:ue,track:de,nonBlocking:Te,batchSize:Ne})}catch(Fe){throw Fe.caller="git.checkout",Fe}}const Qn=/^refs\/(heads\/|tags\/|remotes\/)?(.*)/;function $r(y){const u=Qn.exec(y);return u?u[1]==="remotes/"&&y.endsWith("/HEAD")?u[2].slice(0,-5):u[2]:y}async function Rr({fs:y,gitdir:u,fullname:_=!1,test:b=!1}){const E=await me.resolve({fs:y,gitdir:u,ref:"HEAD",depth:2});if(b)try{await me.resolve({fs:y,gitdir:u,ref:E})}catch{return}if(E.startsWith("refs/"))return _?E:$r(E)}function eo(y){return y=y.replace(/^git@([^:]+):/,"https://$1/"),y=y.replace(/^ssh:\/\//,"https://"),y}function Js({username:y="",password:u=""}){return`Basic ${Buffer.from(`${y}:${u}`).toString("base64")}`}async function Gr(y,u){const _=Et(y);for(;;){const{value:b,done:E}=await _.next();if(b&&await u(b),E)break}_.return&&_.return()}async function es(y){let u=0;const _=[];await Gr(y,T=>{_.push(T),u+=T.byteLength});const b=new Uint8Array(u);let E=0;for(const T of _)b.set(T,E),E+=T.byteLength;return b}function Ys(y){let u=y.match(/^https?:\/\/([^/]+)@/);if(u==null)return{url:y,auth:{}};u=u[1];const[_,b]=u.split(":");return y=y.replace(`${u}@`,""),{url:y,auth:{username:_,password:b}}}function gs(y,u){const _=u.toString(16);return"0".repeat(y-_.length)+_}class er{static flush(){return Buffer.from("0000","utf8")}static delim(){return Buffer.from("0001","utf8")}static encode(u){typeof u=="string"&&(u=Buffer.from(u));const _=u.length+4,b=gs(4,_);return Buffer.concat([Buffer.from(b,"utf8"),u])}static streamReader(u){const _=new St(u);return async function(){try{let E=await _.read(4);if(E==null)return!0;if(E=parseInt(E.toString("utf8"),16),E===0||E===1)return null;const T=await _.read(E-4);return T??!0}catch(E){return u.error=E,!0}}}}async function Zs(y){const u={};let _;for(;_=await y(),_!==!0;){if(_===null)continue;_=_.toString("utf8").replace(/\n$/,"");const b=_.indexOf("=");if(b>-1){const E=_.slice(0,b),T=_.slice(b+1);u[E]=T}else u[_]=!0}return{protocolVersion:2,capabilities2:u}}async function Xs(y,{service:u}){const _=new Set,b=new Map,E=new Map,T=er.streamReader(y);let F=await T();for(;F===null;)F=await T();if(F===!0)throw new Ve;if(F.includes("version 2"))return Zs(T);if(F.toString("utf8").replace(/\n$/,"")!==`# service=${u}`)throw new jt(`# service=${u}\\n`,F.toString("utf8"));let z=await T();for(;z===null;)z=await T();if(z===!0)return{capabilities:_,refs:b,symrefs:E};if(z=z.toString("utf8"),z.includes("version 2"))return Zs(T);const[se,ae]=_s(z,"\0","\\x00");if(ae.split(" ").map(re=>_.add(re)),se!=="0000000000000000000000000000000000000000 capabilities^{}"){const[re,ue]=_s(se," "," ");for(b.set(ue,re);;){const de=await T();if(de===!0)break;if(de!==null){const[Ee,Te]=_s(de.toString("utf8")," "," ");b.set(Te,Ee)}}}for(const re of _)if(re.startsWith("symref=")){const ue=re.match(/symref=([^:]+):(.*)/);ue.length===3&&E.set(ue[1],ue[2])}return{protocolVersion:1,capabilities:_,refs:b,symrefs:E}}function _s(y,u,_){const b=y.trim().split(u);if(b.length!==2)throw new jt(`Two strings separated by '${_}'`,y.toString("utf8"));return b}const Qs=(y,u)=>y.endsWith("?")?`${y}${u}`:`${y}/${u.replace(/^https?:\/\//,"")}`,ei=(y,u)=>{(u.username||u.password)&&(y.Authorization=Js(u)),u.headers&&Object.assign(y,u.headers)},ws=async y=>{try{const u=Buffer.from(await es(y.body)),_=u.toString("utf8");return{preview:_.length<256?_:_.slice(0,256)+"...",response:_,data:u}}catch{return{}}};class ts{static async capabilities(){return["discover","connect"]}static async discover({http:u,onProgress:_,onAuth:b,onAuthSuccess:E,onAuthFailure:T,corsProxy:F,service:z,url:se,headers:ae,protocolVersion:re}){let{url:ue,auth:de}=Ys(se);const Ee=F?Qs(F,ue):ue;(de.username||de.password)&&(ae.Authorization=Js(de)),re===2&&(ae["Git-Protocol"]="version=2");let Te,Ne,Fe=!1;do if(Te=await u.request({onProgress:_,method:"GET",url:`${Ee}/info/refs?service=${z}`,headers:ae}),Ne=!1,Te.statusCode===401||Te.statusCode===203){const Ge=Fe?T:b;if(Ge){if(de=await Ge(ue,{...de,headers:{...ae}}),de&&de.cancel)throw new rr;de&&(ei(ae,de),Fe=!0,Ne=!0)}}else Te.statusCode===200&&Fe&&E&&await E(ue,de);while(Ne);if(Te.statusCode!==200){const{response:Ge}=await ws(Te);throw new Ce(Te.statusCode,Te.statusMessage,Ge)}if(Te.headers["content-type"]===`application/x-${z}-advertisement`){const Ge=await Xs(Te.body,{service:z});return Ge.auth=de,Ge}else{const{preview:Ge,response:Je,data:ct}=await ws(Te);try{const Ct=await Xs([ct],{service:z});return Ct.auth=de,Ct}catch{throw new hr(Ge,Je)}}}static async connect({http:u,onProgress:_,corsProxy:b,service:E,url:T,auth:F,body:z,headers:se}){const ae=Ys(T);ae&&(T=ae.url),b&&(T=Qs(b,T)),se["content-type"]=`application/x-${E}-request`,se.accept=`application/x-${E}-result`,ei(se,F);const re=await u.request({onProgress:_,method:"POST",url:`${T}/${E}`,body:z,headers:se});if(re.statusCode!==200){const{response:ue}=ws(re);throw new Ce(re.statusCode,re.statusMessage,ue)}return re}}class rs{static getRemoteHelperFor({url:u}){const _=new Map;_.set("http",ts),_.set("https",ts);const b=to({url:u});if(!b)throw new ur(u);if(_.has(b.transport))return _.get(b.transport);throw new Tt(u,b.transport,b.transport==="ssh"?eo(u):void 0)}}function to({url:y}){if(y.startsWith("git@"))return{transport:"ssh",address:y};const u=y.match(/(\w+)(:\/\/|::)(.*)/);if(u!==null){if(u[2]==="://")return{transport:u[1],address:u[0]};if(u[2]==="::")return{transport:u[1],address:u[3]}}}let Tr=null;class Kr{static async read({fs:u,gitdir:_}){Tr===null&&(Tr=new e);const b=fe(_,"shallow"),E=new Set;return await Tr.acquire(b,async function(){const T=await u.read(b,{encoding:"utf8"});if(T===null||T.trim()==="")return E;T.trim().split(`
`).map(F=>E.add(F))}),E}static async write({fs:u,gitdir:_,oids:b}){Tr===null&&(Tr=new e);const E=fe(_,"shallow");if(b.size>0){const T=[...b].join(`
`)+`
`;await Tr.acquire(E,async function(){await u.write(E,T,{encoding:"utf8"})})}else await Tr.acquire(E,async function(){await u.rm(E)})}}async function ro({fs:y,gitdir:u,oid:_}){const b=`objects/${_.slice(0,2)}/${_.slice(2)}`;return y.exists(`${u}/${b}`)}async function so({fs:y,cache:u,gitdir:_,oid:b,getExternalRefDelta:E}){let T=await y.readdir(fe(_,"objects/pack"));T=T.filter(F=>F.endsWith(".idx"));for(const F of T){const z=`${_}/objects/pack/${F}`,se=await nt({fs:y,cache:u,filename:z,getExternalRefDelta:E});if(se.error)throw new f(se.error);if(se.offsets.has(b))return!0}return!1}async function ti({fs:y,cache:u,gitdir:_,oid:b,format:E="content"}){const T=z=>Ie({fs:y,cache:u,gitdir:_,oid:z});let F=await ro({fs:y,gitdir:_,oid:b});return F||(F=await so({fs:y,cache:u,gitdir:_,oid:b,getExternalRefDelta:T})),F}function io(y){const E="5041434b"+"00000002"+"00000000";return y.slice(0,12).toString("hex")===E}function ri(y,u){const _=y.map(b=>b.split("=",1)[0]);return u.filter(b=>{const E=b.split("=",1)[0];return _.includes(E)})}const ss={name:"isomorphic-git",version:"1.36.3",agent:"git/isomorphic-git@1.36.3"};class is{constructor(){this._queue=[]}write(u){if(this._ended)throw Error("You cannot write to a FIFO that has already been ended!");if(this._waiting){const _=this._waiting;this._waiting=null,_({value:u})}else this._queue.push(u)}end(){if(this._ended=!0,this._waiting){const u=this._waiting;this._waiting=null,u({done:!0})}}destroy(u){this.error=u,this.end()}async next(){if(this._queue.length>0)return{value:this._queue.shift()};if(this._ended)return{done:!0};if(this._waiting)throw Error("You cannot call read until the previous call to read has returned!");return new Promise(u=>{this._waiting=u})}}function no(y){const u=y.indexOf("\r"),_=y.indexOf(`
`);return u===-1&&_===-1?-1:u===-1?_+1:_===-1?u+1:_===u+1?_+1:Math.min(u,_)+1}function si(y){const u=new is;let _="";return(async()=>(await Gr(y,b=>{for(b=b.toString("utf8"),_+=b;;){const E=no(_);if(E===-1)break;u.write(_.slice(0,E)),_=_.slice(E)}}),_.length>0&&u.write(_),u.end()))(),u}class ii{static demux(u){const _=er.streamReader(u),b=new is,E=new is,T=new is,F=async function(){const z=await _();if(z===null)return F();if(z===!0){b.end(),T.end(),u.error?E.destroy(u.error):E.end();return}switch(z[0]){case 1:{E.write(z.slice(1));break}case 2:{T.write(z.slice(1));break}case 3:{const se=z.slice(1);T.write(se),b.end(),T.end(),E.destroy(new Error(se.toString("utf8")));return}default:b.write(z)}F()};return F(),{packetlines:b,packfile:E,progress:T}}}async function oo(y){const{packetlines:u,packfile:_,progress:b}=ii.demux(y),E=[],T=[],F=[];let z=!1,se=!1;return new Promise((ae,re)=>{Gr(u,ue=>{const de=ue.toString("utf8").trim();if(de.startsWith("shallow")){const Ee=de.slice(-41).trim();Ee.length!==40&&re(new ye(Ee)),E.push(Ee)}else if(de.startsWith("unshallow")){const Ee=de.slice(-41).trim();Ee.length!==40&&re(new ye(Ee)),T.push(Ee)}else if(de.startsWith("ACK")){const[,Ee,Te]=de.split(" ");F.push({oid:Ee,status:Te}),Te||(se=!0)}else de.startsWith("NAK")?(z=!0,se=!0):(se=!0,z=!0);se&&(y.error?re(y.error):ae({shallows:E,unshallows:T,acks:F,nak:z,packfile:_,progress:b}))}).finally(()=>{se||(y.error?re(y.error):ae({shallows:E,unshallows:T,acks:F,nak:z,packfile:_,progress:b}))})})}function ao({capabilities:y=[],wants:u=[],haves:_=[],shallows:b=[],depth:E=null,since:T=null,exclude:F=[]}){const z=[];u=[...new Set(u)];let se=` ${y.join(" ")}`;for(const ae of u)z.push(er.encode(`want ${ae}${se}
`)),se="";for(const ae of b)z.push(er.encode(`shallow ${ae}
`));E!==null&&z.push(er.encode(`deepen ${E}
`)),T!==null&&z.push(er.encode(`deepen-since ${Math.floor(T.valueOf()/1e3)}
`));for(const ae of F)z.push(er.encode(`deepen-not ${ae}
`));z.push(er.flush());for(const ae of _)z.push(er.encode(`have ${ae}
`));return z.push(er.encode(`done
`)),z}async function ys({fs:y,cache:u,http:_,onProgress:b,onMessage:E,onAuth:T,onAuthSuccess:F,onAuthFailure:z,gitdir:se,ref:ae,remoteRef:re,remote:ue,url:de,corsProxy:Ee,depth:Te=null,since:Ne=null,exclude:Fe=[],relative:Ge=!1,tags:Je=!1,singleBranch:ct=!1,headers:Ct={},prune:Rt=!1,pruneTags:$t=!1}){const tt=ae||await Rr({fs:y,gitdir:se,test:!0}),it=await _e.get({fs:y,gitdir:se}),ut=ue||tt&&await it.get(`branch.${tt}.remote`)||"origin",Ut=de||await it.get(`remote.${ut}.url`);if(typeof Ut>"u")throw new Mt("remote OR url");const Wt=re||tt&&await it.get(`branch.${tt}.merge`)||ae||"HEAD";Ee===void 0&&(Ee=await it.get("http.corsProxy"));const sr=rs.getRemoteHelperFor({url:Ut}),Jt=await sr.discover({http:_,onAuth:T,onAuthSuccess:F,onAuthFailure:z,corsProxy:Ee,service:"git-upload-pack",url:Ut,headers:Ct,protocolVersion:1}),ir=Jt.auth,or=Jt.refs;if(or.size===0)return{defaultBranch:null,fetchHead:null,fetchHeadDescription:null};if(Te!==null&&!Jt.capabilities.has("shallow"))throw new Vt("shallow","depth");if(Ne!==null&&!Jt.capabilities.has("deepen-since"))throw new Vt("deepen-since","since");if(Fe.length>0&&!Jt.capabilities.has("deepen-not"))throw new Vt("deepen-not","exclude");if(Ge===!0&&!Jt.capabilities.has("deepen-relative"))throw new Vt("deepen-relative","relative");const{oid:Ir,fullref:Br}=me.resolveAgainstMap({ref:Wt,map:or});for(const Yt of or.keys())Yt===Br||Yt==="HEAD"||Yt.startsWith("refs/heads/")||Je&&Yt.startsWith("refs/tags/")||or.delete(Yt);const Ur=ri([...Jt.capabilities],["multi_ack_detailed","no-done","side-band-64k","ofs-delta",`agent=${ss.agent}`]);Ge&&Ur.push("deepen-relative");const xs=ct?[Ir]:or.values(),ks=ct?[tt]:await me.listRefs({fs:y,gitdir:se,filepath:"refs"});let wr=[];for(let Yt of ks)try{Yt=await me.expand({fs:y,gitdir:se,ref:Yt});const ar=await me.resolve({fs:y,gitdir:se,ref:Yt});await ti({fs:y,cache:u,gitdir:se,oid:ar})&&wr.push(ar)}catch{}wr=[...new Set(wr)];const Xt=await Kr.read({fs:y,gitdir:se}),vr=Jt.capabilities.has("shallow")?[...Xt]:[],lr=ao({capabilities:Ur,wants:xs,haves:wr,shallows:vr,depth:Te,since:Ne,exclude:Fe}),Vr=Buffer.from(await es(lr)),Pr=await sr.connect({http:_,onProgress:b,corsProxy:Ee,service:"git-upload-pack",url:Ut,auth:ir,body:[Vr],headers:Ct}),nr=await oo(Pr.body);Pr.headers&&(nr.headers=Pr.headers);for(const Yt of nr.shallows)if(!Xt.has(Yt))try{const{object:ar}=await Ie({fs:y,cache:u,gitdir:se,oid:Yt}),yr=new Zt(ar),br=await Promise.all(yr.headers().parent.map(Yr=>ti({fs:y,cache:u,gitdir:se,oid:Yr})));br.length===0||br.every(Yr=>Yr)||Xt.add(Yt)}catch{Xt.add(Yt)}for(const Yt of nr.unshallows)Xt.delete(Yt);if(await Kr.write({fs:y,gitdir:se,oids:Xt}),ct){const Yt=new Map([[Br,Ir]]),ar=new Map;let yr=10,br=Br;for(;yr--;){const Rs=Jt.symrefs.get(br);if(Rs===void 0)break;ar.set(br,Rs),br=Rs}const As=or.get(br);As&&Yt.set(br,As);const{pruned:Yr}=await me.updateRemoteRefs({fs:y,gitdir:se,remote:ut,refs:Yt,symrefs:ar,tags:Je,prune:Rt});Rt&&(nr.pruned=Yr)}else{const{pruned:Yt}=await me.updateRemoteRefs({fs:y,gitdir:se,remote:ut,refs:or,symrefs:Jt.symrefs,tags:Je,prune:Rt,pruneTags:$t});Rt&&(nr.pruned=Yt)}if(nr.HEAD=Jt.symrefs.get("HEAD"),nr.HEAD===void 0){const{oid:Yt}=me.resolveAgainstMap({ref:"HEAD",map:or});for(const[ar,yr]of or.entries())if(ar!=="HEAD"&&yr===Yt){nr.HEAD=ar;break}}const Xo=Br.startsWith("refs/tags")?"tag":"branch";if(nr.FETCH_HEAD={oid:Ir,description:`${Xo} '${$r(Br)}' of ${Ut}`},b||E){const Yt=si(nr.progress);Gr(Yt,async ar=>{if(E&&await E(ar),b){const yr=ar.match(/([^:]*).*\((\d+?)\/(\d+?)\)/);yr&&await b({phase:yr[1].trim(),loaded:parseInt(yr[2],10),total:parseInt(yr[3],10)})}})}const os=Buffer.from(await es(nr.packfile));if(Pr.body.error)throw Pr.body.error;const In=os.slice(-20).toString("hex"),Jr={defaultBranch:nr.HEAD,fetchHead:nr.FETCH_HEAD.oid,fetchHeadDescription:nr.FETCH_HEAD.description};if(nr.headers&&(Jr.headers=nr.headers),Rt&&(Jr.pruned=nr.pruned),In!==""&&!io(os)){Jr.packfile=`objects/pack/pack-${In}.pack`;const Yt=fe(se,Jr.packfile);await y.write(Yt,os);const ar=br=>Ie({fs:y,cache:u,gitdir:se,oid:br}),yr=await Kt.fromPack({pack:os,getExternalRefDelta:ar,onProgress:b});await y.write(Yt.replace(/\.pack$/,".idx"),await yr.toBuffer())}return Jr}async function ni({fs:y,bare:u=!1,dir:_,gitdir:b=u?_:fe(_,".git"),defaultBranch:E="master"}){if(await y.exists(b+"/config"))return;let T=["hooks","info","objects/info","objects/pack","refs/heads","refs/tags"];T=T.map(F=>b+"/"+F);for(const F of T)await y.mkdir(F);await y.write(b+"/config",`[core]
	repositoryformatversion = 0
	filemode = false
	bare = ${u}
`+(u?"":`	logallrefupdates = true
`)+`	symlinks = false
	ignorecase = true
`),await y.write(b+"/HEAD",`ref: refs/heads/${E}
`)}async function co({fs:y,cache:u,http:_,onProgress:b,onMessage:E,onAuth:T,onAuthSuccess:F,onAuthFailure:z,onPostCheckout:se,dir:ae,gitdir:re,url:ue,corsProxy:de,ref:Ee,remote:Te,depth:Ne,since:Fe,exclude:Ge,relative:Je,singleBranch:ct,noCheckout:Ct,noTags:Rt,headers:$t,nonBlocking:tt,batchSize:it=100}){try{if(await ni({fs:y,gitdir:re}),await qs({fs:y,gitdir:re,remote:Te,url:ue,force:!1}),de){const Wt=await _e.get({fs:y,gitdir:re});await Wt.set("http.corsProxy",de),await _e.save({fs:y,gitdir:re,config:Wt})}const{defaultBranch:ut,fetchHead:Ut}=await ys({fs:y,cache:u,http:_,onProgress:b,onMessage:E,onAuth:T,onAuthSuccess:F,onAuthFailure:z,gitdir:re,ref:Ee,remote:Te,corsProxy:de,depth:Ne,since:Fe,exclude:Ge,relative:Je,singleBranch:ct,headers:$t,tags:!Rt});if(Ut===null)return;Ee=Ee||ut,Ee=Ee.replace("refs/heads/",""),await ps({fs:y,cache:u,onProgress:b,onPostCheckout:se,dir:ae,gitdir:re,ref:Ee,remote:Te,noCheckout:Ct,nonBlocking:tt,batchSize:it})}catch(ut){throw await y.rmdir(re,{recursive:!0,maxRetries:10}).catch(()=>{}),ut}}async function oi({fs:y,http:u,onProgress:_,onMessage:b,onAuth:E,onAuthSuccess:T,onAuthFailure:F,onPostCheckout:z,dir:se,gitdir:ae=fe(se,".git"),url:re,corsProxy:ue=void 0,ref:de=void 0,remote:Ee="origin",depth:Te=void 0,since:Ne=void 0,exclude:Fe=[],relative:Ge=!1,singleBranch:Je=!1,noCheckout:ct=!1,noTags:Ct=!1,headers:Rt={},cache:$t={},nonBlocking:tt=!1,batchSize:it=100}){try{$e("fs",y),$e("http",u),$e("gitdir",ae),ct||$e("dir",se),$e("url",re);const ut=new Bt(y),Ut=await Ot({fsp:ut,dotgit:ae});return await co({fs:ut,cache:$t,http:u,onProgress:_,onMessage:b,onAuth:E,onAuthSuccess:T,onAuthFailure:F,onPostCheckout:z,dir:se,gitdir:Ut,url:re,corsProxy:ue,ref:de,remote:Ee,depth:Te,since:Ne,exclude:Fe,relative:Ge,singleBranch:Je,noCheckout:ct,noTags:Ct,headers:Rt,nonBlocking:tt,batchSize:it})}catch(ut){throw ut.caller="git.clone",ut}}async function ai({fs:y,onSign:u,dir:_,gitdir:b=fe(_,".git"),message:E,author:T,committer:F,signingKey:z,amend:se=!1,dryRun:ae=!1,noUpdateBranch:re=!1,ref:ue,parent:de,tree:Ee,cache:Te={}}){try{$e("fs",y),se||$e("message",E),z&&$e("onSign",u);const Ne=new Bt(y),Fe=await Ot({fsp:Ne,dotgit:b});return await Qr({fs:Ne,cache:Te,onSign:u,gitdir:Fe,message:E,author:T,committer:F,signingKey:z,amend:se,dryRun:ae,noUpdateBranch:re,ref:ue,parent:de,tree:Ee})}catch(Ne){throw Ne.caller="git.commit",Ne}}async function ci({fs:y,dir:u,gitdir:_=fe(u,".git"),fullname:b=!1,test:E=!1}){try{$e("fs",y),$e("gitdir",_);const T=new Bt(y),F=await Ot({fsp:T,dotgit:_});return await Rr({fs:T,gitdir:F,fullname:b,test:E})}catch(T){throw T.caller="git.currentBranch",T}}async function lo({fs:y,gitdir:u,ref:_}){if(_=_.startsWith("refs/heads/")?_:`refs/heads/${_}`,!await me.exists({fs:y,gitdir:u,ref:_}))throw new ce(_);const E=await me.expand({fs:y,gitdir:u,ref:_}),T=await Rr({fs:y,gitdir:u,fullname:!0});if(E===T){const se=await me.resolve({fs:y,gitdir:u,ref:E});await me.writeRef({fs:y,gitdir:u,ref:"HEAD",value:se})}await me.deleteRef({fs:y,gitdir:u,ref:E});const F=$r(_),z=await _e.get({fs:y,gitdir:u});await z.deleteSection("branch",F),await _e.save({fs:y,gitdir:u,config:z})}async function li({fs:y,dir:u,gitdir:_=fe(u,".git"),ref:b}){try{$e("fs",y),$e("ref",b);const E=new Bt(y),T=await Ot({fsp:E,dotgit:_});return await lo({fs:E,gitdir:T,ref:b})}catch(E){throw E.caller="git.deleteBranch",E}}async function hi({fs:y,dir:u,gitdir:_=fe(u,".git"),ref:b}){try{$e("fs",y),$e("ref",b);const E=new Bt(y),T=await Ot({fsp:E,dotgit:_});await me.deleteRef({fs:E,gitdir:T,ref:b})}catch(E){throw E.caller="git.deleteRef",E}}async function ho({fs:y,gitdir:u,remote:_}){const b=await _e.get({fs:y,gitdir:u});await b.deleteSection("remote",_),await _e.save({fs:y,gitdir:u,config:b})}async function ui({fs:y,dir:u,gitdir:_=fe(u,".git"),remote:b}){try{$e("fs",y),$e("remote",b);const E=new Bt(y),T=await Ot({fsp:E,dotgit:_});return await ho({fs:E,gitdir:T,remote:b})}catch(E){throw E.caller="git.deleteRemote",E}}async function uo({fs:y,gitdir:u,ref:_}){_=_.startsWith("refs/tags/")?_:`refs/tags/${_}`,await me.deleteRef({fs:y,gitdir:u,ref:_})}async function di({fs:y,dir:u,gitdir:_=fe(u,".git"),ref:b}){try{$e("fs",y),$e("ref",b);const E=new Bt(y),T=await Ot({fsp:E,dotgit:_});return await uo({fs:E,gitdir:T,ref:b})}catch(E){throw E.caller="git.deleteTag",E}}async function fo({fs:y,gitdir:u,oid:_}){const b=_.slice(0,2);return(await y.readdir(`${u}/objects/${b}`)).map(T=>`${b}${T}`).filter(T=>T.startsWith(_))}async function po({fs:y,cache:u,gitdir:_,oid:b,getExternalRefDelta:E}){const T=[];let F=await y.readdir(fe(_,"objects/pack"));F=F.filter(z=>z.endsWith(".idx"));for(const z of F){const se=`${_}/objects/pack/${z}`,ae=await nt({fs:y,cache:u,filename:se,getExternalRefDelta:E});if(ae.error)throw new f(ae.error);for(const re of ae.offsets.keys())re.startsWith(b)&&T.push(re)}return T}async function mo({fs:y,cache:u,gitdir:_,oid:b}){const E=z=>Ie({fs:y,cache:u,gitdir:_,oid:z}),T=await fo({fs:y,gitdir:_,oid:b}),F=await po({fs:y,cache:u,gitdir:_,oid:b,getExternalRefDelta:E});for(const z of F)T.indexOf(z)===-1&&T.push(z);if(T.length===1)return T[0];throw T.length>1?new Xe("oids",b,T):new ce(`an object matching "${b}"`)}async function pi({fs:y,dir:u,gitdir:_=fe(u,".git"),oid:b,cache:E={}}){try{$e("fs",y),$e("gitdir",_),$e("oid",b);const T=new Bt(y),F=await Ot({fsp:T,dotgit:_});return await mo({fs:T,cache:E,gitdir:F,oid:b})}catch(T){throw T.caller="git.expandOid",T}}async function mi({fs:y,dir:u,gitdir:_=fe(u,".git"),ref:b}){try{$e("fs",y),$e("gitdir",_),$e("ref",b);const E=new Bt(y),T=await Ot({fsp:E,dotgit:_});return await me.expand({fs:E,gitdir:T,ref:b})}catch(E){throw E.caller="git.expandRef",E}}async function vs({fs:y,cache:u,gitdir:_,oids:b}){const E={},T=b.length;let F=b.map((z,se)=>({index:se,oid:z}));for(;F.length;){const z=new Set;for(const{oid:ae,index:re}of F)E[ae]||(E[ae]=new Set),E[ae].add(re),E[ae].size===T&&z.add(ae);if(z.size>0)return[...z];const se=new Map;for(const{oid:ae,index:re}of F)try{const{object:ue}=await Ie({fs:y,cache:u,gitdir:_,oid:ae}),de=Zt.from(ue),{parent:Ee}=de.parseHeaders();for(const Te of Ee)(!E[Te]||!E[Te].has(re))&&se.set(Te+":"+re,{oid:Te,index:re})}catch{}F=Array.from(se.values())}return[]}const bs=/^.*(\r?\n|$)/gm;function go({branches:y,contents:u}){const _=y[1],b=y[2],E=u[0],T=u[1],F=u[2],z=T.match(bs),se=E.match(bs),ae=F.match(bs),re=a(z,se,ae),ue=7;let de="",Ee=!0;for(const Te of re)Te.ok&&(de+=Te.ok.join("")),Te.conflict&&(Ee=!1,de+=`${"<".repeat(ue)} ${_}
`,de+=Te.conflict.a.join(""),de+=`${"=".repeat(ue)}
`,de+=Te.conflict.b.join(""),de+=`${">".repeat(ue)} ${b}
`);return{cleanMerge:Ee,mergedText:de}}async function _o({fs:y,cache:u,dir:_,gitdir:b=fe(_,".git"),index:E,ourOid:T,baseOid:F,theirOid:z,ourName:se="ours",baseName:ae="base",theirName:re="theirs",dryRun:ue=!1,abortOnConflict:de=!0,mergeDriver:Ee}){const Te=_r({ref:T}),Ne=_r({ref:F}),Fe=_r({ref:z}),Ge=[],Je=[],ct=[],Ct=[],Rt=await kr({fs:y,cache:u,dir:_,gitdir:b,trees:[Te,Ne,Fe],map:async function($t,[tt,it,ut]){const Ut=j($t),Wt=await Xr(tt,it),sr=await Xr(ut,it);switch(`${Wt}-${sr}`){case"false-false":return{mode:await it.mode(),path:Ut,oid:await it.oid(),type:await it.type()};case"false-true":return!ut&&await tt.type()==="tree"?{mode:await tt.mode(),path:Ut,oid:await tt.oid(),type:await tt.type()}:ut?{mode:await ut.mode(),path:Ut,oid:await ut.oid(),type:await ut.type()}:void 0;case"true-false":return!tt&&await ut.type()==="tree"?{mode:await ut.mode(),path:Ut,oid:await ut.oid(),type:await ut.type()}:tt?{mode:await tt.mode(),path:Ut,oid:await tt.oid(),type:await tt.type()}:void 0;case"true-true":{if(tt&&ut&&await tt.type()==="tree"&&await ut.type()==="tree")return{mode:await tt.mode(),path:Ut,oid:await tt.oid(),type:"tree"};if(tt&&ut&&await tt.type()==="blob"&&await ut.type()==="blob")return wo({fs:y,gitdir:b,path:Ut,ours:tt,base:it,theirs:ut,ourName:se,baseName:ae,theirName:re,mergeDriver:Ee}).then(async Jt=>{if(Jt.cleanMerge)de||E.insert({filepath:$t,oid:Jt.mergeResult.oid,stage:0});else if(Ge.push($t),Je.push($t),!de){let ir="";it&&await it.type()==="blob"&&(ir=await it.oid());const or=await tt.oid(),Ir=await ut.oid();E.delete({filepath:$t}),ir&&E.insert({filepath:$t,oid:ir,stage:1}),E.insert({filepath:$t,oid:or,stage:2}),E.insert({filepath:$t,oid:Ir,stage:3})}return Jt.mergeResult});if(it&&!tt&&ut&&await it.type()==="blob"&&await ut.type()==="blob"){if(Ge.push($t),ct.push($t),!de){const Jt=await it.oid(),ir=await ut.oid();E.delete({filepath:$t}),E.insert({filepath:$t,oid:Jt,stage:1}),E.insert({filepath:$t,oid:ir,stage:3})}return{mode:await ut.mode(),oid:await ut.oid(),type:"blob",path:Ut}}if(it&&tt&&!ut&&await it.type()==="blob"&&await tt.type()==="blob"){if(Ge.push($t),Ct.push($t),!de){const Jt=await it.oid(),ir=await tt.oid();E.delete({filepath:$t}),E.insert({filepath:$t,oid:Jt,stage:1}),E.insert({filepath:$t,oid:ir,stage:2})}return{mode:await tt.mode(),oid:await tt.oid(),type:"blob",path:Ut}}if(it&&!tt&&!ut&&(await it.type()==="blob"||await it.type()==="tree"))return;throw new Pt}}},reduce:Ge.length!==0&&(!_||de)?void 0:async($t,tt)=>{const it=tt.filter(Boolean);if($t&&!($t&&$t.type==="tree"&&it.length===0&&$t.path!==".")){if(it.length>0||$t.path==="."&&it.length===0){const Ut=new M(it).toObject(),Wt=await gr({fs:y,gitdir:b,type:"tree",object:Ut,dryRun:ue});$t.oid=Wt}return $t}}});return Ge.length!==0?(_&&!de&&await kr({fs:y,cache:u,dir:_,gitdir:b,trees:[_r({ref:Rt.oid})],map:async function($t,[tt]){const it=`${_}/${$t}`;if(await tt.type()==="blob"){const ut=await tt.mode(),Ut=new TextDecoder().decode(await tt.content());await y.write(it,Ut,{mode:ut})}return!0}}),new zt(Ge,Je,ct,Ct)):Rt.oid}async function wo({fs:y,gitdir:u,path:_,ours:b,base:E,theirs:T,ourName:F,theirName:z,baseName:se,dryRun:ae,mergeDriver:re=go}){const ue="blob";let de="100755",Ee="",Te="";E&&await E.type()==="blob"&&(de=await E.mode(),Ee=await E.oid(),Te=Buffer.from(await E.content()).toString("utf8"));const Ne=de===await b.mode()?await T.mode():await b.mode();if(await b.oid()===await T.oid())return{cleanMerge:!0,mergeResult:{mode:Ne,path:_,oid:await b.oid(),type:ue}};if(await b.oid()===Ee)return{cleanMerge:!0,mergeResult:{mode:Ne,path:_,oid:await T.oid(),type:ue}};if(await T.oid()===Ee)return{cleanMerge:!0,mergeResult:{mode:Ne,path:_,oid:await b.oid(),type:ue}};const Fe=Buffer.from(await b.content()).toString("utf8"),Ge=Buffer.from(await T.content()).toString("utf8"),{mergedText:Je,cleanMerge:ct}=await re({branches:[se,F,z],contents:[Te,Fe,Ge],path:_}),Ct=await gr({fs:y,gitdir:u,type:"blob",object:Buffer.from(Je,"utf8"),dryRun:ae});return{cleanMerge:ct,mergeResult:{mode:Ne,path:_,oid:Ct,type:ue}}}async function gi({fs:y,cache:u,dir:_,gitdir:b,ours:E,theirs:T,fastForward:F=!0,fastForwardOnly:z=!1,dryRun:se=!1,noUpdateBranch:ae=!1,abortOnConflict:re=!0,message:ue,author:de,committer:Ee,signingKey:Te,onSign:Ne,mergeDriver:Fe,allowUnrelatedHistories:Ge=!1}){E===void 0&&(E=await Rr({fs:y,gitdir:b,fullname:!0})),E=await me.expand({fs:y,gitdir:b,ref:E}),T=await me.expand({fs:y,gitdir:b,ref:T});const Je=await me.resolve({fs:y,gitdir:b,ref:E}),ct=await me.resolve({fs:y,gitdir:b,ref:T}),Ct=await vs({fs:y,cache:u,gitdir:b,oids:[Je,ct]});if(Ct.length!==1)if(Ct.length===0&&Ge)Ct.push("4b825dc642cb6eb9a060e54bf8d69288fbee4904");else throw new Pt;const Rt=Ct[0];if(Rt===ct)return{oid:Je,alreadyMerged:!0};if(F&&Rt===Je)return!se&&!ae&&await me.writeRef({fs:y,gitdir:b,ref:E,value:ct}),{oid:ct,fastForward:!0};{if(z)throw new et;const $t=await q.acquire({fs:y,gitdir:b,cache:u,allowUnmerged:!1},async it=>_o({fs:y,cache:u,dir:_,gitdir:b,index:it,ourOid:Je,theirOid:ct,baseOid:Rt,ourName:$r(E),baseName:"base",theirName:$r(T),dryRun:se,abortOnConflict:re,mergeDriver:Fe}));if($t instanceof zt)throw $t;return ue||(ue=`Merge branch '${$r(T)}' into ${$r(E)}`),{oid:await Qr({fs:y,cache:u,gitdir:b,message:ue,ref:E,tree:$t,parent:[Je,ct],author:de,committer:Ee,signingKey:Te,onSign:Ne,dryRun:se,noUpdateBranch:ae}),tree:$t,mergeCommit:!0}}}async function _i({fs:y,cache:u,http:_,onProgress:b,onMessage:E,onAuth:T,onAuthSuccess:F,onAuthFailure:z,dir:se,gitdir:ae,ref:re,url:ue,remote:de,remoteRef:Ee,prune:Te,pruneTags:Ne,fastForward:Fe,fastForwardOnly:Ge,corsProxy:Je,singleBranch:ct,headers:Ct,author:Rt,committer:$t,signingKey:tt}){try{if(!re){const Ut=await Rr({fs:y,gitdir:ae});if(!Ut)throw new Mt("ref");re=Ut}const{fetchHead:it,fetchHeadDescription:ut}=await ys({fs:y,cache:u,http:_,onProgress:b,onMessage:E,onAuth:T,onAuthSuccess:F,onAuthFailure:z,gitdir:ae,corsProxy:Je,ref:re,url:ue,remote:de,remoteRef:Ee,singleBranch:ct,headers:Ct,prune:Te,pruneTags:Ne});await gi({fs:y,cache:u,gitdir:ae,ours:re,theirs:it,fastForward:Fe,fastForwardOnly:Ge,message:`Merge ${ut}`,author:Rt,committer:$t,signingKey:tt,dryRun:!1,noUpdateBranch:!1}),await ps({fs:y,cache:u,onProgress:b,dir:se,gitdir:ae,ref:re,remote:de,noCheckout:!1})}catch(it){throw it.caller="git.pull",it}}async function wi({fs:y,http:u,onProgress:_,onMessage:b,onAuth:E,onAuthSuccess:T,onAuthFailure:F,dir:z,gitdir:se=fe(z,".git"),ref:ae,url:re,remote:ue,remoteRef:de,corsProxy:Ee,singleBranch:Te,headers:Ne={},cache:Fe={}}){try{$e("fs",y),$e("http",u),$e("gitdir",se);const Ge={name:"",email:"",timestamp:Date.now(),timezoneOffset:0},Je=new Bt(y),ct=await Ot({fsp:Je,dotgit:se});return await _i({fs:Je,cache:Fe,http:u,onProgress:_,onMessage:b,onAuth:E,onAuthSuccess:T,onAuthFailure:F,dir:z,gitdir:ct,ref:ae,url:re,remote:ue,remoteRef:de,fastForwardOnly:!0,corsProxy:Ee,singleBranch:Te,headers:Ne,author:Ge,committer:Ge})}catch(Ge){throw Ge.caller="git.fastForward",Ge}}async function yi({fs:y,http:u,onProgress:_,onMessage:b,onAuth:E,onAuthSuccess:T,onAuthFailure:F,dir:z,gitdir:se=fe(z,".git"),ref:ae,remote:re,remoteRef:ue,url:de,corsProxy:Ee,depth:Te=null,since:Ne=null,exclude:Fe=[],relative:Ge=!1,tags:Je=!1,singleBranch:ct=!1,headers:Ct={},prune:Rt=!1,pruneTags:$t=!1,cache:tt={}}){try{$e("fs",y),$e("http",u),$e("gitdir",se);const it=new Bt(y),ut=await Ot({fsp:it,dotgit:se});return await ys({fs:it,cache:tt,http:u,onProgress:_,onMessage:b,onAuth:E,onAuthSuccess:T,onAuthFailure:F,gitdir:ut,ref:ae,remote:re,remoteRef:ue,url:de,corsProxy:Ee,depth:Te,since:Ne,exclude:Fe,relative:Ge,tags:Je,singleBranch:ct,headers:Ct,prune:Rt,pruneTags:$t})}catch(it){throw it.caller="git.fetch",it}}async function vi({fs:y,dir:u,gitdir:_=fe(u,".git"),oids:b,cache:E={}}){try{$e("fs",y),$e("gitdir",_),$e("oids",b);const T=new Bt(y),F=await Ot({fsp:T,dotgit:_});return await vs({fs:T,cache:E,gitdir:F,oids:b})}catch(T){throw T.caller="git.findMergeBase",T}}async function bi({fs:y,filepath:u}){if(await y.exists(fe(u,".git")))return u;{const _=H(u);if(_===u)throw new ce(`git root for ${u}`);return bi({fs:y,filepath:_})}}async function Si({fs:y,filepath:u}){try{return $e("fs",y),$e("filepath",u),await bi({fs:new Bt(y),filepath:u})}catch(_){throw _.caller="git.findRoot",_}}async function Ci({fs:y,dir:u,gitdir:_=fe(u,".git"),path:b}){try{$e("fs",y),$e("gitdir",_),$e("path",b);const E=new Bt(y),T=await Ot({fsp:E,dotgit:_});return await Hr({fs:E,gitdir:T,path:b})}catch(E){throw E.caller="git.getConfig",E}}async function yo({fs:y,gitdir:u,path:_}){return(await _e.get({fs:y,gitdir:u})).getall(_)}async function Ei({fs:y,dir:u,gitdir:_=fe(u,".git"),path:b}){try{$e("fs",y),$e("gitdir",_),$e("path",b);const E=new Bt(y),T=await Ot({fsp:E,dotgit:_});return await yo({fs:E,gitdir:T,path:b})}catch(E){throw E.caller="git.getConfigAll",E}}async function xi({http:y,onAuth:u,onAuthSuccess:_,onAuthFailure:b,corsProxy:E,url:T,headers:F={},forPush:z=!1}){try{$e("http",y),$e("url",T);const ae=await rs.getRemoteHelperFor({url:T}).discover({http:y,onAuth:u,onAuthSuccess:_,onAuthFailure:b,corsProxy:E,service:z?"git-receive-pack":"git-upload-pack",url:T,headers:F,protocolVersion:1}),re={capabilities:[...ae.capabilities]};for(const[ue,de]of ae.refs){const Ee=ue.split("/"),Te=Ee.pop();let Ne=re;for(const Fe of Ee)Ne[Fe]=Ne[Fe]||{},Ne=Ne[Fe];Ne[Te]=de}for(const[ue,de]of ae.symrefs){const Ee=ue.split("/"),Te=Ee.pop();let Ne=re;for(const Fe of Ee)Ne[Fe]=Ne[Fe]||{},Ne=Ne[Fe];Ne[Te]=de}return re}catch(se){throw se.caller="git.getRemoteInfo",se}}function ki(y,u,_,b){const E=[];for(const[T,F]of y.refs){if(u&&!T.startsWith(u))continue;if(T.endsWith("^{}")){if(b){const se=T.replace("^{}",""),ae=E[E.length-1],re=ae.ref===se?ae:E.find(ue=>ue.ref===se);if(re===void 0)throw new Error("I did not expect this to happen");re.peeled=F}continue}const z={ref:T,oid:F};_&&y.symrefs.has(T)&&(z.target=y.symrefs.get(T)),E.push(z)}return E}async function Ai({http:y,onAuth:u,onAuthSuccess:_,onAuthFailure:b,corsProxy:E,url:T,headers:F={},forPush:z=!1,protocolVersion:se=2}){try{$e("http",y),$e("url",T);const re=await rs.getRemoteHelperFor({url:T}).discover({http:y,onAuth:u,onAuthSuccess:_,onAuthFailure:b,corsProxy:E,service:z?"git-receive-pack":"git-upload-pack",url:T,headers:F,protocolVersion:se});if(re.protocolVersion===2)return{protocolVersion:re.protocolVersion,capabilities:re.capabilities2};const ue={};for(const de of re.capabilities){const[Ee,Te]=de.split("=");Te?ue[Ee]=Te:ue[Ee]=!0}return{protocolVersion:1,capabilities:ue,refs:ki(re,void 0,!0,!0)}}catch(ae){throw ae.caller="git.getRemoteInfo2",ae}}async function vo({type:y,object:u,format:_="content",oid:b=void 0}){return _!=="deflated"&&(_!=="wrapped"&&(u=R.wrap({type:y,object:u})),b=await B(u)),{oid:b,object:u}}async function Ri({object:y}){try{$e("object",y),typeof y=="string"?y=Buffer.from(y,"utf8"):y instanceof Uint8Array||(y=new Uint8Array(y));const u="blob",{oid:_,object:b}=await vo({type:u,format:"content",object:y});return{oid:_,type:u,object:b,format:"wrapped"}}catch(u){throw u.caller="git.hashBlob",u}}async function bo({fs:y,cache:u,onProgress:_,dir:b,gitdir:E,filepath:T}){try{T=fe(b,T);const F=await y.read(T),z=ae=>Ie({fs:y,cache:u,gitdir:E,oid:ae}),se=await Kt.fromPack({pack:F,getExternalRefDelta:z,onProgress:_});return await y.write(T.replace(/\.pack$/,".idx"),await se.toBuffer()),{oids:[...se.hashes]}}catch(F){throw F.caller="git.indexPack",F}}async function $i({fs:y,onProgress:u,dir:_,gitdir:b=fe(_,".git"),filepath:E,cache:T={}}){try{$e("fs",y),$e("dir",_),$e("gitdir",_),$e("filepath",E);const F=new Bt(y),z=await Ot({fsp:F,dotgit:b});return await bo({fs:F,cache:T,onProgress:u,dir:_,gitdir:z,filepath:E})}catch(F){throw F.caller="git.indexPack",F}}async function Ti({fs:y,bare:u=!1,dir:_,gitdir:b=u?_:fe(_,".git"),defaultBranch:E="master"}){try{$e("fs",y),$e("gitdir",b),u||$e("dir",_);const T=new Bt(y),F=await Ot({fsp:T,dotgit:b});return await ni({fs:T,bare:u,dir:_,gitdir:F,defaultBranch:E})}catch(T){throw T.caller="git.init",T}}async function Ii({fs:y,cache:u,gitdir:_,oid:b,ancestor:E,depth:T}){const F=await Kr.read({fs:y,gitdir:_});if(!b)throw new Mt("oid");if(!E)throw new Mt("ancestor");if(b===E)return!1;const z=[b],se=new Set;let ae=0;for(;z.length;){if(ae++===T)throw new ht(T);const re=z.shift(),{type:ue,object:de}=await Ie({fs:y,cache:u,gitdir:_,oid:re});if(ue!=="commit")throw new U(re,ue,"commit");const Ee=Zt.from(de).parse();for(const Te of Ee.parent)if(Te===E)return!0;if(!F.has(re))for(const Te of Ee.parent)se.has(Te)||(z.push(Te),se.add(Te))}return!1}async function Bi({fs:y,dir:u,gitdir:_=fe(u,".git"),oid:b,ancestor:E,depth:T=-1,cache:F={}}){try{$e("fs",y),$e("gitdir",_),$e("oid",b),$e("ancestor",E);const z=new Bt(y),se=await Ot({fsp:z,dotgit:_});return await Ii({fs:z,cache:F,gitdir:se,oid:b,ancestor:E,depth:T})}catch(z){throw z.caller="git.isDescendent",z}}async function Pi({fs:y,dir:u,gitdir:_=fe(u,".git"),filepath:b}){try{$e("fs",y),$e("dir",u),$e("gitdir",_),$e("filepath",b);const E=new Bt(y),T=await Ot({fsp:E,dotgit:_});return Lr.isIgnored({fs:E,dir:u,gitdir:T,filepath:b})}catch(E){throw E.caller="git.isIgnored",E}}async function Oi({fs:y,dir:u,gitdir:_=fe(u,".git"),remote:b}){try{$e("fs",y),$e("gitdir",_);const E=new Bt(y),T=await Ot({fsp:E,dotgit:_});return me.listBranches({fs:E,gitdir:T,remote:b})}catch(E){throw E.caller="git.listBranches",E}}async function So({fs:y,gitdir:u,ref:_,cache:b}){if(_){const E=await me.resolve({gitdir:u,fs:y,ref:_}),T=[];return await Di({fs:y,cache:b,gitdir:u,oid:E,filenames:T,prefix:""}),T}else return q.acquire({fs:y,gitdir:u,cache:b},async function(E){return E.entries.map(T=>T.path)})}async function Di({fs:y,cache:u,gitdir:_,oid:b,filenames:E,prefix:T}){const{tree:F}=await Nr({fs:y,cache:u,gitdir:_,oid:b});for(const z of F)z.type==="tree"?await Di({fs:y,cache:u,gitdir:_,oid:z.oid,filenames:E,prefix:fe(T,z.path)}):E.push(fe(T,z.path))}async function Li({fs:y,dir:u,gitdir:_=fe(u,".git"),ref:b,cache:E={}}){try{$e("fs",y),$e("gitdir",_);const T=new Bt(y),F=await Ot({fsp:T,dotgit:_});return await So({fs:T,cache:E,gitdir:F,ref:b})}catch(T){throw T.caller="git.listFiles",T}}async function Co({fs:y,cache:u,gitdir:_,ref:b}){let E;try{E=await me.resolve({gitdir:_,fs:y,ref:b})}catch(z){if(z instanceof ce)return[]}return(await Nr({fs:y,cache:u,gitdir:_,oid:E})).tree.map(z=>({target:z.path,note:z.oid}))}async function Mi({fs:y,dir:u,gitdir:_=fe(u,".git"),ref:b="refs/notes/commits",cache:E={}}){try{$e("fs",y),$e("gitdir",_),$e("ref",b);const T=new Bt(y),F=await Ot({fsp:T,dotgit:_});return await Co({fs:T,cache:E,gitdir:F,ref:b})}catch(T){throw T.caller="git.listNotes",T}}async function Fi({fs:y,dir:u,gitdir:_=fe(u,".git"),filepath:b}){try{$e("fs",y),$e("gitdir",_);const E=new Bt(y),T=await Ot({fsp:E,dotgit:_});return me.listRefs({fs:E,gitdir:T,filepath:b})}catch(E){throw E.caller="git.listRefs",E}}async function Eo({fs:y,gitdir:u}){const _=await _e.get({fs:y,gitdir:u}),b=await _.getSubsections("remote");return Promise.all(b.map(async T=>{const F=await _.get(`remote.${T}.url`);return{remote:T,url:F}}))}async function Ni({fs:y,dir:u,gitdir:_=fe(u,".git")}){try{$e("fs",y),$e("gitdir",_);const b=new Bt(y),E=await Ot({fsp:b,dotgit:_});return await Eo({fs:b,gitdir:E})}catch(b){throw b.caller="git.listRemotes",b}}async function xo(y){const u=er.streamReader(y),_=[];let b;for(;b=await u(),b!==!0;){if(b===null)continue;b=b.toString("utf8").replace(/\n$/,"");const[E,T,...F]=b.split(" "),z={ref:T,oid:E};for(const se of F){const[ae,re]=se.split(":");ae==="symref-target"?z.target=re:ae==="peeled"&&(z.peeled=re)}_.push(z)}return _}async function ko({prefix:y,symrefs:u,peelTags:_}){const b=[];return b.push(er.encode(`command=ls-refs
`)),b.push(er.encode(`agent=${ss.agent}
`)),(_||u||y)&&b.push(er.delim()),_&&b.push(er.encode("peel")),u&&b.push(er.encode("symrefs")),y&&b.push(er.encode(`ref-prefix ${y}`)),b.push(er.flush()),b}async function ji({http:y,onAuth:u,onAuthSuccess:_,onAuthFailure:b,corsProxy:E,url:T,headers:F={},forPush:z=!1,protocolVersion:se=2,prefix:ae,symrefs:re,peelTags:ue}){try{$e("http",y),$e("url",T);const de=await ts.discover({http:y,onAuth:u,onAuthSuccess:_,onAuthFailure:b,corsProxy:E,service:z?"git-receive-pack":"git-upload-pack",url:T,headers:F,protocolVersion:se});if(de.protocolVersion===1)return ki(de,ae,re,ue);const Ee=await ko({prefix:ae,symrefs:re,peelTags:ue}),Te=await ts.connect({http:y,auth:de.auth,headers:F,corsProxy:E,service:z?"git-receive-pack":"git-upload-pack",url:T,body:Ee});return xo(Te.body)}catch(de){throw de.caller="git.listServerRefs",de}}async function Ui({fs:y,dir:u,gitdir:_=fe(u,".git")}){try{$e("fs",y),$e("gitdir",_);const b=new Bt(y),E=await Ot({fsp:b,dotgit:_});return me.listTags({fs:b,gitdir:E})}catch(b){throw b.caller="git.listTags",b}}function Ao(y,u){return y.committer.timestamp-u.committer.timestamp}const Ro="e69de29bb2d1d6434b8b29ae775ad8c2e48c5391";async function Hi({fs:y,cache:u,gitdir:_,oid:b,fileId:E}){if(E===Ro)return;const T=b;let F;const z=await Or({fs:y,cache:u,gitdir:_,oid:b}),se=z.tree;return E===z.oid?F=z.path:(F=await qi({fs:y,cache:u,gitdir:_,tree:se,fileId:E,oid:T}),Array.isArray(F)&&(F.length===0?F=void 0:F.length===1&&(F=F[0]))),F}async function qi({fs:y,cache:u,gitdir:_,tree:b,fileId:E,oid:T,filepaths:F=[],parentPath:z=""}){const se=b.entries().map(function(ae){let re;return ae.oid===E?(re=fe(z,ae.path),F.push(re)):ae.type==="tree"&&(re=Ie({fs:y,cache:u,gitdir:_,oid:ae.oid}).then(function({object:ue}){return qi({fs:y,cache:u,gitdir:_,tree:M.from(ue),fileId:E,oid:T,filepaths:F,parentPath:fe(z,ae.path)})})),re});return await Promise.all(se),F}async function $o({fs:y,cache:u,gitdir:_,filepath:b,ref:E,depth:T,since:F,force:z,follow:se}){const ae=typeof F>"u"?void 0:Math.floor(F.valueOf()/1e3),re=[],ue=await Kr.read({fs:y,gitdir:_}),de=await me.resolve({fs:y,gitdir:_,ref:E}),Ee=[await Fr({fs:y,cache:u,gitdir:_,oid:de})];let Te,Ne,Fe;function Ge(Je){Fe&&b&&re.push(Je)}for(;Ee.length>0;){const Je=Ee.pop();if(ae!==void 0&&Je.commit.committer.timestamp<=ae)break;if(b){let ct;try{ct=await qr({fs:y,cache:u,gitdir:_,oid:Je.commit.tree,filepath:b}),Ne&&Te!==ct&&re.push(Ne),Te=ct,Ne=Je,Fe=!0}catch(Ct){if(Ct instanceof ce){let Rt=se&&Te;if(Rt&&(Rt=await Hi({fs:y,cache:u,gitdir:_,oid:Je.commit.tree,fileId:Te}),Rt))if(Array.isArray(Rt)){if(Ne){const $t=await Hi({fs:y,cache:u,gitdir:_,oid:Ne.commit.tree,fileId:Te});if(Array.isArray($t))if(Rt=Rt.filter(tt=>$t.indexOf(tt)===-1),Rt.length===1)Rt=Rt[0],b=Rt,Ne&&re.push(Ne);else{Rt=!1,Ne&&re.push(Ne);break}}}else b=Rt,Ne&&re.push(Ne);if(!Rt){if(Fe&&Te&&(re.push(Ne),!z))break;if(!z&&!se)throw Ct}Ne=Je,Fe=!1}else throw Ct}}else re.push(Je);if(T!==void 0&&re.length===T){Ge(Je);break}if(!ue.has(Je.oid))for(const ct of Je.commit.parent){const Ct=await Fr({fs:y,cache:u,gitdir:_,oid:ct});Ee.map(Rt=>Rt.oid).includes(Ct.oid)||Ee.push(Ct)}Ee.length===0&&Ge(Je),Ee.sort((ct,Ct)=>Ao(ct.commit,Ct.commit))}return re}async function Wi({fs:y,dir:u,gitdir:_=fe(u,".git"),filepath:b,ref:E="HEAD",depth:T,since:F,force:z,follow:se,cache:ae={}}){try{$e("fs",y),$e("gitdir",_),$e("ref",E);const re=new Bt(y),ue=await Ot({fsp:re,dotgit:_});return await $o({fs:re,cache:ae,gitdir:ue,filepath:b,ref:E,depth:T,since:F,force:z,follow:se})}catch(re){throw re.caller="git.log",re}}async function zi({fs:y,onSign:u,dir:_,gitdir:b=fe(_,".git"),ours:E,theirs:T,fastForward:F=!0,fastForwardOnly:z=!1,dryRun:se=!1,noUpdateBranch:ae=!1,abortOnConflict:re=!0,message:ue,author:de,committer:Ee,signingKey:Te,cache:Ne={},mergeDriver:Fe,allowUnrelatedHistories:Ge=!1}){try{$e("fs",y),Te&&$e("onSign",u);const Je=new Bt(y),ct=await Ot({fsp:Je,dotgit:b}),Ct=await Ar({fs:Je,gitdir:ct,author:de});if(!Ct&&(!z||!F))throw new at("author");const Rt=await Mr({fs:Je,gitdir:ct,author:Ct,committer:Ee});if(!Rt&&(!z||!F))throw new at("committer");return await gi({fs:Je,cache:Ne,dir:_,gitdir:ct,ours:E,theirs:T,fastForward:F,fastForwardOnly:z,dryRun:se,noUpdateBranch:ae,abortOnConflict:re,message:ue,author:Ct,committer:Rt,signingKey:Te,onSign:u,mergeDriver:Fe,allowUnrelatedHistories:Ge})}catch(Je){throw Je.caller="git.merge",Je}}const To={commit:16,tree:32,blob:48,tag:64,ofs_delta:96,ref_delta:112};async function Gi({fs:y,cache:u,dir:_,gitdir:b=fe(_,".git"),oids:E}){const T=new r,F=[];function z(re,ue){const de=Buffer.from(re,ue);F.push(de),T.update(de)}async function se({stype:re,object:ue}){const de=To[re];let Ee=ue.length,Te=Ee>15?128:0;const Ne=Ee&15;Ee=Ee>>>4;let Fe=(Te|de|Ne).toString(16);for(z(Fe,"hex");Te;)Te=Ee>127?128:0,Fe=Te|Ee&127,z(gs(2,Fe),"hex"),Ee=Ee>>>7;z(Buffer.from(await Ds(ue)))}z("PACK"),z("00000002","hex"),z(gs(8,E.length),"hex");for(const re of E){const{type:ue,object:de}=await Ie({fs:y,cache:u,gitdir:b,oid:re});await se({object:de,stype:ue})}const ae=T.digest();return F.push(ae),F}async function Io({fs:y,cache:u,gitdir:_,oids:b,write:E}){const T=await Gi({fs:y,cache:u,gitdir:_,oids:b}),F=Buffer.from(await es(T)),se=`pack-${F.slice(-20).toString("hex")}.pack`;return E?(await y.write(fe(_,`objects/pack/${se}`),F),{filename:se}):{filename:se,packfile:new Uint8Array(F)}}async function Ki({fs:y,dir:u,gitdir:_=fe(u,".git"),oids:b,write:E=!1,cache:T={}}){try{$e("fs",y),$e("gitdir",_),$e("oids",b);const F=new Bt(y),z=await Ot({fsp:F,dotgit:_});return await Io({fs:F,cache:T,gitdir:z,oids:b,write:E})}catch(F){throw F.caller="git.packObjects",F}}async function Vi({fs:y,http:u,onProgress:_,onMessage:b,onAuth:E,onAuthSuccess:T,onAuthFailure:F,dir:z,gitdir:se=fe(z,".git"),ref:ae,url:re,remote:ue,remoteRef:de,prune:Ee=!1,pruneTags:Te=!1,fastForward:Ne=!0,fastForwardOnly:Fe=!1,corsProxy:Ge,singleBranch:Je,headers:ct={},author:Ct,committer:Rt,signingKey:$t,cache:tt={}}){try{$e("fs",y),$e("gitdir",se);const it=new Bt(y),ut=await Ot({fsp:it,dotgit:se}),Ut=await Ar({fs:it,gitdir:ut,author:Ct});if(!Ut)throw new at("author");const Wt=await Mr({fs:it,gitdir:ut,author:Ut,committer:Rt});if(!Wt)throw new at("committer");return await _i({fs:it,cache:tt,http:u,onProgress:_,onMessage:b,onAuth:E,onAuthSuccess:T,onAuthFailure:F,dir:z,gitdir:ut,ref:ae,url:re,remote:ue,remoteRef:de,fastForward:Ne,fastForwardOnly:Fe,corsProxy:Ge,singleBranch:Je,headers:ct,author:Ut,committer:Wt,signingKey:$t,prune:Ee,pruneTags:Te})}catch(it){throw it.caller="git.pull",it}}async function Bo({fs:y,cache:u,dir:_,gitdir:b=fe(_,".git"),start:E,finish:T}){const F=await Kr.read({fs:y,gitdir:b}),z=new Set,se=new Set;for(const ue of E)z.add(await me.resolve({fs:y,gitdir:b,ref:ue}));for(const ue of T)try{const de=await me.resolve({fs:y,gitdir:b,ref:ue});se.add(de)}catch{}const ae=new Set;async function re(ue){ae.add(ue);const{type:de,object:Ee}=await Ie({fs:y,cache:u,gitdir:b,oid:ue});if(de==="tag"){const Ne=mr.from(Ee).headers().object;return re(Ne)}if(de!=="commit")throw new U(ue,de,"commit");if(!F.has(ue)){const Ne=Zt.from(Ee).headers().parent;for(ue of Ne)!se.has(ue)&&!ae.has(ue)&&await re(ue)}}for(const ue of z)await re(ue);return ae}async function Ss({fs:y,cache:u,dir:_,gitdir:b=fe(_,".git"),oids:E}){const T=new Set;async function F(z){if(T.has(z))return;T.add(z);const{type:se,object:ae}=await Ie({fs:y,cache:u,gitdir:b,oid:z});if(se==="tag"){const ue=mr.from(ae).headers().object;await F(ue)}else if(se==="commit"){const ue=Zt.from(ae).headers().tree;await F(ue)}else if(se==="tree"){const re=M.from(ae);for(const ue of re)ue.type==="blob"&&T.add(ue.oid),ue.type==="tree"&&await F(ue.oid)}}for(const z of E)await F(z);return T}async function Po(y){const u={};let _="";const b=er.streamReader(y);let E=await b();for(;E!==!0;)E!==null&&(_+=E.toString("utf8")+`
`),E=await b();const T=_.toString("utf8").split(`
`);if(E=T.shift(),!E.startsWith("unpack "))throw new jt('unpack ok" or "unpack [error message]',E);u.ok=E==="unpack ok",u.ok||(u.error=E.slice(7)),u.refs={};for(const F of T){if(F.trim()==="")continue;const z=F.slice(0,2),se=F.slice(3);let ae=se.indexOf(" ");ae===-1&&(ae=se.length);const re=se.slice(0,ae),ue=se.slice(ae+1);u.refs[re]={ok:z==="ok",error:ue}}return u}async function Oo({capabilities:y=[],triplets:u=[]}){const _=[];let b=`\0 ${y.join(" ")}`;for(const E of u)_.push(er.encode(`${E.oldoid} ${E.oid} ${E.fullRef}${b}
`)),b="";return _.push(er.flush()),_}async function Do({fs:y,cache:u,http:_,onProgress:b,onMessage:E,onAuth:T,onAuthSuccess:F,onAuthFailure:z,onPrePush:se,gitdir:ae,ref:re,remoteRef:ue,remote:de,url:Ee,force:Te=!1,delete:Ne=!1,corsProxy:Fe,headers:Ge={}}){const Je=re||await Rr({fs:y,gitdir:ae});if(typeof Je>"u")throw new Mt("ref");const ct=await _e.get({fs:y,gitdir:ae});de=de||await ct.get(`branch.${Je}.pushRemote`)||await ct.get("remote.pushDefault")||await ct.get(`branch.${Je}.remote`)||"origin";const Ct=Ee||await ct.get(`remote.${de}.pushurl`)||await ct.get(`remote.${de}.url`);if(typeof Ct>"u")throw new Mt("remote OR url");const Rt=ue||await ct.get(`branch.${Je}.merge`);if(typeof Ct>"u")throw new Mt("remoteRef");Fe===void 0&&(Fe=await ct.get("http.corsProxy"));const $t=await me.expand({fs:y,gitdir:ae,ref:Je}),tt=Ne?"0000000000000000000000000000000000000000":await me.resolve({fs:y,gitdir:ae,ref:$t}),it=rs.getRemoteHelperFor({url:Ct}),ut=await it.discover({http:_,onAuth:T,onAuthSuccess:F,onAuthFailure:z,corsProxy:Fe,service:"git-receive-pack",url:Ct,headers:Ge,protocolVersion:1}),Ut=ut.auth;let Wt;if(!Rt)Wt=$t;else try{Wt=await me.expandAgainstMap({ref:Rt,map:ut.refs})}catch(Xt){if(Xt instanceof ce)Wt=Rt.startsWith("refs/")?Rt:`refs/heads/${Rt}`;else throw Xt}const sr=ut.refs.get(Wt)||"0000000000000000000000000000000000000000";if(se&&!await se({remote:de,url:Ct,localRef:{ref:Ne?"(delete)":$t,oid:tt},remoteRef:{ref:Wt,oid:sr}}))throw new rr;const Jt=!ut.capabilities.has("no-thin");let ir=new Set;if(!Ne){const Xt=[...ut.refs.values()];let vr=new Set;if(sr!=="0000000000000000000000000000000000000000"){const lr=await vs({fs:y,cache:u,gitdir:ae,oids:[tt,sr]});for(const Vr of lr)Xt.push(Vr);Jt&&(vr=await Ss({fs:y,cache:u,gitdir:ae,oids:lr}))}if(!Xt.includes(tt)){const lr=await Bo({fs:y,cache:u,gitdir:ae,start:[tt],finish:Xt});ir=await Ss({fs:y,cache:u,gitdir:ae,oids:lr})}if(Jt){try{const lr=await me.resolve({fs:y,gitdir:ae,ref:`refs/remotes/${de}/HEAD`,depth:2}),{oid:Vr}=await me.resolveAgainstMap({ref:lr.replace(`refs/remotes/${de}/`,""),fullref:lr,map:ut.refs}),Pr=[Vr];for(const nr of await Ss({fs:y,cache:u,gitdir:ae,oids:Pr}))vr.add(nr)}catch{}for(const lr of vr)ir.delete(lr)}if(tt===sr&&(Te=!0),!Te){if($t.startsWith("refs/tags")&&sr!=="0000000000000000000000000000000000000000")throw new Qt("tag-exists");if(tt!=="0000000000000000000000000000000000000000"&&sr!=="0000000000000000000000000000000000000000"&&!await Ii({fs:y,cache:u,gitdir:ae,oid:tt,ancestor:sr,depth:-1}))throw new Qt("not-fast-forward")}}const or=ri([...ut.capabilities],["report-status","side-band-64k",`agent=${ss.agent}`]),Ir=await Oo({capabilities:or,triplets:[{oldoid:sr,oid:tt,fullRef:Wt}]}),Br=Ne?[]:await Gi({fs:y,cache:u,gitdir:ae,oids:[...ir]}),Ur=await it.connect({http:_,onProgress:b,corsProxy:Fe,service:"git-receive-pack",url:Ct,auth:Ut,headers:Ge,body:[...Ir,...Br]}),{packfile:xs,progress:ks}=await ii.demux(Ur.body);if(E){const Xt=si(ks);Gr(Xt,async vr=>{await E(vr)})}const wr=await Po(xs);if(Ur.headers&&(wr.headers=Ur.headers),de&&wr.ok&&wr.refs[Wt].ok&&!$t.startsWith("refs/tags")){const Xt=`refs/remotes/${de}/${Wt.replace("refs/heads","")}`;Ne?await me.deleteRef({fs:y,gitdir:ae,ref:Xt}):await me.writeRef({fs:y,gitdir:ae,ref:Xt,value:tt})}if(wr.ok&&Object.values(wr.refs).every(Xt=>Xt.ok))return wr;{const Xt=Object.entries(wr.refs).filter(([vr,lr])=>!lr.ok).map(([vr,lr])=>`
  - ${vr}: ${lr.error}`).join("");throw new pt(Xt,wr)}}async function Ji({fs:y,http:u,onProgress:_,onMessage:b,onAuth:E,onAuthSuccess:T,onAuthFailure:F,onPrePush:z,dir:se,gitdir:ae=fe(se,".git"),ref:re,remoteRef:ue,remote:de="origin",url:Ee,force:Te=!1,delete:Ne=!1,corsProxy:Fe,headers:Ge={},cache:Je={}}){try{$e("fs",y),$e("http",u),$e("gitdir",ae);const ct=new Bt(y),Ct=await Ot({fsp:ct,dotgit:ae});return await Do({fs:ct,cache:Je,http:u,onProgress:_,onMessage:b,onAuth:E,onAuthSuccess:T,onAuthFailure:F,onPrePush:z,gitdir:Ct,ref:re,remoteRef:ue,remote:de,url:Ee,force:Te,delete:Ne,corsProxy:Fe,headers:Ge})}catch(ct){throw ct.caller="git.push",ct}}async function Yi({fs:y,cache:u,gitdir:_,oid:b}){const{type:E,object:T}=await Ie({fs:y,cache:u,gitdir:_,oid:b});if(E==="tag")return b=mr.from(T).parse().object,Yi({fs:y,cache:u,gitdir:_,oid:b});if(E!=="blob")throw new U(b,E,"blob");return{oid:b,blob:new Uint8Array(T)}}async function Zi({fs:y,cache:u,gitdir:_,oid:b,filepath:E=void 0}){return E!==void 0&&(b=await qr({fs:y,cache:u,gitdir:_,oid:b,filepath:E})),await Yi({fs:y,cache:u,gitdir:_,oid:b})}async function Xi({fs:y,dir:u,gitdir:_=fe(u,".git"),oid:b,filepath:E,cache:T={}}){try{$e("fs",y),$e("gitdir",_),$e("oid",b);const F=new Bt(y),z=await Ot({fsp:F,dotgit:_});return await Zi({fs:F,cache:T,gitdir:z,oid:b,filepath:E})}catch(F){throw F.caller="git.readBlob",F}}async function Cs({fs:y,dir:u,gitdir:_=fe(u,".git"),oid:b,cache:E={}}){try{$e("fs",y),$e("gitdir",_),$e("oid",b);const T=new Bt(y),F=await Ot({fsp:T,dotgit:_});return await Fr({fs:T,cache:E,gitdir:F,oid:b})}catch(T){throw T.caller="git.readCommit",T}}async function Lo({fs:y,cache:u,gitdir:_,ref:b="refs/notes/commits",oid:E}){const T=await me.resolve({gitdir:_,fs:y,ref:b}),{blob:F}=await Zi({fs:y,cache:u,gitdir:_,oid:T,filepath:E});return F}async function Qi({fs:y,dir:u,gitdir:_=fe(u,".git"),ref:b="refs/notes/commits",oid:E,cache:T={}}){try{$e("fs",y),$e("gitdir",_),$e("ref",b),$e("oid",E);const F=new Bt(y),z=await Ot({fsp:F,dotgit:_});return await Lo({fs:F,cache:T,gitdir:z,ref:b,oid:E})}catch(F){throw F.caller="git.readNote",F}}async function en({fs:y,dir:u,gitdir:_=fe(u,".git"),oid:b,format:E="parsed",filepath:T=void 0,encoding:F=void 0,cache:z={}}){try{$e("fs",y),$e("gitdir",_),$e("oid",b);const se=new Bt(y),ae=await Ot({fsp:se,dotgit:_});T!==void 0&&(b=await qr({fs:se,cache:z,gitdir:ae,oid:b,filepath:T}));const ue=await Ie({fs:se,cache:z,gitdir:ae,oid:b,format:E==="parsed"?"content":E});if(ue.oid=b,E==="parsed")switch(ue.format="parsed",ue.type){case"commit":ue.object=Zt.from(ue.object).parse();break;case"tree":ue.object=M.from(ue.object).entries();break;case"blob":F?ue.object=ue.object.toString(F):(ue.object=new Uint8Array(ue.object),ue.format="content");break;case"tag":ue.object=mr.from(ue.object).parse();break;default:throw new U(ue.oid,ue.type,"blob|commit|tag|tree")}else(ue.format==="deflated"||ue.format==="wrapped")&&(ue.type=ue.format);return ue}catch(se){throw se.caller="git.readObject",se}}async function Mo({fs:y,cache:u,gitdir:_,oid:b}){const{type:E,object:T}=await Ie({fs:y,cache:u,gitdir:_,oid:b,format:"content"});if(E!=="tag")throw new U(b,E,"tag");const F=mr.from(T);return{oid:b,tag:F.parse(),payload:F.payload()}}async function tn({fs:y,dir:u,gitdir:_=fe(u,".git"),oid:b,cache:E={}}){try{$e("fs",y),$e("gitdir",_),$e("oid",b);const T=new Bt(y),F=await Ot({fsp:T,dotgit:_});return await Mo({fs:T,cache:E,gitdir:F,oid:b})}catch(T){throw T.caller="git.readTag",T}}async function rn({fs:y,dir:u,gitdir:_=fe(u,".git"),oid:b,filepath:E=void 0,cache:T={}}){try{$e("fs",y),$e("gitdir",_),$e("oid",b);const F=new Bt(y),z=await Ot({fsp:F,dotgit:_});return await Nr({fs:F,cache:T,gitdir:z,oid:b,filepath:E})}catch(F){throw F.caller="git.readTree",F}}async function sn({fs:y,dir:u,gitdir:_=fe(u,".git"),filepath:b,cache:E={}}){try{$e("fs",y),$e("gitdir",_),$e("filepath",b);const T=new Bt(y),F=await Ot({fsp:T,dotgit:_});await q.acquire({fs:T,gitdir:F,cache:E},async function(z){z.delete({filepath:b})})}catch(T){throw T.caller="git.remove",T}}async function Fo({fs:y,cache:u,onSign:_,gitdir:b,ref:E="refs/notes/commits",oid:T,author:F,committer:z,signingKey:se}){let ae;try{ae=await me.resolve({gitdir:b,fs:y,ref:E})}catch(Te){if(!(Te instanceof ce))throw Te}let ue=(await Nr({fs:y,cache:u,gitdir:b,oid:ae||"4b825dc642cb6eb9a060e54bf8d69288fbee4904"})).tree;ue=ue.filter(Te=>Te.path!==T);const de=await Wr({fs:y,gitdir:b,tree:ue});return await Qr({fs:y,cache:u,onSign:_,gitdir:b,ref:E,tree:de,parent:ae&&[ae],message:`Note removed by 'isomorphic-git removeNote'
`,author:F,committer:z,signingKey:se})}async function nn({fs:y,onSign:u,dir:_,gitdir:b=fe(_,".git"),ref:E="refs/notes/commits",oid:T,author:F,committer:z,signingKey:se,cache:ae={}}){try{$e("fs",y),$e("gitdir",b),$e("oid",T);const re=new Bt(y),ue=await Ot({fsp:re,dotgit:b}),de=await Ar({fs:re,gitdir:ue,author:F});if(!de)throw new at("author");const Ee=await Mr({fs:re,gitdir:ue,author:de,committer:z});if(!Ee)throw new at("committer");return await Fo({fs:re,cache:ae,onSign:u,gitdir:ue,ref:E,oid:T,author:de,committer:Ee,signingKey:se})}catch(re){throw re.caller="git.removeNote",re}}async function No({fs:y,gitdir:u,oldref:_,ref:b,checkout:E=!1}){if(!zr(b))throw new ot(b,o.clean(b));if(!zr(_))throw new ot(_,o.clean(_));const T=`refs/heads/${_}`,F=`refs/heads/${b}`;if(await me.exists({fs:y,gitdir:u,ref:F}))throw new ze("branch",b,!1);const se=await me.resolve({fs:y,gitdir:u,ref:T,depth:1});await me.writeRef({fs:y,gitdir:u,ref:F,value:se}),await me.deleteRef({fs:y,gitdir:u,ref:T});const re=await Rr({fs:y,gitdir:u,fullname:!0})===T;(E||re)&&await me.writeSymbolicRef({fs:y,gitdir:u,ref:"HEAD",value:F})}async function on({fs:y,dir:u,gitdir:_=fe(u,".git"),ref:b,oldref:E,checkout:T=!1}){try{$e("fs",y),$e("gitdir",_),$e("ref",b),$e("oldref",E);const F=new Bt(y),z=await Ot({fsp:F,dotgit:_});return await No({fs:F,gitdir:z,ref:b,oldref:E,checkout:T})}catch(F){throw F.caller="git.renameBranch",F}}async function an({gitdir:y,type:u,object:_}){return B(R.wrap({type:u,object:_}))}async function cn({fs:y,dir:u,gitdir:_=fe(u,".git"),filepath:b,ref:E,cache:T={}}){try{$e("fs",y),$e("gitdir",_),$e("filepath",b);const F=new Bt(y),z=await Ot({fsp:F,dotgit:_});let se,ae;try{se=await me.resolve({fs:F,gitdir:z,ref:E||"HEAD"})}catch(de){if(E)throw de}if(se)try{se=await qr({fs:F,cache:T,gitdir:z,oid:se,filepath:b})}catch{se=null}let re={ctime:new Date(0),mtime:new Date(0),dev:0,ino:0,mode:0,uid:0,gid:0,size:0};const ue=u&&await F.read(fe(u,b));ue&&(ae=await an({gitdir:z,type:"blob",object:ue}),se===ae&&(re=await F.lstat(fe(u,b)))),await q.acquire({fs:F,gitdir:z,cache:T},async function(de){de.delete({filepath:b}),se&&de.insert({filepath:b,stats:re,oid:se})})}catch(F){throw F.caller="git.reset",F}}async function hn({fs:y,dir:u,gitdir:_=fe(u,".git"),ref:b,depth:E}){try{$e("fs",y),$e("gitdir",_),$e("ref",b);const T=new Bt(y),F=await Ot({fsp:T,dotgit:_});return await me.resolve({fs:T,gitdir:F,ref:b,depth:E})}catch(T){throw T.caller="git.resolveRef",T}}async function un({fs:y,dir:u,gitdir:_=fe(u,".git"),path:b,value:E,append:T=!1}){try{$e("fs",y),$e("gitdir",_),$e("path",b);const F=new Bt(y),z=await Ot({fsp:F,dotgit:_}),se=await _e.get({fs:F,gitdir:z});T?await se.append(b,E):await se.set(b,E),await _e.save({fs:F,gitdir:z,config:se})}catch(F){throw F.caller="git.setConfig",F}}async function fn({fs:y,gitdir:u,commit:_}){const b=Zt.from(_).toObject();return await gr({fs:y,gitdir:u,type:"commit",object:b,format:"content"})}class ns{static get timezoneOffsetForRefLogEntry(){const u=new Date().getTimezoneOffset(),_=Math.abs(Math.floor(u/60)),b=Math.abs(u%60).toString().padStart(2,"0");return`${u>0?"-":"+"}${_.toString().padStart(2,"0")}${b}`}static createStashReflogEntry(u,_,b){const E=u.name.replace(/\s/g,""),T="0000000000000000000000000000000000000000",F=Math.floor(Date.now()/1e3),z=ns.timezoneOffsetForRefLogEntry;return`${T} ${_} ${E} ${u.email} ${F} ${z}	${b}
`}static getStashReflogEntry(u,_=!1){return u.split(`
`).filter(T=>T).reverse().map((T,F)=>_?`stash@{${F}}: ${T.split("	")[1]}`:T)}}const jo={stage:pe,workdir:Dr};let Es;async function jr(y,u){return Es===void 0&&(Es=new e),Es.acquire(y,u)}async function Uo(y,u,_,b,E=null){const T=fe(_,b),F=await y.lstat(T);if(!F)throw new ce(T);if(F.isDirectory())throw new f(`${T}: file expected, but found directory`);const z=E?await D({fs:y,gitdir:u,oid:E}):void 0;let se=z?E:void 0;return z||await jr({fs:y,gitdir:u,currentFilepath:T},async()=>{const ae=F.isSymbolicLink()?await y.readlink(T).then(Ls):await y.read(T);if(ae===null)throw new ce(T);se=await gr({fs:y,gitdir:u,type:"blob",object:ae})}),se}async function Ho({fs:y,dir:u,gitdir:_,entries:b}){async function E(T){if(T.type==="tree"){if(!T.oid){const F=await Promise.all(T.children.map(E));T.oid=await Wr({fs:y,gitdir:_,tree:F}),T.mode=16384}}else T.type==="blob"&&(T.oid=await Uo(y,_,u,T.path,T.oid),T.mode=33188);return T.path=T.path.split("/").pop(),T}return Promise.all(b.map(E))}async function dn({fs:y,dir:u,gitdir:_,treePair:b}){const E=b[1]==="stage",T=b.map(Ee=>typeof Ee=="string"?jo[Ee]():Ee),F=[],re=await kr({fs:y,cache:{},dir:u,gitdir:_,trees:T,map:async(Ee,[Te,Ne])=>{if(!(Ee==="."||await Lr.isIgnored({fs:y,dir:u,gitdir:_,filepath:Ee}))&&Ne)return(!Te||await Te.oid()!==await Ne.oid()&&await Ne.oid()!==void 0)&&F.push([Te,Ne]),{mode:await Ne.mode(),path:Ee,oid:await Ne.oid(),type:await Ne.type()}},reduce:async(Ee,Te)=>(Te=Te.filter(Boolean),Ee?(Ee.children=Te,Ee):Te.length>0?Te:void 0),iterate:async(Ee,Te)=>{const Ne=[];for(const Fe of Te){const[Ge,Je]=Fe;E?Je&&(await y.exists(`${u}/${Je.toString()}`)?Ne.push(Fe):F.push([null,Je])):Ge&&(Je?Ne.push(Fe):F.push([Ge,null]))}return Ne.length?Promise.all(Ne.map(Ee)):[]}});if(F.length===0||re.length===0)return null;const de=(await Ho({fs:y,dir:u,gitdir:_,entries:re})).filter(Boolean).map(Ee=>({mode:Ee.mode,path:Ee.path,oid:Ee.oid,type:Ee.type}));return Wr({fs:y,gitdir:_,tree:de})}async function qo({fs:y,dir:u,gitdir:_,stashCommit:b,parentCommit:E,wasStaged:T}){const F=[],z=[],se=await kr({fs:y,cache:{},dir:u,gitdir:_,trees:[_r({ref:E}),_r({ref:b})],map:async(ae,[re,ue])=>{if(ae==="."||await Lr.isIgnored({fs:y,dir:u,gitdir:_,filepath:ae}))return;const de=ue?await ue.type():await re.type();if(de!=="tree"&&de!=="blob")return;if(!ue&&re){const Te=de==="tree"?"rmdir":"rm";return de==="tree"&&F.push(ae),de==="blob"&&T&&z.push({filepath:ae,oid:await re.oid()}),{method:Te,filepath:ae}}const Ee=await ue.oid();if(!re||await re.oid()!==Ee)return de==="tree"?{method:"mkdir",filepath:ae}:(T&&z.push({filepath:ae,oid:Ee,stats:await y.lstat(fe(u,ae))}),{method:"write",filepath:ae,oid:Ee})}});await jr({fs:y,gitdir:_,dirRemoved:F,ops:se},async()=>{for(const ae of se){const re=fe(u,ae.filepath);switch(ae.method){case"rmdir":await y.rmdir(re);break;case"mkdir":await y.mkdir(re);break;case"rm":await y.rm(re);break;case"write":if(!F.some(ue=>re.startsWith(ue))){const{object:ue}=await Ie({fs:y,cache:{},gitdir:_,oid:ae.oid});await y.exists(re)&&await y.rm(re),await y.write(re,ue)}break}}}),await q.acquire({fs:y,gitdir:_,cache:{}},async ae=>{z.forEach(({filepath:re,stats:ue,oid:de})=>{ae.insert({filepath:re,stats:ue,oid:de})})})}class Er{constructor({fs:u,dir:_,gitdir:b=fe(_,".git")}){Object.assign(this,{fs:u,dir:_,gitdir:b,_author:null})}static get refStash(){return"refs/stash"}static get refLogsStash(){return"logs/refs/stash"}get refStashPath(){return fe(this.gitdir,Er.refStash)}get refLogsStashPath(){return fe(this.gitdir,Er.refLogsStash)}async getAuthor(){if(!this._author&&(this._author=await Ar({fs:this.fs,gitdir:this.gitdir,author:{}}),!this._author))throw new at("author");return this._author}async getStashSHA(u,_){return await this.fs.exists(this.refStashPath)?(_||await this.readStashReflogs({parsed:!1}))[u].split(" ")[1]:null}async writeStashCommit({message:u,tree:_,parent:b}){return fn({fs:this.fs,gitdir:this.gitdir,commit:{message:u,tree:_,parent:b,author:await this.getAuthor(),committer:await this.getAuthor()}})}async readStashCommit(u){const _=await this.readStashReflogs({parsed:!1});if(u!==0&&(u<0||u>_.length-1))throw new ot(`stash@${u}`,"number that is in range of [0, num of stash pushed]");const b=await this.getStashSHA(u,_);return b?Fr({fs:this.fs,cache:{},gitdir:this.gitdir,oid:b}):{}}async writeStashRef(u){return me.writeRef({fs:this.fs,gitdir:this.gitdir,ref:Er.refStash,value:u})}async writeStashReflogEntry({stashCommit:u,message:_}){const b=await this.getAuthor(),E=ns.createStashReflogEntry(b,u,_),T=this.refLogsStashPath;await jr({filepath:T,entry:E},async()=>{const F=await this.fs.exists(T)?await this.fs.read(T,"utf8"):"";await this.fs.write(T,F+E,"utf8")})}async readStashReflogs({parsed:u=!1}){if(!await this.fs.exists(this.refLogsStashPath))return[];const _=await this.fs.read(this.refLogsStashPath,"utf8");return ns.getStashReflogEntry(_,u)}}async function pn({fs:y,dir:u,gitdir:_,message:b=""}){const E=new Er({fs:y,dir:u,gitdir:_});await E.getAuthor();const T=await Rr({fs:y,gitdir:_,fullname:!1}),F=await me.resolve({fs:y,gitdir:_,ref:"HEAD"}),se=(await Cs({fs:y,dir:u,gitdir:_,oid:F})).commit.message,ae=[F];let re=null,ue=_r({ref:"HEAD"});const de=await dn({fs:y,dir:u,gitdir:_,treePair:[_r({ref:"HEAD"}),"stage"]});if(de){const Fe=await E.writeStashCommit({message:`stash-Index: WIP on ${T} - ${new Date().toISOString()}`,tree:de,parent:ae});ae.push(Fe),re=de,ue=pe()}const Ee=await dn({fs:y,dir:u,gitdir:_,treePair:[ue,"workdir"]});if(Ee){const Fe=await E.writeStashCommit({message:`stash-WorkDir: WIP on ${T} - ${new Date().toISOString()}`,tree:Ee,parent:[ae[ae.length-1]]});ae.push(Fe),re=Ee}if(!re||!de&&!Ee)throw new ce("changes, nothing to stash");const Te=(b.trim()||`WIP on ${T}`)+`: ${F.substring(0,7)} ${se}`;return{stashCommit:await E.writeStashCommit({message:Te,tree:re,parent:ae}),stashMsg:Te,branch:T,stashMgr:E}}async function Wo({fs:y,dir:u,gitdir:_,message:b=""}){const{stashCommit:E,stashMsg:T,branch:F,stashMgr:z}=await pn({fs:y,dir:u,gitdir:_,message:b});return await z.writeStashRef(E),await z.writeStashReflogEntry({stashCommit:E,message:T}),await ms({fs:y,dir:u,gitdir:_,ref:F,track:!1,force:!0}),E}async function zo({fs:y,dir:u,gitdir:_,message:b=""}){const{stashCommit:E}=await pn({fs:y,dir:u,gitdir:_,message:b});return E}async function mn({fs:y,dir:u,gitdir:_,refIdx:b=0}){const T=await new Er({fs:y,dir:u,gitdir:_}).readStashCommit(b),{parent:F=null}=T.commit?T.commit:{};if(!(!F||!Array.isArray(F)))for(let z=0;z<F.length-1;z++){const ae=(await Fr({fs:y,cache:{},gitdir:_,oid:F[z+1]})).commit.message.startsWith("stash-Index");await qo({fs:y,dir:u,gitdir:_,stashCommit:F[z+1],parentCommit:F[z],wasStaged:ae})}}async function gn({fs:y,dir:u,gitdir:_,refIdx:b=0}){const E=new Er({fs:y,dir:u,gitdir:_});if(!(await E.readStashCommit(b)).commit)return;const F=E.refStashPath;await jr(F,async()=>{await y.exists(F)&&await y.rm(F)});const z=await E.readStashReflogs({parsed:!1});if(!z.length)return;z.splice(b,1);const se=E.refLogsStashPath;await jr({reflogEntries:z,stashReflogPath:se,stashMgr:E},async()=>{if(z.length){await y.write(se,z.reverse().join(`
`)+`
`,"utf8");const ae=z[z.length-1].split(" ")[1];await E.writeStashRef(ae)}else await y.rm(se)})}async function Go({fs:y,dir:u,gitdir:_}){return new Er({fs:y,dir:u,gitdir:_}).readStashReflogs({parsed:!0})}async function Ko({fs:y,dir:u,gitdir:_}){const b=new Er({fs:y,dir:u,gitdir:_}),E=[b.refStashPath,b.refLogsStashPath];await jr(E,async()=>{await Promise.all(E.map(async T=>{if(await y.exists(T))return y.rm(T)}))})}async function Vo({fs:y,dir:u,gitdir:_,refIdx:b=0}){await mn({fs:y,dir:u,gitdir:_,refIdx:b}),await gn({fs:y,dir:u,gitdir:_,refIdx:b})}async function _n({fs:y,dir:u,gitdir:_=fe(u,".git"),op:b="push",message:E="",refIdx:T=0}){$e("fs",y),$e("dir",u),$e("gitdir",_),$e("op",b);const F={push:Wo,apply:mn,drop:gn,list:Go,clear:Ko,pop:Vo,create:zo},z=["apply","drop","pop"];try{const se=new Bt(y),ae=await Ot({fsp:se,dotgit:_});["refs","logs","logs/refs"].map(de=>fe(ae,de)).forEach(async de=>{await se.exists(de)||await se.mkdir(de)});const ue=F[b];if(ue){if(z.includes(b)&&T<0)throw new ot(`stash@${T}`,"number that is in range of [0, num of stash pushed]");return await ue({fs:se,dir:u,gitdir:ae,message:E,refIdx:T})}throw new Error(`To be implemented: ${b}`)}catch(se){throw se.caller="git.stash",se}}async function wn({fs:y,dir:u,gitdir:_=fe(u,".git"),filepath:b,cache:E={}}){try{$e("fs",y),$e("gitdir",_),$e("filepath",b);const T=new Bt(y),F=await Ot({fsp:T,dotgit:_});if(await Lr.isIgnored({fs:T,gitdir:F,dir:u,filepath:b}))return"ignored";const se=await Jo({fs:T,cache:E,gitdir:F}),ae=await yn({fs:T,cache:E,gitdir:F,tree:se,path:b}),re=await q.acquire({fs:T,gitdir:F,cache:E},async function(Fe){for(const Ge of Fe)if(Ge.path===b)return Ge;return null}),ue=await T.lstat(fe(u,b)),de=ae!==null,Ee=re!==null,Te=ue!==null,Ne=async()=>{if(Ee&&!Y(re,ue))return re.oid;{const Fe=await T.read(fe(u,b)),Ge=await an({gitdir:F,type:"blob",object:Fe});return Ee&&re.oid===Ge&&ue.size!==-1&&q.acquire({fs:T,gitdir:F,cache:E},async function(Je){Je.insert({filepath:b,stats:ue,oid:Ge})}),Ge}};if(!de&&!Te&&!Ee)return"absent";if(!de&&!Te&&Ee)return"*absent";if(!de&&Te&&!Ee)return"*added";if(!de&&Te&&Ee)return await Ne()===re.oid?"added":"*added";if(de&&!Te&&!Ee)return"deleted";if(de&&!Te&&Ee)return ae===re.oid,"*deleted";if(de&&Te&&!Ee)return await Ne()===ae?"*undeleted":"*undeletemodified";if(de&&Te&&Ee){const Fe=await Ne();return Fe===ae?Fe===re.oid?"unmodified":"*unmodified":Fe===re.oid?"modified":"*modified"}}catch(T){throw T.caller="git.status",T}}async function yn({fs:y,cache:u,gitdir:_,tree:b,path:E}){typeof E=="string"&&(E=E.split("/"));const T=E.shift();for(const F of b)if(F.path===T){if(E.length===0)return F.oid;const{type:z,object:se}=await Ie({fs:y,cache:u,gitdir:_,oid:F.oid});if(z==="tree"){const ae=M.from(se);return yn({fs:y,cache:u,gitdir:_,tree:ae,path:E})}if(z==="blob")throw new U(F.oid,z,"blob",E.join("/"))}return null}async function Jo({fs:y,cache:u,gitdir:_}){let b;try{b=await me.resolve({fs:y,gitdir:_,ref:"HEAD"})}catch(T){if(T instanceof ce)return[]}const{tree:E}=await Nr({fs:y,cache:u,gitdir:_,oid:b});return E}async function vn({fs:y,dir:u,gitdir:_=fe(u,".git"),ref:b="HEAD",filepaths:E=["."],filter:T,cache:F={},ignored:z=!1}){try{$e("fs",y),$e("gitdir",_),$e("ref",b);const se=new Bt(y),ae=await Ot({fsp:se,dotgit:_});return await kr({fs:se,cache:F,dir:u,gitdir:ae,trees:[_r({ref:b}),Dr(),pe()],map:async function(re,[ue,de,Ee]){if(!ue&&!Ee&&de&&!z&&await Lr.isIgnored({fs:se,dir:u,filepath:re})||!E.some(tt=>Ks(re,tt)))return null;if(T&&!T(re))return;const[Te,Ne,Fe]=await Promise.all([ue&&ue.type(),de&&de.type(),Ee&&Ee.type()]),Ge=[Te,Ne,Fe].includes("blob");if((Te==="tree"||Te==="special")&&!Ge)return;if(Te==="commit")return null;if((Ne==="tree"||Ne==="special")&&!Ge)return;if(Fe==="commit")return null;if((Fe==="tree"||Fe==="special")&&!Ge)return;const Je=Te==="blob"?await ue.oid():void 0,ct=Fe==="blob"?await Ee.oid():void 0;let Ct;Te!=="blob"&&Ne==="blob"&&Fe!=="blob"?Ct="42":Ne==="blob"&&(Ct=await de.oid());const Rt=[void 0,Je,Ct,ct],$t=Rt.map(tt=>Rt.indexOf(tt));return $t.shift(),[re,...$t]}})}catch(se){throw se.caller="git.statusMatrix",se}}async function bn({fs:y,dir:u,gitdir:_=fe(u,".git"),ref:b,object:E,force:T=!1}){try{$e("fs",y),$e("gitdir",_),$e("ref",b);const F=new Bt(y);if(b===void 0)throw new Mt("ref");b=b.startsWith("refs/tags/")?b:`refs/tags/${b}`;const z=await Ot({fsp:F,dotgit:_}),se=await me.resolve({fs:F,gitdir:z,ref:E||"HEAD"});if(!T&&await me.exists({fs:F,gitdir:z,ref:b}))throw new ze("tag",b);await me.writeRef({fs:F,gitdir:z,ref:b,value:se})}catch(F){throw F.caller="git.tag",F}}async function Sn({fs:y,dir:u,gitdir:_=fe(u,".git"),cache:b={},filepath:E,oid:T,mode:F,add:z,remove:se,force:ae}){try{$e("fs",y),$e("gitdir",_),$e("filepath",E);const re=new Bt(y),ue=await Ot({fsp:re,dotgit:_});if(se)return await q.acquire({fs:re,gitdir:ue,cache:b},async function(Ee){if(!ae){const Te=await re.lstat(fe(u,E));if(Te){if(Te.isDirectory())throw new He("directory");return}}Ee.has({filepath:E})&&Ee.delete({filepath:E})});let de;if(!T){if(de=await re.lstat(fe(u,E)),!de)throw new ce(`file at "${E}" on disk and "remove" not set`);if(de.isDirectory())throw new He("directory")}return await q.acquire({fs:re,gitdir:ue,cache:b},async function(Ee){if(!z&&!Ee.has({filepath:E}))throw new ce(`file at "${E}" in index and "add" not set`);let Te;if(T)Te={ctime:new Date(0),mtime:new Date(0),dev:0,ino:0,mode:F,uid:0,gid:0,size:0};else{Te=de;const Ne=Te.isSymbolicLink()?await re.readlink(fe(u,E)):await re.read(fe(u,E));T=await gr({fs:re,gitdir:ue,type:"blob",format:"content",object:Ne})}return Ee.insert({filepath:E,oid:T,stats:Te}),T})}catch(re){throw re.caller="git.updateIndex",re}}function Cn(){try{return ss.version}catch(y){throw y.caller="git.version",y}}async function En({fs:y,dir:u,gitdir:_=fe(u,".git"),trees:b,map:E,reduce:T,iterate:F,cache:z={}}){try{$e("fs",y),$e("gitdir",_),$e("trees",b);const se=new Bt(y),ae=await Ot({fsp:se,dotgit:_});return await kr({fs:se,cache:z,dir:u,gitdir:ae,trees:b,map:E,reduce:T,iterate:F})}catch(se){throw se.caller="git.walk",se}}async function xn({fs:y,dir:u,gitdir:_=fe(u,".git"),blob:b}){try{$e("fs",y),$e("gitdir",_),$e("blob",b);const E=new Bt(y),T=await Ot({fsp:E,dotgit:_});return await gr({fs:E,gitdir:T,type:"blob",object:b,format:"content"})}catch(E){throw E.caller="git.writeBlob",E}}async function kn({fs:y,dir:u,gitdir:_=fe(u,".git"),commit:b}){try{$e("fs",y),$e("gitdir",_),$e("commit",b);const E=new Bt(y),T=await Ot({fsp:E,dotgit:_});return await fn({fs:E,gitdir:T,commit:b})}catch(E){throw E.caller="git.writeCommit",E}}async function An({fs:y,dir:u,gitdir:_=fe(u,".git"),type:b,object:E,format:T="parsed",oid:F,encoding:z=void 0}){try{const se=new Bt(y),ae=await Ot({fsp:se,dotgit:_});if(T==="parsed"){switch(b){case"commit":E=Zt.from(E).toObject();break;case"tree":E=M.from(E).toObject();break;case"blob":E=Buffer.from(E,z);break;case"tag":E=mr.from(E).toObject();break;default:throw new U(F||"",b,"blob|commit|tag|tree")}T="content"}return F=await gr({fs:se,gitdir:ae,type:b,object:E,oid:F,format:T}),F}catch(se){throw se.caller="git.writeObject",se}}async function Rn({fs:y,dir:u,gitdir:_=fe(u,".git"),ref:b,value:E,force:T=!1,symbolic:F=!1}){try{$e("fs",y),$e("gitdir",_),$e("ref",b),$e("value",E);const z=new Bt(y);if(!zr(b,!0))throw new ot(b,o.clean(b));const se=await Ot({fsp:z,dotgit:_});if(!T&&await me.exists({fs:z,gitdir:se,ref:b}))throw new ze("ref",b);F?await me.writeSymbolicRef({fs:z,gitdir:se,ref:b,value:E}):(E=await me.resolve({fs:z,gitdir:se,ref:E}),await me.writeRef({fs:z,gitdir:se,ref:b,value:E}))}catch(z){throw z.caller="git.writeRef",z}}async function Yo({fs:y,gitdir:u,tag:_}){const b=mr.from(_).toObject();return await gr({fs:y,gitdir:u,type:"tag",object:b,format:"content"})}async function $n({fs:y,dir:u,gitdir:_=fe(u,".git"),tag:b}){try{$e("fs",y),$e("gitdir",_),$e("tag",b);const E=new Bt(y),T=await Ot({fsp:E,dotgit:_});return await Yo({fs:E,gitdir:T,tag:b})}catch(E){throw E.caller="git.writeTag",E}}async function Tn({fs:y,dir:u,gitdir:_=fe(u,".git"),tree:b}){try{$e("fs",y),$e("gitdir",_),$e("tree",b);const E=new Bt(y),T=await Ot({fsp:E,dotgit:_});return await Wr({fs:E,gitdir:T,tree:b})}catch(E){throw E.caller="git.writeTree",E}}var Zo={Errors:dr,STAGE:pe,TREE:_r,WORKDIR:Dr,add:Ms,abortMerge:Os,addNote:Hs,addRemote:Ws,annotatedTag:zs,branch:Gs,checkout:ms,clone:oi,commit:ai,getConfig:Ci,getConfigAll:Ei,setConfig:un,currentBranch:ci,deleteBranch:li,deleteRef:hi,deleteRemote:ui,deleteTag:di,expandOid:pi,expandRef:mi,fastForward:wi,fetch:yi,findMergeBase:vi,findRoot:Si,getRemoteInfo:xi,getRemoteInfo2:Ai,hashBlob:Ri,indexPack:$i,init:Ti,isDescendent:Bi,isIgnored:Pi,listBranches:Oi,listFiles:Li,listNotes:Mi,listRefs:Fi,listRemotes:Ni,listServerRefs:ji,listTags:Ui,log:Wi,merge:zi,packObjects:Ki,pull:Vi,push:Ji,readBlob:Xi,readCommit:Cs,readNote:Qi,readObject:en,readTag:tn,readTree:rn,remove:sn,removeNote:nn,renameBranch:on,resetIndex:cn,updateIndex:Sn,resolveRef:hn,status:wn,statusMatrix:vn,tag:bn,version:Cn,walk:En,writeBlob:xn,writeCommit:kn,writeObject:An,writeRef:Rn,writeTag:$n,writeTree:Tn,stash:_n};return isomorphicGit.Errors=dr,isomorphicGit.STAGE=pe,isomorphicGit.TREE=_r,isomorphicGit.WORKDIR=Dr,isomorphicGit.abortMerge=Os,isomorphicGit.add=Ms,isomorphicGit.addNote=Hs,isomorphicGit.addRemote=Ws,isomorphicGit.annotatedTag=zs,isomorphicGit.branch=Gs,isomorphicGit.checkout=ms,isomorphicGit.clone=oi,isomorphicGit.commit=ai,isomorphicGit.currentBranch=ci,isomorphicGit.default=Zo,isomorphicGit.deleteBranch=li,isomorphicGit.deleteRef=hi,isomorphicGit.deleteRemote=ui,isomorphicGit.deleteTag=di,isomorphicGit.expandOid=pi,isomorphicGit.expandRef=mi,isomorphicGit.fastForward=wi,isomorphicGit.fetch=yi,isomorphicGit.findMergeBase=vi,isomorphicGit.findRoot=Si,isomorphicGit.getConfig=Ci,isomorphicGit.getConfigAll=Ei,isomorphicGit.getRemoteInfo=xi,isomorphicGit.getRemoteInfo2=Ai,isomorphicGit.hashBlob=Ri,isomorphicGit.indexPack=$i,isomorphicGit.init=Ti,isomorphicGit.isDescendent=Bi,isomorphicGit.isIgnored=Pi,isomorphicGit.listBranches=Oi,isomorphicGit.listFiles=Li,isomorphicGit.listNotes=Mi,isomorphicGit.listRefs=Fi,isomorphicGit.listRemotes=Ni,isomorphicGit.listServerRefs=ji,isomorphicGit.listTags=Ui,isomorphicGit.log=Wi,isomorphicGit.merge=zi,isomorphicGit.packObjects=Ki,isomorphicGit.pull=Vi,isomorphicGit.push=Ji,isomorphicGit.readBlob=Xi,isomorphicGit.readCommit=Cs,isomorphicGit.readNote=Qi,isomorphicGit.readObject=en,isomorphicGit.readTag=tn,isomorphicGit.readTree=rn,isomorphicGit.remove=sn,isomorphicGit.removeNote=nn,isomorphicGit.renameBranch=on,isomorphicGit.resetIndex=cn,isomorphicGit.resolveRef=hn,isomorphicGit.setConfig=un,isomorphicGit.stash=_n,isomorphicGit.status=wn,isomorphicGit.statusMatrix=vn,isomorphicGit.tag=bn,isomorphicGit.updateIndex=Sn,isomorphicGit.version=Cn,isomorphicGit.walk=En,isomorphicGit.writeBlob=xn,isomorphicGit.writeCommit=kn,isomorphicGit.writeObject=An,isomorphicGit.writeRef=Rn,isomorphicGit.writeTag=$n,isomorphicGit.writeTree=Tn,isomorphicGit}var isomorphicGitExports=requireIsomorphicGit();const git=getDefaultExportFromCjs$1(isomorphicGitExports);function fromValue(t){let e=[t];return{next(){return Promise.resolve({done:e.length===0,value:e.pop()})},return(){return e=[],{}},[Symbol.asyncIterator](){return this}}}function getIterator(t){return t[Symbol.asyncIterator]?t[Symbol.asyncIterator]():t[Symbol.iterator]?t[Symbol.iterator]():t.next?t:fromValue(t)}async function forAwait(t,e){const r=getIterator(t);for(;;){const{value:n,done:c}=await r.next();if(n&&await e(n),c)break}r.return&&r.return()}async function collect(t){let e=0;const r=[];await forAwait(t,s=>{r.push(s),e+=s.byteLength});const n=new Uint8Array(e);let c=0;for(const s of r)n.set(s,c),c+=s.byteLength;return n}function fromStream(t){if(t[Symbol.asyncIterator])return t;const e=t.getReader();return{next(){return e.read()},return(){return e.releaseLock(),{}},[Symbol.asyncIterator](){return this}}}async function request({onProgress:t,url:e,method:r="GET",headers:n={},body:c}){c&&(c=await collect(c));const s=await fetch(e,{method:r,headers:n,body:c}),h=s.body&&s.body.getReader?fromStream(s.body):[new Uint8Array(await s.arrayBuffer())];n={};for(const[o,a]of s.headers.entries())n[o]=a;return{url:s.url,method:s.method,statusCode:s.status,statusMessage:s.statusText,body:h,headers:n}}var index={request};const gitCmd={name:"git",description:"Version control system",async exec(t){const e=t.args[0];if(!e)return t.stdout=`usage: git <command> [<args>]

Available commands:
  init, add, commit, status, log, diff, branch, checkout, clone
  push, pull, fetch, remote, merge
`,0;const r=t.fs.toIsomorphicGitFS(),n=t.cwd;try{switch(e){case"init":{let c=n;t.args[1]&&(c=t.fs.resolvePath(t.args[1],n),await t.fs.mkdir(c,{recursive:!0}));const s=t.fs.resolvePath(".git",c);try{await t.fs.mkdir(s,{recursive:!0})}catch{}await git.init({fs:r,dir:c}),t.stdout=`Initialized empty Git repository in ${c}/.git/
`;break}case"add":{const c=t.args.slice(1);if(c.length===0||c.includes(".")){const s=await listAllFiles(t.fs,n,n);for(const h of s)await git.add({fs:r,dir:n,filepath:h})}else for(const s of c)await git.add({fs:r,dir:n,filepath:s});break}case"commit":{let c="";for(let h=1;h<t.args.length;h++)(t.args[h]==="-m"||t.args[h]==="--message")&&t.args[h+1]&&(c=t.args[++h]);if(!c)return t.stderr=`error: must supply commit message with -m
`,1;const s=await git.commit({fs:r,dir:n,message:c,author:{name:t.env.USER||"user",email:"user@shiro.local"}});t.stdout=`[main ${s.slice(0,7)}] ${c}
`;break}case"status":{const c=await git.statusMatrix({fs:r,dir:n}),s={"003":"added","020":"deleted","023":"deleted",100:"deleted",101:"deleted",103:"modified",110:"deleted",111:"",120:"modified",121:"modified",122:"modified",123:"modified"};let h=!1;const o=[],a=[],d=[];for(const[l,f,p,S]of c){const k=`${f}${p}${S}`;k!=="111"&&(h=!0,f===0&&p===2&&S===0?d.push(l):S===3||f===0&&S===2?o.push(`${s[k]||"modified"}:   ${l}`):(S===0||p!==S)&&a.push(`${s[k]||"modified"}:   ${l}`))}if(t.stdout=`On branch main
`,o.length>0){t.stdout+=`
Changes to be committed:
`;for(const l of o)t.stdout+=`	${l}
`}if(a.length>0){t.stdout+=`
Changes not staged for commit:
`;for(const l of a)t.stdout+=`	${l}
`}if(d.length>0){t.stdout+=`
Untracked files:
`;for(const l of d)t.stdout+=`	${l}
`}h||(t.stdout+=`
nothing to commit, working tree clean
`);break}case"log":{let c=10,s=!1;for(let o=1;o<t.args.length;o++)t.args[o]==="-n"&&t.args[o+1]&&(c=parseInt(t.args[++o])),t.args[o]?.startsWith("--max-count=")&&(c=parseInt(t.args[o].split("=")[1])),t.args[o]==="--oneline"&&(s=!0);const h=await git.log({fs:r,dir:n,depth:c});for(const o of h)if(s)t.stdout+=`${o.oid.slice(0,7)} ${o.commit.message.trim()}
`;else{t.stdout+=`commit ${o.oid}
`,t.stdout+=`Author: ${o.commit.author.name} <${o.commit.author.email}>
`;const a=new Date(o.commit.author.timestamp*1e3);t.stdout+=`Date:   ${a.toISOString()}
`,t.stdout+=`
    ${o.commit.message.trim()}

`}break}case"diff":{const c=await git.statusMatrix({fs:r,dir:n});for(const[s,h,o,a]of c)if(h!==o)if(h===0&&o===2){const d=await t.fs.readFile(t.fs.resolvePath(s,n),"utf8");t.stdout+=`diff --git a/${s} b/${s}
`,t.stdout+=`new file
`,t.stdout+=`--- /dev/null
`,t.stdout+=`+++ b/${s}
`;const l=d.split(`
`);t.stdout+=`@@ -0,0 +1,${l.length} @@
`;for(const f of l)t.stdout+=`+${f}
`}else o===0?(t.stdout+=`diff --git a/${s} b/${s}
`,t.stdout+=`deleted file
`):(t.stdout+=`diff --git a/${s} b/${s}
`,t.stdout+=`--- a/${s}
`,t.stdout+=`+++ b/${s}
`,t.stdout+=`(binary diff not shown)
`);t.stdout||(t.stdout="");break}case"branch":{const c=await git.listBranches({fs:r,dir:n}),s=await git.currentBranch({fs:r,dir:n});for(const h of c)t.stdout+=(h===s?"* ":"  ")+h+`
`;break}case"checkout":{const c=t.args[1];if(!c)return t.stderr=`error: must specify branch or path
`,1;if(c==="-b"){const s=t.args[2];if(!s)return t.stderr=`error: must specify new branch name
`,1;await git.branch({fs:r,dir:n,ref:s,checkout:!0}),t.stdout=`Switched to a new branch '${s}'
`}else if((await git.listBranches({fs:r,dir:n})).includes(c))await git.checkout({fs:r,dir:n,ref:c}),t.stdout=`Switched to branch '${c}'
`;else{const h=c==="--"?t.args[2]:c;if(!h)return t.stderr=`error: pathspec '${c}' did not match any branch or file
`,1;await git.checkout({fs:r,dir:n,ref:"HEAD",filepaths:[h],force:!0}),t.stdout=`Updated 1 path from HEAD
`}break}case"clone":{let c=t.args[1];if(!c)return t.stderr=`error: must specify repository URL
`,1;!c.startsWith("http://")&&!c.startsWith("https://")&&!c.startsWith("git://")&&(c="https://"+c);const s=c.split("/").pop()?.replace(/\.git$/,"")||"repo",h=t.args[2]?t.fs.resolvePath(t.args[2],t.cwd):t.fs.resolvePath(s,t.cwd);await t.fs.mkdir(h,{recursive:!0});const o=t.fs.resolvePath(".git",h);try{await t.fs.mkdir(o,{recursive:!0})}catch{}t.stdout=`Cloning into '${s}'...
`;const a=t.env.GIT_CORS_PROXY||"https://cors.isomorphic-git.org";await Promise.race([git.clone({fs:r,http:index,dir:h,url:c,corsProxy:a,singleBranch:!0,depth:1}),new Promise((d,l)=>setTimeout(()=>l(new Error("clone timed out")),3e4))]),t.stdout+=`done.
`;break}case"remote":{const c=t.args[1];if(!c||c==="-v"){const s=await git.listRemotes({fs:r,dir:n});if(s.length===0)t.stdout="";else for(const h of s)c==="-v"?(t.stdout+=`${h.remote}	${h.url} (fetch)
`,t.stdout+=`${h.remote}	${h.url} (push)
`):t.stdout+=`${h.remote}
`}else if(c==="add"){const s=t.args[2],h=t.args[3];if(!s||!h)return t.stderr=`usage: git remote add <name> <url>
`,1;await git.addRemote({fs:r,dir:n,remote:s,url:h}),t.stdout=""}else if(c==="remove"||c==="rm"){const s=t.args[2];if(!s)return t.stderr=`usage: git remote remove <name>
`,1;await git.deleteRemote({fs:r,dir:n,remote:s}),t.stdout=""}else return t.stderr=`git remote: '${c}' is not a valid subcommand
`,1;break}case"push":{const{remote:c,ref:s,token:h,corsProxy:o}=parseRemoteArgs(t);if(!h)return t.stderr=`error: authentication required
Set GITHUB_TOKEN or run: export GITHUB_TOKEN=ghp_...
`,1;const a=s||await git.currentBranch({fs:r,dir:n})||"main";t.stdout=`Pushing to ${c}/${a}...
`,await git.push({fs:r,http:index,dir:n,remote:c,ref:a,corsProxy:o,onAuth:()=>({username:h})}),t.stdout+=`done.
`;break}case"fetch":{const{remote:c,token:s,corsProxy:h}=parseRemoteArgs(t);if(!s)return t.stderr=`error: authentication required
Set GITHUB_TOKEN or run: export GITHUB_TOKEN=ghp_...
`,1;t.stdout=`Fetching from ${c}...
`,await git.fetch({fs:r,http:index,dir:n,remote:c,corsProxy:h,onAuth:()=>({username:s})}),t.stdout+=`done.
`;break}case"pull":{const{remote:c,ref:s,token:h,corsProxy:o}=parseRemoteArgs(t);if(!h)return t.stderr=`error: authentication required
Set GITHUB_TOKEN or run: export GITHUB_TOKEN=ghp_...
`,1;const a=s||await git.currentBranch({fs:r,dir:n})||"main";t.stdout=`Pulling from ${c}/${a}...
`,await git.pull({fs:r,http:index,dir:n,remote:c,ref:a,corsProxy:o,singleBranch:!0,author:{name:t.env.USER||"user",email:"user@shiro.local"},onAuth:()=>({username:h})}),t.stdout+=`done.
`;break}case"merge":{const c=t.args[1];if(!c)return t.stderr=`usage: git merge <branch>
`,1;const s=await git.merge({fs:r,dir:n,ours:await git.currentBranch({fs:r,dir:n})||"main",theirs:c,author:{name:t.env.USER||"user",email:"user@shiro.local"}});s.alreadyMerged?t.stdout=`Already up to date.
`:s.fastForward?t.stdout=`Fast-forward merge to ${s.oid?.slice(0,7)}
`:t.stdout=`Merge made by the 'recursive' strategy. ${s.oid?.slice(0,7)}
`;break}default:return t.stderr=`git: '${e}' is not a git command
`,1}}catch(c){return t.stderr=`fatal: ${c.message}
`,128}return 0}};function parseRemoteArgs(t){let e="origin",r="";const n=[];for(let h=1;h<t.args.length;h++)t.args[h].startsWith("-")||n.push(t.args[h]);n.length>=1&&(e=n[0]),n.length>=2&&(r=n[1]);const c=t.env.GITHUB_TOKEN||typeof localStorage<"u"&&localStorage.getItem("shiro_github_token")||"",s=t.env.GIT_CORS_PROXY||"https://cors.isomorphic-git.org";return{remote:e,ref:r,token:c,corsProxy:s}}async function listAllFiles(t,e,r){const n=await t.readdir(e),c=[];for(const s of n){if(s===".git")continue;const h=e==="/"?"/"+s:e+"/"+s;(await t.stat(h)).isDirectory()?c.push(...await listAllFiles(t,h,r)):c.push(h.slice(r.length+1))}return c}const fetchCmd={name:"fetch",description:"HTTP client (like curl)",async exec(t){let e="GET",r="",n="",c=!1,s=!1,h="",o=!1,a=!1,d=!1,l=!0;const f={};let p=0;for(;p<t.args.length;){const S=t.args[p];if(S==="-X"&&t.args[p+1])e=t.args[++p].toUpperCase();else if(S==="-H"&&t.args[p+1]){const k=t.args[++p],A=k.indexOf(":");A>0&&(f[k.slice(0,A).trim()]=k.slice(A+1).trim())}else if(S==="-d"&&t.args[p+1])n=t.args[++p],e==="GET"&&(e="POST");else if(S==="-I"||S==="--head")c=!0;else if(S==="-i"||S==="--include")s=!0;else if(S==="-o"&&t.args[p+1])h=t.args[++p];else if(S==="-s"||S==="--silent")o=!0;else if(S==="-S"||S==="--show-error")a=!0;else if(S==="-f"||S==="--fail")d=!0;else if(S==="-L"||S==="--location")l=!0;else if(S.startsWith("-")&&!S.startsWith("--"))for(const k of S.slice(1))k==="f"?d=!0:k==="s"?o=!0:k==="S"?a=!0:k==="L"?l=!0:k==="i"?s=!0:k==="I"&&(c=!0);else S.startsWith("-")||(r=S);p++}if(!r)return t.stderr=`fetch: missing URL
`,1;!r.startsWith("http://")&&!r.startsWith("https://")&&(r="https://"+r);try{const S={method:e,headers:f,redirect:l?"follow":"manual"};n&&e!=="GET"&&e!=="HEAD"&&(S.body=n,f["Content-Type"]||(f["Content-Type"]="application/json"));const k=await fetch(r,S);if(d&&!k.ok)return a&&(t.stderr=`curl: (22) The requested URL returned error: ${k.status}
`),22;let A="";if((s||c)&&(A+=`HTTP/${k.status} ${k.statusText}
`,k.headers.forEach((w,v)=>{A+=`${v}: ${w}
`}),A+=`
`),!c){const w=await k.text();A+=w,w.endsWith(`
`)||(A+=`
`)}if(h){const w=t.fs.resolvePath(h,t.cwd);await t.fs.writeFile(w,A),t.stdout=""}else t.stdout=A;return k.ok?0:1}catch(S){return(!o||a)&&(t.stderr=`curl: ${S.message}
`),1}}},curlCmd={name:"curl",description:"HTTP client (alias for fetch)",exec:fetchCmd.exec},globCmd={name:"glob",description:"Match files using glob patterns (e.g., **/*.ts)",async exec(t){if(t.args.length===0)return t.stderr=`glob: missing pattern
`,1;const e=t.args[0],r=t.args[1]?t.fs.resolvePath(t.args[1],t.cwd):t.cwd,n=await t.fs.glob(e,r);return n.length>0&&(t.stdout=n.join(`
`)+`
`),n.length>0?0:1}},DEFAULT_BASE_URL$2="https://api.anthropic.com",API_VERSION$1="2023-06-01";class ApiClient{constructor(e,r="claude-sonnet-4-20250514",n=DEFAULT_BASE_URL$2){this.apiKey=e,this.model=r,this.baseUrl=n}async createMessage(e,r){const n=await fetch(`${this.baseUrl}/v1/messages`,{method:"POST",headers:{"Content-Type":"application/json","x-api-key":this.apiKey,"anthropic-version":API_VERSION$1,"anthropic-dangerous-direct-browser-access":"true"},body:JSON.stringify({model:this.model,...e}),signal:r});if(!n.ok){const c=await n.text();throw new Error(`Anthropic API error ${n.status}: ${c}`)}return n.json()}async createMessageStream(e,r,n,c){const s={model:this.model,stream:!0,...e};e.thinkingBudget&&e.thinkingBudget>0&&(s.thinking={type:"enabled",budget_tokens:e.thinkingBudget}),delete s.thinkingBudget;const h=await fetch(`${this.baseUrl}/v1/messages`,{method:"POST",headers:{"Content-Type":"application/json","x-api-key":this.apiKey,"anthropic-version":API_VERSION$1,"anthropic-dangerous-direct-browser-access":"true"},body:JSON.stringify(s),signal:n});if(!h.ok){const g=await h.text();throw new Error(`Anthropic API error ${h.status}: ${g}`)}const o=[];let a="end_turn",d=0,l=0;const f=new Map,p=new Map,S=new Map,k=new Map;if(!h.body)throw new Error("Anthropic API error: empty response body (no stream)");const A=h.body.getReader(),w=new TextDecoder;let v="";try{for(;;){let g;try{g=await A.read()}catch(B){const P=B instanceof Error?B.message:String(B);throw new Error(`Stream interrupted: ${P}`)}const{done:m,value:$}=g;if(m)break;v+=w.decode($,{stream:!0});const I=v.split(`
`);v=I.pop();for(const B of I){if(!B.startsWith("data: "))continue;const P=B.slice(6).trim();if(P==="[DONE]")continue;let x;try{x=JSON.parse(P)}catch{continue}switch(x.type){case"error":throw new Error(`Anthropic API stream error (${x.error.type}): ${x.error.message}`);case"message_start":d=x.message.usage.input_tokens;break;case"content_block_start":x.content_block.type==="text"?f.set(x.index,x.content_block.text):x.content_block.type==="thinking"?p.set(x.index,x.content_block.thinking??""):x.content_block.type==="tool_use"&&(k.set(x.index,{id:x.content_block.id,name:x.content_block.name}),S.set(x.index,""));break;case"content_block_delta":if(x.delta.type==="text_delta"){const N=f.get(x.index)??"";f.set(x.index,N+x.delta.text),r(x.delta.text)}else if(x.delta.type==="thinking_delta"){const N=p.get(x.index)??"";p.set(x.index,N+x.delta.thinking),c?.(x.delta.thinking)}else if(x.delta.type==="input_json_delta"){const N=S.get(x.index)??"";S.set(x.index,N+x.delta.partial_json)}break;case"content_block_stop":{if(f.has(x.index)){const N=f.get(x.index);o.push({type:"text",text:N}),f.delete(x.index)}else if(p.has(x.index)){const N=p.get(x.index);o.push({type:"thinking",thinking:N}),p.delete(x.index)}else if(k.has(x.index)){const N=k.get(x.index),J=S.get(x.index)??"{}";let Q;try{Q=JSON.parse(J)}catch{Q={}}o.push({type:"tool_use",id:N.id,name:N.name,input:Q}),k.delete(x.index),S.delete(x.index)}break}case"message_delta":a=x.delta.stop_reason,l=x.usage.output_tokens;break}}}}finally{try{A.releaseLock()}catch{}}return{content:o,stop_reason:a,inputTokens:d,outputTokens:l}}}const bashTool={name:"Bash",description:"Execute a shell command in the virtual terminal. Supports Unix commands, dev tools (node, npm, git, etc.), pipes, redirects, and shell operators.",input_schema:{type:"object",properties:{command:{type:"string",description:"The shell command to execute"}},required:["command"]}};async function executeBash(t,e){const r=await e.exec(t.command);let n="";return r.stdout&&(n+=r.stdout),r.stderr&&(n+=(n?`
`:"")+"STDERR: "+r.stderr),r.exitCode!==0&&(n+=`
[Exit code: ${r.exitCode}]`),n||"(no output)"}const readTool={name:"Read",description:"Read the contents of a file. Returns the file content with line numbers.",input_schema:{type:"object",properties:{file_path:{type:"string",description:"Path to the file to read"},offset:{type:"number",description:"Line number to start reading from (1-based)"},limit:{type:"number",description:"Maximum number of lines to read"}},required:["file_path"]}};async function executeRead(t,e){const r=e.resolvePath(t.file_path),c=(await e.readFile(r)).split(`
`),s=(t.offset??1)-1,h=t.limit?s+t.limit:c.length;return c.slice(s,h).map((a,d)=>`${String(s+d+1).padStart(6)}	${a}`).join(`
`)}const writeTool={name:"Write",description:"Create or overwrite a file with the given content. Creates parent directories if needed.",input_schema:{type:"object",properties:{file_path:{type:"string",description:"Path to write to"},content:{type:"string",description:"Content to write"}},required:["file_path","content"]}};async function executeWrite(t,e){const r=e.resolvePath(t.file_path),n=r.lastIndexOf("/");if(n>0){const c=r.substring(0,n);await e.exists(c)||await e.mkdir(c,{recursive:!0})}return await e.writeFile(r,t.content),`Successfully wrote to ${r}`}const editTool={name:"Edit",description:"Make a surgical edit to a file by replacing an exact string match with new content. The old_string must match exactly once in the file.",input_schema:{type:"object",properties:{file_path:{type:"string",description:"Path to the file to edit"},old_string:{type:"string",description:"Exact string to find (must match uniquely)"},new_string:{type:"string",description:"Replacement string"}},required:["file_path","old_string","new_string"]}};async function executeEdit(t,e){const r=e.resolvePath(t.file_path),n=await e.readFile(r),c=n.split(t.old_string).length-1;if(c===0)return`Error: old_string not found in ${r}`;if(c>1)return`Error: old_string found ${c} times in ${r}. Must match exactly once. Add more surrounding context to make it unique.`;const s=n.replace(t.old_string,t.new_string);return await e.writeFile(r,s),`Successfully edited ${r}`}const globTool={name:"Glob",description:'Find files matching a glob pattern (e.g., "**/*.ts", "src/**/*.js").',input_schema:{type:"object",properties:{pattern:{type:"string",description:"Glob pattern to match"},path:{type:"string",description:"Base directory to search from"}},required:["pattern"]}};async function executeGlob(t,e){const r=t.path?e.resolvePath(t.path):e.getCwd(),n=await e.glob(t.pattern,r);return n.length===0?"No files found":n.join(`
`)}const grepTool={name:"Grep",description:"Search file contents using a regular expression. More efficient than grep via Bash for multi-file searches. Returns matching lines with file paths and line numbers.",input_schema:{type:"object",properties:{pattern:{type:"string",description:"Regular expression pattern to search for"},path:{type:"string",description:"File or directory to search in (defaults to current directory)"},glob:{type:"string",description:'Glob pattern to filter files (e.g., "*.ts", "*.js")'},case_insensitive:{type:"boolean",description:"Case insensitive search (default false)"},max_results:{type:"number",description:"Maximum number of matching lines to return (default 100)"}},required:["pattern"]}};async function executeGrep(t,e){const r=t.case_insensitive?"gi":"g";let n;try{n=new RegExp(t.pattern,r)}catch{return`Error: invalid regex pattern "${t.pattern}"`}const c=t.path?e.resolvePath(t.path):e.getCwd(),s=t.max_results??100,h=[];if((await e.stat(c)).isFile())await searchFile(c,n,s,h,e);else{let d;t.glob?(d=await e.glob(t.glob,c),d=d.map(l=>l.startsWith("/")?l:c==="/"?"/"+l:c+"/"+l)):d=await collectFiles$1(c,e);for(const l of d){if(h.length>=s)break;await searchFile(l,n,s,h,e)}}if(h.length===0)return"No matches found";const a=h.length>=s?`
(results truncated at ${s} matches)`:"";return h.join(`
`)+a}async function searchFile(t,e,r,n,c){let s;try{s=await c.readFile(t)}catch{return}const h=s.split(`
`);for(let o=0;o<h.length&&!(n.length>=r);o++)e.lastIndex=0,e.test(h[o])&&n.push(`${t}:${o+1}:${h[o]}`)}const MAX_COLLECT_DEPTH=20;async function collectFiles$1(t,e,r=0,n=new Set){if(r>MAX_COLLECT_DEPTH||n.has(t))return[];n.add(t);const c=[];let s;try{s=await e.readdir(t)}catch{return[]}for(const h of s)if(h.type==="file")c.push(h.path);else if(h.type==="dir"){const o=await collectFiles$1(h.path,e,r+1,n);c.push(...o)}return c}const askUserTool={name:"AskUserQuestion",description:"Ask the user a question and wait for their response.",input_schema:{type:"object",properties:{question:{type:"string",description:"The question to ask the user"}},required:["question"]}};async function executeAskUser(t,e){return e.readFromUser(t.question)}const webFetchTool={name:"WebFetch",description:"Fetch content from a URL. Returns the response body as text. Useful for reading web pages, APIs, documentation, and other HTTP resources. The URL must be a fully-formed valid URL (e.g., https://example.com).",input_schema:{type:"object",properties:{url:{type:"string",description:"The URL to fetch content from"},method:{type:"string",description:'HTTP method (default: "GET")',enum:["GET","POST","PUT","DELETE","PATCH","HEAD"]},headers:{type:"object",description:"Optional HTTP headers as key-value pairs"},body:{type:"string",description:"Optional request body (for POST/PUT/PATCH)"}},required:["url"]}};async function executeWebFetch(t,e){const r=t.url.trim();let n;try{n=new URL(r)}catch{throw new Error(`Invalid URL: ${r}`)}if(n.protocol!=="http:"&&n.protocol!=="https:")throw new Error(`Unsupported protocol: ${n.protocol} (only http/https allowed)`);const c=t.method||"GET",s={method:c,headers:t.headers};t.body&&["POST","PUT","PATCH"].includes(c)&&(s.body=t.body);const h=await fetch(r,s),o=h.status,a=h.statusText,d=h.headers.get("content-type")||"",l=await h.text();let f=l;d.includes("text/html")&&(f=htmlToText(l));const p=1e5;return f.length>p&&(f=f.slice(0,p)+`

[... truncated, response was `+l.length+" characters]"),`HTTP ${o} ${a}
Content-Type: ${d}
URL: ${r}

${f}`}function htmlToText(t){let e=t.replace(/<script[\s\S]*?<\/script>/gi,"");return e=e.replace(/<style[\s\S]*?<\/style>/gi,""),e=e.replace(/<br\s*\/?>/gi,`
`),e=e.replace(/<\/(p|div|h[1-6]|li|tr|blockquote|pre)>/gi,`
`),e=e.replace(/<(p|div|h[1-6]|li|tr|blockquote|pre)[\s>]/gi,`
`),e=e.replace(/<[^>]+>/g,""),e=e.replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#39;/g,"'").replace(/&nbsp;/g," "),e=e.replace(/[ \t]+/g," "),e=e.replace(/\n{3,}/g,`

`),e=e.trim(),e}class ToolRegistry{constructor(){this.tools=new Map,this.register(bashTool,executeBash),this.register(readTool,executeRead),this.register(writeTool,executeWrite),this.register(editTool,executeEdit),this.register(globTool,executeGlob),this.register(grepTool,executeGrep),this.register(askUserTool,executeAskUser),this.register(webFetchTool,executeWebFetch)}register(e,r){this.tools.set(e.name,{definition:e,execute:r})}getDefinitions(){return Array.from(this.tools.values()).map(e=>e.definition)}async execute(e,r,n){const c=this.tools.get(e);if(!c)throw new Error(`Unknown tool: ${e}`);return c.execute(r,n)}}function buildSystemPrompt(t){const e=t.getHostInfo(),r=t.getEnv(),n=t.getCwd(),c=r.HOME||"/home/user",s=r.USER||"user",h=e.capabilities;return`You are Spirit, an AI development assistant running inside ${e.name} v${e.version}, a browser-based virtual operating system.

You have access to a Unix-like virtual filesystem backed by IndexedDB. Files persist across sessions. The environment runs entirely in the browser  there is no real OS underneath.

Current working directory: ${n}
Home directory: ${c}
User: ${s}

${buildToolsSection()}

${buildShellSection(h)}

${buildDevEnvironmentSection(h)}

${buildBehaviorSection()}

${buildConstraintsSection(c,h)}`}function buildToolsSection(){return`## Tools

You have tools to interact with this environment:
- **Bash**: Run shell commands via the host's command interpreter.
- **Read**: Read file contents with line numbers. Supports offset/limit for large files.
- **Write**: Create or overwrite files. Auto-creates parent directories.
- **Edit**: Exact string replacement in files (old_string must match exactly once). Always read files before editing.
- **Glob**: Find files matching patterns (e.g., "**/*.ts", "src/*.js").
- **Grep**: Regex search across files with glob filtering. Use output_mode for different results.
- **AskUserQuestion**: Ask the user a question and wait for their response.
- **WebFetch**: Fetch content from a URL. Returns the page as readable text. Use for reading docs, APIs, or web resources.
- **TaskCreate**: Create a task to track progress on multi-step work.
- **TaskUpdate**: Update a task's status (pending  in_progress  completed).
- **SpawnAgent**: Launch a sub-agent for concurrent background work.
- **WaitForAgent**: Wait for a sub-agent to complete and get its result.`}function buildShellSection(t){let e=`## Available Shell Commands (via Bash tool)

File operations: ls, cat, head, tail, touch, cp, mv, rm, mkdir, rmdir, find, chmod, ln, readlink
Text processing: grep, sed, sort, uniq, wc, tr, cut, diff, tee, xargs
Shell features: pipes (|), redirects (>, >>), && || ; operators, $VAR expansion
Version control: git init, add, commit, status, log, diff, branch, checkout, clone
Utilities: echo, printf, pwd, cd, env, export, date, whoami, basename, dirname, true, false, clear, uname, hostname`;return t?.extraCommands?.length&&(e+=`
Additional commands: ${t.extraCommands.join(", ")}`),e}function buildDevEnvironmentSection(t){if(!t)return"";const e=["## Dev Environment"];if(t.runtimes.length&&e.push(`- **Runtimes**: ${t.runtimes.join(", ")}`),t.packageManagers.length&&e.push(`- **Package managers**: ${t.packageManagers.join(", ")}`),t.buildTools.length&&e.push(`- **Build tools**: ${t.buildTools.join(", ")}`),t.git&&e.push("- **Git**: available (init, add, commit, status, log, diff, branch, checkout, clone)"),t.fsRoots.length&&e.push(`- **Filesystem roots**: ${t.fsRoots.join(", ")}`),t.notes.length)for(const r of t.notes)e.push(`- ${r}`);return e.length>1?e.join(`
`):""}function buildBehaviorSection(){return`## Behavior Guidelines

- **Read before editing**: Always read files before modifying them. Understand existing code before suggesting changes.
- **Be direct**: Do the work directly. Don't explain what you plan to do  just do it.
- **Be concise**: Keep responses short and focused. Use tool calls, not verbose explanations.
- **Verify your work**: After making changes, verify they're correct (read the file back, run tests if available).
- **Prefer dedicated tools**: Use Read/Write/Edit/Grep tools for file operations rather than cat/echo/grep via Bash.
- **Multi-step tasks**: For complex tasks, create tasks with TaskCreate to track progress.
- **Concurrent work**: Use SpawnAgent for independent subtasks that can run in parallel.`}function buildConstraintsSection(t,e){const r=["## Constraints"];if(e){const n=[];e.packageManagers.includes("apt")||n.push("apt"),e.packageManagers.includes("brew")||n.push("brew"),!e.runtimes.includes("python")&&!e.packageManagers.includes("pip")&&n.push("pip"),n.length&&r.push(`- Not available: ${n.join(", ")}. Use the dev tools listed above.`)}else r.push("- This is a virtual filesystem, not a real OS. There is no apt, brew, pip, npm, or system package manager.");return r.push(`- All file paths are virtual. Root is "/", home is "${t}".`),r.push("- File content is text (UTF-8). No binary file support."),r.push("- Security: Never write secrets or credentials to files. Warn the user if they ask you to."),r.push("- Never create documentation files unless explicitly asked."),r.join(`
`)}class SubAgentManager{constructor(e,r){this.agents=new Map,this.idCounter=0,this.completedResults=[],this.provider=e,this.config=r}setOnUpdate(e){this.onUpdate=e}spawn(e,r){const n=String(++this.idCounter),c={...this.config,maxTurns:this.config.maxTurns?Math.min(this.config.maxTurns,20):20,onText:void 0,onThinking:void 0,onToolStart:void 0,onToolEnd:void 0,onPermissionRequest:void 0,onError:this.config.onError},s=new AgentLoop(this.provider,c),h=s.run(e).then(o=>{const a={id:n,prompt:r??e.slice(0,80),result:o,status:"completed"};return this.completedResults.push(a),this.agents.delete(n),a}).catch(o=>{const a=o instanceof Error?o.message:String(o),d={id:n,prompt:r??e.slice(0,80),result:"",status:"error",error:a};return this.completedResults.push(d),this.agents.delete(n),d});return this.agents.set(n,{loop:s,promise:h}),n}async waitFor(e){const r=this.agents.get(e);if(r)return r.promise;const n=this.completedResults.find(c=>c.id===e);if(n)return n;throw new Error(`Sub-agent ${e} not found`)}async waitAll(){const e=Array.from(this.agents.values()).map(n=>n.promise);return(await Promise.allSettled(e)).map(n=>n.status==="fulfilled"?n.value:{id:"?",prompt:"",result:"",status:"error",error:String(n.reason)})}getStatus(){return{running:Array.from(this.agents.keys()),completed:[...this.completedResults]}}abort(e){const r=this.agents.get(e);return r?(r.loop.abort(),!0):!1}abortAll(){for(const e of this.agents.values())e.loop.abort()}}const DEFAULT_BASE_URL$1="https://api.anthropic.com",API_VERSION="2023-06-01",MODELS$2=["claude-opus-4-5-20251101","claude-sonnet-4-20250514","claude-haiku-3-5-20241022"],PRICING$2={"claude-opus-4-5-20251101":{input:15,output:75},"claude-sonnet-4-20250514":{input:3,output:15},"claude-haiku-3-5-20241022":{input:.8,output:4}};class AnthropicProvider{constructor(e,r,n){if(this.name="anthropic",this.capabilities={streaming:!0,toolUse:!0,thinking:!0,vision:!0},this.availableModels=MODELS$2,e.type!=="api_key")throw new Error("Anthropic only supports API key authentication");this.apiKey=e.apiKey,this.model=r??"claude-sonnet-4-20250514",this.baseUrl=n??DEFAULT_BASE_URL$1}isAuthenticated(){return!!this.apiKey}getPricing(){return PRICING$2[this.model]??null}async createMessage(e,r){const n=await fetch(`${this.baseUrl}/v1/messages`,{method:"POST",headers:{"Content-Type":"application/json","x-api-key":this.apiKey,"anthropic-version":API_VERSION,"anthropic-dangerous-direct-browser-access":"true"},body:JSON.stringify({model:this.model,system:e.system,messages:this.convertMessages(e.messages),tools:e.tools,max_tokens:e.max_tokens}),signal:r});if(!n.ok){const s=await n.text();throw new Error(`Anthropic API error ${n.status}: ${s}`)}const c=await n.json();return{content:c.content,stop_reason:c.stop_reason,inputTokens:c.usage.input_tokens,outputTokens:c.usage.output_tokens}}async createMessageStream(e,r,n){const c={model:this.model,stream:!0,system:e.system,messages:this.convertMessages(e.messages),tools:e.tools,max_tokens:e.max_tokens};e.thinkingBudget&&e.thinkingBudget>0&&(c.thinking={type:"enabled",budget_tokens:e.thinkingBudget});const s=await fetch(`${this.baseUrl}/v1/messages`,{method:"POST",headers:{"Content-Type":"application/json","x-api-key":this.apiKey,"anthropic-version":API_VERSION,"anthropic-dangerous-direct-browser-access":"true"},body:JSON.stringify(c),signal:n});if(!s.ok){const h=await s.text();throw new Error(`Anthropic API error ${s.status}: ${h}`)}return this.parseSSEStream(s,r)}convertMessages(e){return e.filter(r=>r.role!=="system").map(r=>({role:r.role,content:r.content}))}async parseSSEStream(e,r){const n=[];let c="end_turn",s=0,h=0;const o=new Map,a=new Map,d=new Map,l=new Map;if(!e.body)throw new Error("Empty response body");const f=e.body.getReader(),p=new TextDecoder;let S="";try{for(;;){const{done:k,value:A}=await f.read();if(k)break;S+=p.decode(A,{stream:!0});const w=S.split(`
`);S=w.pop();for(const v of w){if(!v.startsWith("data: "))continue;const g=v.slice(6).trim();if(g==="[DONE]")continue;let m;try{m=JSON.parse(g)}catch{continue}switch(m.type){case"error":throw new Error(`Stream error: ${m.error.message}`);case"message_start":s=m.message.usage.input_tokens;break;case"content_block_start":m.content_block.type==="text"?o.set(m.index,m.content_block.text??""):m.content_block.type==="thinking"?a.set(m.index,m.content_block.thinking??""):m.content_block.type==="tool_use"&&(l.set(m.index,{id:m.content_block.id,name:m.content_block.name}),d.set(m.index,""));break;case"content_block_delta":if(m.delta.type==="text_delta"){const $=o.get(m.index)??"";o.set(m.index,$+m.delta.text),r.onText?.(m.delta.text)}else if(m.delta.type==="thinking_delta"){const $=a.get(m.index)??"";a.set(m.index,$+m.delta.thinking),r.onThinking?.(m.delta.thinking)}else if(m.delta.type==="input_json_delta"){const $=d.get(m.index)??"";d.set(m.index,$+m.delta.partial_json)}break;case"content_block_stop":if(o.has(m.index))n.push({type:"text",text:o.get(m.index)}),o.delete(m.index);else if(a.has(m.index))n.push({type:"thinking",thinking:a.get(m.index)}),a.delete(m.index);else if(l.has(m.index)){const $=l.get(m.index),I=d.get(m.index)??"{}";let B;try{B=JSON.parse(I)}catch{B={}}n.push({type:"tool_use",id:$.id,name:$.name,input:B}),l.delete(m.index),d.delete(m.index)}break;case"message_delta":c=m.delta.stop_reason,h=m.usage.output_tokens;break}}}}finally{try{f.releaseLock()}catch{}}return{content:n,stop_reason:c,inputTokens:s,outputTokens:h}}}const DEFAULT_BASE_URL="https://api.openai.com",MODELS$1=["gpt-4o","gpt-4o-mini","gpt-4-turbo","gpt-4","gpt-3.5-turbo","o1","o1-mini"],PRICING$1={"gpt-4o":{input:2.5,output:10},"gpt-4o-mini":{input:.15,output:.6},"gpt-4-turbo":{input:10,output:30},"gpt-4":{input:30,output:60},"gpt-3.5-turbo":{input:.5,output:1.5},o1:{input:15,output:60},"o1-mini":{input:3,output:12}};class OpenAIProvider{constructor(e,r,n){if(this.name="openai",this.capabilities={streaming:!0,toolUse:!0,thinking:!1,vision:!0},this.availableModels=MODELS$1,e.type!=="api_key")throw new Error("OpenAI only supports API key authentication");this.apiKey=e.apiKey,this.model=r??"gpt-4o",this.baseUrl=n??DEFAULT_BASE_URL}isAuthenticated(){return!!this.apiKey}getPricing(){return PRICING$1[this.model]??null}async createMessage(e,r){const n=await fetch(`${this.baseUrl}/v1/chat/completions`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.apiKey}`},body:JSON.stringify({model:this.model,messages:this.convertMessages(e),tools:this.convertTools(e.tools),max_tokens:e.max_tokens}),signal:r});if(!n.ok){const s=await n.text();throw new Error(`OpenAI API error ${n.status}: ${s}`)}const c=await n.json();return this.convertResponse(c)}async createMessageStream(e,r,n){const c=await fetch(`${this.baseUrl}/v1/chat/completions`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.apiKey}`},body:JSON.stringify({model:this.model,messages:this.convertMessages(e),tools:e.tools.length>0?this.convertTools(e.tools):void 0,max_tokens:e.max_tokens,stream:!0}),signal:n});if(!c.ok){const s=await c.text();throw new Error(`OpenAI API error ${c.status}: ${s}`)}return this.parseSSEStream(c,r)}convertMessages(e){const r=[];r.push({role:"system",content:e.system});for(const n of e.messages)if(n.role!=="system"){if(typeof n.content=="string")r.push({role:n.role,content:n.content});else if(Array.isArray(n.content)){const c=n.content.filter(s=>s.type==="tool_result");if(c.length>0)for(const s of c)r.push({role:"tool",tool_call_id:s.tool_use_id,content:s.content});else{const s=n.content.filter(a=>a.type==="text"),h=n.content.filter(a=>a.type==="tool_use"),o={role:"assistant",content:s.length>0?s.map(a=>a.text).join(""):null};h.length>0&&(o.tool_calls=h.map(a=>({id:a.id,type:"function",function:{name:a.name,arguments:JSON.stringify(a.input)}}))),r.push(o)}}}return r}convertTools(e){return e.map(r=>({type:"function",function:{name:r.name,description:r.description,parameters:r.input_schema}}))}convertResponse(e){const r=e.choices[0],n=[];if(r.message.content&&n.push({type:"text",text:r.message.content}),r.message.tool_calls)for(const s of r.message.tool_calls)n.push({type:"tool_use",id:s.id,name:s.function.name,input:JSON.parse(s.function.arguments||"{}")});let c="end_turn";return r.finish_reason==="tool_calls"?c="tool_use":r.finish_reason==="length"&&(c="max_tokens"),{content:n,stop_reason:c,inputTokens:e.usage?.prompt_tokens??0,outputTokens:e.usage?.completion_tokens??0}}async parseSSEStream(e,r){const n=[];let c="";const s=new Map;let h="end_turn",o=0,a=0;if(!e.body)throw new Error("Empty response body");const d=e.body.getReader(),l=new TextDecoder;let f="";try{for(;;){const{done:p,value:S}=await d.read();if(p)break;f+=l.decode(S,{stream:!0});const k=f.split(`
`);f=k.pop();for(const A of k){if(!A.startsWith("data: "))continue;const w=A.slice(6).trim();if(w==="[DONE]")continue;let v;try{v=JSON.parse(w)}catch{continue}const g=v.choices?.[0];if(!g)continue;const m=g.delta;if(m?.content&&(c+=m.content,r.onText?.(m.content)),m?.tool_calls)for(const $ of m.tool_calls){const I=$.index;s.has(I)||s.set(I,{id:$.id??"",name:$.function?.name??"",args:""});const B=s.get(I);$.id&&(B.id=$.id),$.function?.name&&(B.name=$.function.name),$.function?.arguments&&(B.args+=$.function.arguments)}g.finish_reason&&(g.finish_reason==="tool_calls"?h="tool_use":g.finish_reason==="length"&&(h="max_tokens")),v.usage&&(o=v.usage.prompt_tokens??0,a=v.usage.completion_tokens??0)}}}finally{try{d.releaseLock()}catch{}}c&&n.push({type:"text",text:c});for(const[p,S]of s)n.push({type:"tool_use",id:S.id,name:S.name,input:JSON.parse(S.args||"{}")});return{content:n,stop_reason:h,inputTokens:o,outputTokens:a}}}const API_BASE_URL="https://generativelanguage.googleapis.com/v1beta",MODELS=["gemini-2.0-flash","gemini-1.5-pro","gemini-1.5-flash","gemini-1.5-flash-8b"],PRICING={"gemini-2.0-flash":{input:.1,output:.4},"gemini-1.5-pro":{input:1.25,output:5},"gemini-1.5-flash":{input:.075,output:.3},"gemini-1.5-flash-8b":{input:.0375,output:.15}};class GeminiProvider{constructor(e,r){if(this.name="gemini",this.capabilities={streaming:!0,toolUse:!0,thinking:!1,vision:!0},this.availableModels=MODELS,e.type!=="api_key")throw new Error("Gemini provider requires API key authentication");this.apiKey=e.apiKey,this.model=r??"gemini-2.0-flash"}isAuthenticated(){return!!this.apiKey}getPricing(){return PRICING[this.model]??null}getUrl(e){return`${API_BASE_URL}/models/${this.model}:${e}?key=${this.apiKey}`}async createMessage(e,r){const n=await fetch(this.getUrl("generateContent"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(this.convertRequest(e)),signal:r});if(!n.ok){const s=await n.text();throw new Error(`Gemini API error ${n.status}: ${s}`)}const c=await n.json();return this.convertResponse(c)}async createMessageStream(e,r,n){const c=await fetch(this.getUrl("streamGenerateContent")+"&alt=sse",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(this.convertRequest(e)),signal:n});if(!c.ok){const s=await c.text();throw new Error(`Gemini API error ${c.status}: ${s}`)}return this.parseSSEStream(c,r)}convertRequest(e){const r=[],n={parts:[{text:e.system}]};for(const s of e.messages){if(s.role==="system")continue;const h=s.role==="assistant"?"model":"user";if(typeof s.content=="string")r.push({role:h,parts:[{text:s.content}]});else if(Array.isArray(s.content)){const o=[];for(const a of s.content)a.type==="text"?o.push({text:a.text}):a.type==="tool_use"?o.push({functionCall:{name:a.name,args:a.input}}):a.type==="tool_result"&&o.push({functionResponse:{name:a.tool_use_id,response:{result:a.content}}});o.length>0&&r.push({role:h,parts:o})}}const c={contents:r,systemInstruction:n,generationConfig:{maxOutputTokens:e.max_tokens}};return e.tools.length>0&&(c.tools=[{functionDeclarations:e.tools.map(s=>({name:s.name,description:s.description,parameters:s.input_schema}))}]),c}convertResponse(e){const r=[];let n="end_turn";const c=e.candidates?.[0];if(c){for(const s of c.content?.parts??[])s.text&&r.push({type:"text",text:s.text}),s.functionCall&&(r.push({type:"tool_use",id:`call_${Date.now()}_${Math.random().toString(36).slice(2)}`,name:s.functionCall.name,input:s.functionCall.args??{}}),n="tool_use");c.finishReason==="MAX_TOKENS"&&(n="max_tokens")}return{content:r,stop_reason:n,inputTokens:e.usageMetadata?.promptTokenCount??0,outputTokens:e.usageMetadata?.candidatesTokenCount??0}}async parseSSEStream(e,r){const n=[];let c="";const s=[];let h="end_turn",o=0,a=0;if(!e.body)throw new Error("Empty response body");const d=e.body.getReader(),l=new TextDecoder;let f="";try{for(;;){const{done:p,value:S}=await d.read();if(p)break;f+=l.decode(S,{stream:!0});const k=f.split(`
`);f=k.pop();for(const A of k){if(!A.startsWith("data: "))continue;const w=A.slice(6).trim();if(!w)continue;let v;try{v=JSON.parse(w)}catch{continue}const g=v.candidates?.[0];if(g?.content?.parts)for(const m of g.content.parts)m.text&&(c+=m.text,r.onText?.(m.text)),m.functionCall&&(s.push({id:`call_${Date.now()}_${Math.random().toString(36).slice(2)}`,name:m.functionCall.name,input:m.functionCall.args??{}}),h="tool_use");g?.finishReason==="MAX_TOKENS"&&(h="max_tokens"),v.usageMetadata&&(o=v.usageMetadata.promptTokenCount??0,a=v.usageMetadata.candidatesTokenCount??0)}}}finally{try{d.releaseLock()}catch{}}c&&n.push({type:"text",text:c});for(const p of s)n.push({type:"tool_use",id:p.id,name:p.name,input:p.input});return{content:n,stop_reason:h,inputTokens:o,outputTokens:a}}}function createProvider(t){const e={type:"api_key",apiKey:t.apiKey};switch(t.provider){case"anthropic":return new AnthropicProvider(e,t.model,t.baseUrl);case"openai":return new OpenAIProvider(e,t.model,t.baseUrl);case"gemini":return new GeminiProvider(e,t.model);default:throw new Error(`Unknown provider: ${t.provider}`)}}function withTimeout(t,e,r){return new Promise((n,c)=>{const s=setTimeout(()=>c(new Error(r)),e);t.then(h=>{clearTimeout(s),n(h)},h=>{clearTimeout(s),c(h)})})}const DEFAULT_MAX_TURNS=50,DEFAULT_MAX_TOKENS=16384,DEFAULT_TOOL_TIMEOUT_MS=3e4,MAX_API_RETRIES=3,RETRY_BASE_DELAY_MS=1e3,RETRYABLE_STATUS_CODES=new Set([429,500,502,503,529]);class AgentLoop{constructor(e,r){this.messages=[],this.llmProvider=null,this.abortController=null,this.stats={inputTokens:0,outputTokens:0,totalTokens:0,turns:0,toolCalls:0,elapsedMs:0},this.runStartTime=0,this.tasks=[],this.taskIdCounter=0,this.osProvider=e,this.config=r,r.provider?(this.llmProvider=createProvider({provider:r.provider.type,apiKey:r.provider.apiKey??"",model:r.provider.model??r.model,baseUrl:r.provider.baseUrl}),this.apiClient=new ApiClient(r.provider.apiKey??"",r.provider.model??r.model)):this.apiClient=new ApiClient(r.apiKey??"",r.model),this.tools=new ToolRegistry,this.subAgentManager=new SubAgentManager(e,r),this.tools.register({name:"TaskCreate",description:"Create a task to track progress on multi-step work. Returns the task ID.",input_schema:{type:"object",properties:{subject:{type:"string",description:"Brief task title"},description:{type:"string",description:"Detailed description"}},required:["subject"]}},async n=>{const c=String(++this.taskIdCounter);return this.tasks.push({id:c,subject:n.subject,status:"pending",description:n.description}),this.config.onTaskUpdate?.([...this.tasks]),`Task #${c} created: ${n.subject}`}),this.tools.register({name:"TaskUpdate",description:"Update a task's status. Use 'in_progress' when starting work, 'completed' when done.",input_schema:{type:"object",properties:{taskId:{type:"string",description:"The task ID to update"},status:{type:"string",enum:["pending","in_progress","completed"],description:"New status"}},required:["taskId","status"]}},async n=>{const c=this.tasks.find(s=>s.id===n.taskId);return c?(c.status=n.status,this.config.onTaskUpdate?.([...this.tasks]),`Task #${c.id}  ${c.status}`):`Error: task ${n.taskId} not found`}),this.tools.register({name:"SpawnAgent",description:"Launch a sub-agent to handle a task concurrently. The sub-agent runs independently with its own conversation. Returns an agent ID for tracking.",input_schema:{type:"object",properties:{prompt:{type:"string",description:"The task for the sub-agent to perform"},description:{type:"string",description:"Short description for tracking (3-5 words)"}},required:["prompt"]}},async n=>`Sub-agent #${this.subAgentManager.spawn(n.prompt,n.description)} spawned: ${n.description??n.prompt.slice(0,60)}`),this.tools.register({name:"WaitForAgent",description:"Wait for a sub-agent to complete and get its result. Use 'all' as ID to wait for all running agents.",input_schema:{type:"object",properties:{agentId:{type:"string",description:"The agent ID to wait for, or 'all'"}},required:["agentId"]}},async n=>{const c=n.agentId;if(c==="all")return(await this.subAgentManager.waitAll()).map(o=>`Agent #${o.id} (${o.prompt}): ${o.status}${o.status==="error"?` - ${o.error}`:""}
${o.result.slice(0,500)}`).join(`

`);const s=await this.subAgentManager.waitFor(c);return`Agent #${s.id} (${s.prompt}): ${s.status}
${s.result}`})}registerTool(e,r){this.tools.register(e,r)}async run(e){this.abortController=new AbortController,this.runStartTime=Date.now(),this.messages.push({role:"user",content:e});const r=this.config.systemPrompt??buildSystemPrompt(this.osProvider),n=this.config.maxTurns??DEFAULT_MAX_TURNS,c=this.config.maxTokens??DEFAULT_MAX_TOKENS;for(;this.stats.turns<n;){let s;try{s=await this.callApiWithRetry(r,c,this.abortController.signal)}catch(l){const f=l instanceof Error?l.message:String(l);return this.config.onError?.(l instanceof Error?l:new Error(f)),`[Spirit error: ${f}]`}this.stats.inputTokens+=s.inputTokens,this.stats.outputTokens+=s.outputTokens,this.stats.totalTokens=this.stats.inputTokens+this.stats.outputTokens,this.stats.turns++,this.stats.elapsedMs=Date.now()-this.runStartTime,this.emitStats(),this.messages.push({role:"assistant",content:s.content});const h=s.content.filter(l=>l.type==="text").map(l=>l.text),o=s.content.filter(l=>l.type==="tool_use");if(o.length===0)return h.join("");const a=[],d=new Set(["Bash","Write","Edit"]);for(const l of o){if(this.stats.toolCalls++,d.has(l.name)&&this.config.onPermissionRequest){const f=this.describeToolUse(l),p={tool:l.name,description:f,input:l.input};if(!await this.config.onPermissionRequest(p)){a.push({type:"tool_result",tool_use_id:l.id,content:"Permission denied by user.",is_error:!0});continue}}this.config.onToolStart?.(l.name,l.input);try{const f=this.config.toolTimeoutMs??DEFAULT_TOOL_TIMEOUT_MS,p=await withTimeout(this.tools.execute(l.name,l.input,this.osProvider),f,`Tool "${l.name}" timed out after ${f}ms`);this.config.onToolEnd?.(l.name,p),a.push({type:"tool_result",tool_use_id:l.id,content:p})}catch(f){const p=f instanceof Error?f.message:String(f);this.config.onError?.(f instanceof Error?f:new Error(p)),a.push({type:"tool_result",tool_use_id:l.id,content:`Error: ${p}`,is_error:!0})}this.stats.elapsedMs=Date.now()-this.runStartTime,this.emitStats()}this.messages.push({role:"user",content:a})}return"[Spirit: max turns reached]"}async callApiWithRetry(e,r,n){let c=null;for(let s=0;s<=MAX_API_RETRIES;s++){if(s>0){const h=RETRY_BASE_DELAY_MS*Math.pow(2,s-1);this.config.onText?.(`
[Retrying API call (attempt ${s+1}/${MAX_API_RETRIES+1}) after ${h}ms...]
`),await new Promise(o=>setTimeout(o,h))}try{if(this.llmProvider){const h=await this.llmProvider.createMessageStream({system:e,messages:this.messages,tools:this.tools.getDefinitions(),max_tokens:r,thinkingBudget:this.config.thinkingBudget},{onText:o=>this.config.onText?.(o),onThinking:o=>this.config.onThinking?.(o)},n);return{content:h.content,stop_reason:h.stop_reason,inputTokens:h.inputTokens,outputTokens:h.outputTokens}}return await this.apiClient.createMessageStream({system:e,messages:this.messages,tools:this.tools.getDefinitions(),max_tokens:r,thinkingBudget:this.config.thinkingBudget},h=>{this.config.onText?.(h)},n,h=>{this.config.onThinking?.(h)})}catch(h){c=h instanceof Error?h:new Error(String(h));const o=c.message.match(/API error (\d+)/),a=o?parseInt(o[1],10):0;if(a>0&&!RETRYABLE_STATUS_CODES.has(a))throw c}}throw c??new Error("API call failed after retries")}async compact(){if(this.messages.length<4)return"Nothing to compact";const e=[...this.messages,{role:"user",content:"Summarize this entire conversation concisely. Preserve: all file paths mentioned, all decisions made, current state of work, and any pending tasks. This summary will replace the conversation history to save tokens."}],n=(await this.apiClient.createMessage({system:"You are a conversation summarizer. Be concise but complete.",messages:e,tools:[],max_tokens:4096},this.abortController?.signal)).content.filter(s=>s.type==="text").map(s=>s.text).join(""),c=this.messages.length;return this.messages=[{role:"user",content:`[Conversation summary from ${c} messages]

${n}`},{role:"assistant",content:"Understood. I have the context from the conversation summary. How can I continue helping?"}],`Compacted ${c} messages  summary (${n.length} chars)`}describeToolUse(e){const r=e.input;switch(e.name){case"Bash":return`Run command: ${r.command}`;case"Write":return`Write to ${r.file_path}`;case"Edit":return`Edit ${r.file_path}`;default:return`${e.name}: ${JSON.stringify(r).slice(0,100)}`}}emitStats(){this.config.onStats?.({...this.stats})}abort(){this.abortController?.abort(),this.subAgentManager.abortAll()}clearHistory(){this.messages=[],this.stats={inputTokens:0,outputTokens:0,totalTokens:0,turns:0,toolCalls:0,elapsedMs:0},this.tasks=[],this.taskIdCounter=0}getMessages(){return[...this.messages]}getStats(){return{...this.stats,elapsedMs:this.runStartTime?Date.now()-this.runStartTime:this.stats.elapsedMs}}getTasks(){return[...this.tasks]}getApiClient(){return this.apiClient}}const SLASH_COMMANDS={"/help":"Show available commands","/clear":"Clear conversation history and stats","/compact":"Summarize conversation to reduce token usage","/model":"Switch model (e.g., /model opus, /model sonnet)","/stats":"Show token usage and timing","/tasks":"Show task checklist","/thinking":"Toggle extended thinking (e.g., /thinking 10000)","/cost":"Show estimated API cost","/history":"Show conversation turn count","/env":"Show dev environment capabilities","/abort":"Cancel current run"},MODEL_ALIASES={opus:"claude-opus-4-5-20251101",sonnet:"claude-sonnet-4-20250514",haiku:"claude-haiku-3-5-20241022"},MODEL_PRICING={"claude-opus-4-5-20251101":{input:15,output:75},"claude-sonnet-4-20250514":{input:3,output:15},"claude-haiku-3-5-20241022":{input:.8,output:4}};class SpiritAgent{constructor(e,r){this.provider=e,this.config=r,this.loop=new AgentLoop(e,r)}registerTool(e,r){this.loop.registerTool(e,r)}async handleSlashCommand(e){const r=e.trim();if(!r.startsWith("/"))return{handled:!1,output:""};const n=r.split(/\s+/),c=n[0].toLowerCase();switch(c){case"/help":return{handled:!0,output:`Available commands:
${Object.entries(SLASH_COMMANDS).map(([h,o])=>`  ${h.padEnd(12)} ${o}`).join(`
`)}`};case"/clear":return this.loop.clearHistory(),{handled:!0,output:"Conversation cleared."};case"/compact":return{handled:!0,output:await this.loop.compact()};case"/model":{const s=n[1];if(!s)return{handled:!0,output:`Current model: ${this.loop.getApiClient().model}
Usage: /model <name>
Aliases: ${Object.keys(MODEL_ALIASES).join(", ")}`};const h=MODEL_ALIASES[s.toLowerCase()]??s;return this.loop.getApiClient().model=h,{handled:!0,output:`Model switched to: ${h}`}}case"/stats":{const s=this.loop.getStats(),h=(s.elapsedMs/1e3).toFixed(1);return{handled:!0,output:[`Tokens: ${s.inputTokens.toLocaleString()} in / ${s.outputTokens.toLocaleString()} out (${s.totalTokens.toLocaleString()} total)`,`Turns: ${s.turns}  Tool calls: ${s.toolCalls}`,`Elapsed: ${h}s`].join(`
`)}}case"/tasks":{const s=this.loop.getTasks();if(s.length===0)return{handled:!0,output:"No tasks."};const h={pending:"[ ]",in_progress:"[~]",completed:"[x]"};return{handled:!0,output:s.map(a=>`${h[a.status]??"[ ]"} #${a.id} ${a.subject}`).join(`
`)}}case"/thinking":{const s=parseInt(n[1],10);if(!n[1]){const h=this.config.thinkingBudget??0;return{handled:!0,output:h>0?`Extended thinking: enabled (budget: ${h.toLocaleString()} tokens)`:`Extended thinking: disabled
Usage: /thinking <budget> (e.g., /thinking 10000)`}}return isNaN(s)||s<0?{handled:!0,output:"Invalid budget. Use a positive number or 0 to disable."}:(this.config.thinkingBudget=s,{handled:!0,output:s>0?`Extended thinking enabled: ${s.toLocaleString()} token budget`:"Extended thinking disabled."})}case"/cost":{const s=this.loop.getStats(),h=this.loop.getApiClient().model,o=MODEL_PRICING[h];if(o){const a=s.inputTokens/1e6*o.input,d=s.outputTokens/1e6*o.output,l=a+d;return{handled:!0,output:[`Model: ${h}`,`Input:  ${s.inputTokens.toLocaleString()} tokens  $${o.input}/M = $${a.toFixed(4)}`,`Output: ${s.outputTokens.toLocaleString()} tokens  $${o.output}/M = $${d.toFixed(4)}`,`Total:  $${l.toFixed(4)}`].join(`
`)}}return{handled:!0,output:`Model: ${h}
Tokens: ${s.totalTokens.toLocaleString()} (pricing unknown for this model)`}}case"/history":{const s=this.loop.getMessages().length,h=this.loop.getStats();return{handled:!0,output:`Messages: ${s}  Turns: ${h.turns}  Tool calls: ${h.toolCalls}`}}case"/env":{const s=this.provider.getHostInfo(),h=s.capabilities;if(!h)return{handled:!0,output:`${s.name} v${s.version}
No dev capabilities declared.`};const o=[`${s.name} v${s.version}  Dev Environment`];if(h.runtimes.length&&o.push(`Runtimes:         ${h.runtimes.join(", ")}`),h.packageManagers.length&&o.push(`Package managers:  ${h.packageManagers.join(", ")}`),h.buildTools.length&&o.push(`Build tools:       ${h.buildTools.join(", ")}`),o.push(`Git:               ${h.git?"yes":"no"}`),h.extraCommands.length&&o.push(`Extra commands:    ${h.extraCommands.join(", ")}`),h.fsRoots.length&&o.push(`FS roots:          ${h.fsRoots.join(", ")}`),h.notes.length){o.push("");for(const a of h.notes)o.push(`  ${a}`)}return{handled:!0,output:o.join(`
`)}}case"/abort":return this.loop.abort(),{handled:!0,output:"Aborted."};default:return{handled:!0,output:`Unknown command: ${c}. Type /help for available commands.`}}}async run(e){return this.loop.run(e)}abort(){this.loop.abort()}clearHistory(){this.loop.clearHistory()}getStats(){return this.loop.getStats()}getTasks(){return this.loop.getTasks()}async compact(){return this.loop.compact()}}const spiritCmd={name:"spirit",description:"AI coding agent",async exec(t){const e=t.env.ANTHROPIC_API_KEY||typeof localStorage<"u"&&localStorage.getItem("shiro_anthropic_key")||"",r=t.env.OPENAI_API_KEY||typeof localStorage<"u"&&localStorage.getItem("shiro_openai_key")||"",n=t.env.GOOGLE_API_KEY||typeof localStorage<"u"&&localStorage.getItem("shiro_google_key")||"",c=typeof localStorage<"u"&&localStorage.getItem("shiro_api_key")||"",s=e||r||n||c,h=e?"anthropic":r?"openai":n?"gemini":"anthropic";if(!s)return t.stdout=["Spirit - AI Coding Agent for Shiro OS","","Spirit is not configured. Set an API key for your preferred provider:","","  Anthropic (Claude):","    export ANTHROPIC_API_KEY=sk-ant-your-key-here","","  OpenAI (GPT):","    export OPENAI_API_KEY=sk-your-key-here","","  Google (Gemini):","    export GOOGLE_API_KEY=your-key-here","","Or persist keys across sessions:","  shiro config set anthropic_key sk-ant-...","  shiro config set openai_key sk-...","  shiro config set google_key ...","","Then run:","  spirit                          # interactive mode",'  spirit "your prompt here"       # one-shot mode',"","Slash commands: /help, /clear, /model, /stats, /thinking, /cost, /exit",""].join(`
`),1;t.env.SPIRIT_PROVIDER=h;const o=t.shell._spiritProvider;if(!o)return t.stderr=`spirit: provider not initialized
`,1;const a=createAgent(t,o,s,h),d=t.args.join(" ");return d?await runOneShot(t,a,o,d):await runRepl(t,a,o)}};function createAgent(t,e,r,n){const c={anthropic:"claude-sonnet-4-20250514",openai:"gpt-4o",gemini:"gemini-2.0-flash"};return new SpiritAgent(e,{provider:{type:n,apiKey:r,model:t.env.SPIRIT_MODEL||c[n]},model:t.env.SPIRIT_MODEL||c[n],maxTurns:parseInt(t.env.SPIRIT_MAX_TURNS||"30",10),maxTokens:parseInt(t.env.SPIRIT_MAX_TOKENS||"8192",10),thinkingBudget:t.env.SPIRIT_THINKING?parseInt(t.env.SPIRIT_THINKING,10):void 0,onText:s=>{e.writeToTerminal(s.replace(/\n/g,`\r
`))},onThinking:s=>{e.writeToTerminal(`\x1B[2m${s.replace(/\n/g,`\r
`)}\x1B[0m`)},onToolStart:(s,h)=>{const o=s==="Bash"?`$ ${h.command}`:s==="Read"?`Reading ${h.file_path}`:s==="Write"?`Writing ${h.file_path}`:s==="Edit"?`Editing ${h.file_path}`:s==="Glob"?`Glob ${h.pattern}`:`${s}`;e.writeToTerminal(`\x1B[36m ${o}\x1B[0m\r
`)},onToolEnd:(s,h)=>{},onError:s=>{e.writeToTerminal(`\x1B[31mError: ${s.message.replace(/\n/g,`\r
`)}\x1B[0m\r
`)}})}async function runOneShot(t,e,r,n){try{if(n.startsWith("/")){const{handled:s,output:h}=await e.handleSlashCommand(n);if(s)return t.stdout=h.replace(/\n/g,`\r
`)+`\r
`,0}const c=await e.run(n);return t.stdout=c,0}catch(c){return t.stderr=`spirit: ${c.message}
`,1}}async function runRepl(t,e,r){for(r.writeToTerminal(`\x1B[1;95mSpirit\x1B[0m  AI Coding Agent\r
`),r.writeToTerminal(`\x1B[90mType your prompt, /help for commands, /exit to quit.\x1B[0m\r
\r
`);;){const c=(await r.readFromUser("\x1B[95mspirit>\x1B[0m")).trim();if(c===""||c==="/exit"||c==="/quit"){r.writeToTerminal(`\r
`);break}if(c.startsWith("/"))try{const{handled:s,output:h}=await e.handleSlashCommand(c);if(s){const o=h.replace(/\n/g,`\r
`);r.writeToTerminal(o+`\r
\r
`);continue}}catch(s){r.writeToTerminal(`\x1B[31mError: ${s.message}\x1B[0m\r
`);continue}try{await e.run(c),r.writeToTerminal(`\r
`)}catch(s){r.writeToTerminal(`\x1B[31mError: ${s.message}\x1B[0m\r
`)}}return 0}class IframeServerManager{servers=new Map;defaultContainer=null;setDefaultContainer(e){this.defaultContainer=e}serve(e,r,n){if(this.servers.has(e))throw new Error(`Port ${e} already in use`);return this.servers.set(e,{port:e,handler:r,name:n}),console.log(`[IframeServer] Server "${n||"unnamed"}" listening on port ${e}`),()=>this.close(e)}async fetch(e,r="/",n){const c=this.servers.get(e);if(!c)return{status:404,body:`No server listening on port ${e}`};let s=r,h={};const o=r.indexOf("?");o>=0&&(s=r.substring(0,o),new URLSearchParams(r.substring(o+1)).forEach((l,f)=>{h[f]=l}));const a={method:n?.method||"GET",path:s,headers:n?.headers||{},body:n?.body||null,query:h};try{return await c.handler(a)}catch(d){return{status:500,body:d instanceof Error?d.message:"Internal server error"}}}async createIframe(e,r,n){const c=r||this.defaultContainer;if(!c)throw new Error("No container specified and no default container set");const s=this.servers.get(e);if(!s)throw new Error(`No server listening on port ${e}`);const h=n?.path||"/",o=await this.fetch(e,h),a=document.createElement("iframe");a.setAttribute("data-virtual-port",String(e)),a.setAttribute("data-virtual-path",h),a.style.border="none",a.style.width=n?.width||"100%",a.style.height=n?.height||"400px",n?.style&&Object.assign(a.style,n.style);let d;typeof o.body=="string"?d=o.body:o.body instanceof Uint8Array?d=new TextDecoder().decode(o.body):o.body&&typeof o.body=="object"?d=`<!DOCTYPE html>
<html>
<head><meta charset="UTF-8"><title>JSON</title></head>
<body><pre>${JSON.stringify(o.body,null,2)}</pre></body>
</html>`:d="<!DOCTYPE html><html><body></body></html>";const l=`
<script>
(function() {
  // Intercept link clicks for virtual navigation
  document.addEventListener('click', function(e) {
    const link = e.target.closest('a[href]');
    if (link && link.href) {
      const href = link.getAttribute('href');
      // Only intercept relative and same-origin links
      if (href && !href.startsWith('http://') && !href.startsWith('https://') && !href.startsWith('//')) {
        e.preventDefault();
        window.parent.postMessage({
          type: 'virtual-navigate',
          port: ${e},
          path: href
        }, '*');
      }
    }
  });

  // Intercept form submissions
  document.addEventListener('submit', function(e) {
    const form = e.target;
    if (form.tagName === 'FORM') {
      e.preventDefault();
      const formData = new FormData(form);
      const data = {};
      formData.forEach((value, key) => data[key] = value);
      window.parent.postMessage({
        type: 'virtual-submit',
        port: ${e},
        path: form.getAttribute('action') || '/',
        method: form.method || 'GET',
        data: data
      }, '*');
    }
  });
})();
<\/script>
`;d.includes("</body>")?d=d.replace("</body>",l+"</body>"):d.includes("</html>")?d=d.replace("</html>",l+"</html>"):d+=l,a.srcdoc=d,s.iframe=a,c.appendChild(a);const f=async p=>{if(p.source===a.contentWindow){if(p.data?.type==="virtual-navigate"&&p.data?.port===e)await this.navigateIframe(e,p.data.path);else if(p.data?.type==="virtual-submit"&&p.data?.port===e){const S=await this.fetch(e,p.data.path,{method:p.data.method,body:JSON.stringify(p.data.data)});if(typeof S.body=="string"){let k=S.body;k.includes("</body>")&&(k=k.replace("</body>",l+"</body>")),a.srcdoc=k}}}};return window.addEventListener("message",f),a._messageHandler=f,a}async navigateIframe(e,r){const n=this.servers.get(e);if(!n?.iframe)throw new Error(`No iframe for port ${e}`);const c=await this.fetch(e,r);let s;typeof c.body=="string"?s=c.body:c.body instanceof Uint8Array?s=new TextDecoder().decode(c.body):s=`<pre>${JSON.stringify(c.body,null,2)}</pre>`,n.iframe.setAttribute("data-virtual-path",r),n.iframe.srcdoc=s}close(e){const r=this.servers.get(e);if(r){if(r.iframe){const n=r.iframe._messageHandler;n&&window.removeEventListener("message",n),r.iframe.remove()}this.servers.delete(e),console.log(`[IframeServer] Server on port ${e} closed`)}}list(){return Array.from(this.servers.values()).map(e=>({port:e.port,name:e.name,hasIframe:!!e.iframe}))}isPortInUse(e){return this.servers.has(e)}getServer(e){return this.servers.get(e)}cleanup(){for(const[e]of this.servers)this.close(e);console.log("[IframeServer] All servers cleaned up")}}const iframeServer=new IframeServerManager;function createStaticServer(t,e,r){const n=r?.index||["index.html","index.htm"],c={".html":"text/html",".htm":"text/html",".css":"text/css",".js":"text/javascript",".mjs":"text/javascript",".json":"application/json",".png":"image/png",".jpg":"image/jpeg",".jpeg":"image/jpeg",".gif":"image/gif",".svg":"image/svg+xml",".ico":"image/x-icon",".woff":"font/woff",".woff2":"font/woff2",".ttf":"font/ttf",".txt":"text/plain",".md":"text/markdown",...r?.mimeTypes};return async s=>{let h=e+(s.path==="/"?"":s.path);try{if((await t.stat(h))?.isDirectory())for(const a of n){const d=h+(h.endsWith("/")?"":"/")+a;try{const l=await t.stat(d);if(l&&!l.isDirectory()){h=d;break}}catch{}}}catch{}try{const o=await t.readFile(h),a=h.substring(h.lastIndexOf(".")),d=c[a]||"application/octet-stream";return{status:200,contentType:d,headers:{"Content-Type":d},body:o}}catch{return{status:404,contentType:"text/html",body:`<!DOCTYPE html>
<html>
<head><title>404 Not Found</title></head>
<body>
<h1>404 Not Found</h1>
<p>The requested path "${s.path}" was not found.</p>
</body>
</html>`}}}}function createRouter(){const t=[];function e(n,c,s){const h=[],o=new RegExp("^"+c.replace(/:(\w+)/g,(a,d)=>(h.push(d),"([^/]+)"))+"$");t.push({method:n,pattern:o,keys:h,handler:s})}const r={get:(n,c)=>e("GET",n,c),post:(n,c)=>e("POST",n,c),put:(n,c)=>e("PUT",n,c),delete:(n,c)=>e("DELETE",n,c),all:(n,c)=>{e("GET",n,c),e("POST",n,c),e("PUT",n,c),e("DELETE",n,c)},async handle(n){for(const c of t){if(c.method!==n.method&&c.method!=="*")continue;const s=n.path.match(c.pattern);if(s){const h={};return c.keys.forEach((o,a)=>{h[o]=s[a+1]}),c.handler({...n,params:h})}}return{status:404,body:"Not Found"}},serve(n,c){return iframeServer.serve(n,s=>r.handle(s),c||`router:${n}`)}};return r}typeof window<"u"&&(window.__iframeServer=iframeServer,window.__createStaticServer=createStaticServer,window.__createRouter=createRouter);const jsEvalCmd={name:"js-eval",description:"Evaluate JavaScript expression in the browser VM",async exec(t){let e=t.args.join(" ");if(!e.trim()&&t.stdin&&(e=t.stdin),!e.trim())return t.stderr+=`js-eval: no code provided
`,t.stderr+=`Usage: js-eval <expression>
`,1;try{const r={fs:t.fs,shell:t.shell,env:t.env,cwd:t.cwd},n=Object.getPrototypeOf(async function(){}).constructor,s=await new n("shiro",`
        const result = await (async () => { return (${e}); })().catch(async () => {
          // If expression eval fails, try as statements
          await (async () => { ${e} })();
          return undefined;
        });
        return result;
      `)(r);if(s!==void 0){const h=typeof s=="string"?s:JSON.stringify(s,null,2);t.stdout+=h+`
`}return 0}catch(r){return t.stderr+=`js-eval: ${r.message}
`,1}}},nodeCmd={name:"node",description:"Execute JavaScript files (browser JS VM)",async exec(t){let e="",r=!1;const n=[];for(let s=0;s<t.args.length;s++)if(t.args[s]==="-e"||t.args[s]==="--eval")e=t.args[++s]||"";else if(t.args[s]==="-p"||t.args[s]==="--print")e=t.args[++s]||"",r=!0;else{if(t.args[s]==="--help"||t.args[s]==="-h")return t.stdout+=`Usage: node [options] [script.js] [arguments]
`,t.stdout+=`  -e, --eval <code>   Evaluate code
`,t.stdout+=`  -p, --print <code>  Evaluate and print result
`,t.stdout+=`
Note: Runs in browser JS VM, not real Node.js.
`,t.stdout+=`Full DOM/browser API access available.
`,0;n.push(t.args[s])}let c="";if(!e&&n.length>0){c=t.fs.resolvePath(n[0],t.cwd);try{e=await t.fs.readFile(c,"utf8")}catch(s){return t.stderr+=`node: ${s.message}
`,1}}if(!e&&t.stdin&&(e=t.stdin),!e)return t.stderr+=`node: no input provided
`,1;try{let s=function(j,H,G){return typeof j=="number"?s.alloc(j):s.from(j,H)},h=function(j){switch(j){case"path":case"node:path":return{join:(...H)=>H.join("/").replace(/\/+/g,"/"),resolve:(...H)=>{let G=H.reduce((V,oe)=>oe.startsWith("/")?oe:V+"/"+oe);return t.fs.resolvePath(G,t.cwd)},dirname:H=>H.substring(0,H.lastIndexOf("/"))||"/",basename:(H,G)=>{const V=H.split("/").pop()||"";return G&&V.endsWith(G)?V.slice(0,-G.length):V},extname:H=>{const G=H.match(/\.[^./]+$/);return G?G[0]:""},isAbsolute:H=>H.startsWith("/"),normalize:H=>t.fs.resolvePath(H,"/"),relative:(H,G)=>{const V=H.split("/").filter(Boolean),oe=G.split("/").filter(Boolean);let Z=0;for(;Z<V.length&&Z<oe.length&&V[Z]===oe[Z];)Z++;return[...Array(V.length-Z).fill(".."),...oe.slice(Z)].join("/")||"."},sep:"/",delimiter:":",parse:H=>({root:H.startsWith("/")?"/":"",dir:H.substring(0,H.lastIndexOf("/")),base:H.split("/").pop()||"",ext:(H.match(/\.[^./]+$/)||[""])[0],name:(H.split("/").pop()||"").replace(/\.[^.]+$/,"")}),format:H=>(H.dir?H.dir+"/":"")+(H.base||H.name+(H.ext||""))};case"fs":case"node:fs":return{readFileSync:(G,V)=>{const oe=t.fs.resolvePath(G,t.cwd),Z=m.get(oe)??m.get(oe+".js");if(Z!==void 0)return Z;throw new Error(`ENOENT: no such file or directory, open '${G}'`)},writeFileSync:(G,V)=>{const oe=t.fs.resolvePath(G,t.cwd),Z=typeof V=="string"?V:new TextDecoder().decode(V);m.set(oe,Z),t.fs.writeFile(oe,Z).catch(()=>{})},existsSync:G=>{const V=t.fs.resolvePath(G,t.cwd);return m.has(V)||m.has(V+".js")||m.has(V+"/index.js")},statSync:G=>{const V=t.fs.resolvePath(G,t.cwd),oe=m.has(V),Z=[...m.keys()].some(pe=>pe.startsWith(V+"/"));if(!oe&&!Z)throw new Error(`ENOENT: no such file or directory, stat '${G}'`);return{isFile:()=>oe,isDirectory:()=>Z&&!oe,isSymbolicLink:()=>!1,size:oe?(m.get(V)||"").length:0,mtime:new Date}},readdirSync:G=>{const V=t.fs.resolvePath(G,t.cwd),oe=V==="/"?"/":V+"/",Z=new Set;for(const pe of m.keys())if(pe.startsWith(oe)){const U=pe.slice(oe.length).split("/")[0];U&&Z.add(U)}return[...Z].sort()},mkdirSync:(G,V)=>{t.fs.mkdir(t.fs.resolvePath(G,t.cwd),V).catch(()=>{})},unlinkSync:G=>{t.fs.unlink(t.fs.resolvePath(G,t.cwd)).catch(()=>{})},copyFileSync:(G,V)=>{const oe=t.fs.resolvePath(G,t.cwd),Z=t.fs.resolvePath(V,t.cwd),pe=m.get(oe);pe!==void 0?(m.set(Z,pe),t.fs.writeFile(Z,pe).catch(()=>{})):t.fs.readFile(oe,"utf8").then(ce=>t.fs.writeFile(Z,ce)).catch(()=>{})},renameSync:(G,V)=>{t.fs.rename(t.fs.resolvePath(G,t.cwd),t.fs.resolvePath(V,t.cwd)).catch(()=>{})},promises:{readFile:async(G,V)=>{const oe=typeof V=="string"?V:V?.encoding;return await t.fs.readFile(t.fs.resolvePath(G,t.cwd),oe||"utf8")},writeFile:async(G,V)=>{await t.fs.writeFile(t.fs.resolvePath(G,t.cwd),V)},readdir:async G=>t.fs.readdir(t.fs.resolvePath(G,t.cwd)),stat:async G=>t.fs.stat(t.fs.resolvePath(G,t.cwd)),mkdir:async(G,V)=>t.fs.mkdir(t.fs.resolvePath(G,t.cwd),V),unlink:async G=>t.fs.unlink(t.fs.resolvePath(G,t.cwd)),access:async G=>{if(!await t.fs.exists(t.fs.resolvePath(G,t.cwd)))throw new Error(`ENOENT: no such file or directory, access '${G}'`)}}};case"fs/promises":case"node:fs/promises":return{readFile:async(H,G)=>{const V=t.fs.resolvePath(H,t.cwd),oe=await t.fs.readFile(V),Z=typeof G=="string"?G:G?.encoding;return Z==="utf8"||Z==="utf-8"?typeof oe=="string"?oe:new TextDecoder().decode(oe):s.from(oe)},writeFile:async(H,G)=>{const V=t.fs.resolvePath(H,t.cwd),oe=typeof G=="string"?G:new TextDecoder().decode(G);await t.fs.writeFile(V,oe)},readdir:async H=>{const G=t.fs.resolvePath(H,t.cwd);return await t.fs.readdir(G)},stat:async H=>{const G=t.fs.resolvePath(H,t.cwd);return await t.fs.stat(G)},mkdir:async(H,G)=>{const V=t.fs.resolvePath(H,t.cwd);await t.fs.mkdir(V,G?.recursive)},unlink:async H=>{const G=t.fs.resolvePath(H,t.cwd);await t.fs.unlink(G)},rm:async(H,G)=>{const V=t.fs.resolvePath(H,t.cwd);await t.fs.unlink(V)},access:async H=>{const G=t.fs.resolvePath(H,t.cwd);if(!await t.fs.exists(G))throw new Error(`ENOENT: no such file or directory, access '${H}'`)}};case"child_process":case"node:child_process":{const H=async G=>{let V="",oe="";const Z=await t.shell.execute(G,pe=>{V+=pe},pe=>{oe+=pe});return{stdout:V,stderr:oe,exitCode:Z}};return{execSync:(G,V)=>{let oe="";const Z=H(G).then(ce=>{oe=ce.stdout});return{toString:()=>oe,then:(ce,U)=>Z.then(()=>ce(s.from(oe))).catch(U),[Symbol.toPrimitive]:()=>oe}},spawnSync:(G,V)=>{const oe=V?`${G} ${V.join(" ")}`:G;let Z="",pe="",ce=0;return H(oe).then(U=>{Z=U.stdout,pe=U.stderr,ce=U.exitCode}),{get stdout(){return s.from(Z)},get stderr(){return s.from(pe)},get status(){return ce}}},exec:(G,V,oe)=>{const Z=typeof V=="function"?V:oe;H(G).then(pe=>Z?.(pe.exitCode!==0?new Error(`Exit code ${pe.exitCode}`):null,pe.stdout,pe.stderr)).catch(pe=>Z?.(pe,"",""))},execFile:(G,V,oe,Z)=>{const pe=typeof oe=="function"?oe:Z,ce=`${G} ${(V||[]).join(" ")}`;H(ce).then(U=>pe?.(U.exitCode!==0?new Error(`Exit code ${U.exitCode}`):null,U.stdout,U.stderr)).catch(U=>pe?.(U,"",""))}}}case"os":case"node:os":return{platform:()=>"browser",arch:()=>"wasm",homedir:()=>t.env.HOME||"/home/user",tmpdir:()=>"/tmp",hostname:()=>"shiro",type:()=>"Shiro",release:()=>"0.1.0",cpus:()=>[{model:"Browser",speed:0}],totalmem:()=>0,freemem:()=>0,EOL:`
`};case"util":case"node:util":return{promisify:H=>(...G)=>new Promise((V,oe)=>{H(...G,(Z,pe)=>Z?oe(Z):V(pe))}),inspect:H=>JSON.stringify(H,null,2),format:(...H)=>H.map(String).join(" "),types:{isDate:H=>H instanceof Date,isRegExp:H=>H instanceof RegExp,isCryptoKey:H=>typeof CryptoKey<"u"&&H instanceof CryptoKey,isTypedArray:H=>ArrayBuffer.isView(H)&&!(H instanceof DataView)},deprecate:(H,G)=>H,inherits:(H,G)=>{G&&G.prototype&&(H.super_=G,H.prototype=Object.create(G.prototype,{constructor:{value:H,writable:!0,configurable:!0}}))},isArray:Array.isArray,isBuffer:H=>H instanceof Uint8Array,debuglog:()=>()=>{},TextEncoder,TextDecoder};case"events":case"node:events":{class H{_events={};on(V,oe){return(this._events[V]??=[]).push(oe),this}off(V,oe){return this._events[V]=(this._events[V]||[]).filter(Z=>Z!==oe),this}emit(V,...oe){return(this._events[V]||[]).forEach(Z=>Z(...oe)),!0}once(V,oe){const Z=(...pe)=>{this.off(V,Z),oe(...pe)};return this.on(V,Z)}removeAllListeners(V){return V?delete this._events[V]:this._events={},this}}return{EventEmitter:H,default:H}}case"url":case"node:url":return{URL:globalThis.URL,URLSearchParams:globalThis.URLSearchParams,parse:H=>new URL(H),format:H=>H.toString?H.toString():String(H)};case"assert":case"node:assert":{const H=(G,V)=>{if(!G)throw new Error(V||`AssertionError: ${G}`)};return H.ok=H,H.equal=(G,V,oe)=>{if(G!=V)throw new Error(oe||`AssertionError: ${G} != ${V}`)},H.strictEqual=(G,V,oe)=>{if(G!==V)throw new Error(oe||`AssertionError: ${G} !== ${V}`)},H.deepEqual=H.deepStrictEqual=(G,V,oe)=>{if(JSON.stringify(G)!==JSON.stringify(V))throw new Error(oe||"AssertionError: deep equal failed")},H.throws=(G,V)=>{try{throw G(),new Error(V||"Expected function to throw")}catch(oe){if(oe.message===(V||"Expected function to throw"))throw oe}},H.notEqual=(G,V,oe)=>{if(G==V)throw new Error(oe||`AssertionError: ${G} == ${V}`)},H}case"buffer":case"node:buffer":return{Buffer:s};case"stream":case"node:stream":{console.log("[stream shim] Creating stream module with Transform");const H={};globalThis.__streamShimDebug=!0;const G=function(){};G.prototype.pipe=function(U){return U},G.prototype.on=function(U,ye){return this},G.prototype.once=function(U,ye){return this},G.prototype.emit=function(U,...ye){return!0},G.prototype.removeListener=function(U,ye){return this},G.prototype.addListener=function(U,ye){return this},H.Stream=G;const V=function(U){G.call(this)};V.prototype=Object.create(G.prototype),V.prototype.constructor=V,V.prototype._read=function(){},V.prototype.push=function(U){return!0},V.prototype.read=function(){return null},H.Readable=V;const oe=function(U){G.call(this)};oe.prototype=Object.create(G.prototype),oe.prototype.constructor=oe,oe.prototype._write=function(U,ye,be){be()},oe.prototype.write=function(U,ye,be){return!0},oe.prototype.end=function(U,ye,be){},H.Writable=oe;const Z=function(U){V.call(this,U)};Z.prototype=Object.create(V.prototype),Z.prototype.constructor=Z,Z.prototype._write=function(U,ye,be){be()},Z.prototype.write=function(U,ye,be){return!0},Z.prototype.end=function(U,ye,be){},H.Duplex=Z;const pe=function(U){Z.call(this,U)};pe.prototype=Object.create(Z.prototype),pe.prototype.constructor=pe,pe.prototype._transform=function(U,ye,be){be()},pe.prototype._flush=function(U){U()},H.Transform=pe;const ce=function(U){pe.call(this,U)};return ce.prototype=Object.create(pe.prototype),ce.prototype.constructor=ce,H.PassThrough=ce,console.log("[stream shim] Module ready, Transform:",typeof pe,pe?.name),console.log("[stream shim] Returning:",Object.keys(H)),H}case"crypto":case"node:crypto":return{randomBytes:H=>{const G=new Uint8Array(H);return crypto.getRandomValues(G),Object.assign(G,{toString:V=>V==="hex"?Array.from(G).map(oe=>oe.toString(16).padStart(2,"0")).join(""):new TextDecoder().decode(G)})},createHash:H=>{let G="";return{update:V=>(G+=V,{digest:oe=>`${H}:${G.length}`})}},randomUUID:()=>crypto.randomUUID(),webcrypto:crypto,subtle:crypto.subtle};case"http":case"node:http":case"https":case"node:https":{const H=G=>{let V=G,oe=null,Z=null;const pe={_events:{},on(ce,U){return ce==="request"&&!V&&(V=U),(this._events[ce]??=[]).push(U),this},emit(ce,...U){(this._events[ce]||[]).forEach(ye=>ye(...U))},listen(ce,U,ye){const be=typeof U=="function"?U:ye;Z=ce;const Pe=async Ue=>new Promise(rt=>{const yt={method:Ue.method,url:Ue.path+(Object.keys(Ue.query||{}).length?"?"+new URLSearchParams(Ue.query).toString():""),headers:Ue.headers||{},query:Ue.query||{},body:Ue.body,on(We,Ze){return We==="data"&&Ue.body&&setTimeout(()=>Ze(Ue.body),0),We==="end"&&setTimeout(()=>Ze(),0),this}};let dt=200,fe={},Re="";const Ke={statusCode:200,setHeader(We,Ze){fe[We.toLowerCase()]=Ze},getHeader(We){return fe[We.toLowerCase()]},writeHead(We,Ze){if(dt=We,Ze)for(const[st,gt]of Object.entries(Ze))fe[st.toLowerCase()]=gt;return this},write(We){return Re+=We,!0},end(We){We&&(Re+=We),rt({status:dt,headers:fe,body:Re})},status(We){return dt=We,this},json(We){fe["content-type"]="application/json",this.end(JSON.stringify(We))},send(We){typeof We=="object"?this.json(We):this.end(String(We))}};if(V)try{V(yt,Ke)}catch(We){rt({status:500,body:`Server error: ${We.message}`})}else rt({status:404,body:"No handler"})});oe=iframeServer.serve(ce,Pe,`http:${ce}`),w.log(`Server listening on port ${ce}`);const Oe=t.shell._terminal;if(Oe&&typeof Oe.getIframeContainer=="function"){const Ue=Oe.getIframeContainer();iframeServer.createIframe(ce,Ue,{height:"300px"}).then(()=>w.log("Browser window opened")).catch(rt=>w.warn("Could not open browser:",rt.message))}return pe.emit("listening"),be?.(),this},close(ce){return oe&&(oe(),oe=null),Z&&(w.log(`Server on port ${Z} closed`),Z=null),pe.emit("close"),ce?.(),this},address(){return Z?{port:Z,address:"0.0.0.0"}:null}};return pe};return{createServer:H,Server:function(G){return H(G)},request:()=>{throw new Error("http.request not implemented - use fetch()")},get:()=>{throw new Error("http.get not implemented - use fetch()")}}}case"dotenv":case"dotenv/config":{const H=G=>{const V=G?.path||".env",oe=t.fs.resolvePath(V,t.cwd),Z=m.get(oe);if(Z)for(const pe of Z.split(`
`)){const ce=pe.trim();if(!ce||ce.startsWith("#"))continue;const U=ce.indexOf("=");if(U>0){const ye=ce.slice(0,U).trim();let be=ce.slice(U+1).trim();(be.startsWith('"')&&be.endsWith('"')||be.startsWith("'")&&be.endsWith("'"))&&(be=be.slice(1,-1)),t.env[ye]=be,g.env[ye]=be}}return{parsed:t.env}};return j==="dotenv/config"&&H(),{config:H,parse:G=>{const V={};for(const oe of G.split(`
`)){const Z=oe.trim();if(!Z||Z.startsWith("#"))continue;const pe=Z.indexOf("=");if(pe>0){const ce=Z.slice(0,pe).trim();let U=Z.slice(pe+1).trim();(U.startsWith('"')&&U.endsWith('"')||U.startsWith("'")&&U.endsWith("'"))&&(U=U.slice(1,-1)),V[ce]=U}}return V}}}case"tslib":return{__importDefault:fe=>fe&&fe.__esModule?fe:{default:fe},__importStar:fe=>{if(fe&&fe.__esModule)return fe;const Re={};if(fe!=null)for(const Ke in fe)Object.hasOwnProperty.call(fe,Ke)&&(Re[Ke]=fe[Ke]);return Re.default=fe,Re},__awaiter:(fe,Re,Ke,We)=>new Promise((Ze,st)=>{function gt(vt){try{wt(We.next(vt))}catch(qt){st(qt)}}function Dt(vt){try{wt(We.throw(vt))}catch(qt){st(qt)}}function wt(vt){vt.done?Ze(vt.value):Promise.resolve(vt.value).then(gt,Dt)}wt((We=We.apply(fe,Re||[])).next())}),__generator:(fe,Re)=>{let Ke,We,Ze,st;return st={next:gt(0),throw:gt(1),return:gt(2)},typeof Symbol=="function"&&(st[Symbol.iterator]=function(){return this}),st;function gt(vt){return function(qt){return Dt([vt,qt])}}function Dt(vt){if(Ke)throw new TypeError("Generator is already executing.");for(;st&&(st=0,vt[0]&&(wt=0)),wt;)try{if(Ke=1,We&&(Ze=vt[0]&2?We.return:vt[0]?We.throw||((Ze=We.return)&&Ze.call(We),0):We.next)&&!(Ze=Ze.call(We,vt[1])).done)return Ze;switch(We=0,Ze&&(vt=[vt[0]&2,Ze.value]),vt[0]){case 0:case 1:Ze=vt;break;case 4:return wt.label++,{value:vt[1],done:!1};case 5:wt.label++,We=vt[1],vt=[0];continue;case 7:vt=wt.ops.pop(),wt.trys.pop();continue;default:if(Ze=wt.trys,!(Ze=Ze.length>0&&Ze[Ze.length-1])&&(vt[0]===6||vt[0]===2)){wt=0;continue}if(vt[0]===3&&(!Ze||vt[1]>Ze[0]&&vt[1]<Ze[3])){wt.label=vt[1];break}if(vt[0]===6&&wt.label<Ze[1]){wt.label=Ze[1],Ze=vt;break}if(Ze&&wt.label<Ze[2]){wt.label=Ze[2],wt.ops.push(vt);break}Ze[2]&&wt.ops.pop(),wt.trys.pop();continue}vt=Re.call(fe,wt)}catch(qt){vt=[6,qt],We=0}finally{Ke=Ze=0}if(vt[0]&5)throw vt[1];return{value:vt[0]?vt[1]:void 0,done:!0}}},__spreadArray:(fe,Re,Ke)=>fe.concat(Array.prototype.slice.call(Re)),__assign:Object.assign,__rest:(fe,Re)=>{const Ke={};for(const We in fe)Object.prototype.hasOwnProperty.call(fe,We)&&Re.indexOf(We)<0&&(Ke[We]=fe[We]);return Ke},__extends:(fe,Re)=>{if(typeof Re!="function"&&Re!==null)throw new TypeError("Class extends value "+String(Re)+" is not a constructor or null");Object.setPrototypeOf(fe,Re),fe.prototype=Object.create(Re===null?Re:Re.prototype),fe.prototype.constructor=fe},__exportStar:(fe,Re)=>{for(const Ke in fe)Ke!=="default"&&!Object.prototype.hasOwnProperty.call(Re,Ke)&&(Re[Ke]=fe[Ke])},__createBinding:(fe,Re,Ke,We)=>{We===void 0&&(We=Ke),Object.defineProperty(fe,We,{enumerable:!0,get:()=>Re[Ke]})},__values:fe=>{const Re=typeof Symbol=="function"&&Symbol.iterator,Ke=Re&&fe[Re];let We=0;if(Ke)return Ke.call(fe);if(fe&&typeof fe.length=="number")return{next:()=>({value:fe&&fe[We++],done:!fe||We>=fe.length})};throw new TypeError(Re?"Object is not iterable.":"Symbol.iterator is not defined.")},__read:(fe,Re)=>{const Ke=[];for(let We=0,Ze;We<(Re===void 0?fe.length:Re);We++)Ze=fe[We],Ke.push(Ze);return Ke},__spread:(...fe)=>{const Re=[];for(const Ke of fe)Re.push(...Ke);return Re},__decorate:(fe,Re,Ke,We)=>{let Ze=arguments.length,st=Ze<3?Re:We===null?We=Object.getOwnPropertyDescriptor(Re,Ke):We,gt;for(let Dt=fe.length-1;Dt>=0;Dt--)(gt=fe[Dt])&&(st=(Ze<3?gt(st):Ze>3?gt(Re,Ke,st):gt(Re,Ke))||st);return Ze>3&&st&&Object.defineProperty(Re,Ke,st),st},__param:(fe,Re)=>(Ke,We)=>Re(Ke,We,fe),__metadata:(fe,Re)=>(Ke,We)=>{},__esModule:!0};case"cookie-parser":{const H=G=>(V,oe,Z)=>{V.cookies={},V.signedCookies={};const pe=V.headers?.cookie||V.get?.("cookie")||"";if(pe)for(const ce of pe.split(";")){const[U,...ye]=ce.trim().split("=");if(U){const be=ye.join("=");V.cookies[U.trim()]=decodeURIComponent(be||"")}}Z?.()};return Object.assign(H,{default:H})}case"cors":{const H=G=>(V,oe,Z)=>{const pe=G?.origin||"*";if(oe.setHeader?.("Access-Control-Allow-Origin",pe),oe.setHeader?.("Access-Control-Allow-Methods",G?.methods||"GET,HEAD,PUT,PATCH,POST,DELETE"),oe.setHeader?.("Access-Control-Allow-Headers",G?.allowedHeaders||"Content-Type,Authorization"),G?.credentials&&oe.setHeader?.("Access-Control-Allow-Credentials","true"),V.method==="OPTIONS"){oe.status?.(204).end?.();return}Z?.()};return Object.assign(H,{default:H})}case"express-jwt":{const H=G=>{const{secret:V,algorithms:oe,credentialsRequired:Z=!0,requestProperty:pe="auth",getToken:ce}=G;return(U,ye,be)=>{try{let Pe=ce?ce(U):null;if(!Pe){const Ue=U.headers?.authorization||U.get?.("authorization");Ue?.startsWith("Bearer ")&&(Pe=Ue.slice(7))}if(!Pe){if(Z){const Ue=new Error("No authorization token was found");return Ue.name="UnauthorizedError",Ue.status=401,be(Ue)}return be()}const Oe=Pe.split(".");if(Oe.length===3)try{const Ue=JSON.parse(atob(Oe[1]));U[pe]=Ue}catch{if(Z){const Ue=new Error("Invalid token");return Ue.name="UnauthorizedError",Ue.status=401,be(Ue)}}be()}catch(Pe){be(Pe)}}};return{expressjwt:H,default:H}}case"sharp":{const H=G=>{const V={resize:()=>V,rotate:()=>V,flip:()=>V,flop:()=>V,sharpen:()=>V,median:()=>V,blur:()=>V,flatten:()=>V,gamma:()=>V,negate:()=>V,normalise:()=>V,normalize:()=>V,clahe:()=>V,convolve:()=>V,threshold:()=>V,linear:()=>V,recomb:()=>V,modulate:()=>V,tint:()=>V,greyscale:()=>V,grayscale:()=>V,toColourspace:()=>V,toColorspace:()=>V,removeAlpha:()=>V,ensureAlpha:()=>V,extractChannel:()=>V,joinChannel:()=>V,bandbool:()=>V,extract:()=>V,trim:()=>V,extend:()=>V,composite:()=>V,jpeg:()=>V,png:()=>V,webp:()=>V,avif:()=>V,heif:()=>V,tiff:()=>V,gif:()=>V,jp2:()=>V,raw:()=>V,tile:()=>V,timeout:()=>V,withMetadata:()=>V,clone:()=>H(G),metadata:async()=>({width:100,height:100,format:"png"}),stats:async()=>({channels:[]}),toBuffer:async()=>G||new Uint8Array(0),toFile:async oe=>({size:0,width:100,height:100}),pipe:oe=>oe};return V};return H.cache=()=>{},H.concurrency=()=>1,H.counters=()=>({}),H.simd=()=>!1,H.format={jpeg:{},png:{},webp:{}},H.versions={sharp:"0.0.0-shiro-stub"},Object.assign(H,{default:H})}default:return null}},o=function(){const j=function(pe,ce,U){U?.()};j.locals={};const H=[],G=[];function V(pe,ce){if(typeof pe!="string"||typeof ce!="string")return null;if(pe==="*"||pe==="/*")return{};const U=pe.split("/").filter(Boolean),ye=ce.split("/").filter(Boolean);if(U.length>ye.length)return null;const be={};for(let Pe=0;Pe<U.length;Pe++){const Oe=U[Pe];if(Oe.startsWith(":"))be[Oe.slice(1)]=ye[Pe];else if(Oe!==ye[Pe])return null}return be}j._handleRequest=async pe=>new Promise(ce=>{let U=200,ye={},be="",Pe=!1,Oe=pe.body;try{pe.headers["content-type"]?.includes("application/json")&&pe.body&&(Oe=JSON.parse(pe.body))}catch{}const Ue={method:pe.method,url:pe.path,path:pe.path,headers:pe.headers,query:pe.query,body:Oe,params:{},get(Re){return pe.headers[Re.toLowerCase()]},on(Re,Ke){return Re==="data"&&pe.body&&setTimeout(()=>Ke(pe.body),0),Re==="end"&&setTimeout(()=>Ke(),0),this}},rt={statusCode:200,locals:{},setHeader(Re,Ke){return ye[Re.toLowerCase()]=Ke,this},getHeader(Re){return ye[Re.toLowerCase()]},set(Re,Ke){if(typeof Re=="object")for(const[We,Ze]of Object.entries(Re))ye[We.toLowerCase()]=Ze;else ye[Re.toLowerCase()]=Ke;return this},header(Re,Ke){return this.set(Re,Ke)},writeHead(Re,Ke){if(U=Re,Ke)for(const[We,Ze]of Object.entries(Ke))ye[We.toLowerCase()]=Ze;return this},status(Re){return U=Re,this},sendStatus(Re){U=Re,this.end(String(Re))},write(Re){return be+=Re,!0},end(Re){Pe||(Pe=!0,Re&&(be+=Re),ce({status:U,headers:ye,body:be}))},json(Re){ye["content-type"]="application/json",this.end(JSON.stringify(Re))},send(Re){typeof Re=="object"?this.json(Re):(ye["content-type"]||(ye["content-type"]="text/html"),this.end(String(Re)))},redirect(Re,Ke){const We=typeof Re=="string"?Re:Ke;U=typeof Re=="number"?Re:302,ye.location=We,console.log(`[Express] REDIRECT ${U} -> ${We}`),this.end()},type(Re){return ye["content-type"]=Re,this},cookie(Re,Ke,We){let Ze=`${Re}=${Ke}`;return We?.httpOnly&&(Ze+="; HttpOnly"),We?.secure&&(Ze+="; Secure"),We?.maxAge&&(Ze+=`; Max-Age=${We.maxAge}`),ye["set-cookie"]=Ze,this},clearCookie(Re){return this.cookie(Re,"",{maxAge:0})},async sendFile(Re,Ke){try{const We=t.fs.resolvePath(Re,t.cwd),Ze=await t.fs.readFile(We,"utf8"),st=Re.split(".").pop()?.toLowerCase()||"",gt={html:"text/html",css:"text/css",js:"application/javascript",json:"application/json",png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg",gif:"image/gif",svg:"image/svg+xml",ico:"image/x-icon"};ye["content-type"]||(ye["content-type"]=gt[st]||"application/octet-stream"),this.end(Ze)}catch{U=404,this.end(`File not found: ${Re}`)}}};console.log(`[Express] ${Ue.method} ${Ue.path} - ${H.length} middlewares, ${G.length} routes`);let yt=0,dt=null;(async Re=>{for(;yt<H.length;){const Ke=H[yt++],We=Ke.handler.length===4;if(dt&&!We||!dt&&We)continue;const Ze=V(Ke.path,Ue.path);if(Ze!==null){Ue.params={...Ue.params,...Ze};try{let st=!1,gt=null;if(await new Promise(wt=>{const vt=Lt=>{st=!0,gt=Lt,wt()},qt=We?Ke.handler(dt,Ue,rt,vt):Ke.handler(Ue,rt,vt);qt&&typeof qt.then=="function"&&qt.then(()=>{(Pe||st)&&wt()}).catch(Lt=>{gt=Lt,wt()})}),Pe||(We&&!gt&&(dt=null),gt&&(dt=gt),!st))return}catch(st){dt=st}}}for(const Ke of G){if(Ke.method!==Ue.method&&Ke.method!=="ALL")continue;const We=V(Ke.path,Ue.path);if(We!==null){Ue.params={...Ue.params,...We};for(let Ze=0;Ze<Ke.handlers.length;Ze++){if(Pe)return;const st=Ke.handlers[Ze],gt=Ze===Ke.handlers.length-1;try{let Dt=!1;if(await new Promise(vt=>{const Lt=st(Ue,rt,gt?()=>{}:()=>{Dt=!0,vt()});Lt&&typeof Lt.then=="function"?Lt.then(()=>vt()).catch(Gt=>{ce({status:500,body:`Handler error: ${Gt.message}`})}):(gt||Pe)&&vt()}),Pe||!Dt&&!gt)return}catch(Dt){ce({status:500,body:`Handler error: ${Dt.message}`});return}}return}}Pe||ce({status:404,body:`Cannot ${Ue.method} ${Ue.path}`})})()}),j.use=(pe,...ce)=>{const U=typeof pe=="string"?pe:"/",ye=typeof pe=="function"?[pe,...ce]:ce;for(const be of ye)H.push({path:U,handler:be});return j};const oe=pe=>(ce,...U)=>{const ye=Array.isArray(ce)?ce:[ce];for(const be of ye)G.push({method:pe,path:be,handlers:U});return j};j.get=oe("GET"),j.post=oe("POST"),j.put=oe("PUT"),j.delete=oe("DELETE"),j.patch=oe("PATCH"),j.options=oe("OPTIONS"),j.head=oe("HEAD"),j.all=oe("ALL"),j.static=pe=>async(ce,U,ye)=>{if(ce.method!=="GET"&&ce.method!=="HEAD")return ye();const be=t.fs.resolvePath(pe+ce.path,t.cwd);try{const Pe=await t.fs.stat(be);if(!Pe||Pe.type!=="file")return ye();const Oe=await t.fs.readFile(be,"utf8"),Ue=be.split(".").pop()||"",rt={html:"text/html",css:"text/css",js:"application/javascript",json:"application/json",png:"image/png",jpg:"image/jpeg",svg:"image/svg+xml",txt:"text/plain"};U.type(rt[Ue]||"application/octet-stream"),U.send(Oe)}catch{ye()}},j.listen=(pe,ce,U)=>{const ye=typeof ce=="function"?ce:U;let be=null;const Pe=new Promise(Oe=>{const Ue=iframeServer.serve(pe,j._handleRequest,`express:${pe}`);be=()=>{Ue(),w.log(`Server on port ${pe} closed`);const yt=t.shell._terminal;yt&&typeof yt.hideIframeContainer=="function"&&yt.hideIframeContainer(),Oe()},w.log(`Express app listening on port ${pe}`);const rt=t.shell._terminal;if(rt&&typeof rt.getIframeContainer=="function"){const yt=rt.getIframeContainer();iframeServer.createIframe(pe,yt,{height:"300px"}).then(()=>w.log("Browser window opened")).catch(dt=>w.warn("Could not open browser:",dt.message))}ye?.()});return A.push(Pe),{close:()=>be?.()}};const Z={};return j.set=(pe,ce)=>(Z[pe]=ce,j),j.get=((pe,...ce)=>ce.length===0&&!pe.startsWith("/")?Z[pe]:oe("GET")(pe,...ce)),j.enable=pe=>(Z[pe]=!0,j),j.disable=pe=>(Z[pe]=!1,j),j.enabled=pe=>!!Z[pe],j.disabled=pe=>!Z[pe],j},a=function(){async function j(){if(typeof window>"u")throw new Error("better-sqlite3 shim requires browser environment (sql.js WASM)");return N||(N=(async()=>{const V=window.initSqlJs;return V?await V({locateFile:oe=>`https://sql.js.org/dist/${oe}`}):(await new Promise((oe,Z)=>{const pe=document.createElement("script");pe.src="https://sql.js.org/dist/sql-wasm.js",pe.onload=()=>oe(),pe.onerror=Z,document.head.appendChild(pe)}),await window.initSqlJs({locateFile:oe=>`https://sql.js.org/dist/${oe}`}))})()),N}class H{db=null;dbPath;SQL=null;initPromise=null;_isReady=!1;constructor(oe,Z){this.dbPath=t.fs.resolvePath(oe,t.cwd)}async _init(){if(!this._isReady){if(this.SQL=await j(),J.has(this.dbPath)){this.db=J.get(this.dbPath),this._isReady=!0;return}try{const oe=await t.fs.readFile(this.dbPath);oe instanceof Uint8Array?this.db=new this.SQL.Database(oe):this.db=new this.SQL.Database}catch{this.db=new this.SQL.Database}J.set(this.dbPath,this.db),this._isReady=!0}}ensureReady(){if(!this._isReady)throw this.initPromise||(this.initPromise=this._init()),new Error("Database not initialized. Call await db.ready first, or use async patterns.")}prepare(oe){return this.ensureReady(),new G(this.db,oe)}exec(oe){return this.ensureReady(),this.db.run(oe),this._save(),this}pragma(oe,Z){this.ensureReady();const pe=this.db.exec(`PRAGMA ${oe}`);return pe.length===0?Z?.simple?void 0:[]:Z?.simple?pe[0].values[0]?.[0]:pe[0].values.map(ce=>{const U={};return pe[0].columns.forEach((ye,be)=>{U[ye]=ce[be]}),U})}transaction(oe){return()=>{this.exec("BEGIN");try{const Z=oe();return this.exec("COMMIT"),Z}catch(Z){throw this.exec("ROLLBACK"),Z}}}close(){this._save(),this.db&&(this.db.close(),J.delete(this.dbPath),this.db=null)}_save(){if(!this.db)return;const oe=this.db.export();t.fs.writeFile(this.dbPath,oe).catch(()=>{})}get ready(){return this.initPromise||(this.initPromise=this._init()),this.initPromise}}class G{db;sql;constructor(oe,Z){this.db=oe,this.sql=Z}run(...oe){const Z=oe.length===1&&typeof oe[0]=="object"&&!Array.isArray(oe[0])?oe[0]:oe.flat();this.db.run(this.sql,Z);const pe=this.db.exec("SELECT changes()"),ce=this.db.exec("SELECT last_insert_rowid()");return{changes:pe[0]?.values[0]?.[0]??0,lastInsertRowid:ce[0]?.values[0]?.[0]??0}}get(...oe){const Z=oe.length===1&&typeof oe[0]=="object"&&!Array.isArray(oe[0])?oe[0]:oe.flat(),pe=this.db.prepare(this.sql);if(pe.bind(Z),pe.step()){const ce=pe.getColumnNames(),U=pe.get();pe.free();const ye={};return ce.forEach((be,Pe)=>{ye[be]=U[Pe]}),ye}pe.free()}all(...oe){const Z=oe.length===1&&typeof oe[0]=="object"&&!Array.isArray(oe[0])?oe[0]:oe.flat(),pe=this.db.exec(this.sql,Z);if(pe.length===0)return[];const ce=pe[0].columns;return pe[0].values.map(U=>{const ye={};return ce.forEach((be,Pe)=>{ye[be]=U[Pe]}),ye})}iterate(...oe){return this.all(...oe)[Symbol.iterator]()}bind(...oe){return this}}return H},d=function(j,H){if((j==="stream"||j.includes("iconv")||j.includes("streams"))&&console.log(`[require] Called for '${j}' from '${H}'`),j==="express")return o;if(j==="better-sqlite3")return a();const G=h(j);if(G!==null)return(j==="stream"||j==="node:stream")&&console.log("[require] Returning stream builtin with Transform:",typeof G.Transform,G.Transform?.name),G;let V=j;if(j.startsWith("./")||j.startsWith("../")||j.startsWith("/"))V=t.fs.resolvePath(j,H),!V.endsWith(".js")&&!V.endsWith(".json")&&(m.has(V+".js")?V+=".js":m.has(V+"/index.js")&&(V+="/index.js"));else{const U=j.split("/"),ye=j.startsWith("@"),be=ye?U.slice(0,2).join("/"):U[0],Pe=ye?U.slice(2).join("/"):U.slice(1).join("/");let Oe=H.startsWith("/")?H:t.cwd,Ue=!1;for(;Oe;){let rt=`${Oe}/node_modules/${be}`,yt=`${rt}/package.json`;if(!m.has(yt)){const fe=[...m.keys()].find(Re=>Re.startsWith(rt+"/")&&Re.endsWith("/package.json")&&Re.split("/").length===rt.split("/").length+2);fe&&(rt=fe.replace("/package.json",""),yt=fe)}if(m.has(yt)){if(Pe){let fe;try{const Re=JSON.parse(m.get(yt));if(Re.exports){const Ke=`./${Pe}`,We=Re.exports[Ke];if(We){const Ze=typeof We=="string"?We:We.import||We.require||We.default;Ze&&(fe=`${rt}/${Ze.replace(/^\.\//,"")}`)}else for(const[Ze,st]of Object.entries(Re.exports))if(Ze.includes("*")){const gt=Ze.replace("./","").replace("*","(.*)"),Dt=new RegExp(`^${gt}$`),wt=Pe.match(Dt);if(wt){const vt=typeof st=="string"?st:st.import||st.require||st.default;if(vt){fe=`${rt}/${vt.replace(/^\.\//,"").replace("*",wt[1])}`;break}}}}}catch{}if(fe&&m.has(fe))V=fe;else{const Re=`${rt}/${Pe}`;m.has(Re+".js")?V=Re+".js":m.has(Re)?V=Re:m.has(Re+"/index.js")?V=Re+"/index.js":V=fe||Re+".js"}}else try{const fe=JSON.parse(m.get(yt));let Re;if(fe.exports){const Ke=fe.exports;if(typeof Ke=="string")Re=Ke;else if(Ke["."]){const We=Ke["."];typeof We=="string"?Re=We:(Re=We.import||We.require||We.default||We.node,typeof Re=="object"&&(Re=Re.import||Re.require||Re.default))}else(Ke.import||Ke.require||Ke.default)&&(Re=Ke.import||Ke.require||Ke.default)}Re||(Re=fe.main||fe.module||"index.js"),typeof Re!="string"&&(Re="index.js"),Re=Re.replace(/^\.\//,""),/\.(js|cjs|mjs|json)$/.test(Re)||(Re+=".js"),V=`${rt}/${Re}`}catch{V=`${rt}/index.js`}Ue=!0;break}if(m.has(`${rt}/index.js`)){if(Pe){const fe=`${rt}/${Pe}`;m.has(fe+".js")?V=fe+".js":m.has(fe)?V=fe:V=fe+"/index.js"}else V=`${rt}/index.js`;Ue=!0;break}const dt=Oe.substring(0,Oe.lastIndexOf("/"))||"";if(dt===Oe||!dt)break;Oe=dt}Ue||(V=`${t.cwd}/node_modules/${j}/index.js`)}if($.has(V))return $.get(V).exports;const oe=m.get(V);if(oe===void 0){const U=[...m.keys()].filter(be=>be.includes(j.replace(/^\.\.?\//g,"").replace(/\.js$/,""))).slice(0,5),ye=U.length?`
Similar files in cache: ${U.join(", ")}`:"";throw new Error(`Cannot find module '${j}' (resolved: ${V})${ye}`)}if(V.endsWith(".json")){const U=JSON.parse(oe);return $.set(V,{exports:U}),U}const Z={exports:{}};$.set(V,Z);const pe=V.substring(0,V.lastIndexOf("/"))||t.cwd,ce=U=>d(U,pe);V.includes("streams.js")&&V.includes("iconv")&&(console.log(`[module] Loading: ${V}`),console.log("[module] Original content first 500 chars:",oe.slice(0,500)));try{const U=l(oe);V.includes("streams.js")&&V.includes("iconv")&&console.log("[module] Transformed content first 800 chars:",U.slice(0,800));const ye={url:`file://${V}`,dirname:pe,filename:V},be=Object.getPrototypeOf(async function(){}).constructor,Oe=new be("module","exports","require","__filename","__dirname","console","process","global","Buffer","__import_meta",U)(Z,Z.exports,ce,V,pe,w,g,globalThis,s,ye);A.push(Oe.catch(Ue=>{console.error(`Error in module ${V}:`,Ue)})),(V.includes("streams.js")||V.includes("iconv"))&&console.log(`[module] ${V} exports:`,typeof Z.exports,Z.exports?.name||Object.keys(Z.exports||{}).slice(0,5))}catch(U){$.delete(V);const ye=U instanceof Error?U.message:String(U),be=new Error(`Error loading module '${V}': ${ye}`);throw U instanceof Error&&U.stack&&(be.stack=`Error loading module '${V}':
${U.stack}`),be}return Z.exports},l=function(j){j=j.replace(/\r\n/g,`
`).replace(/\r/g,`
`);const H=[];j=j.replace(/\/\*[\s\S]*?\*\//g,V=>(H.push(V),`___COMMENT_${H.length-1}___`)),j=j.replace(/\bimport\s*\(\s*(['"`])([^'"`]+)\1\s*\)/g,"Promise.resolve(require($1$2$1))"),j=j.replace(/import\.meta/g,"__import_meta"),j=j.replace(/import\s+(\w+)\s*,\s*\{([^}]+)\}\s+from\s+['"]([^'"]+)['"]\s*;?/g,(V,oe,Z,pe)=>{const U=Z.replace(/\/\/[^\n]*/g,"").replace(/\/\*[\s\S]*?\*\//g,"").replace(/(\w+)\s+as\s+(\w+)/g,"$1: $2");return`const ${oe} = require("${pe}"); const {${U}} = require("${pe}");`}),j=j.replace(/import\s+(\w+)\s+from\s+['"]([^'"]+)['"]\s*;?/g,'const $1 = require("$2");'),j=j.replace(/import\s+\{([^}]+)\}\s+from\s+['"]([^'"]+)['"]\s*;?/g,(V,oe,Z)=>`const {${oe.replace(/\/\/[^\n]*/g,"").replace(/\/\*[\s\S]*?\*\//g,"").replace(/(\w+)\s+as\s+(\w+)/g,"$1: $2")}} = require("${Z}");`),j=j.replace(/import\s+\*\s+as\s+(\w+)\s+from\s+['"]([^'"]+)['"]\s*;?/g,'const $1 = require("$2");'),j=j.replace(/import\s+['"]([^'"]+)['"]\s*;?/g,'require("$1");'),j=j.replace(/export\s+default\s+/g,"module.exports = "),j=j.replace(/export\s*\{([^}]+)\}\s+from\s+['"]([^'"]+)['"]\s*;?/g,(V,oe,Z)=>oe.replace(/\/\/[^\n]*/g,"").replace(/\/\*[\s\S]*?\*\//g,"").split(",").map(ye=>ye.trim()).filter(ye=>ye&&/^\w/.test(ye)).map(ye=>{const be=ye.match(/^(\w+)\s+as\s+(\w+)$/);return be?`module.exports.${be[2]} = require("${Z}").${be[1]};`:`module.exports.${ye} = require("${Z}").${ye};`}).join(" ")),j=j.replace(/export\s+\*\s+as\s+(\w+)\s+from\s+['"]([^'"]+)['"]\s*;?/g,'module.exports.$1 = require("$2");'),j=j.replace(/export\s+\*\s+from\s+['"]([^'"]+)['"]\s*;?/g,'Object.assign(module.exports, require("$1"));'),j=j.replace(/export\s*\{([^}]+)\}\s*;?/g,(V,oe)=>oe.replace(/\/\/[^\n]*/g,"").replace(/\/\*[\s\S]*?\*\//g,"").split(",").map(ce=>ce.trim()).filter(ce=>ce&&/^\w/.test(ce)).map(ce=>{const U=ce.match(/^(\w+)\s+as\s+(\w+)$/);return U?`module.exports.${U[2]} = ${U[1]};`:`module.exports.${ce} = ${ce};`}).join(" "));const G=[];for(j=j.replace(/export\s+(const|let|var)\s+(\w+)\s*=/g,(V,oe,Z)=>(G.push(Z),`${oe} ${Z} =`)),j=j.replace(/export\s+(var|let)\s+(\w+)\s*;/g,(V,oe,Z)=>(G.push(Z),`${oe} ${Z};`)),j=j.replace(/export\s+function\s+(\w+)/g,(V,oe)=>(G.push(oe),`function ${oe}`)),j=j.replace(/export\s+class\s+(\w+)/g,(V,oe)=>(G.push(oe),`class ${oe}`)),j=j.replace(/export\s+async\s+function\s+(\w+)/g,(V,oe)=>(G.push(oe),`async function ${oe}`)),G.length>0&&(j+=`
`+G.map(V=>`module.exports.${V} = ${V};`).join(`
`)),j=j.replace(/(?:const|let|var)\s+__filename\s*=\s*[^;]+;?/g,"/* __filename provided */"),j=j.replace(/(?:const|let|var)\s+__dirname\s*=\s*[^;]+;?/g,"/* __dirname provided */"),j=j.replace(/(?:const|let|var)\s+Buffer\s*=\s*[^;]+;?/g,"/* Buffer provided */"),j=j.replace(/(?:const|let|var)\s*\{\s*Buffer\s*\}\s*=\s*[^;]+;?/g,"/* Buffer provided */"),j=j.replace(/(\{\s*)Buffer(\s*,)/g,"$1/* Buffer */$2"),j=j.replace(/(,\s*)Buffer(\s*\})/g,"$1/* Buffer */$2"),j=j.replace(/(,\s*)Buffer(\s*,)/g,"$1/* Buffer */$2"),j=j.replace(/\bexport\s+type\s+/g,"/* export type */ "),j=j.replace(/\bimport\s+type\s+[^;]+;?/g,"/* import type */");/\bexport\s*\{/.test(j);)j=j.replace(/\bexport\s*\{([^}]*)\}\s*;?/g,(V,oe)=>oe.replace(/\/\/[^\n]*/g,"").replace(/\/\*[\s\S]*?\*\//g,"").split(",").map(ce=>ce.trim()).filter(ce=>ce&&/^\w/.test(ce)).map(ce=>{const U=ce.match(/^(\w+)\s+as\s+(\w+)$/);return U?`module.exports.${U[2]} = ${U[1]};`:`module.exports.${ce} = ${ce};`}).join(" "));return j=j.replace(/___COMMENT_(\d+)___/g,(V,oe)=>H[parseInt(oe)]),j},f=0,p=!1;const S=[],k=[],A=[],w={log:(...j)=>{S.push(j.map(formatArg).join(" "))},info:(...j)=>{S.push(j.map(formatArg).join(" "))},warn:(...j)=>{k.push(j.map(formatArg).join(" "))},error:(...j)=>{k.push(j.map(formatArg).join(" "))},dir:j=>{S.push(JSON.stringify(j,null,2))}},v={},g={env:{...t.env},cwd:()=>t.cwd,exit:j=>{throw f=j||0,p=!0,new ProcessExitError(f)},argv:["node",...n],platform:"browser",version:"v0.1.0-shiro",versions:{node:"20.0.0"},stdout:{write:j=>{S.push(j)}},stderr:{write:j=>{k.push(j)}},on:(j,H)=>((v[j]??=[]).push(H),g),off:(j,H)=>(v[j]=(v[j]||[]).filter(G=>G!==H),g),once:(j,H)=>{const G=(...V)=>{g.off(j,G),H(...V)};return g.on(j,G)},emit:(j,...H)=>{(v[j]||[]).forEach(G=>G(...H))},nextTick:(j,...H)=>{queueMicrotask(()=>j(...H))},hrtime:{bigint:()=>BigInt(Date.now())*BigInt(1e6)}},m=new Map,$=new Map;async function I(j,H=0,G=5){if(!(H>G))try{const V=await t.fs.readdir(j);for(const oe of V){if(oe===".git"||oe==="node_modules"&&H>0)continue;const Z=j+"/"+oe;try{const pe=await t.fs.stat(Z);if(pe.isDirectory())await I(Z,H+1,G);else if(pe.size<1048576){const ce=await t.fs.readFile(Z,"utf8");m.set(Z,ce)}}catch{}}}catch{}}const B=[t.cwd],P=t.env.HOME||"/home/user";P!==t.cwd&&B.push(P),B.push("/tmp");for(const j of B)await I(j,0,5);let x=t.cwd;for(;x;){const j=x==="/"?"/node_modules":x+"/node_modules";try{const G=await t.fs.readdir(j);for(const V of G)await I(j+"/"+V,0,10)}catch{}const H=x.substring(0,x.lastIndexOf("/"))||"";if(H===x||!H)break;x=H}if(c){let j=c.substring(0,c.lastIndexOf("/"))||t.cwd,H=j;for(;H&&H!==P&&H!=="/";)try{await t.fs.stat(H+"/package.json"),j=H;break}catch{const G=H.substring(0,H.lastIndexOf("/"))||"";if(G===H||!G)break;H=G}await I(j,0,10)}s.prototype=Object.create(Uint8Array.prototype),s.prototype.constructor=s,s.prototype.toString=function(j){return new TextDecoder().decode(this)},s.prototype.toJSON=function(){return{type:"Buffer",data:Array.from(this)}},s.from=(j,H)=>{let G;if(typeof j=="string")if(H==="base64"){const V=atob(j);G=new Uint8Array(V.length);for(let oe=0;oe<V.length;oe++)G[oe]=V.charCodeAt(oe)}else if(H==="hex"){const V=j.replace(/[^0-9a-fA-F]/g,"");G=new Uint8Array(V.length/2);for(let oe=0;oe<G.length;oe++)G[oe]=parseInt(V.substr(oe*2,2),16)}else G=new TextEncoder().encode(j);else j instanceof Uint8Array?G=new Uint8Array(j):Array.isArray(j)?G=new Uint8Array(j):G=new Uint8Array(0);return Object.setPrototypeOf(G,s.prototype),G},s.alloc=(j,H)=>{const G=new Uint8Array(j);return H!==void 0&&G.fill(typeof H=="number"?H:0),Object.setPrototypeOf(G,s.prototype),G},s.allocUnsafe=j=>s.alloc(j),s.allocUnsafeSlow=j=>s.alloc(j),s.isBuffer=j=>j instanceof Uint8Array,s.isEncoding=j=>["utf8","utf-8","ascii","base64","hex","binary"].includes(j?.toLowerCase()),s.byteLength=(j,H)=>s.from(j,H).length,s.concat=(j,H)=>{const G=H??j.reduce((Z,pe)=>Z+pe.length,0),V=new Uint8Array(G);let oe=0;for(const Z of j)V.set(Z,oe),oe+=Z.length;return Object.setPrototypeOf(V,s.prototype),V},o.json=()=>(j,H,G)=>{G()},o.urlencoded=j=>(H,G,V)=>{typeof H.body=="string"&&H.headers["content-type"]?.includes("urlencoded")&&(H.body=Object.fromEntries(new URLSearchParams(H.body))),V()},o.static=j=>async(H,G,V)=>{if(H.method!=="GET"&&H.method!=="HEAD")return V();const oe=t.fs.resolvePath(j+H.path,t.cwd);try{const Z=await t.fs.stat(oe);if(!Z||Z.type!=="file")return V();const pe=await t.fs.readFile(oe,"utf8"),ce=oe.split(".").pop()||"",U={html:"text/html",css:"text/css",js:"application/javascript",json:"application/json",png:"image/png",jpg:"image/jpeg",svg:"image/svg+xml",txt:"text/plain"};G.type(U[ce]||"application/octet-stream"),G.send(pe)}catch{V()}},o.raw=j=>(H,G,V)=>{V()},o.text=j=>(H,G,V)=>{V()},o.Router=()=>{const j=(G,V,oe)=>{const Z=oe||(()=>{}),pe=(ye,be)=>{if(typeof ye!="string"||typeof be!="string")return null;if(ye==="/"||ye==="*"||ye==="/*")return{};const Pe=ye.split("/").filter(Boolean),Oe=be.split("/").filter(Boolean);if(Pe.length>Oe.length)return null;const Ue={};for(let rt=0;rt<Pe.length;rt++)if(Pe[rt].startsWith(":"))Ue[Pe[rt].slice(1)]=Oe[rt];else if(Pe[rt]!==Oe[rt])return null;return Ue};let ce=0;const U=()=>{for(;ce<j.middlewares.length;){const ye=j.middlewares[ce++],be=pe(ye.path,G.path);if(be!==null){G.params={...G.params,...be};try{ye.handler(G,V,U);return}catch(Pe){Z(Pe);return}}}for(const ye of j.routes){if(ye.method!==G.method&&ye.method!=="ALL")continue;const be=pe(ye.path,G.path);if(be!==null){G.params={...G.params,...be};let Pe=0;const Oe=()=>{},Ue=()=>{if(Pe<ye.handlers.length){const rt=ye.handlers[Pe++],yt=Pe<ye.handlers.length?Ue:Oe;try{rt(G,V,yt)}catch(dt){Z(dt)}}};Ue();return}}Z()};U()};j.routes=[],j.middlewares=[];const H=G=>(V,...oe)=>{const Z=Array.isArray(V)?V:[V];for(const pe of Z)j.routes.push({method:G,path:pe,handlers:oe});return j};return j.get=H("GET"),j.post=H("POST"),j.put=H("PUT"),j.delete=H("DELETE"),j.patch=H("PATCH"),j.all=H("ALL"),j.use=(G,...V)=>(typeof G=="function"?(j.middlewares.push({path:"/",handler:G}),V.forEach(oe=>j.middlewares.push({path:"/",handler:oe}))):V.forEach(oe=>j.middlewares.push({path:G,handler:oe})),j),j};let N=null;const J=new Map,Q=j=>d(j,t.cwd),W=Object.getPrototypeOf(async function(){}).constructor,Y=l(e),ve=r?`return (${Y})`:Y,Be=new W("console","process","require","Buffer","__filename","__dirname","shiro","__import_meta",ve),je=c||t.cwd+"/repl.js",xe=c?c.substring(0,c.lastIndexOf("/")):t.cwd,ke={url:`file://${je}`,dirname:xe,filename:je};let q;try{q=await Be(w,g,Q,s,je,xe,{fs:t.fs,shell:t.shell,env:t.env,cwd:t.cwd},ke)}catch(j){if(j instanceof ProcessExitError)f=j.code;else throw j}for(;A.length>0;){const j=[...A];A.length=0,await Promise.all(j)}return S.length>0&&(t.stdout+=S.join(`
`)+`
`),k.length>0&&(t.stderr+=k.join(`
`)+`
`),r&&q!==void 0&&!p&&(t.stdout+=formatArg(q)+`
`),f}catch(s){return t.stderr+=`${s.stack||s.message}
`,1}}};class ProcessExitError extends Error{code;constructor(e){super(`process.exit(${e})`),this.code=e}}function formatArg(t){if(typeof t=="string")return t;if(t===null)return"null";if(t===void 0)return"undefined";try{return JSON.stringify(t,null,2)}catch{return String(t)}}async function gunzip(t){if(typeof DecompressionStream>"u")throw new Error("DecompressionStream not supported in this browser");const e=new Blob([t.buffer]),r=new Response(e).body;if(!r)throw new Error("Failed to create stream from compressed data");const c=r.pipeThrough(new DecompressionStream("gzip")).getReader(),s=[];for(;;){const{done:d,value:l}=await c.read();if(d)break;s.push(l)}const h=s.reduce((d,l)=>d+l.length,0),o=new Uint8Array(h);let a=0;for(const d of s)o.set(d,a),a+=d.length;return o}function parseTarHeader(t){let e=!0;for(let s=0;s<512;s++)if(t[s]!==0){e=!1;break}if(e)return null;const r=new TextDecoder("ascii"),n=(s,h)=>{const o=t.slice(s,s+h),a=o.indexOf(0);return r.decode(a>=0?o.slice(0,a):o).trim()},c=(s,h)=>{const o=n(s,h);return o?parseInt(o,8):0};return{name:n(0,100),mode:n(100,8),uid:n(108,8),gid:n(116,8),size:c(124,12),mtime:n(136,12),checksum:n(148,8),typeflag:n(156,1),linkname:n(157,100),ustarIndicator:n(257,6),ustarVersion:n(263,2),uname:n(265,32),gname:n(297,32),devmajor:n(329,8),devminor:n(337,8),prefix:n(345,155)}}async function untar(t){const e=[];let r=0;for(;r<t.length&&!(r+512>t.length);){const n=t.slice(r,r+512),c=parseTarHeader(n);if(!c)break;r+=512;let s=c.prefix?`${c.prefix}/${c.name}`:c.name;s.startsWith("package/")&&(s=s.slice(8));let h="file";c.typeflag==="5"?h="directory":c.typeflag==="2"&&(h="symlink");let o;if(c.size>0&&h==="file"){if(r+c.size>t.length)throw new Error(`Incomplete tar file: expected ${c.size} bytes at offset ${r}`);o=t.slice(r,r+c.size)}const a=(512-c.size%512)%512;r+=c.size+a;const d=c.mode?parseInt(c.mode,8):420,l=new Date(parseInt(c.mtime,8)*1e3);e.push({name:s,type:h,mode:d,size:c.size,mtime:l,data:o,linkname:c.linkname||void 0})}return e}async function extractTarGz(t){const e=await gunzip(t);return untar(e)}async function ensureDirRecursive(t,e){const r=t.split("/").filter(Boolean);let n="";for(const c of r){n+="/"+c;try{await e.mkdir(n)}catch(s){if(!s.message?.includes("EEXIST"))throw s}}}async function extractTarGzToFS(t,e,r){const n=await extractTarGz(t);n.sort((c,s)=>c.type==="directory"&&s.type!=="directory"?-1:c.type!=="directory"&&s.type==="directory"?1:0);for(const c of n){if(!c.name||c.name===".")continue;const s=`${e}/${c.name}`;if(c.type==="directory")try{await r.mkdir(s)}catch{}else if(c.type==="file"&&c.data){const h=s.substring(0,s.lastIndexOf("/"));if(h&&h!==e)try{await ensureDirRecursive(h,r)}catch{}await r.writeFile(s,c.data)}else c.type==="symlink"&&c.linkname&&r.symlink&&await r.symlink(c.linkname,s)}}function parseSemVer(t){t=t.trim(),t.startsWith("v")&&(t=t.slice(1));const e=t.match(/^(\d+)\.(\d+)\.(\d+)(?:-([a-zA-Z0-9.-]+))?(?:\+([a-zA-Z0-9.-]+))?$/);return e?{major:parseInt(e[1],10),minor:parseInt(e[2],10),patch:parseInt(e[3],10),prerelease:e[4],build:e[5],raw:t}:null}function compareSemVer(t,e){return t.major!==e.major?t.major-e.major:t.minor!==e.minor?t.minor-e.minor:t.patch!==e.patch?t.patch-e.patch:!t.prerelease&&e.prerelease?1:t.prerelease&&!e.prerelease?-1:t.prerelease&&e.prerelease?t.prerelease.localeCompare(e.prerelease):0}function satisfiesCaret(t,e){return t.major!==e.major?!1:e.major>0?t.minor>e.minor||t.minor===e.minor&&t.patch>=e.patch:e.minor>0?t.minor===e.minor&&t.patch>=e.patch:t.minor===e.minor&&t.patch===e.patch}function satisfiesTilde(t,e){return t.major===e.major&&t.minor===e.minor&&t.patch>=e.patch}function satisfiesComparator(t,e,r){const n=compareSemVer(t,r);switch(e){case"=":case"==":return n===0;case">":return n>0;case">=":return n>=0;case"<":return n<0;case"<=":return n<=0;default:return!1}}function satisfiesRange(t,e){if(e=e.trim(),e==="*"||e==="latest"||e==="")return!0;const r=parseSemVer(t);if(!r)return!1;if(!e.match(/[\^~><]/)){const c=parseSemVer(e);return c?compareSemVer(r,c)===0:!1}if(e.startsWith("^")){const c=parseSemVer(e.slice(1));return c?satisfiesCaret(r,c):!1}if(e.startsWith("~")){const c=parseSemVer(e.slice(1));return c?satisfiesTilde(r,c):!1}const n=e.match(/^(>=?|<=?|=)\s*(.+)$/);if(n){const c=n[1],s=parseSemVer(n[2]);return s?satisfiesComparator(r,c,s):!1}if(e.includes(" ")){const c=e.split(/\s+/);for(let s=0;s<c.length;s+=2){const h=c[s],o=c[s+1];if(!o)continue;const a=parseSemVer(o);if(!a||!satisfiesComparator(r,h,a))return!1}return!0}return!1}function maxSatisfying(t,e){const r=t.filter(c=>satisfiesRange(c,e));if(r.length===0)return null;const n=r.map(c=>parseSemVer(c)).filter(c=>c!==null);return n.length===0?null:(n.sort((c,s)=>compareSemVer(s,c)),n[0].raw)}const metadataCache=new Map,METADATA_CACHE_TTL=3600*1e3,pendingMetadataRequests=new Map,npmCmd={name:"npm",description:"Browser-native package manager for Node.js packages",async exec(t){const e=t.args[0];if(!e||e==="--help"||e==="-h")return t.stdout+=`Usage: npm <command>

`,t.stdout+=`Commands:
`,t.stdout+=`  init              Create a package.json file
`,t.stdout+=`  install [pkg]     Install package(s) from registry.npmjs.org
`,t.stdout+=`  i [pkg]           Alias for install
`,t.stdout+=`  list              List installed packages
`,t.stdout+=`  ls                Alias for list
`,t.stdout+=`  run <script>      Run a script from package.json
`,t.stdout+=`  uninstall [pkg]   Remove a package
`,t.stdout+=`  cache clean       Clear the metadata cache
`,t.stdout+=`  cache status      Show cache statistics
`,t.stdout+=`  --version         Show npm version
`,t.stdout+=`
Note: Downloads real tarballs from registry.npmjs.org
`,t.stdout+=`Package metadata is cached for 1 hour to speed up installs.
`,0;if(e==="--version"||e==="-v")return t.stdout+=`npm v1.0.0-shiro (browser-native)
`,0;switch(e){case"init":return await npmInit(t);case"install":case"i":return await npmInstall(t);case"list":case"ls":return await npmList(t);case"run":return await npmRun(t);case"uninstall":case"remove":case"rm":return await npmUninstall(t);case"cache":return await npmCache(t);default:return t.stderr+=`npm: unknown command '${e}'
`,t.stderr+=`Run 'npm --help' for usage.
`,1}}};async function npmInit(t){const e=t.fs.resolvePath("package.json",t.cwd);try{return await t.fs.readFile(e,"utf8"),t.stdout+=`package.json already exists.
`,0}catch{}const n={name:t.cwd.split("/").filter(Boolean).pop()||"my-project",version:"1.0.0",description:"",main:"index.js",type:"module",scripts:{test:'echo "Error: no test specified" && exit 1'},dependencies:{}};return await t.fs.writeFile(e,JSON.stringify(n,null,2)+`
`),t.stdout+=`Created package.json
`,0}async function fetchPackageMetadata(t){const e=metadataCache.get(t);if(e&&Date.now()-e.timestamp<METADATA_CACHE_TTL)return e.data;const r=pendingMetadataRequests.get(t);if(r)return r;const n=(async()=>{const c=`https://registry.npmjs.org/${t}`,s=await fetch(c,{headers:{Accept:"application/json"}});if(!s.ok)throw s.status===404?new Error(`Package '${t}' not found in npm registry`):new Error(`Failed to fetch package metadata: ${s.statusText}`);const h=await s.json();return metadataCache.set(t,{data:h,timestamp:Date.now()}),h})();pendingMetadataRequests.set(t,n);try{return await n}finally{pendingMetadataRequests.delete(t)}}function resolveVersion(t,e){if(e==="latest"||e==="*"||e==="")return t["dist-tags"].latest;const r=Object.keys(t.versions);return maxSatisfying(r,e)}async function resolveDependencyTree(t,e,r){const n=new Map;let c=[{name:t,range:e}];const s=new Set;for(;c.length>0;){const h=c.filter(({name:d,range:l})=>{const f=`${d}@${l}`;return s.has(f)?!1:(s.add(f),!0)});if(h.length===0)break;c=[];const o=h.map(async({name:d,range:l})=>{try{const f=await fetchPackageMetadata(d);return{name:d,range:l,metadata:f}}catch(f){return r.stderr+=`Error resolving ${d}@${l}: ${f.message}
`,{name:d,range:l,metadata:null}}}),a=await Promise.all(o);for(const{name:d,range:l,metadata:f}of a){if(!f)continue;const p=resolveVersion(f,l);if(!p){r.stderr+=`Warning: No version found for ${d}@${l}
`;continue}const S=f.versions[p];if(!S){r.stderr+=`Warning: Version ${p} not found for ${d}
`;continue}n.set(`${d}@${p}`,{name:d,version:p,tarballUrl:S.dist.tarball,dependencies:S.dependencies||{}});for(const[k,A]of Object.entries(S.dependencies||{}))c.push({name:k,range:A})}}return n}async function installPackage(t,e){e.stdout+=`  + ${t.name}@${t.version}
`;const r=await fetch(t.tarballUrl);if(!r.ok)throw new Error(`Failed to download ${t.name}: ${r.statusText}`);const n=await r.arrayBuffer(),c=new Uint8Array(n),s=e.fs.resolvePath("node_modules",e.cwd);try{await e.fs.mkdir(s)}catch{}const h=e.fs.resolvePath(`node_modules/${t.name}`,e.cwd);await e.fs.mkdir(h,{recursive:!0});let o=0;await extractTarGzToFS(c,h,{writeFile:async(d,l)=>{await e.fs.writeFile(d,l),o++},mkdir:async d=>{try{await e.fs.mkdir(d,{recursive:!0})}catch{}}}),e.stdout+=`  ${o} files extracted
`}async function createBinSymlinks(t,e){const r=t.fs.resolvePath("node_modules/.bin",t.cwd);try{await t.fs.mkdir(r,{recursive:!0})}catch{}let n=0;for(const c of e.values())try{const s=t.fs.resolvePath(`node_modules/${c.name}/package.json`,t.cwd),h=await t.fs.readFile(s,"utf8"),o=JSON.parse(h);if(!o.bin)continue;const a=typeof o.bin=="string"?{[c.name]:o.bin}:o.bin;for(const[d,l]of Object.entries(a)){const f=t.fs.resolvePath(`node_modules/.bin/${d}`,t.cwd),p=l.replace(/^\.\//,""),S=`../${c.name}/${p}`;try{await t.fs.unlink(f)}catch{}await t.fs.symlink(S,f),n++}}catch{}n>0&&(t.stdout+=`Created ${n} bin symlink(s) in node_modules/.bin
`)}async function npmInstall(t){const e=t.fs.resolvePath("package.json",t.cwd);let r;try{const a=await t.fs.readFile(e,"utf8");r=JSON.parse(a)}catch(a){return a.message.includes("ENOENT")?(t.stderr+=`npm: package.json not found. Run "npm init" first.
`,1):(t.stderr+=`npm: failed to parse package.json: ${a.message}
`,1)}const n=t.args.slice(1);let c={};if(n.length===0){const a={...r.dependencies,...r.devDependencies};if(Object.keys(a).length===0)return t.stdout+=`No dependencies to install.
`,0;c=a,t.stdout+=`Installing dependencies...
`}else{r.dependencies||(r.dependencies={});for(const a of n){const[d,l]=a.includes("@")&&!a.startsWith("@")?a.split("@"):[a,"latest"];c[d]=l,r.dependencies[d]=l==="latest"?"*":l}await t.fs.writeFile(e,JSON.stringify(r,null,2)+`
`),t.stdout+=`Installing packages...
`}const s=new Map;for(const[a,d]of Object.entries(c))try{const l=await resolveDependencyTree(a,d,t);for(const[f,p]of l)s.set(f,p)}catch(l){return t.stderr+=`Error installing ${a}: ${l.message}
`,1}t.stdout+=`
Resolved ${s.size} package(s):
`;const o=Array.from(s.values()).map(a=>installPackage(a,t).catch(d=>{t.stderr+=`Error installing ${a.name}: ${d.message}
`}));return await Promise.all(o),await createBinSymlinks(t,s),t.stdout+=`
Packages installed successfully.
`,0}async function npmList(t){const e=t.fs.resolvePath("package.json",t.cwd);let r;try{const s=await t.fs.readFile(e,"utf8");r=JSON.parse(s)}catch{return t.stderr+=`npm: package.json not found.
`,1}const n=r.dependencies||{},c=r.devDependencies||{};if(Object.keys(n).length===0&&Object.keys(c).length===0)return t.stdout+=`No packages installed.
`,0;if(t.stdout+=`${r.name}@${r.version}
`,Object.keys(n).length>0){t.stdout+=`
dependencies:
`;for(const[s,h]of Object.entries(n)){const o=t.fs.resolvePath(`node_modules/${s}/package.json`,t.cwd);let a=h;try{const d=await t.fs.readFile(o,"utf8");a=JSON.parse(d).version||h}catch{}t.stdout+=`  ${s} ${a}
`}}if(Object.keys(c).length>0){t.stdout+=`
devDependencies:
`;for(const[s,h]of Object.entries(c))t.stdout+=`  ${s} ${h}
`}return 0}async function npmRun(t){const e=t.args[1];if(!e){const h=t.fs.resolvePath("package.json",t.cwd);let o;try{const d=await t.fs.readFile(h,"utf8");o=JSON.parse(d)}catch{return t.stderr+=`npm: package.json not found.
`,1}const a=o.scripts||{};if(Object.keys(a).length===0)return t.stdout+=`No scripts available.
`,0;t.stdout+=`Available scripts:
`;for(const[d,l]of Object.entries(a))t.stdout+=`  ${d}
`,t.stdout+=`    ${l}
`;return 0}const r=t.fs.resolvePath("package.json",t.cwd);let n;try{const h=await t.fs.readFile(r,"utf8");n=JSON.parse(h)}catch{return t.stderr+=`npm: package.json not found.
`,1}const c=n.scripts?.[e];if(!c){t.stderr+=`npm: missing script: ${e}
`,t.stderr+=`
Available scripts:
`;for(const h of Object.keys(n.scripts||{}))t.stderr+=`  ${h}
`;return 1}return t.stdout+=`> ${n.name}@${n.version} ${e}
`,t.stdout+=`> ${c}

`,await t.shell.execute(c,h=>t.stdout+=h,h=>t.stderr+=h)}async function npmUninstall(t){const e=t.args.slice(1);if(e.length===0)return t.stderr+=`npm: missing package name
`,t.stderr+=`Usage: npm uninstall <package>
`,1;const r=t.fs.resolvePath("package.json",t.cwd);let n;try{const c=await t.fs.readFile(r,"utf8");n=JSON.parse(c)}catch{return t.stderr+=`npm: package.json not found.
`,1}for(const c of e){n.dependencies?.[c]?(delete n.dependencies[c],t.stdout+=`Removed ${c} from dependencies.
`):n.devDependencies?.[c]?(delete n.devDependencies[c],t.stdout+=`Removed ${c} from devDependencies.
`):t.stderr+=`Package ${c} not found in dependencies.
`;const s=t.fs.resolvePath(`node_modules/${c}`,t.cwd);try{await t.fs.rm(s,{recursive:!0}),t.stdout+=`Removed ${c} from node_modules.
`}catch(h){t.stderr+=`Warning: Could not remove ${c} from node_modules: ${h.message}
`}}return await t.fs.writeFile(r,JSON.stringify(n,null,2)+`
`),0}async function npmCache(t){const e=t.args[1];if(!e||e==="--help")return t.stdout+=`Usage: npm cache <command>

`,t.stdout+=`Commands:
`,t.stdout+=`  clean     Clear the metadata cache
`,t.stdout+=`  status    Show cache statistics
`,0;switch(e){case"clean":case"clear":const r=metadataCache.size;return metadataCache.clear(),t.stdout+=`Cleared ${r} cached package metadata entries.
`,0;case"status":case"ls":if(t.stdout+=`npm metadata cache:
`,t.stdout+=`  Cached packages: ${metadataCache.size}
`,t.stdout+=`  TTL: ${METADATA_CACHE_TTL/1e3/60} minutes
`,metadataCache.size>0){t.stdout+=`
  Cached entries:
`;const n=Date.now();for(const[c,{timestamp:s}]of metadataCache){const h=Math.floor((n-s)/1e3),o=Math.floor(h/60),a=Math.floor((METADATA_CACHE_TTL-(n-s))/1e3/60);t.stdout+=`    ${c} (age: ${o}m, expires in: ${a}m)
`}}return 0;default:return t.stderr+=`npm cache: unknown command '${e}'
`,1}}var browser={exports:{}},hasRequiredBrowser;function requireBrowser(){return hasRequiredBrowser||(hasRequiredBrowser=1,(function(t){(e=>{var r=Object.defineProperty,n=Object.getOwnPropertyDescriptor,c=Object.getOwnPropertyNames,s=Object.prototype.hasOwnProperty,h=(le,M)=>{for(var R in M)r(le,R,{get:M[R],enumerable:!0})},o=(le,M,R,D)=>{if(M&&typeof M=="object"||typeof M=="function")for(let X of c(M))!s.call(le,X)&&X!==R&&r(le,X,{get:()=>M[X],enumerable:!(D=n(M,X))||D.enumerable});return le},a=le=>o(r({},"__esModule",{value:!0}),le),d=(le,M,R)=>new Promise((D,X)=>{var he=De=>{try{Ae(R.next(De))}catch(Et){X(Et)}},we=De=>{try{Ae(R.throw(De))}catch(Et){X(Et)}},Ae=De=>De.done?D(De.value):Promise.resolve(De.value).then(he,we);Ae((R=R.apply(le,M)).next())}),l={};h(l,{analyzeMetafile:()=>ge,analyzeMetafileSync:()=>qe,build:()=>te,buildSync:()=>ne,context:()=>C,default:()=>bt,formatMessages:()=>ee,formatMessagesSync:()=>K,initialize:()=>Se,stop:()=>lt,transform:()=>O,transformSync:()=>_e,version:()=>Gt}),e.exports=a(l);function f(le){let M=D=>{if(D===null)R.write8(0);else if(typeof D=="boolean")R.write8(1),R.write8(+D);else if(typeof D=="number")R.write8(2),R.write32(D|0);else if(typeof D=="string")R.write8(3),R.write(k(D));else if(D instanceof Uint8Array)R.write8(4),R.write(D);else if(D instanceof Array){R.write8(5),R.write32(D.length);for(let X of D)M(X)}else{let X=Object.keys(D);R.write8(6),R.write32(X.length);for(let he of X)R.write(k(he)),M(D[he])}},R=new S;return R.write32(0),R.write32(le.id<<1|+!le.isRequest),M(le.value),g(R.buf,R.len-4,0),R.buf.subarray(0,R.len)}function p(le){let M=()=>{switch(R.read8()){case 0:return null;case 1:return!!R.read8();case 2:return R.read32();case 3:return A(R.read());case 4:return R.read();case 5:{let we=R.read32(),Ae=[];for(let De=0;De<we;De++)Ae.push(M());return Ae}case 6:{let we=R.read32(),Ae={};for(let De=0;De<we;De++)Ae[A(R.read())]=M();return Ae}default:throw new Error("Invalid packet")}},R=new S(le),D=R.read32(),X=(D&1)===0;D>>>=1;let he=M();if(R.ptr!==le.length)throw new Error("Invalid packet");return{id:D,isRequest:X,value:he}}var S=class{constructor(le=new Uint8Array(1024)){this.buf=le,this.len=0,this.ptr=0}_write(le){if(this.len+le>this.buf.length){let M=new Uint8Array((this.len+le)*2);M.set(this.buf),this.buf=M}return this.len+=le,this.len-le}write8(le){let M=this._write(1);this.buf[M]=le}write32(le){let M=this._write(4);g(this.buf,le,M)}write(le){let M=this._write(4+le.length);g(this.buf,le.length,M),this.buf.set(le,M+4)}_read(le){if(this.ptr+le>this.buf.length)throw new Error("Invalid packet");return this.ptr+=le,this.ptr-le}read8(){return this.buf[this._read(1)]}read32(){return v(this.buf,this._read(4))}read(){let le=this.read32(),M=new Uint8Array(le),R=this._read(M.length);return M.set(this.buf.subarray(R,R+le)),M}},k,A,w;if(typeof TextEncoder<"u"&&typeof TextDecoder<"u"){let le=new TextEncoder,M=new TextDecoder;k=R=>le.encode(R),A=R=>M.decode(R),w='new TextEncoder().encode("")'}else if(typeof Buffer<"u")k=le=>Buffer.from(le),A=le=>{let{buffer:M,byteOffset:R,byteLength:D}=le;return Buffer.from(M,R,D).toString()},w='Buffer.from("")';else throw new Error("No UTF-8 codec found");if(!(k("")instanceof Uint8Array))throw new Error(`Invariant violation: "${w} instanceof Uint8Array" is incorrectly false

This indicates that your JavaScript environment is broken. You cannot use
esbuild in this environment because esbuild relies on this invariant. This
is not a problem with esbuild. You need to fix your environment instead.
`);function v(le,M){return le[M++]|le[M++]<<8|le[M++]<<16|le[M++]<<24}function g(le,M,R){le[R++]=M,le[R++]=M>>8,le[R++]=M>>16,le[R++]=M>>24}var m=JSON.stringify,$="warning",I="silent";function B(le,M){const R=[];for(const D of le){if(be(D,M),D.indexOf(",")>=0)throw new Error(`Invalid ${M}: ${D}`);R.push(D)}return R.join(",")}var P=()=>null,x=le=>typeof le=="boolean"?null:"a boolean",N=le=>typeof le=="string"?null:"a string",J=le=>le instanceof RegExp?null:"a RegExp object",Q=le=>typeof le=="number"&&le===(le|0)?null:"an integer",W=le=>typeof le=="number"&&le===(le|0)&&le>=0&&le<=65535?null:"a valid port number",Y=le=>typeof le=="function"?null:"a function",ve=le=>Array.isArray(le)?null:"an array",Be=le=>Array.isArray(le)&&le.every(M=>typeof M=="string")?null:"an array of strings",je=le=>typeof le=="object"&&le!==null&&!Array.isArray(le)?null:"an object",xe=le=>typeof le=="object"&&le!==null?null:"an array or an object",ke=le=>le instanceof WebAssembly.Module?null:"a WebAssembly.Module",q=le=>typeof le=="object"&&!Array.isArray(le)?null:"an object or null",j=le=>typeof le=="string"||typeof le=="boolean"?null:"a string or a boolean",H=le=>typeof le=="string"||typeof le=="object"&&le!==null&&!Array.isArray(le)?null:"a string or an object",G=le=>typeof le=="string"||Array.isArray(le)&&le.every(M=>typeof M=="string")?null:"a string or an array of strings",V=le=>typeof le=="string"||le instanceof Uint8Array?null:"a string or a Uint8Array",oe=le=>typeof le=="string"||le instanceof URL?null:"a string or a URL";function Z(le,M,R,D){let X=le[R];if(M[R+""]=!0,X===void 0)return;let he=D(X);if(he!==null)throw new Error(`${m(R)} must be ${he}`);return X}function pe(le,M,R){for(let D in le)if(!(D in M))throw new Error(`Invalid option ${R}: ${m(D)}`)}function ce(le){let M=Object.create(null),R=Z(le,M,"wasmURL",oe),D=Z(le,M,"wasmModule",ke),X=Z(le,M,"worker",x);return pe(le,M,"in initialize() call"),{wasmURL:R,wasmModule:D,worker:X}}function U(le){let M;if(le!==void 0){M=Object.create(null);for(let R in le){let D=le[R];if(typeof D=="string"||D===!1)M[R]=D;else throw new Error(`Expected ${m(R)} in mangle cache to map to either a string or false`)}}return M}function ye(le,M,R,D,X){let he=Z(M,R,"color",x),we=Z(M,R,"logLevel",N),Ae=Z(M,R,"logLimit",Q);he!==void 0?le.push(`--color=${he}`):D&&le.push("--color=true"),le.push(`--log-level=${we||X}`),le.push(`--log-limit=${Ae||0}`)}function be(le,M,R){if(typeof le!="string")throw new Error(`Expected value for ${M}${R!==void 0?" "+m(R):""} to be a string, got ${typeof le} instead`);return le}function Pe(le,M,R){let D=Z(M,R,"legalComments",N),X=Z(M,R,"sourceRoot",N),he=Z(M,R,"sourcesContent",x),we=Z(M,R,"target",G),Ae=Z(M,R,"format",N),De=Z(M,R,"globalName",N),Et=Z(M,R,"mangleProps",J),St=Z(M,R,"reserveProps",J),Qe=Z(M,R,"mangleQuoted",x),mt=Z(M,R,"minify",x),It=Z(M,R,"minifySyntax",x),Ft=Z(M,R,"minifyWhitespace",x),Nt=Z(M,R,"minifyIdentifiers",x),kt=Z(M,R,"lineLimit",Q),Kt=Z(M,R,"drop",Be),xt=Z(M,R,"dropLabels",Be),At=Z(M,R,"charset",N),nt=Z(M,R,"treeShaking",x),Ye=Z(M,R,"ignoreAnnotations",x),Ie=Z(M,R,"jsx",N),ze=Z(M,R,"jsxFactory",N),Xe=Z(M,R,"jsxFragment",N),ft=Z(M,R,"jsxImportSource",N),_t=Z(M,R,"jsxDev",x),Ve=Z(M,R,"jsxSideEffects",x),et=Z(M,R,"define",je),pt=Z(M,R,"logOverride",je),Ce=Z(M,R,"supported",je),He=Z(M,R,"pure",Be),ot=Z(M,R,"keepNames",x),ht=Z(M,R,"platform",N),Pt=Z(M,R,"tsconfigRaw",H),zt=Z(M,R,"absPaths",Be);if(D&&le.push(`--legal-comments=${D}`),X!==void 0&&le.push(`--source-root=${X}`),he!==void 0&&le.push(`--sources-content=${he}`),we&&le.push(`--target=${B(Array.isArray(we)?we:[we],"target")}`),Ae&&le.push(`--format=${Ae}`),De&&le.push(`--global-name=${De}`),ht&&le.push(`--platform=${ht}`),Pt&&le.push(`--tsconfig-raw=${typeof Pt=="string"?Pt:JSON.stringify(Pt)}`),mt&&le.push("--minify"),It&&le.push("--minify-syntax"),Ft&&le.push("--minify-whitespace"),Nt&&le.push("--minify-identifiers"),kt&&le.push(`--line-limit=${kt}`),At&&le.push(`--charset=${At}`),nt!==void 0&&le.push(`--tree-shaking=${nt}`),Ye&&le.push("--ignore-annotations"),Kt)for(let at of Kt)le.push(`--drop:${be(at,"drop")}`);if(xt&&le.push(`--drop-labels=${B(xt,"drop label")}`),zt&&le.push(`--abs-paths=${B(zt,"abs paths")}`),Et&&le.push(`--mangle-props=${Lt(Et)}`),St&&le.push(`--reserve-props=${Lt(St)}`),Qe!==void 0&&le.push(`--mangle-quoted=${Qe}`),Ie&&le.push(`--jsx=${Ie}`),ze&&le.push(`--jsx-factory=${ze}`),Xe&&le.push(`--jsx-fragment=${Xe}`),ft&&le.push(`--jsx-import-source=${ft}`),_t&&le.push("--jsx-dev"),Ve&&le.push("--jsx-side-effects"),et)for(let at in et){if(at.indexOf("=")>=0)throw new Error(`Invalid define: ${at}`);le.push(`--define:${at}=${be(et[at],"define",at)}`)}if(pt)for(let at in pt){if(at.indexOf("=")>=0)throw new Error(`Invalid log override: ${at}`);le.push(`--log-override:${at}=${be(pt[at],"log override",at)}`)}if(Ce)for(let at in Ce){if(at.indexOf("=")>=0)throw new Error(`Invalid supported: ${at}`);const Mt=Ce[at];if(typeof Mt!="boolean")throw new Error(`Expected value for supported ${m(at)} to be a boolean, got ${typeof Mt} instead`);le.push(`--supported:${at}=${Mt}`)}if(He)for(let at of He)le.push(`--pure:${be(at,"pure")}`);ot&&le.push("--keep-names")}function Oe(le,M,R,D,X){var he;let we=[],Ae=[],De=Object.create(null),Et=null,St=null;ye(we,M,De,R,D),Pe(we,M,De);let Qe=Z(M,De,"sourcemap",j),mt=Z(M,De,"bundle",x),It=Z(M,De,"splitting",x),Ft=Z(M,De,"preserveSymlinks",x),Nt=Z(M,De,"metafile",x),kt=Z(M,De,"outfile",N),Kt=Z(M,De,"outdir",N),xt=Z(M,De,"outbase",N),At=Z(M,De,"tsconfig",N),nt=Z(M,De,"resolveExtensions",Be),Ye=Z(M,De,"nodePaths",Be),Ie=Z(M,De,"mainFields",Be),ze=Z(M,De,"conditions",Be),Xe=Z(M,De,"external",Be),ft=Z(M,De,"packages",N),_t=Z(M,De,"alias",je),Ve=Z(M,De,"loader",je),et=Z(M,De,"outExtension",je),pt=Z(M,De,"publicPath",N),Ce=Z(M,De,"entryNames",N),He=Z(M,De,"chunkNames",N),ot=Z(M,De,"assetNames",N),ht=Z(M,De,"inject",Be),Pt=Z(M,De,"banner",je),zt=Z(M,De,"footer",je),at=Z(M,De,"entryPoints",xe),Mt=Z(M,De,"absWorkingDir",N),Ht=Z(M,De,"stdin",je),jt=(he=Z(M,De,"write",x))!=null?he:X,Qt=Z(M,De,"allowOverwrite",x),Vt=Z(M,De,"mangleCache",je);if(De.plugins=!0,pe(M,De,`in ${le}() call`),Qe&&we.push(`--sourcemap${Qe===!0?"":`=${Qe}`}`),mt&&we.push("--bundle"),Qt&&we.push("--allow-overwrite"),It&&we.push("--splitting"),Ft&&we.push("--preserve-symlinks"),Nt&&we.push("--metafile"),kt&&we.push(`--outfile=${kt}`),Kt&&we.push(`--outdir=${Kt}`),xt&&we.push(`--outbase=${xt}`),At&&we.push(`--tsconfig=${At}`),ft&&we.push(`--packages=${ft}`),nt&&we.push(`--resolve-extensions=${B(nt,"resolve extension")}`),pt&&we.push(`--public-path=${pt}`),Ce&&we.push(`--entry-names=${Ce}`),He&&we.push(`--chunk-names=${He}`),ot&&we.push(`--asset-names=${ot}`),Ie&&we.push(`--main-fields=${B(Ie,"main field")}`),ze&&we.push(`--conditions=${B(ze,"condition")}`),Xe)for(let Tt of Xe)we.push(`--external:${be(Tt,"external")}`);if(_t)for(let Tt in _t){if(Tt.indexOf("=")>=0)throw new Error(`Invalid package name in alias: ${Tt}`);we.push(`--alias:${Tt}=${be(_t[Tt],"alias",Tt)}`)}if(Pt)for(let Tt in Pt){if(Tt.indexOf("=")>=0)throw new Error(`Invalid banner file type: ${Tt}`);we.push(`--banner:${Tt}=${be(Pt[Tt],"banner",Tt)}`)}if(zt)for(let Tt in zt){if(Tt.indexOf("=")>=0)throw new Error(`Invalid footer file type: ${Tt}`);we.push(`--footer:${Tt}=${be(zt[Tt],"footer",Tt)}`)}if(ht)for(let Tt of ht)we.push(`--inject:${be(Tt,"inject")}`);if(Ve)for(let Tt in Ve){if(Tt.indexOf("=")>=0)throw new Error(`Invalid loader extension: ${Tt}`);we.push(`--loader:${Tt}=${be(Ve[Tt],"loader",Tt)}`)}if(et)for(let Tt in et){if(Tt.indexOf("=")>=0)throw new Error(`Invalid out extension: ${Tt}`);we.push(`--out-extension:${Tt}=${be(et[Tt],"out extension",Tt)}`)}if(at)if(Array.isArray(at))for(let Tt=0,ur=at.length;Tt<ur;Tt++){let rr=at[Tt];if(typeof rr=="object"&&rr!==null){let cr=Object.create(null),fr=Z(rr,cr,"in",N),dr=Z(rr,cr,"out",N);if(pe(rr,cr,"in entry point at index "+Tt),fr===void 0)throw new Error('Missing property "in" for entry point at index '+Tt);if(dr===void 0)throw new Error('Missing property "out" for entry point at index '+Tt);Ae.push([dr,fr])}else Ae.push(["",be(rr,"entry point at index "+Tt)])}else for(let Tt in at)Ae.push([Tt,be(at[Tt],"entry point",Tt)]);if(Ht){let Tt=Object.create(null),ur=Z(Ht,Tt,"contents",V),rr=Z(Ht,Tt,"resolveDir",N),cr=Z(Ht,Tt,"sourcefile",N),fr=Z(Ht,Tt,"loader",N);pe(Ht,Tt,'in "stdin" object'),cr&&we.push(`--sourcefile=${cr}`),fr&&we.push(`--loader=${fr}`),rr&&(St=rr),typeof ur=="string"?Et=k(ur):ur instanceof Uint8Array&&(Et=ur)}let hr=[];if(Ye)for(let Tt of Ye)Tt+="",hr.push(Tt);return{entries:Ae,flags:we,write:jt,stdinContents:Et,stdinResolveDir:St,absWorkingDir:Mt,nodePaths:hr,mangleCache:U(Vt)}}function Ue(le,M,R,D){let X=[],he=Object.create(null);ye(X,M,he,R,D),Pe(X,M,he);let we=Z(M,he,"sourcemap",j),Ae=Z(M,he,"sourcefile",N),De=Z(M,he,"loader",N),Et=Z(M,he,"banner",N),St=Z(M,he,"footer",N),Qe=Z(M,he,"mangleCache",je);return pe(M,he,`in ${le}() call`),we&&X.push(`--sourcemap=${we===!0?"external":we}`),Ae&&X.push(`--sourcefile=${Ae}`),De&&X.push(`--loader=${De}`),Et&&X.push(`--banner=${Et}`),St&&X.push(`--footer=${St}`),{flags:X,mangleCache:U(Qe)}}function rt(le){const M={},R={didClose:!1,reason:""};let D={},X=0,he=0,we=new Uint8Array(16*1024),Ae=0,De=At=>{let nt=Ae+At.length;if(nt>we.length){let Ie=new Uint8Array(nt*2);Ie.set(we),we=Ie}we.set(At,Ae),Ae+=At.length;let Ye=0;for(;Ye+4<=Ae;){let Ie=v(we,Ye);if(Ye+4+Ie>Ae)break;Ye+=4,Ft(we.subarray(Ye,Ye+Ie)),Ye+=Ie}Ye>0&&(we.copyWithin(0,Ye,Ae),Ae-=Ye)},Et=At=>{R.didClose=!0,At&&(R.reason=": "+(At.message||At));const nt="The service was stopped"+R.reason;for(let Ye in D)D[Ye](nt,null);D={}},St=(At,nt,Ye)=>{if(R.didClose)return Ye("The service is no longer running"+R.reason,null);let Ie=X++;D[Ie]=(ze,Xe)=>{try{Ye(ze,Xe)}finally{At&&At.unref()}},At&&At.ref(),le.writeToStdin(f({id:Ie,isRequest:!0,value:nt}))},Qe=(At,nt)=>{if(R.didClose)throw new Error("The service is no longer running"+R.reason);le.writeToStdin(f({id:At,isRequest:!1,value:nt}))},mt=(At,nt)=>d(null,null,function*(){try{if(nt.command==="ping"){Qe(At,{});return}if(typeof nt.key=="number"){const Ye=M[nt.key];if(!Ye)return;const Ie=Ye[nt.command];if(Ie){yield Ie(At,nt);return}}throw new Error("Invalid command: "+nt.command)}catch(Ye){const Ie=[Ke(Ye,le,null,void 0,"")];try{Qe(At,{errors:Ie})}catch{}}}),It=!0,Ft=At=>{if(It){It=!1;let Ye=String.fromCharCode(...At);if(Ye!=="0.27.2")throw new Error(`Cannot start service: Host version "0.27.2" does not match binary version ${m(Ye)}`);return}let nt=p(At);if(nt.isRequest)mt(nt.id,nt.value);else{let Ye=D[nt.id];delete D[nt.id],nt.value.error?Ye(nt.value.error,{}):Ye(null,nt.value)}};return{readFromStdout:De,afterClose:Et,service:{buildOrContext:({callName:At,refs:nt,options:Ye,isTTY:Ie,defaultWD:ze,callback:Xe})=>{let ft=0;const _t=he++,Ve={},et={ref(){++ft===1&&nt&&nt.ref()},unref(){--ft===0&&(delete M[_t],nt&&nt.unref())}};M[_t]=Ve,et.ref(),yt(At,_t,St,Qe,et,le,Ve,Ye,Ie,ze,(pt,Ce)=>{try{Xe(pt,Ce)}finally{et.unref()}})},transform:({callName:At,refs:nt,input:Ye,options:Ie,isTTY:ze,fs:Xe,callback:ft})=>{const _t=fe();let Ve=et=>{try{if(typeof Ye!="string"&&!(Ye instanceof Uint8Array))throw new Error('The input to "transform" must be a string or a Uint8Array');let{flags:pt,mangleCache:Ce}=Ue(At,Ie,ze,I),He={command:"transform",flags:pt,inputFS:et!==null,input:et!==null?k(et):typeof Ye=="string"?k(Ye):Ye};Ce&&(He.mangleCache=Ce),St(nt,He,(ot,ht)=>{if(ot)return ft(new Error(ot),null);let Pt=st(ht.errors,_t),zt=st(ht.warnings,_t),at=1,Mt=()=>{if(--at===0){let Ht={warnings:zt,code:ht.code,map:ht.map,mangleCache:void 0,legalComments:void 0};"legalComments"in ht&&(Ht.legalComments=ht?.legalComments),ht.mangleCache&&(Ht.mangleCache=ht?.mangleCache),ft(null,Ht)}};if(Pt.length>0)return ft(Ze("Transform failed",Pt,zt),null);ht.codeFS&&(at++,Xe.readFile(ht.code,(Ht,jt)=>{Ht!==null?ft(Ht,null):(ht.code=jt,Mt())})),ht.mapFS&&(at++,Xe.readFile(ht.map,(Ht,jt)=>{Ht!==null?ft(Ht,null):(ht.map=jt,Mt())})),Mt()})}catch(pt){let Ce=[];try{ye(Ce,Ie,{},ze,I)}catch{}const He=Ke(pt,le,_t,void 0,"");St(nt,{command:"error",flags:Ce,error:He},()=>{He.detail=_t.load(He.detail),ft(Ze("Transform failed",[He],[]),null)})}};if((typeof Ye=="string"||Ye instanceof Uint8Array)&&Ye.length>1024*1024){let et=Ve;Ve=()=>Xe.writeFile(Ye,et)}Ve(null)},formatMessages:({callName:At,refs:nt,messages:Ye,options:Ie,callback:ze})=>{if(!Ie)throw new Error(`Missing second argument in ${At}() call`);let Xe={},ft=Z(Ie,Xe,"kind",N),_t=Z(Ie,Xe,"color",x),Ve=Z(Ie,Xe,"terminalWidth",Q);if(pe(Ie,Xe,`in ${At}() call`),ft===void 0)throw new Error(`Missing "kind" in ${At}() call`);if(ft!=="error"&&ft!=="warning")throw new Error(`Expected "kind" to be "error" or "warning" in ${At}() call`);let et={command:"format-msgs",messages:Dt(Ye,"messages",null,"",Ve),isWarning:ft==="warning"};_t!==void 0&&(et.color=_t),Ve!==void 0&&(et.terminalWidth=Ve),St(nt,et,(pt,Ce)=>{if(pt)return ze(new Error(pt),null);ze(null,Ce.messages)})},analyzeMetafile:({callName:At,refs:nt,metafile:Ye,options:Ie,callback:ze})=>{Ie===void 0&&(Ie={});let Xe={},ft=Z(Ie,Xe,"color",x),_t=Z(Ie,Xe,"verbose",x);pe(Ie,Xe,`in ${At}() call`);let Ve={command:"analyze-metafile",metafile:Ye};ft!==void 0&&(Ve.color=ft),_t!==void 0&&(Ve.verbose=_t),St(nt,Ve,(et,pt)=>{if(et)return ze(new Error(et),null);ze(null,pt.result)})}}}}function yt(le,M,R,D,X,he,we,Ae,De,Et,St){const Qe=fe(),mt=le==="context",It=(kt,Kt)=>{const xt=[];try{ye(xt,Ae,{},De,$)}catch{}const At=Ke(kt,he,Qe,void 0,Kt);R(X,{command:"error",flags:xt,error:At},()=>{At.detail=Qe.load(At.detail),St(Ze(mt?"Context failed":"Build failed",[At],[]),null)})};let Ft;if(typeof Ae=="object"){const kt=Ae.plugins;if(kt!==void 0){if(!Array.isArray(kt))return It(new Error('"plugins" must be an array'),"");Ft=kt}}if(Ft&&Ft.length>0){if(he.isSync)return It(new Error("Cannot use plugins in synchronous API calls"),"");dt(M,R,D,X,he,we,Ae,Ft,Qe).then(kt=>{if(!kt.ok)return It(kt.error,kt.pluginName);try{Nt(kt.requestPlugins,kt.runOnEndCallbacks,kt.scheduleOnDisposeCallbacks)}catch(Kt){It(Kt,"")}},kt=>It(kt,""));return}try{Nt(null,(kt,Kt)=>Kt([],[]),()=>{})}catch(kt){It(kt,"")}function Nt(kt,Kt,xt){const At=he.hasFS,{entries:nt,flags:Ye,write:Ie,stdinContents:ze,stdinResolveDir:Xe,absWorkingDir:ft,nodePaths:_t,mangleCache:Ve}=Oe(le,Ae,De,$,At);if(Ie&&!he.hasFS)throw new Error('The "write" option is unavailable in this environment');const et={command:"build",key:M,entries:nt,flags:Ye,write:Ie,stdinContents:ze,stdinResolveDir:Xe,absWorkingDir:ft||Et,nodePaths:_t,context:mt};kt&&(et.plugins=kt),Ve&&(et.mangleCache=Ve);const pt=(ot,ht)=>{const Pt={errors:st(ot.errors,Qe),warnings:st(ot.warnings,Qe),outputFiles:void 0,metafile:void 0,mangleCache:void 0},zt=Pt.errors.slice(),at=Pt.warnings.slice();ot.outputFiles&&(Pt.outputFiles=ot.outputFiles.map(qt)),ot.metafile&&(Pt.metafile=JSON.parse(ot.metafile)),ot.mangleCache&&(Pt.mangleCache=ot.mangleCache),ot.writeToStdout!==void 0&&console.log(A(ot.writeToStdout).replace(/\n$/,"")),Kt(Pt,(Mt,Ht)=>{if(zt.length>0||Mt.length>0){const jt=Ze("Build failed",zt.concat(Mt),at.concat(Ht));return ht(jt,null,Mt,Ht)}ht(null,Pt,Mt,Ht)})};let Ce,He;mt&&(we["on-end"]=(ot,ht)=>new Promise(Pt=>{pt(ht,(zt,at,Mt,Ht)=>{const jt={errors:Mt,warnings:Ht};He&&He(zt,at),Ce=void 0,He=void 0,D(ot,jt),Pt()})})),R(X,et,(ot,ht)=>{if(ot)return St(new Error(ot),null);if(!mt)return pt(ht,(at,Mt)=>(xt(),St(at,Mt)));if(ht.errors.length>0)return St(Ze("Context failed",ht.errors,ht.warnings),null);let Pt=!1;const zt={rebuild:()=>(Ce||(Ce=new Promise((at,Mt)=>{let Ht;He=(Qt,Vt)=>{Ht||(Ht=()=>Qt?Mt(Qt):at(Vt))};const jt=()=>{R(X,{command:"rebuild",key:M},(Vt,hr)=>{Vt?Mt(new Error(Vt)):Ht?Ht():jt()})};jt()})),Ce),watch:(at={})=>new Promise((Mt,Ht)=>{if(!he.hasFS)throw new Error('Cannot use the "watch" API in this environment');const jt={},Qt=Z(at,jt,"delay",Q);pe(at,jt,"in watch() call");const Vt={command:"watch",key:M};Qt&&(Vt.delay=Qt),R(X,Vt,hr=>{hr?Ht(new Error(hr)):Mt(void 0)})}),serve:(at={})=>new Promise((Mt,Ht)=>{if(!he.hasFS)throw new Error('Cannot use the "serve" API in this environment');const jt={},Qt=Z(at,jt,"port",W),Vt=Z(at,jt,"host",N),hr=Z(at,jt,"servedir",N),Tt=Z(at,jt,"keyfile",N),ur=Z(at,jt,"certfile",N),rr=Z(at,jt,"fallback",N),cr=Z(at,jt,"cors",je),fr=Z(at,jt,"onRequest",Y);pe(at,jt,"in serve() call");const dr={command:"serve",key:M,onRequest:!!fr};if(Qt!==void 0&&(dr.port=Qt),Vt!==void 0&&(dr.host=Vt),hr!==void 0&&(dr.servedir=hr),Tt!==void 0&&(dr.keyfile=Tt),ur!==void 0&&(dr.certfile=ur),rr!==void 0&&(dr.fallback=rr),cr){const Sr={},xr=Z(cr,Sr,"origin",G);pe(cr,Sr,'on "cors" object'),Array.isArray(xr)?dr.corsOrigin=xr:xr!==void 0&&(dr.corsOrigin=[xr])}R(X,dr,(Sr,xr)=>{if(Sr)return Ht(new Error(Sr));fr&&(we["serve-request"]=(as,cs)=>{fr(cs.args),D(as,{})}),Mt(xr)})}),cancel:()=>new Promise(at=>{if(Pt)return at();R(X,{command:"cancel",key:M},()=>{at()})}),dispose:()=>new Promise(at=>{if(Pt)return at();Pt=!0,R(X,{command:"dispose",key:M},()=>{at(),xt(),X.unref()})})};X.ref(),St(null,zt)})}}var dt=(le,M,R,D,X,he,we,Ae,De)=>d(null,null,function*(){let Et=[],St=[],Qe={},mt={},It=[],Ft=0,Nt=0,kt=[],Kt=!1;Ae=[...Ae];for(let nt of Ae){let Ye={};if(typeof nt!="object")throw new Error(`Plugin at index ${Nt} must be an object`);const Ie=Z(nt,Ye,"name",N);if(typeof Ie!="string"||Ie==="")throw new Error(`Plugin at index ${Nt} is missing a name`);try{let ze=Z(nt,Ye,"setup",Y);if(typeof ze!="function")throw new Error("Plugin is missing a setup function");pe(nt,Ye,`on plugin ${m(Ie)}`);let Xe={name:Ie,onStart:!1,onEnd:!1,onResolve:[],onLoad:[]};Nt++;let _t=ze({initialOptions:we,resolve:(Ve,et={})=>{if(!Kt)throw new Error('Cannot call "resolve" before plugin setup has completed');if(typeof Ve!="string")throw new Error("The path to resolve must be a string");let pt=Object.create(null),Ce=Z(et,pt,"pluginName",N),He=Z(et,pt,"importer",N),ot=Z(et,pt,"namespace",N),ht=Z(et,pt,"resolveDir",N),Pt=Z(et,pt,"kind",N),zt=Z(et,pt,"pluginData",P),at=Z(et,pt,"with",je);return pe(et,pt,"in resolve() call"),new Promise((Mt,Ht)=>{const jt={command:"resolve",path:Ve,key:le,pluginName:Ie};if(Ce!=null&&(jt.pluginName=Ce),He!=null&&(jt.importer=He),ot!=null&&(jt.namespace=ot),ht!=null&&(jt.resolveDir=ht),Pt!=null)jt.kind=Pt;else throw new Error('Must specify "kind" when calling "resolve"');zt!=null&&(jt.pluginData=De.store(zt)),at!=null&&(jt.with=vt(at,"with")),M(D,jt,(Qt,Vt)=>{Qt!==null?Ht(new Error(Qt)):Mt({errors:st(Vt.errors,De),warnings:st(Vt.warnings,De),path:Vt.path,external:Vt.external,sideEffects:Vt.sideEffects,namespace:Vt.namespace,suffix:Vt.suffix,pluginData:De.load(Vt.pluginData)})})})},onStart(Ve){let et='This error came from the "onStart" callback registered here:',pt=Re(new Error(et),X,"onStart");Et.push({name:Ie,callback:Ve,note:pt}),Xe.onStart=!0},onEnd(Ve){let et='This error came from the "onEnd" callback registered here:',pt=Re(new Error(et),X,"onEnd");St.push({name:Ie,callback:Ve,note:pt}),Xe.onEnd=!0},onResolve(Ve,et){let pt='This error came from the "onResolve" callback registered here:',Ce=Re(new Error(pt),X,"onResolve"),He={},ot=Z(Ve,He,"filter",J),ht=Z(Ve,He,"namespace",N);if(pe(Ve,He,`in onResolve() call for plugin ${m(Ie)}`),ot==null)throw new Error("onResolve() call is missing a filter");let Pt=Ft++;Qe[Pt]={name:Ie,callback:et,note:Ce},Xe.onResolve.push({id:Pt,filter:Lt(ot),namespace:ht||""})},onLoad(Ve,et){let pt='This error came from the "onLoad" callback registered here:',Ce=Re(new Error(pt),X,"onLoad"),He={},ot=Z(Ve,He,"filter",J),ht=Z(Ve,He,"namespace",N);if(pe(Ve,He,`in onLoad() call for plugin ${m(Ie)}`),ot==null)throw new Error("onLoad() call is missing a filter");let Pt=Ft++;mt[Pt]={name:Ie,callback:et,note:Ce},Xe.onLoad.push({id:Pt,filter:Lt(ot),namespace:ht||""})},onDispose(Ve){It.push(Ve)},esbuild:X.esbuild});_t&&(yield _t),kt.push(Xe)}catch(ze){return{ok:!1,error:ze,pluginName:Ie}}}he["on-start"]=(nt,Ye)=>d(null,null,function*(){De.clear();let Ie={errors:[],warnings:[]};yield Promise.all(Et.map(ze=>d(null,[ze],function*({name:Xe,callback:ft,note:_t}){try{let Ve=yield ft();if(Ve!=null){if(typeof Ve!="object")throw new Error(`Expected onStart() callback in plugin ${m(Xe)} to return an object`);let et={},pt=Z(Ve,et,"errors",ve),Ce=Z(Ve,et,"warnings",ve);pe(Ve,et,`from onStart() callback in plugin ${m(Xe)}`),pt!=null&&Ie.errors.push(...Dt(pt,"errors",De,Xe,void 0)),Ce!=null&&Ie.warnings.push(...Dt(Ce,"warnings",De,Xe,void 0))}}catch(Ve){Ie.errors.push(Ke(Ve,X,De,_t&&_t(),Xe))}}))),R(nt,Ie)}),he["on-resolve"]=(nt,Ye)=>d(null,null,function*(){let Ie={},ze="",Xe,ft;for(let _t of Ye.ids)try{({name:ze,callback:Xe,note:ft}=Qe[_t]);let Ve=yield Xe({path:Ye.path,importer:Ye.importer,namespace:Ye.namespace,resolveDir:Ye.resolveDir,kind:Ye.kind,pluginData:De.load(Ye.pluginData),with:Ye.with});if(Ve!=null){if(typeof Ve!="object")throw new Error(`Expected onResolve() callback in plugin ${m(ze)} to return an object`);let et={},pt=Z(Ve,et,"pluginName",N),Ce=Z(Ve,et,"path",N),He=Z(Ve,et,"namespace",N),ot=Z(Ve,et,"suffix",N),ht=Z(Ve,et,"external",x),Pt=Z(Ve,et,"sideEffects",x),zt=Z(Ve,et,"pluginData",P),at=Z(Ve,et,"errors",ve),Mt=Z(Ve,et,"warnings",ve),Ht=Z(Ve,et,"watchFiles",Be),jt=Z(Ve,et,"watchDirs",Be);pe(Ve,et,`from onResolve() callback in plugin ${m(ze)}`),Ie.id=_t,pt!=null&&(Ie.pluginName=pt),Ce!=null&&(Ie.path=Ce),He!=null&&(Ie.namespace=He),ot!=null&&(Ie.suffix=ot),ht!=null&&(Ie.external=ht),Pt!=null&&(Ie.sideEffects=Pt),zt!=null&&(Ie.pluginData=De.store(zt)),at!=null&&(Ie.errors=Dt(at,"errors",De,ze,void 0)),Mt!=null&&(Ie.warnings=Dt(Mt,"warnings",De,ze,void 0)),Ht!=null&&(Ie.watchFiles=wt(Ht,"watchFiles")),jt!=null&&(Ie.watchDirs=wt(jt,"watchDirs"));break}}catch(Ve){Ie={id:_t,errors:[Ke(Ve,X,De,ft&&ft(),ze)]};break}R(nt,Ie)}),he["on-load"]=(nt,Ye)=>d(null,null,function*(){let Ie={},ze="",Xe,ft;for(let _t of Ye.ids)try{({name:ze,callback:Xe,note:ft}=mt[_t]);let Ve=yield Xe({path:Ye.path,namespace:Ye.namespace,suffix:Ye.suffix,pluginData:De.load(Ye.pluginData),with:Ye.with});if(Ve!=null){if(typeof Ve!="object")throw new Error(`Expected onLoad() callback in plugin ${m(ze)} to return an object`);let et={},pt=Z(Ve,et,"pluginName",N),Ce=Z(Ve,et,"contents",V),He=Z(Ve,et,"resolveDir",N),ot=Z(Ve,et,"pluginData",P),ht=Z(Ve,et,"loader",N),Pt=Z(Ve,et,"errors",ve),zt=Z(Ve,et,"warnings",ve),at=Z(Ve,et,"watchFiles",Be),Mt=Z(Ve,et,"watchDirs",Be);pe(Ve,et,`from onLoad() callback in plugin ${m(ze)}`),Ie.id=_t,pt!=null&&(Ie.pluginName=pt),Ce instanceof Uint8Array?Ie.contents=Ce:Ce!=null&&(Ie.contents=k(Ce)),He!=null&&(Ie.resolveDir=He),ot!=null&&(Ie.pluginData=De.store(ot)),ht!=null&&(Ie.loader=ht),Pt!=null&&(Ie.errors=Dt(Pt,"errors",De,ze,void 0)),zt!=null&&(Ie.warnings=Dt(zt,"warnings",De,ze,void 0)),at!=null&&(Ie.watchFiles=wt(at,"watchFiles")),Mt!=null&&(Ie.watchDirs=wt(Mt,"watchDirs"));break}}catch(Ve){Ie={id:_t,errors:[Ke(Ve,X,De,ft&&ft(),ze)]};break}R(nt,Ie)});let xt=(nt,Ye)=>Ye([],[]);St.length>0&&(xt=(nt,Ye)=>{d(null,null,function*(){const Ie=[],ze=[];for(const{name:Xe,callback:ft,note:_t}of St){let Ve,et;try{const pt=yield ft(nt);if(pt!=null){if(typeof pt!="object")throw new Error(`Expected onEnd() callback in plugin ${m(Xe)} to return an object`);let Ce={},He=Z(pt,Ce,"errors",ve),ot=Z(pt,Ce,"warnings",ve);pe(pt,Ce,`from onEnd() callback in plugin ${m(Xe)}`),He!=null&&(Ve=Dt(He,"errors",De,Xe,void 0)),ot!=null&&(et=Dt(ot,"warnings",De,Xe,void 0))}}catch(pt){Ve=[Ke(pt,X,De,_t&&_t(),Xe)]}if(Ve){Ie.push(...Ve);try{nt.errors.push(...Ve)}catch{}}if(et){ze.push(...et);try{nt.warnings.push(...et)}catch{}}}Ye(Ie,ze)})});let At=()=>{for(const nt of It)setTimeout(()=>nt(),0)};return Kt=!0,{ok:!0,requestPlugins:kt,runOnEndCallbacks:xt,scheduleOnDisposeCallbacks:At}});function fe(){const le=new Map;let M=0;return{clear(){le.clear()},load(R){return le.get(R)},store(R){if(R===void 0)return-1;const D=M++;return le.set(D,R),D}}}function Re(le,M,R){let D,X=!1;return()=>{if(X)return D;X=!0;try{let he=(le.stack+"").split(`
`);he.splice(1,1);let we=We(M,he,R);if(we)return D={text:le.message,location:we},D}catch{}}}function Ke(le,M,R,D,X){let he="Internal error",we=null;try{he=(le&&le.message||le)+""}catch{}try{we=We(M,(le.stack+"").split(`
`),"")}catch{}return{id:"",pluginName:X,text:he,location:we,notes:D?[D]:[],detail:R?R.store(le):-1}}function We(le,M,R){let D="    at ";if(le.readFileSync&&!M[0].startsWith(D)&&M[1].startsWith(D))for(let X=1;X<M.length;X++){let he=M[X];if(he.startsWith(D))for(he=he.slice(D.length);;){let we=/^(?:new |async )?\S+ \((.*)\)$/.exec(he);if(we){he=we[1];continue}if(we=/^eval at \S+ \((.*)\)(?:, \S+:\d+:\d+)?$/.exec(he),we){he=we[1];continue}if(we=/^(\S+):(\d+):(\d+)$/.exec(he),we){let Ae;try{Ae=le.readFileSync(we[1],"utf8")}catch{break}let De=Ae.split(/\r\n|\r|\n|\u2028|\u2029/)[+we[2]-1]||"",Et=+we[3]-1,St=De.slice(Et,Et+R.length)===R?R.length:0;return{file:we[1],namespace:"file",line:+we[2],column:k(De.slice(0,Et)).length,length:k(De.slice(Et,Et+St)).length,lineText:De+`
`+M.slice(1).join(`
`),suggestion:""}}break}}return null}function Ze(le,M,R){let D=5;le+=M.length<1?"":` with ${M.length} error${M.length<2?"":"s"}:`+M.slice(0,D+1).map((he,we)=>{if(we===D)return`
...`;if(!he.location)return`
error: ${he.text}`;let{file:Ae,line:De,column:Et}=he.location,St=he.pluginName?`[plugin: ${he.pluginName}] `:"";return`
${Ae}:${De}:${Et}: ERROR: ${St}${he.text}`}).join("");let X=new Error(le);for(const[he,we]of[["errors",M],["warnings",R]])Object.defineProperty(X,he,{configurable:!0,enumerable:!0,get:()=>we,set:Ae=>Object.defineProperty(X,he,{configurable:!0,enumerable:!0,value:Ae})});return X}function st(le,M){for(const R of le)R.detail=M.load(R.detail);return le}function gt(le,M,R){if(le==null)return null;let D={},X=Z(le,D,"file",N),he=Z(le,D,"namespace",N),we=Z(le,D,"line",Q),Ae=Z(le,D,"column",Q),De=Z(le,D,"length",Q),Et=Z(le,D,"lineText",N),St=Z(le,D,"suggestion",N);if(pe(le,D,M),Et){const Qe=Et.slice(0,(Ae&&Ae>0?Ae:0)+(De&&De>0?De:0)+(R&&R>0?R:80));!/[\x7F-\uFFFF]/.test(Qe)&&!/\n/.test(Et)&&(Et=Qe)}return{file:X||"",namespace:he||"",line:we||0,column:Ae||0,length:De||0,lineText:Et||"",suggestion:St||""}}function Dt(le,M,R,D,X){let he=[],we=0;for(const Ae of le){let De={},Et=Z(Ae,De,"id",N),St=Z(Ae,De,"pluginName",N),Qe=Z(Ae,De,"text",N),mt=Z(Ae,De,"location",q),It=Z(Ae,De,"notes",ve),Ft=Z(Ae,De,"detail",P),Nt=`in element ${we} of "${M}"`;pe(Ae,De,Nt);let kt=[];if(It)for(const Kt of It){let xt={},At=Z(Kt,xt,"text",N),nt=Z(Kt,xt,"location",q);pe(Kt,xt,Nt),kt.push({text:At||"",location:gt(nt,Nt,X)})}he.push({id:Et||"",pluginName:St||D,text:Qe||"",location:gt(mt,Nt,X),notes:kt,detail:R?R.store(Ft):-1}),we++}return he}function wt(le,M){const R=[];for(const D of le){if(typeof D!="string")throw new Error(`${m(M)} must be an array of strings`);R.push(D)}return R}function vt(le,M){const R=Object.create(null);for(const D in le){const X=le[D];if(typeof X!="string")throw new Error(`key ${m(D)} in object ${m(M)} must be a string`);R[D]=X}return R}function qt({path:le,contents:M,hash:R}){let D=null;return{path:le,contents:M,hash:R,get text(){const X=this.contents;return(D===null||X!==M)&&(M=X,D=A(X)),D}}}function Lt(le){let M=le.source;return le.flags&&(M=`(?${le.flags})${M}`),M}var Gt="0.27.2",te=le=>ie().build(le),C=le=>ie().context(le),O=(le,M)=>ie().transform(le,M),ee=(le,M)=>ie().formatMessages(le,M),ge=(le,M)=>ie().analyzeMetafile(le,M),ne=()=>{throw new Error('The "buildSync" API only works in node')},_e=()=>{throw new Error('The "transformSync" API only works in node')},K=()=>{throw new Error('The "formatMessagesSync" API only works in node')},qe=()=>{throw new Error('The "analyzeMetafileSync" API only works in node')},lt=()=>(me&&me(),Promise.resolve()),L,me,Me,ie=()=>{if(Me)return Me;throw L?new Error('You need to wait for the promise returned from "initialize" to be resolved before calling this'):new Error('You need to call "initialize" before calling this')},Se=le=>{le=ce(le||{});let M=le.wasmURL,R=le.wasmModule,D=le.worker!==!1;if(!M&&!R)throw new Error('Must provide either the "wasmURL" option or the "wasmModule" option');if(L)throw new Error('Cannot call "initialize" more than once');return L=Le(M||"",R,D),L.catch(()=>{L=void 0}),L},Le=(le,M,R)=>d(null,null,function*(){let D,X;const he=new Promise(Qe=>X=Qe);if(R){let Qe=new Blob([`onmessage=((postMessage) => {
      // Copyright 2018 The Go Authors. All rights reserved.
      // Use of this source code is governed by a BSD-style
      // license that can be found in the LICENSE file.
      var __async = (__this, __arguments, generator) => {
        return new Promise((resolve, reject) => {
          var fulfilled = (value) => {
            try {
              step(generator.next(value));
            } catch (e) {
              reject(e);
            }
          };
          var rejected = (value) => {
            try {
              step(generator.throw(value));
            } catch (e) {
              reject(e);
            }
          };
          var step = (x) => x.done ? resolve(x.value) : Promise.resolve(x.value).then(fulfilled, rejected);
          step((generator = generator.apply(__this, __arguments)).next());
        });
      };
      let onmessage;
      let globalThis = {};
      for (let o = self; o; o = Object.getPrototypeOf(o))
        for (let k of Object.getOwnPropertyNames(o))
          if (!(k in globalThis))
            Object.defineProperty(globalThis, k, { get: () => self[k] });
      "use strict";
      (() => {
        const enosys = () => {
          const err = new Error("not implemented");
          err.code = "ENOSYS";
          return err;
        };
        if (!globalThis.fs) {
          let outputBuf = "";
          globalThis.fs = {
            constants: { O_WRONLY: -1, O_RDWR: -1, O_CREAT: -1, O_TRUNC: -1, O_APPEND: -1, O_EXCL: -1, O_DIRECTORY: -1 },
            // unused
            writeSync(fd, buf) {
              outputBuf += decoder.decode(buf);
              const nl = outputBuf.lastIndexOf("\\n");
              if (nl != -1) {
                console.log(outputBuf.substring(0, nl));
                outputBuf = outputBuf.substring(nl + 1);
              }
              return buf.length;
            },
            write(fd, buf, offset, length, position, callback) {
              if (offset !== 0 || length !== buf.length || position !== null) {
                callback(enosys());
                return;
              }
              const n = this.writeSync(fd, buf);
              callback(null, n);
            },
            chmod(path, mode, callback) {
              callback(enosys());
            },
            chown(path, uid, gid, callback) {
              callback(enosys());
            },
            close(fd, callback) {
              callback(enosys());
            },
            fchmod(fd, mode, callback) {
              callback(enosys());
            },
            fchown(fd, uid, gid, callback) {
              callback(enosys());
            },
            fstat(fd, callback) {
              callback(enosys());
            },
            fsync(fd, callback) {
              callback(null);
            },
            ftruncate(fd, length, callback) {
              callback(enosys());
            },
            lchown(path, uid, gid, callback) {
              callback(enosys());
            },
            link(path, link, callback) {
              callback(enosys());
            },
            lstat(path, callback) {
              callback(enosys());
            },
            mkdir(path, perm, callback) {
              callback(enosys());
            },
            open(path, flags, mode, callback) {
              callback(enosys());
            },
            read(fd, buffer, offset, length, position, callback) {
              callback(enosys());
            },
            readdir(path, callback) {
              callback(enosys());
            },
            readlink(path, callback) {
              callback(enosys());
            },
            rename(from, to, callback) {
              callback(enosys());
            },
            rmdir(path, callback) {
              callback(enosys());
            },
            stat(path, callback) {
              callback(enosys());
            },
            symlink(path, link, callback) {
              callback(enosys());
            },
            truncate(path, length, callback) {
              callback(enosys());
            },
            unlink(path, callback) {
              callback(enosys());
            },
            utimes(path, atime, mtime, callback) {
              callback(enosys());
            }
          };
        }
        if (!globalThis.process) {
          globalThis.process = {
            getuid() {
              return -1;
            },
            getgid() {
              return -1;
            },
            geteuid() {
              return -1;
            },
            getegid() {
              return -1;
            },
            getgroups() {
              throw enosys();
            },
            pid: -1,
            ppid: -1,
            umask() {
              throw enosys();
            },
            cwd() {
              throw enosys();
            },
            chdir() {
              throw enosys();
            }
          };
        }
        if (!globalThis.path) {
          globalThis.path = {
            resolve(...pathSegments) {
              return pathSegments.join("/");
            }
          };
        }
        if (!globalThis.crypto) {
          throw new Error("globalThis.crypto is not available, polyfill required (crypto.getRandomValues only)");
        }
        if (!globalThis.performance) {
          throw new Error("globalThis.performance is not available, polyfill required (performance.now only)");
        }
        if (!globalThis.TextEncoder) {
          throw new Error("globalThis.TextEncoder is not available, polyfill required");
        }
        if (!globalThis.TextDecoder) {
          throw new Error("globalThis.TextDecoder is not available, polyfill required");
        }
        const encoder = new TextEncoder("utf-8");
        const decoder = new TextDecoder("utf-8");
        globalThis.Go = class {
          constructor() {
            this.argv = ["js"];
            this.env = {};
            this.exit = (code) => {
              if (code !== 0) {
                console.warn("exit code:", code);
              }
            };
            this._exitPromise = new Promise((resolve) => {
              this._resolveExitPromise = resolve;
            });
            this._pendingEvent = null;
            this._scheduledTimeouts = /* @__PURE__ */ new Map();
            this._nextCallbackTimeoutID = 1;
            const setInt64 = (addr, v) => {
              this.mem.setUint32(addr + 0, v, true);
              this.mem.setUint32(addr + 4, Math.floor(v / 4294967296), true);
            };
            const setInt32 = (addr, v) => {
              this.mem.setUint32(addr + 0, v, true);
            };
            const getInt64 = (addr) => {
              const low = this.mem.getUint32(addr + 0, true);
              const high = this.mem.getInt32(addr + 4, true);
              return low + high * 4294967296;
            };
            const loadValue = (addr) => {
              const f = this.mem.getFloat64(addr, true);
              if (f === 0) {
                return void 0;
              }
              if (!isNaN(f)) {
                return f;
              }
              const id = this.mem.getUint32(addr, true);
              return this._values[id];
            };
            const storeValue = (addr, v) => {
              const nanHead = 2146959360;
              if (typeof v === "number" && v !== 0) {
                if (isNaN(v)) {
                  this.mem.setUint32(addr + 4, nanHead, true);
                  this.mem.setUint32(addr, 0, true);
                  return;
                }
                this.mem.setFloat64(addr, v, true);
                return;
              }
              if (v === void 0) {
                this.mem.setFloat64(addr, 0, true);
                return;
              }
              let id = this._ids.get(v);
              if (id === void 0) {
                id = this._idPool.pop();
                if (id === void 0) {
                  id = this._values.length;
                }
                this._values[id] = v;
                this._goRefCounts[id] = 0;
                this._ids.set(v, id);
              }
              this._goRefCounts[id]++;
              let typeFlag = 0;
              switch (typeof v) {
                case "object":
                  if (v !== null) {
                    typeFlag = 1;
                  }
                  break;
                case "string":
                  typeFlag = 2;
                  break;
                case "symbol":
                  typeFlag = 3;
                  break;
                case "function":
                  typeFlag = 4;
                  break;
              }
              this.mem.setUint32(addr + 4, nanHead | typeFlag, true);
              this.mem.setUint32(addr, id, true);
            };
            const loadSlice = (addr) => {
              const array = getInt64(addr + 0);
              const len = getInt64(addr + 8);
              return new Uint8Array(this._inst.exports.mem.buffer, array, len);
            };
            const loadSliceOfValues = (addr) => {
              const array = getInt64(addr + 0);
              const len = getInt64(addr + 8);
              const a = new Array(len);
              for (let i = 0; i < len; i++) {
                a[i] = loadValue(array + i * 8);
              }
              return a;
            };
            const loadString = (addr) => {
              const saddr = getInt64(addr + 0);
              const len = getInt64(addr + 8);
              return decoder.decode(new DataView(this._inst.exports.mem.buffer, saddr, len));
            };
            const testCallExport = (a, b) => {
              this._inst.exports.testExport0();
              return this._inst.exports.testExport(a, b);
            };
            const timeOrigin = Date.now() - performance.now();
            this.importObject = {
              _gotest: {
                add: (a, b) => a + b,
                callExport: testCallExport
              },
              gojs: {
                // Go's SP does not change as long as no Go code is running. Some operations (e.g. calls, getters and setters)
                // may synchronously trigger a Go event handler. This makes Go code get executed in the middle of the imported
                // function. A goroutine can switch to a new stack if the current stack is too small (see morestack function).
                // This changes the SP, thus we have to update the SP used by the imported function.
                // func wasmExit(code int32)
                "runtime.wasmExit": (sp) => {
                  sp >>>= 0;
                  const code = this.mem.getInt32(sp + 8, true);
                  this.exited = true;
                  delete this._inst;
                  delete this._values;
                  delete this._goRefCounts;
                  delete this._ids;
                  delete this._idPool;
                  this.exit(code);
                },
                // func wasmWrite(fd uintptr, p unsafe.Pointer, n int32)
                "runtime.wasmWrite": (sp) => {
                  sp >>>= 0;
                  const fd = getInt64(sp + 8);
                  const p = getInt64(sp + 16);
                  const n = this.mem.getInt32(sp + 24, true);
                  globalThis.fs.writeSync(fd, new Uint8Array(this._inst.exports.mem.buffer, p, n));
                },
                // func resetMemoryDataView()
                "runtime.resetMemoryDataView": (sp) => {
                  sp >>>= 0;
                  this.mem = new DataView(this._inst.exports.mem.buffer);
                },
                // func nanotime1() int64
                "runtime.nanotime1": (sp) => {
                  sp >>>= 0;
                  setInt64(sp + 8, (timeOrigin + performance.now()) * 1e6);
                },
                // func walltime() (sec int64, nsec int32)
                "runtime.walltime": (sp) => {
                  sp >>>= 0;
                  const msec = (/* @__PURE__ */ new Date()).getTime();
                  setInt64(sp + 8, msec / 1e3);
                  this.mem.setInt32(sp + 16, msec % 1e3 * 1e6, true);
                },
                // func scheduleTimeoutEvent(delay int64) int32
                "runtime.scheduleTimeoutEvent": (sp) => {
                  sp >>>= 0;
                  const id = this._nextCallbackTimeoutID;
                  this._nextCallbackTimeoutID++;
                  this._scheduledTimeouts.set(id, setTimeout(
                    () => {
                      this._resume();
                      while (this._scheduledTimeouts.has(id)) {
                        console.warn("scheduleTimeoutEvent: missed timeout event");
                        this._resume();
                      }
                    },
                    getInt64(sp + 8)
                  ));
                  this.mem.setInt32(sp + 16, id, true);
                },
                // func clearTimeoutEvent(id int32)
                "runtime.clearTimeoutEvent": (sp) => {
                  sp >>>= 0;
                  const id = this.mem.getInt32(sp + 8, true);
                  clearTimeout(this._scheduledTimeouts.get(id));
                  this._scheduledTimeouts.delete(id);
                },
                // func getRandomData(r []byte)
                "runtime.getRandomData": (sp) => {
                  sp >>>= 0;
                  crypto.getRandomValues(loadSlice(sp + 8));
                },
                // func finalizeRef(v ref)
                "syscall/js.finalizeRef": (sp) => {
                  sp >>>= 0;
                  const id = this.mem.getUint32(sp + 8, true);
                  this._goRefCounts[id]--;
                  if (this._goRefCounts[id] === 0) {
                    const v = this._values[id];
                    this._values[id] = null;
                    this._ids.delete(v);
                    this._idPool.push(id);
                  }
                },
                // func stringVal(value string) ref
                "syscall/js.stringVal": (sp) => {
                  sp >>>= 0;
                  storeValue(sp + 24, loadString(sp + 8));
                },
                // func valueGet(v ref, p string) ref
                "syscall/js.valueGet": (sp) => {
                  sp >>>= 0;
                  const result = Reflect.get(loadValue(sp + 8), loadString(sp + 16));
                  sp = this._inst.exports.getsp() >>> 0;
                  storeValue(sp + 32, result);
                },
                // func valueSet(v ref, p string, x ref)
                "syscall/js.valueSet": (sp) => {
                  sp >>>= 0;
                  Reflect.set(loadValue(sp + 8), loadString(sp + 16), loadValue(sp + 32));
                },
                // func valueDelete(v ref, p string)
                "syscall/js.valueDelete": (sp) => {
                  sp >>>= 0;
                  Reflect.deleteProperty(loadValue(sp + 8), loadString(sp + 16));
                },
                // func valueIndex(v ref, i int) ref
                "syscall/js.valueIndex": (sp) => {
                  sp >>>= 0;
                  storeValue(sp + 24, Reflect.get(loadValue(sp + 8), getInt64(sp + 16)));
                },
                // valueSetIndex(v ref, i int, x ref)
                "syscall/js.valueSetIndex": (sp) => {
                  sp >>>= 0;
                  Reflect.set(loadValue(sp + 8), getInt64(sp + 16), loadValue(sp + 24));
                },
                // func valueCall(v ref, m string, args []ref) (ref, bool)
                "syscall/js.valueCall": (sp) => {
                  sp >>>= 0;
                  try {
                    const v = loadValue(sp + 8);
                    const m = Reflect.get(v, loadString(sp + 16));
                    const args = loadSliceOfValues(sp + 32);
                    const result = Reflect.apply(m, v, args);
                    sp = this._inst.exports.getsp() >>> 0;
                    storeValue(sp + 56, result);
                    this.mem.setUint8(sp + 64, 1);
                  } catch (err) {
                    sp = this._inst.exports.getsp() >>> 0;
                    storeValue(sp + 56, err);
                    this.mem.setUint8(sp + 64, 0);
                  }
                },
                // func valueInvoke(v ref, args []ref) (ref, bool)
                "syscall/js.valueInvoke": (sp) => {
                  sp >>>= 0;
                  try {
                    const v = loadValue(sp + 8);
                    const args = loadSliceOfValues(sp + 16);
                    const result = Reflect.apply(v, void 0, args);
                    sp = this._inst.exports.getsp() >>> 0;
                    storeValue(sp + 40, result);
                    this.mem.setUint8(sp + 48, 1);
                  } catch (err) {
                    sp = this._inst.exports.getsp() >>> 0;
                    storeValue(sp + 40, err);
                    this.mem.setUint8(sp + 48, 0);
                  }
                },
                // func valueNew(v ref, args []ref) (ref, bool)
                "syscall/js.valueNew": (sp) => {
                  sp >>>= 0;
                  try {
                    const v = loadValue(sp + 8);
                    const args = loadSliceOfValues(sp + 16);
                    const result = Reflect.construct(v, args);
                    sp = this._inst.exports.getsp() >>> 0;
                    storeValue(sp + 40, result);
                    this.mem.setUint8(sp + 48, 1);
                  } catch (err) {
                    sp = this._inst.exports.getsp() >>> 0;
                    storeValue(sp + 40, err);
                    this.mem.setUint8(sp + 48, 0);
                  }
                },
                // func valueLength(v ref) int
                "syscall/js.valueLength": (sp) => {
                  sp >>>= 0;
                  setInt64(sp + 16, parseInt(loadValue(sp + 8).length));
                },
                // valuePrepareString(v ref) (ref, int)
                "syscall/js.valuePrepareString": (sp) => {
                  sp >>>= 0;
                  const str = encoder.encode(String(loadValue(sp + 8)));
                  storeValue(sp + 16, str);
                  setInt64(sp + 24, str.length);
                },
                // valueLoadString(v ref, b []byte)
                "syscall/js.valueLoadString": (sp) => {
                  sp >>>= 0;
                  const str = loadValue(sp + 8);
                  loadSlice(sp + 16).set(str);
                },
                // func valueInstanceOf(v ref, t ref) bool
                "syscall/js.valueInstanceOf": (sp) => {
                  sp >>>= 0;
                  this.mem.setUint8(sp + 24, loadValue(sp + 8) instanceof loadValue(sp + 16) ? 1 : 0);
                },
                // func copyBytesToGo(dst []byte, src ref) (int, bool)
                "syscall/js.copyBytesToGo": (sp) => {
                  sp >>>= 0;
                  const dst = loadSlice(sp + 8);
                  const src = loadValue(sp + 32);
                  if (!(src instanceof Uint8Array || src instanceof Uint8ClampedArray)) {
                    this.mem.setUint8(sp + 48, 0);
                    return;
                  }
                  const toCopy = src.subarray(0, dst.length);
                  dst.set(toCopy);
                  setInt64(sp + 40, toCopy.length);
                  this.mem.setUint8(sp + 48, 1);
                },
                // func copyBytesToJS(dst ref, src []byte) (int, bool)
                "syscall/js.copyBytesToJS": (sp) => {
                  sp >>>= 0;
                  const dst = loadValue(sp + 8);
                  const src = loadSlice(sp + 16);
                  if (!(dst instanceof Uint8Array || dst instanceof Uint8ClampedArray)) {
                    this.mem.setUint8(sp + 48, 0);
                    return;
                  }
                  const toCopy = src.subarray(0, dst.length);
                  dst.set(toCopy);
                  setInt64(sp + 40, toCopy.length);
                  this.mem.setUint8(sp + 48, 1);
                },
                "debug": (value) => {
                  console.log(value);
                }
              }
            };
          }
          run(instance) {
            return __async(this, null, function* () {
              if (!(instance instanceof WebAssembly.Instance)) {
                throw new Error("Go.run: WebAssembly.Instance expected");
              }
              this._inst = instance;
              this.mem = new DataView(this._inst.exports.mem.buffer);
              this._values = [
                // JS values that Go currently has references to, indexed by reference id
                NaN,
                0,
                null,
                true,
                false,
                globalThis,
                this
              ];
              this._goRefCounts = new Array(this._values.length).fill(Infinity);
              this._ids = /* @__PURE__ */ new Map([
                // mapping from JS values to reference ids
                [0, 1],
                [null, 2],
                [true, 3],
                [false, 4],
                [globalThis, 5],
                [this, 6]
              ]);
              this._idPool = [];
              this.exited = false;
              let offset = 4096;
              const strPtr = (str) => {
                const ptr = offset;
                const bytes = encoder.encode(str + "\\0");
                new Uint8Array(this.mem.buffer, offset, bytes.length).set(bytes);
                offset += bytes.length;
                if (offset % 8 !== 0) {
                  offset += 8 - offset % 8;
                }
                return ptr;
              };
              const argc = this.argv.length;
              const argvPtrs = [];
              this.argv.forEach((arg) => {
                argvPtrs.push(strPtr(arg));
              });
              argvPtrs.push(0);
              const keys = Object.keys(this.env).sort();
              keys.forEach((key) => {
                argvPtrs.push(strPtr(\`\${key}=\${this.env[key]}\`));
              });
              argvPtrs.push(0);
              const argv = offset;
              argvPtrs.forEach((ptr) => {
                this.mem.setUint32(offset, ptr, true);
                this.mem.setUint32(offset + 4, 0, true);
                offset += 8;
              });
              const wasmMinDataAddr = 4096 + 8192;
              if (offset >= wasmMinDataAddr) {
                throw new Error("total length of command line and environment variables exceeds limit");
              }
              this._inst.exports.run(argc, argv);
              if (this.exited) {
                this._resolveExitPromise();
              }
              yield this._exitPromise;
            });
          }
          _resume() {
            if (this.exited) {
              throw new Error("Go program has already exited");
            }
            this._inst.exports.resume();
            if (this.exited) {
              this._resolveExitPromise();
            }
          }
          _makeFuncWrapper(id) {
            const go = this;
            return function() {
              const event = { id, this: this, args: arguments };
              go._pendingEvent = event;
              go._resume();
              return event.result;
            };
          }
        };
      })();
      onmessage = ({ data: wasm }) => {
        let decoder = new TextDecoder();
        let fs = globalThis.fs;
        let stderr = "";
        fs.writeSync = (fd, buffer) => {
          if (fd === 1) {
            postMessage(buffer);
          } else if (fd === 2) {
            stderr += decoder.decode(buffer);
            let parts = stderr.split("\\n");
            if (parts.length > 1) console.log(parts.slice(0, -1).join("\\n"));
            stderr = parts[parts.length - 1];
          } else {
            throw new Error("Bad write");
          }
          return buffer.length;
        };
        let stdin = [];
        let resumeStdin;
        let stdinPos = 0;
        onmessage = ({ data }) => {
          if (data.length > 0) {
            stdin.push(data);
            if (resumeStdin) resumeStdin();
          }
          return go;
        };
        fs.read = (fd, buffer, offset, length, position, callback) => {
          if (fd !== 0 || offset !== 0 || length !== buffer.length || position !== null) {
            throw new Error("Bad read");
          }
          if (stdin.length === 0) {
            resumeStdin = () => fs.read(fd, buffer, offset, length, position, callback);
            return;
          }
          let first = stdin[0];
          let count = Math.max(0, Math.min(length, first.length - stdinPos));
          buffer.set(first.subarray(stdinPos, stdinPos + count), offset);
          stdinPos += count;
          if (stdinPos === first.length) {
            stdin.shift();
            stdinPos = 0;
          }
          callback(null, count);
        };
        let go = new globalThis.Go();
        go.argv = ["", \`--service=\${"0.27.2"}\`];
        tryToInstantiateModule(wasm, go).then(
          (instance) => {
            postMessage(null);
            go.run(instance);
          },
          (error) => {
            postMessage(error);
          }
        );
        return go;
      };
      function tryToInstantiateModule(wasm, go) {
        return __async(this, null, function* () {
          if (wasm instanceof WebAssembly.Module) {
            return WebAssembly.instantiate(wasm, go.importObject);
          }
          const res = yield fetch(wasm);
          if (!res.ok) throw new Error(\`Failed to download \${JSON.stringify(wasm)}\`);
          if ("instantiateStreaming" in WebAssembly && /^application\\/wasm($|;)/i.test(res.headers.get("Content-Type") || "")) {
            const result2 = yield WebAssembly.instantiateStreaming(res, go.importObject);
            return result2.instance;
          }
          const bytes = yield res.arrayBuffer();
          const result = yield WebAssembly.instantiate(bytes, go.importObject);
          return result.instance;
        });
      }
      return (m) => onmessage(m);
    })(postMessage)`],{type:"text/javascript"});D=new Worker(URL.createObjectURL(Qe))}else{let Qe=(It=>{var Ft=(xt,At,nt)=>new Promise((Ye,Ie)=>{var ze=_t=>{try{ft(nt.next(_t))}catch(Ve){Ie(Ve)}},Xe=_t=>{try{ft(nt.throw(_t))}catch(Ve){Ie(Ve)}},ft=_t=>_t.done?Ye(_t.value):Promise.resolve(_t.value).then(ze,Xe);ft((nt=nt.apply(xt,At)).next())});let Nt,kt={};for(let xt=self;xt;xt=Object.getPrototypeOf(xt))for(let At of Object.getOwnPropertyNames(xt))At in kt||Object.defineProperty(kt,At,{get:()=>self[At]});(()=>{const xt=()=>{const Ye=new Error("not implemented");return Ye.code="ENOSYS",Ye};if(!kt.fs){let Ye="";kt.fs={constants:{O_WRONLY:-1,O_RDWR:-1,O_CREAT:-1,O_TRUNC:-1,O_APPEND:-1,O_EXCL:-1,O_DIRECTORY:-1},writeSync(Ie,ze){Ye+=nt.decode(ze);const Xe=Ye.lastIndexOf(`
`);return Xe!=-1&&(console.log(Ye.substring(0,Xe)),Ye=Ye.substring(Xe+1)),ze.length},write(Ie,ze,Xe,ft,_t,Ve){if(Xe!==0||ft!==ze.length||_t!==null){Ve(xt());return}const et=this.writeSync(Ie,ze);Ve(null,et)},chmod(Ie,ze,Xe){Xe(xt())},chown(Ie,ze,Xe,ft){ft(xt())},close(Ie,ze){ze(xt())},fchmod(Ie,ze,Xe){Xe(xt())},fchown(Ie,ze,Xe,ft){ft(xt())},fstat(Ie,ze){ze(xt())},fsync(Ie,ze){ze(null)},ftruncate(Ie,ze,Xe){Xe(xt())},lchown(Ie,ze,Xe,ft){ft(xt())},link(Ie,ze,Xe){Xe(xt())},lstat(Ie,ze){ze(xt())},mkdir(Ie,ze,Xe){Xe(xt())},open(Ie,ze,Xe,ft){ft(xt())},read(Ie,ze,Xe,ft,_t,Ve){Ve(xt())},readdir(Ie,ze){ze(xt())},readlink(Ie,ze){ze(xt())},rename(Ie,ze,Xe){Xe(xt())},rmdir(Ie,ze){ze(xt())},stat(Ie,ze){ze(xt())},symlink(Ie,ze,Xe){Xe(xt())},truncate(Ie,ze,Xe){Xe(xt())},unlink(Ie,ze){ze(xt())},utimes(Ie,ze,Xe,ft){ft(xt())}}}if(kt.process||(kt.process={getuid(){return-1},getgid(){return-1},geteuid(){return-1},getegid(){return-1},getgroups(){throw xt()},pid:-1,ppid:-1,umask(){throw xt()},cwd(){throw xt()},chdir(){throw xt()}}),kt.path||(kt.path={resolve(...Ye){return Ye.join("/")}}),!kt.crypto)throw new Error("globalThis.crypto is not available, polyfill required (crypto.getRandomValues only)");if(!kt.performance)throw new Error("globalThis.performance is not available, polyfill required (performance.now only)");if(!kt.TextEncoder)throw new Error("globalThis.TextEncoder is not available, polyfill required");if(!kt.TextDecoder)throw new Error("globalThis.TextDecoder is not available, polyfill required");const At=new TextEncoder("utf-8"),nt=new TextDecoder("utf-8");kt.Go=class{constructor(){this.argv=["js"],this.env={},this.exit=Ce=>{Ce!==0&&console.warn("exit code:",Ce)},this._exitPromise=new Promise(Ce=>{this._resolveExitPromise=Ce}),this._pendingEvent=null,this._scheduledTimeouts=new Map,this._nextCallbackTimeoutID=1;const Ye=(Ce,He)=>{this.mem.setUint32(Ce+0,He,!0),this.mem.setUint32(Ce+4,Math.floor(He/4294967296),!0)},Ie=Ce=>{const He=this.mem.getUint32(Ce+0,!0),ot=this.mem.getInt32(Ce+4,!0);return He+ot*4294967296},ze=Ce=>{const He=this.mem.getFloat64(Ce,!0);if(He===0)return;if(!isNaN(He))return He;const ot=this.mem.getUint32(Ce,!0);return this._values[ot]},Xe=(Ce,He)=>{if(typeof He=="number"&&He!==0){if(isNaN(He)){this.mem.setUint32(Ce+4,2146959360,!0),this.mem.setUint32(Ce,0,!0);return}this.mem.setFloat64(Ce,He,!0);return}if(He===void 0){this.mem.setFloat64(Ce,0,!0);return}let ht=this._ids.get(He);ht===void 0&&(ht=this._idPool.pop(),ht===void 0&&(ht=this._values.length),this._values[ht]=He,this._goRefCounts[ht]=0,this._ids.set(He,ht)),this._goRefCounts[ht]++;let Pt=0;switch(typeof He){case"object":He!==null&&(Pt=1);break;case"string":Pt=2;break;case"symbol":Pt=3;break;case"function":Pt=4;break}this.mem.setUint32(Ce+4,2146959360|Pt,!0),this.mem.setUint32(Ce,ht,!0)},ft=Ce=>{const He=Ie(Ce+0),ot=Ie(Ce+8);return new Uint8Array(this._inst.exports.mem.buffer,He,ot)},_t=Ce=>{const He=Ie(Ce+0),ot=Ie(Ce+8),ht=new Array(ot);for(let Pt=0;Pt<ot;Pt++)ht[Pt]=ze(He+Pt*8);return ht},Ve=Ce=>{const He=Ie(Ce+0),ot=Ie(Ce+8);return nt.decode(new DataView(this._inst.exports.mem.buffer,He,ot))},et=(Ce,He)=>(this._inst.exports.testExport0(),this._inst.exports.testExport(Ce,He)),pt=Date.now()-performance.now();this.importObject={_gotest:{add:(Ce,He)=>Ce+He,callExport:et},gojs:{"runtime.wasmExit":Ce=>{Ce>>>=0;const He=this.mem.getInt32(Ce+8,!0);this.exited=!0,delete this._inst,delete this._values,delete this._goRefCounts,delete this._ids,delete this._idPool,this.exit(He)},"runtime.wasmWrite":Ce=>{Ce>>>=0;const He=Ie(Ce+8),ot=Ie(Ce+16),ht=this.mem.getInt32(Ce+24,!0);kt.fs.writeSync(He,new Uint8Array(this._inst.exports.mem.buffer,ot,ht))},"runtime.resetMemoryDataView":Ce=>{this.mem=new DataView(this._inst.exports.mem.buffer)},"runtime.nanotime1":Ce=>{Ce>>>=0,Ye(Ce+8,(pt+performance.now())*1e6)},"runtime.walltime":Ce=>{Ce>>>=0;const He=new Date().getTime();Ye(Ce+8,He/1e3),this.mem.setInt32(Ce+16,He%1e3*1e6,!0)},"runtime.scheduleTimeoutEvent":Ce=>{Ce>>>=0;const He=this._nextCallbackTimeoutID;this._nextCallbackTimeoutID++,this._scheduledTimeouts.set(He,setTimeout(()=>{for(this._resume();this._scheduledTimeouts.has(He);)console.warn("scheduleTimeoutEvent: missed timeout event"),this._resume()},Ie(Ce+8))),this.mem.setInt32(Ce+16,He,!0)},"runtime.clearTimeoutEvent":Ce=>{Ce>>>=0;const He=this.mem.getInt32(Ce+8,!0);clearTimeout(this._scheduledTimeouts.get(He)),this._scheduledTimeouts.delete(He)},"runtime.getRandomData":Ce=>{Ce>>>=0,crypto.getRandomValues(ft(Ce+8))},"syscall/js.finalizeRef":Ce=>{Ce>>>=0;const He=this.mem.getUint32(Ce+8,!0);if(this._goRefCounts[He]--,this._goRefCounts[He]===0){const ot=this._values[He];this._values[He]=null,this._ids.delete(ot),this._idPool.push(He)}},"syscall/js.stringVal":Ce=>{Ce>>>=0,Xe(Ce+24,Ve(Ce+8))},"syscall/js.valueGet":Ce=>{Ce>>>=0;const He=Reflect.get(ze(Ce+8),Ve(Ce+16));Ce=this._inst.exports.getsp()>>>0,Xe(Ce+32,He)},"syscall/js.valueSet":Ce=>{Ce>>>=0,Reflect.set(ze(Ce+8),Ve(Ce+16),ze(Ce+32))},"syscall/js.valueDelete":Ce=>{Ce>>>=0,Reflect.deleteProperty(ze(Ce+8),Ve(Ce+16))},"syscall/js.valueIndex":Ce=>{Ce>>>=0,Xe(Ce+24,Reflect.get(ze(Ce+8),Ie(Ce+16)))},"syscall/js.valueSetIndex":Ce=>{Ce>>>=0,Reflect.set(ze(Ce+8),Ie(Ce+16),ze(Ce+24))},"syscall/js.valueCall":Ce=>{Ce>>>=0;try{const He=ze(Ce+8),ot=Reflect.get(He,Ve(Ce+16)),ht=_t(Ce+32),Pt=Reflect.apply(ot,He,ht);Ce=this._inst.exports.getsp()>>>0,Xe(Ce+56,Pt),this.mem.setUint8(Ce+64,1)}catch(He){Ce=this._inst.exports.getsp()>>>0,Xe(Ce+56,He),this.mem.setUint8(Ce+64,0)}},"syscall/js.valueInvoke":Ce=>{Ce>>>=0;try{const He=ze(Ce+8),ot=_t(Ce+16),ht=Reflect.apply(He,void 0,ot);Ce=this._inst.exports.getsp()>>>0,Xe(Ce+40,ht),this.mem.setUint8(Ce+48,1)}catch(He){Ce=this._inst.exports.getsp()>>>0,Xe(Ce+40,He),this.mem.setUint8(Ce+48,0)}},"syscall/js.valueNew":Ce=>{Ce>>>=0;try{const He=ze(Ce+8),ot=_t(Ce+16),ht=Reflect.construct(He,ot);Ce=this._inst.exports.getsp()>>>0,Xe(Ce+40,ht),this.mem.setUint8(Ce+48,1)}catch(He){Ce=this._inst.exports.getsp()>>>0,Xe(Ce+40,He),this.mem.setUint8(Ce+48,0)}},"syscall/js.valueLength":Ce=>{Ce>>>=0,Ye(Ce+16,parseInt(ze(Ce+8).length))},"syscall/js.valuePrepareString":Ce=>{Ce>>>=0;const He=At.encode(String(ze(Ce+8)));Xe(Ce+16,He),Ye(Ce+24,He.length)},"syscall/js.valueLoadString":Ce=>{Ce>>>=0;const He=ze(Ce+8);ft(Ce+16).set(He)},"syscall/js.valueInstanceOf":Ce=>{Ce>>>=0,this.mem.setUint8(Ce+24,ze(Ce+8)instanceof ze(Ce+16)?1:0)},"syscall/js.copyBytesToGo":Ce=>{Ce>>>=0;const He=ft(Ce+8),ot=ze(Ce+32);if(!(ot instanceof Uint8Array||ot instanceof Uint8ClampedArray)){this.mem.setUint8(Ce+48,0);return}const ht=ot.subarray(0,He.length);He.set(ht),Ye(Ce+40,ht.length),this.mem.setUint8(Ce+48,1)},"syscall/js.copyBytesToJS":Ce=>{Ce>>>=0;const He=ze(Ce+8),ot=ft(Ce+16);if(!(He instanceof Uint8Array||He instanceof Uint8ClampedArray)){this.mem.setUint8(Ce+48,0);return}const ht=ot.subarray(0,He.length);He.set(ht),Ye(Ce+40,ht.length),this.mem.setUint8(Ce+48,1)},debug:Ce=>{console.log(Ce)}}}}run(Ye){return Ft(this,null,function*(){if(!(Ye instanceof WebAssembly.Instance))throw new Error("Go.run: WebAssembly.Instance expected");this._inst=Ye,this.mem=new DataView(this._inst.exports.mem.buffer),this._values=[NaN,0,null,!0,!1,kt,this],this._goRefCounts=new Array(this._values.length).fill(1/0),this._ids=new Map([[0,1],[null,2],[!0,3],[!1,4],[kt,5],[this,6]]),this._idPool=[],this.exited=!1;let Ie=4096;const ze=pt=>{const Ce=Ie,He=At.encode(pt+"\0");return new Uint8Array(this.mem.buffer,Ie,He.length).set(He),Ie+=He.length,Ie%8!==0&&(Ie+=8-Ie%8),Ce},Xe=this.argv.length,ft=[];this.argv.forEach(pt=>{ft.push(ze(pt))}),ft.push(0),Object.keys(this.env).sort().forEach(pt=>{ft.push(ze(`${pt}=${this.env[pt]}`))}),ft.push(0);const Ve=Ie;if(ft.forEach(pt=>{this.mem.setUint32(Ie,pt,!0),this.mem.setUint32(Ie+4,0,!0),Ie+=8}),Ie>=12288)throw new Error("total length of command line and environment variables exceeds limit");this._inst.exports.run(Xe,Ve),this.exited&&this._resolveExitPromise(),yield this._exitPromise})}_resume(){if(this.exited)throw new Error("Go program has already exited");this._inst.exports.resume(),this.exited&&this._resolveExitPromise()}_makeFuncWrapper(Ye){const Ie=this;return function(){const ze={id:Ye,this:this,args:arguments};return Ie._pendingEvent=ze,Ie._resume(),ze.result}}}})(),Nt=({data:xt})=>{let At=new TextDecoder,nt=kt.fs,Ye="";nt.writeSync=(_t,Ve)=>{if(_t===1)It(Ve);else if(_t===2){Ye+=At.decode(Ve);let et=Ye.split(`
`);et.length>1&&console.log(et.slice(0,-1).join(`
`)),Ye=et[et.length-1]}else throw new Error("Bad write");return Ve.length};let Ie=[],ze,Xe=0;Nt=({data:_t})=>(_t.length>0&&(Ie.push(_t),ze&&ze()),ft),nt.read=(_t,Ve,et,pt,Ce,He)=>{if(_t!==0||et!==0||pt!==Ve.length||Ce!==null)throw new Error("Bad read");if(Ie.length===0){ze=()=>nt.read(_t,Ve,et,pt,Ce,He);return}let ot=Ie[0],ht=Math.max(0,Math.min(pt,ot.length-Xe));Ve.set(ot.subarray(Xe,Xe+ht),et),Xe+=ht,Xe===ot.length&&(Ie.shift(),Xe=0),He(null,ht)};let ft=new kt.Go;return ft.argv=["","--service=0.27.2"],Kt(xt,ft).then(_t=>{It(null),ft.run(_t)},_t=>{It(_t)}),ft};function Kt(xt,At){return Ft(this,null,function*(){if(xt instanceof WebAssembly.Module)return WebAssembly.instantiate(xt,At.importObject);const nt=yield fetch(xt);if(!nt.ok)throw new Error(`Failed to download ${JSON.stringify(xt)}`);if("instantiateStreaming"in WebAssembly&&/^application\/wasm($|;)/i.test(nt.headers.get("Content-Type")||""))return(yield WebAssembly.instantiateStreaming(nt,At.importObject)).instance;const Ye=yield nt.arrayBuffer();return(yield WebAssembly.instantiate(Ye,At.importObject)).instance})}return xt=>Nt(xt)})(It=>D.onmessage({data:It})),mt;D={onmessage:null,postMessage:It=>setTimeout(()=>{try{mt=Qe({data:It})}catch(Ft){X(Ft)}}),terminate(){if(mt)for(let It of mt._scheduledTimeouts.values())clearTimeout(It)}}}let we,Ae;const De=new Promise((Qe,mt)=>{we=Qe,Ae=mt});D.onmessage=({data:Qe})=>{D.onmessage=({data:mt})=>Et(mt),Qe?Ae(Qe):we()},D.postMessage(M||new URL(le,location.href).toString());let{readFromStdout:Et,service:St}=rt({writeToStdin(Qe){D.postMessage(Qe)},isSync:!1,hasFS:!1,esbuild:l});yield De,me=()=>{D.terminate(),L=void 0,me=void 0,Me=void 0},Me={build:Qe=>new Promise((mt,It)=>{he.then(It),St.buildOrContext({callName:"build",refs:null,options:Qe,isTTY:!1,defaultWD:"/",callback:(Ft,Nt)=>Ft?It(Ft):mt(Nt)})}),context:Qe=>new Promise((mt,It)=>{he.then(It),St.buildOrContext({callName:"context",refs:null,options:Qe,isTTY:!1,defaultWD:"/",callback:(Ft,Nt)=>Ft?It(Ft):mt(Nt)})}),transform:(Qe,mt)=>new Promise((It,Ft)=>{he.then(Ft),St.transform({callName:"transform",refs:null,input:Qe,options:mt||{},isTTY:!1,fs:{readFile(Nt,kt){kt(new Error("Internal error"),null)},writeFile(Nt,kt){kt(null)}},callback:(Nt,kt)=>Nt?Ft(Nt):It(kt)})}),formatMessages:(Qe,mt)=>new Promise((It,Ft)=>{he.then(Ft),St.formatMessages({callName:"formatMessages",refs:null,messages:Qe,options:mt,callback:(Nt,kt)=>Nt?Ft(Nt):It(kt)})}),analyzeMetafile:(Qe,mt)=>new Promise((It,Ft)=>{he.then(Ft),St.analyzeMetafile({callName:"analyzeMetafile",refs:null,metafile:typeof Qe=="string"?Qe:JSON.stringify(Qe),options:mt,callback:(Nt,kt)=>Nt?Ft(Nt):It(kt)})})}}),bt=l})(t)})(browser)),browser.exports}var browserExports=requireBrowser();const ESBUILD_WASM_URL$1="https://unpkg.com/esbuild-wasm@0.27.2/esbuild.wasm",WASM_CACHE_DB$1="shiro-wasm-cache",WASM_CACHE_STORE$1="wasm-binaries",WASM_CACHE_KEY$1="esbuild-0.27.2";let esbuildInitialized$1=!1,initPromise$1=null;function openWasmCacheDB$1(){return new Promise((t,e)=>{const r=indexedDB.open(WASM_CACHE_DB$1,1);r.onerror=()=>e(r.error),r.onsuccess=()=>t(r.result),r.onupgradeneeded=()=>{const n=r.result;n.objectStoreNames.contains(WASM_CACHE_STORE$1)||n.createObjectStore(WASM_CACHE_STORE$1)}})}async function getCachedWasm$1(){try{const t=await openWasmCacheDB$1();return new Promise(e=>{const r=t.transaction(WASM_CACHE_STORE$1,"readonly"),c=r.objectStore(WASM_CACHE_STORE$1).get(WASM_CACHE_KEY$1);c.onsuccess=()=>e(c.result||null),c.onerror=()=>e(null),r.oncomplete=()=>t.close()})}catch{return null}}async function cacheWasm$1(t){try{const e=await openWasmCacheDB$1();return new Promise((r,n)=>{const c=e.transaction(WASM_CACHE_STORE$1,"readwrite"),h=c.objectStore(WASM_CACHE_STORE$1).put(t,WASM_CACHE_KEY$1);h.onsuccess=()=>r(),h.onerror=()=>n(h.error),c.oncomplete=()=>e.close()})}catch{}}async function ensureEsbuildInitialized$1(){if(!esbuildInitialized$1){if(initPromise$1){await initPromise$1;return}initPromise$1=(async()=>{try{let t=await getCachedWasm$1();t?await browserExports.initialize({wasmModule:await WebAssembly.compile(t),worker:!1}):(t=await(await fetch(ESBUILD_WASM_URL$1)).arrayBuffer(),await browserExports.initialize({wasmModule:await WebAssembly.compile(t),worker:!1}),cacheWasm$1(t)),esbuildInitialized$1=!0}catch(t){throw initPromise$1=null,new Error(`Failed to initialize esbuild: ${t.message}`)}})(),await initPromise$1}}function createVirtualFSPlugin(t){return{name:"shiro-virtual-fs",setup(e){e.onResolve({filter:/.*/},async r=>{if(!r.path.startsWith(".")&&!r.path.startsWith("/")){const s=[`/node_modules/${r.path}/package.json`,`/node_modules/${r.path}/index.js`,`/node_modules/${r.path}/index.ts`,`/node_modules/${r.path}.js`,`/node_modules/${r.path}.ts`,`${t.cwd}/node_modules/${r.path}/package.json`,`${t.cwd}/node_modules/${r.path}/index.js`,`${t.cwd}/node_modules/${r.path}/index.ts`,`${t.cwd}/node_modules/${r.path}.js`,`${t.cwd}/node_modules/${r.path}.ts`];for(const h of s)try{if(h.endsWith("package.json")){const o=await t.fs.readFile(h,"utf8"),d=JSON.parse(o).main||"index.js",l=h.replace("/package.json","");return{path:t.fs.resolvePath(d,l),namespace:"shiro-fs"}}else return await t.fs.readFile(h,"utf8"),{path:h,namespace:"shiro-fs"}}catch{continue}return{path:r.path,external:!0}}let n;if(r.path.startsWith("/"))n=r.path;else{const s=r.importer?r.importer.split("/").slice(0,-1).join("/")||"/":t.cwd;n=t.fs.resolvePath(r.path,s)}const c=["",".ts",".tsx",".js",".jsx",".json"];for(const s of c){const h=n+s;try{return await t.fs.readFile(h,"utf8"),{path:h,namespace:"shiro-fs"}}catch{continue}}return{path:n,namespace:"shiro-fs"}}),e.onLoad({filter:/.*/,namespace:"shiro-fs"},async r=>{try{const n=await t.fs.readFile(r.path,"utf8");let c="js";return r.path.endsWith(".ts")?c="ts":r.path.endsWith(".tsx")?c="tsx":r.path.endsWith(".jsx")?c="jsx":r.path.endsWith(".json")?c="json":r.path.endsWith(".css")&&(c="css"),{contents:n,loader:c}}catch(n){return{errors:[{text:`Failed to load ${r.path}: ${n.message}`,location:null}]}}})}}}const buildCmd={name:"build",description:"Bundle TypeScript/JavaScript using esbuild-wasm",async exec(t){if(t.args.length===0||t.args[0]==="--help"||t.args[0]==="-h")return t.stdout+=`Usage: build <entry-point> [options]

`,t.stdout+=`Options:
`,t.stdout+=`  --outfile=FILE    Output file path
`,t.stdout+=`  --bundle          Bundle all dependencies
`,t.stdout+=`  --minify          Minify the output
`,t.stdout+=`  --sourcemap       Generate source maps
`,t.stdout+=`  --format=FORMAT   Output format (iife, cjs, esm)
`,t.stdout+=`  --target=TARGET   Target environment (es2015, es2020, etc.)
`,t.stdout+=`
Example:
`,t.stdout+=`  build src/index.ts --outfile=dist/bundle.js --bundle --minify
`,0;try{t.stdout+=`Initializing esbuild...
`,await ensureEsbuildInitialized$1();const e=t.args[0],r={bundle:!1,minify:!1,sourcemap:!1,format:"esm",target:"es2020"};let n="out.js";for(let h=1;h<t.args.length;h++){const o=t.args[h];o.startsWith("--outfile=")?n=o.slice(10):o==="--bundle"?r.bundle=!0:o==="--minify"?r.minify=!0:o==="--sourcemap"?r.sourcemap=!0:o.startsWith("--format=")?r.format=o.slice(9):o.startsWith("--target=")&&(r.target=o.slice(9))}const c=t.fs.resolvePath(e,t.cwd);t.stdout+=`Building ${c}...
`;const s=await browserExports.build({entryPoints:[c],bundle:r.bundle,minify:r.minify,sourcemap:r.sourcemap,format:r.format,target:r.target,write:!1,plugins:[createVirtualFSPlugin(t)],logLevel:"silent"});if(s.errors.length>0){for(const h of s.errors)t.stderr+=`Error: ${h.text}
`,h.location&&(t.stderr+=`  at ${h.location.file}:${h.location.line}:${h.location.column}
`);return 1}if(s.warnings.length>0)for(const h of s.warnings)t.stdout+=`Warning: ${h.text}
`;if(s.outputFiles&&s.outputFiles.length>0){const h=s.outputFiles[0],o=t.fs.resolvePath(n,t.cwd),a=o.split("/").slice(0,-1).join("/");if(a)try{await t.fs.mkdir(a)}catch{}await t.fs.writeFile(o,h.contents);const d=(h.contents.length/1024).toFixed(2);if(t.stdout+=` Built successfully: ${o} (${d} KB)
`,r.sourcemap&&s.outputFiles.length>1){const l=s.outputFiles[1],f=o+".map";await t.fs.writeFile(f,l.contents),t.stdout+=` Generated sourcemap: ${f}
`}}return 0}catch(e){return t.stderr+=`build: ${e.message}
`,e.stack&&(t.stderr+=e.stack+`
`),1}}},viCmd={name:"vi",description:"Minimal vi-like text editor",async exec(t){if(t.args.length===0)return t.stderr+=`Usage: vi <file>
`,1;if(!t.terminal)return t.stderr+=`vi: terminal not available for interactive editing
`,t.stderr+=`Use ed for line-based editing, or cat > file << EOF for file creation.
`,1;const e=t.args[0],r=t.fs.resolvePath(e,t.cwd);let n="",c=!1;try{n=await t.fs.readFile(r,"utf8"),c=!0}catch{n=""}const s={lines:n?n.split(`
`):[""],cursorRow:0,cursorCol:0,mode:"normal",commandBuffer:"",lastKey:"",modified:!1,scrollOffset:0,message:c?`"${e}" ${n.split(`
`).length} lines`:`"${e}" [New File]`,searchPattern:"",searchBuffer:""},h=t.terminal,{rows:o,cols:a}=h.getSize();return new Promise(d=>{let l=!0;const f=I=>{h.writeOutput(I)},p=()=>{f("\x1B[2J\x1B[H");const I=o-2;s.cursorRow<s.scrollOffset?s.scrollOffset=s.cursorRow:s.cursorRow>=s.scrollOffset+I&&(s.scrollOffset=s.cursorRow-I+1);for(let Q=0;Q<I;Q++){const W=Q+s.scrollOffset;if(W<s.lines.length){const Y=s.lines[W];f(Y.slice(0,a-1))}else f("\x1B[34m~\x1B[0m");f(`\x1B[K\r
`)}const B=s.mode==="insert"?"-- INSERT --":(s.mode==="command",""),P=s.modified?"[+]":"",x=`${s.cursorRow+1},${s.cursorCol+1}`,N=` ${B} ${P} ${e} ${x}`.padEnd(a);f(`\x1B[7m${N.slice(0,a)}\x1B[0m\r
`),s.mode==="command"?f(`:${s.commandBuffer}`):s.mode==="search"?f(`/${s.searchBuffer}`):f(s.message),f("\x1B[K");const J=s.cursorRow-s.scrollOffset;f(`\x1B[${J+1};${s.cursorCol+1}H`)},S=async I=>{const B=()=>s.lines[s.cursorRow]||"",P=()=>{const x=Math.max(0,B().length-1);s.cursorCol=Math.min(s.cursorCol,x)};switch(I){case"h":s.cursorCol=Math.max(0,s.cursorCol-1);break;case"j":s.cursorRow<s.lines.length-1&&(s.cursorRow++,P());break;case"k":s.cursorRow>0&&(s.cursorRow--,P());break;case"l":s.cursorCol=Math.min(B().length,s.cursorCol+1);break;case"0":s.cursorCol=0;break;case"$":s.cursorCol=Math.max(0,B().length-1);break;case"i":s.mode="insert";break;case"a":s.cursorCol=Math.min(B().length,s.cursorCol+1),s.mode="insert";break;case"o":s.lines.splice(s.cursorRow+1,0,""),s.cursorRow++,s.cursorCol=0,s.mode="insert",s.modified=!0;break;case"O":s.lines.splice(s.cursorRow,0,""),s.cursorCol=0,s.mode="insert",s.modified=!0;break;case"x":if(B().length>0){const x=B();s.lines[s.cursorRow]=x.slice(0,s.cursorCol)+x.slice(s.cursorCol+1),s.modified=!0,P()}break;case"d":if(s.lastKey==="d"){s.lines.splice(s.cursorRow,1),s.lines.length===0&&(s.lines=[""]),s.cursorRow=Math.min(s.cursorRow,s.lines.length-1),s.modified=!0,s.lastKey="";return}break;case"g":if(s.lastKey==="g"){s.cursorRow=0,s.cursorCol=0,s.lastKey="";return}break;case"G":s.cursorRow=s.lines.length-1,s.cursorCol=0;break;case":":s.mode="command",s.commandBuffer="";break;case"/":s.mode="search",s.searchBuffer="";break;case"n":s.searchPattern?A(s):s.message="No previous search pattern";break;case"N":s.searchPattern?w(s):s.message="No previous search pattern";break}s.lastKey=I},k=async I=>{if(I==="\x1B"||I==="Escape"){s.mode="normal",s.cursorCol=Math.max(0,s.cursorCol-1);return}const B=s.lines[s.cursorRow];if(I==="Enter"||I==="\r"||I===`
`){const P=B.slice(0,s.cursorCol),x=B.slice(s.cursorCol);s.lines[s.cursorRow]=P,s.lines.splice(s.cursorRow+1,0,x),s.cursorRow++,s.cursorCol=0,s.modified=!0}else if(I==="Backspace"||I===""){if(s.cursorCol>0)s.lines[s.cursorRow]=B.slice(0,s.cursorCol-1)+B.slice(s.cursorCol),s.cursorCol--,s.modified=!0;else if(s.cursorRow>0){const P=s.lines[s.cursorRow-1];s.cursorCol=P.length,s.lines[s.cursorRow-1]=P+B,s.lines.splice(s.cursorRow,1),s.cursorRow--,s.modified=!0}}else I.length===1&&I>=" "&&(s.lines[s.cursorRow]=B.slice(0,s.cursorCol)+I+B.slice(s.cursorCol),s.cursorCol++,s.modified=!0)},A=I=>{if(!I.searchPattern)return;const B=I.cursorRow,P=I.cursorCol+1;for(let x=B;x<I.lines.length;x++){const N=I.lines[x],J=x===B?P:0,Q=N.indexOf(I.searchPattern,J);if(Q!==-1){I.cursorRow=x,I.cursorCol=Q,I.message=`Found: ${I.searchPattern}`;return}}for(let x=0;x<=B;x++){const N=I.lines[x],J=x===B?P-1:N.length,Q=N.indexOf(I.searchPattern);if(Q!==-1&&Q<J){I.cursorRow=x,I.cursorCol=Q,I.message=`Found: ${I.searchPattern} (wrapped)`;return}}I.message=`Pattern not found: ${I.searchPattern}`},w=I=>{if(!I.searchPattern)return;const B=I.cursorRow,P=I.cursorCol-1;for(let x=B;x>=0;x--){const N=I.lines[x],J=x===B?P:N.length-1;for(let Q=J;Q>=0;Q--)if(N.slice(Q,Q+I.searchPattern.length)===I.searchPattern){I.cursorRow=x,I.cursorCol=Q,I.message=`Found: ${I.searchPattern}`;return}}for(let x=I.lines.length-1;x>=B;x--){const N=I.lines[x],J=N.length-1;for(let Q=J;Q>=0;Q--)if(N.slice(Q,Q+I.searchPattern.length)===I.searchPattern){I.cursorRow=x,I.cursorCol=Q,I.message=`Found: ${I.searchPattern} (wrapped)`;return}}I.message=`Pattern not found: ${I.searchPattern}`},v=async I=>{if(I==="\x1B"||I==="Escape"){s.mode="normal",s.searchBuffer="";return}if(I==="Enter"||I==="\r"||I===`
`){s.searchPattern=s.searchBuffer,s.mode="normal",s.searchPattern&&A(s),s.searchBuffer="";return}I==="Backspace"||I===""?(s.searchBuffer=s.searchBuffer.slice(0,-1),s.searchBuffer.length===0&&(s.mode="normal")):I.length===1&&I>=" "&&(s.searchBuffer+=I)},g=async I=>{if(I==="\x1B"||I==="Escape"){s.mode="normal",s.commandBuffer="";return}if(I==="Enter"||I==="\r"||I===`
`){const B=s.commandBuffer.trim();if(B==="w"){const P=s.lines.join(`
`);await t.fs.writeFile(r,P),s.modified=!1,s.message=`"${e}" ${s.lines.length} lines written`}else if(B==="q")if(s.modified)s.message="No write since last change (use :q! to override)";else{l=!1,m(),d(0);return}else if(B==="q!"){l=!1,m(),d(0);return}else if(B==="wq"||B==="x"){const P=s.lines.join(`
`);await t.fs.writeFile(r,P),l=!1,m(),d(0);return}else s.message=`Not an editor command: ${B}`;s.mode="normal",s.commandBuffer=""}else I==="Backspace"||I===""?(s.commandBuffer=s.commandBuffer.slice(0,-1),s.commandBuffer.length===0&&(s.mode="normal")):I.length===1&&I>=" "&&(s.commandBuffer+=I)},m=()=>{h.exitRawMode(),f("\x1B[2J\x1B[H")},$=async I=>{if(l){if(I==="Ctrl+C"){l=!1,m(),d(1);return}s.message="",s.mode==="normal"?await S(I):s.mode==="insert"?await k(I):s.mode==="command"?await g(I):s.mode==="search"&&await v(I),l&&p()}};h.enterRawMode($),p()})}},nanoCmd={name:"nano",description:"Simple text editor (Ctrl+O save, Ctrl+X exit)",async exec(t){if(t.args.length===0)return t.stderr+=`Usage: nano <file>
`,1;if(!t.terminal)return t.stderr+=`nano: terminal not available for interactive editing
`,t.stderr+=`Use ed for line-based editing, or cat > file << EOF for file creation.
`,1;const e=t.args[0],r=t.fs.resolvePath(e,t.cwd);let n="",c=!1;try{n=await t.fs.readFile(r,"utf8"),c=!0}catch{n=""}const s={lines:n?n.split(`
`):[""],cursorRow:0,cursorCol:0,scrollOffset:0,modified:!1,message:c?`Read ${n.split(`
`).length} lines`:"New File",cutBuffer:[],searchQuery:"",inputMode:"edit",inputBuffer:""},h=t.terminal,{rows:o,cols:a}=h.getSize();return new Promise(d=>{let l=!0;const f=v=>{h.writeOutput(v)},p=()=>{f("\x1B[2J\x1B[H");const v=2,m=o-v-3,$=`  GNU nano 7.0      ${e}${s.modified?" (modified)":""}`;f(`\x1B[7m${$.padEnd(a)}\x1B[0m\r
`),f(`\r
`),s.cursorRow<s.scrollOffset?s.scrollOffset=s.cursorRow:s.cursorRow>=s.scrollOffset+m&&(s.scrollOffset=s.cursorRow-m+1);for(let B=0;B<m;B++){const P=B+s.scrollOffset;if(P<s.lines.length){const x=s.lines[P].slice(0,a-1);f(x)}f(`\x1B[K\r
`)}f("\x1B[7m");const I=s.inputMode==="edit"?"^G Help  ^O Write Out  ^W Where Is  ^K Cut   ^X Exit":s.inputMode==="save"?"File Name to Write: ":s.inputMode==="search"?"Search: ":"Save modified buffer? (Y/N) ";if(f(I.padEnd(a).slice(0,a)),f(`\x1B[0m\r
`),f("\x1B[7m"),s.inputMode==="edit"?f("^U Paste ^C Cancel   ^\\Replace  ^T Execute".padEnd(a).slice(0,a)):f(s.inputBuffer.padEnd(a).slice(0,a)),f(`\x1B[0m\r
`),f(s.message.slice(0,a)),f("\x1B[K"),s.inputMode==="edit"){const B=s.cursorRow-s.scrollOffset+v;f(`\x1B[${B+1};${s.cursorCol+1}H`)}else f(`\x1B[${o-1};${s.inputBuffer.length+1}H`)},S=()=>{h.exitRawMode(),f("\x1B[2J\x1B[H")},k=async()=>{const v=s.lines.join(`
`);await t.fs.writeFile(r,v),s.modified=!1,s.message=`Wrote ${s.lines.length} lines`},A=(v,g=!0)=>{if(!v)return;s.searchQuery=v;const m=s.cursorRow,$=s.cursorCol+1;for(let I=0;I<s.lines.length;I++){const B=g?(m+I)%s.lines.length:(m-I+s.lines.length)%s.lines.length,P=s.lines[B],x=I===0&&g?$:0,N=P.indexOf(v,x);if(N!==-1){s.cursorRow=B,s.cursorCol=N,s.message=`Found "${v}"`;return}}s.message=`"${v}" not found`},w=async v=>{if(!l)return;if(s.inputMode==="save"){v==="Enter"?(await k(),s.inputMode="edit",s.inputBuffer=""):v==="Ctrl+C"||v==="Escape"?(s.inputMode="edit",s.inputBuffer="",s.message="Cancelled"):v==="Backspace"?s.inputBuffer=s.inputBuffer.slice(0,-1):v.length===1&&v>=" "&&(s.inputBuffer+=v),p();return}if(s.inputMode==="search"){v==="Enter"?(A(s.inputBuffer),s.inputMode="edit",s.inputBuffer=""):v==="Ctrl+C"||v==="Escape"?(s.inputMode="edit",s.inputBuffer="",s.message="Cancelled"):v==="Backspace"?s.inputBuffer=s.inputBuffer.slice(0,-1):v.length===1&&v>=" "&&(s.inputBuffer+=v),p();return}if(s.inputMode==="exit-confirm"){if(v==="y"||v==="Y"){await k(),l=!1,S(),d(0);return}else if(v==="n"||v==="N"){l=!1,S(),d(0);return}else(v==="Ctrl+C"||v==="Escape")&&(s.inputMode="edit",s.message="Cancelled");p();return}s.message="";const g=()=>s.lines[s.cursorRow]||"";switch(v){case"ArrowUp":s.cursorRow>0&&(s.cursorRow--,s.cursorCol=Math.min(s.cursorCol,g().length));break;case"ArrowDown":s.cursorRow<s.lines.length-1&&(s.cursorRow++,s.cursorCol=Math.min(s.cursorCol,g().length));break;case"ArrowLeft":s.cursorCol>0?s.cursorCol--:s.cursorRow>0&&(s.cursorRow--,s.cursorCol=g().length);break;case"ArrowRight":s.cursorCol<g().length?s.cursorCol++:s.cursorRow<s.lines.length-1&&(s.cursorRow++,s.cursorCol=0);break;case"Home":case"Ctrl+A":s.cursorCol=0;break;case"End":case"Ctrl+E":s.cursorCol=g().length;break;case"Enter":const m=g().slice(0,s.cursorCol),$=g().slice(s.cursorCol);s.lines[s.cursorRow]=m,s.lines.splice(s.cursorRow+1,0,$),s.cursorRow++,s.cursorCol=0,s.modified=!0;break;case"Backspace":if(s.cursorCol>0)s.lines[s.cursorRow]=g().slice(0,s.cursorCol-1)+g().slice(s.cursorCol),s.cursorCol--,s.modified=!0;else if(s.cursorRow>0){const I=s.lines[s.cursorRow-1];s.cursorCol=I.length,s.lines[s.cursorRow-1]=I+g(),s.lines.splice(s.cursorRow,1),s.cursorRow--,s.modified=!0}break;case"Delete":s.cursorCol<g().length?(s.lines[s.cursorRow]=g().slice(0,s.cursorCol)+g().slice(s.cursorCol+1),s.modified=!0):s.cursorRow<s.lines.length-1&&(s.lines[s.cursorRow]=g()+s.lines[s.cursorRow+1],s.lines.splice(s.cursorRow+1,1),s.modified=!0);break;case"Ctrl+X":if(s.modified)s.inputMode="exit-confirm",s.message="Save modified buffer?";else{l=!1,S(),d(0);return}break;case"Ctrl+O":s.inputMode="save",s.inputBuffer=e;break;case"Ctrl+K":s.cutBuffer=[g()],s.lines.splice(s.cursorRow,1),s.lines.length===0&&(s.lines=[""]),s.cursorRow=Math.min(s.cursorRow,s.lines.length-1),s.cursorCol=Math.min(s.cursorCol,g().length),s.modified=!0,s.message="Cut 1 line";break;case"Ctrl+U":s.cutBuffer.length>0&&(s.lines.splice(s.cursorRow,0,...s.cutBuffer),s.modified=!0,s.message=`Pasted ${s.cutBuffer.length} line(s)`);break;case"Ctrl+W":s.inputMode="search",s.inputBuffer=s.searchQuery;break;case"Ctrl+G":s.message="^O Save  ^X Exit  ^K Cut  ^U Paste  ^W Search";break;case"Ctrl+C":s.message=`Line ${s.cursorRow+1}/${s.lines.length}, Col ${s.cursorCol+1}`;break;default:v.length===1&&v>=" "&&(s.lines[s.cursorRow]=g().slice(0,s.cursorCol)+v+g().slice(s.cursorCol),s.cursorCol++,s.modified=!0)}p()};h.enterRawMode(w),p()})}},uploadCmd={name:"upload",description:"Upload files from host machine into virtual filesystem",async exec(t){const e=t.args[0]||".";return new Promise(r=>{const n=document.createElement("input");n.type="file",n.multiple=!0,n.style.display="none",document.body.appendChild(n),n.addEventListener("change",async()=>{const c=n.files;if(!c||c.length===0){t.stdout=`No files selected.
`,document.body.removeChild(n),r(0);return}const s=[];for(const h of Array.from(c))try{const o=await h.text(),a=e==="."?t.fs.resolvePath(h.name,t.cwd):t.fs.resolvePath(`${e}/${h.name}`,t.cwd);await t.fs.writeFile(a,o),s.push(`Uploaded: ${a} (${h.size} bytes)`)}catch(o){s.push(`Failed to upload ${h.name}: ${o.message}`)}t.stdout=s.join(`
`)+`
`,document.body.removeChild(n),r(0)}),n.addEventListener("cancel",()=>{t.stdout=`Upload cancelled.
`,document.body.removeChild(n),r(0)}),setTimeout(()=>{document.body.contains(n)&&document.body.removeChild(n)},12e4),n.click()})}},downloadCmd={name:"download",description:"Download files from virtual filesystem to host machine",async exec(t){if(t.args.length===0)return t.stderr=`Usage: download <file> [file2 ...]
`,1;const e=[];for(const r of t.args)try{const n=t.fs.resolvePath(r,t.cwd),c=await t.fs.readFile(n,"utf8"),s=new Blob([c],{type:"application/octet-stream"}),h=URL.createObjectURL(s),o=document.createElement("a");o.href=h,o.download=r.split("/").pop()||"file",document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(h),e.push(`Downloaded: ${r}`)}catch(n){return t.stderr=`download: ${n.message}
`,1}return t.stdout=e.join(`
`)+`
`,0}},shiroConfigCmd={name:"shiro",description:"Shiro OS configuration",async exec(t){const e=(r,n)=>r?`${n}...${r.slice(-8)}`:"(not set)";if(t.args[0]==="config"&&t.args[1]==="set"&&t.args[2]==="anthropic_key"&&t.args[3])return localStorage.setItem("shiro_anthropic_key",t.args[3]),t.env.ANTHROPIC_API_KEY=t.args[3],t.stdout=`Anthropic API key saved.
`,0;if(t.args[0]==="config"&&t.args[1]==="get"&&t.args[2]==="anthropic_key"){const r=localStorage.getItem("shiro_anthropic_key")||"";return t.stdout=e(r,"sk-ant-")+`
`,0}if(t.args[0]==="config"&&t.args[1]==="set"&&t.args[2]==="openai_key"&&t.args[3])return localStorage.setItem("shiro_openai_key",t.args[3]),t.env.OPENAI_API_KEY=t.args[3],t.stdout=`OpenAI API key saved.
`,0;if(t.args[0]==="config"&&t.args[1]==="get"&&t.args[2]==="openai_key"){const r=localStorage.getItem("shiro_openai_key")||"";return t.stdout=e(r,"sk-")+`
`,0}if(t.args[0]==="config"&&t.args[1]==="set"&&t.args[2]==="google_key"&&t.args[3])return localStorage.setItem("shiro_google_key",t.args[3]),t.env.GOOGLE_API_KEY=t.args[3],t.stdout=`Google API key saved.
`,0;if(t.args[0]==="config"&&t.args[1]==="get"&&t.args[2]==="google_key"){const r=localStorage.getItem("shiro_google_key")||"";return t.stdout=e(r,"AIza")+`
`,0}if(t.args[0]==="config"&&t.args[1]==="set"&&t.args[2]==="api_key"&&t.args[3])return localStorage.setItem("shiro_anthropic_key",t.args[3]),t.env.ANTHROPIC_API_KEY=t.args[3],t.stdout=`Anthropic API key saved.
`,0;if(t.args[0]==="config"&&t.args[1]==="get"&&t.args[2]==="api_key"){const r=localStorage.getItem("shiro_anthropic_key")||localStorage.getItem("shiro_api_key")||"";return t.stdout=e(r,"sk-ant-")+`
`,0}if(t.args[0]==="config"&&t.args[1]==="set"&&t.args[2]==="github_token"&&t.args[3])return localStorage.setItem("shiro_github_token",t.args[3]),t.env.GITHUB_TOKEN=t.args[3],t.stdout=`GitHub token saved. You can now use git push/pull.
`,0;if(t.args[0]==="config"&&t.args[1]==="get"&&t.args[2]==="github_token"){const r=localStorage.getItem("shiro_github_token")||"";return t.stdout=e(r,"ghp_")+`
`,0}if(t.args[0]==="config"&&t.args[1]==="list"){const r=localStorage.getItem("shiro_anthropic_key")||localStorage.getItem("shiro_api_key")||"",n=localStorage.getItem("shiro_openai_key")||"",c=localStorage.getItem("shiro_google_key")||"",s=localStorage.getItem("shiro_github_token")||"";return t.stdout=`Configuration:
`,t.stdout+=`  anthropic_key: ${e(r,"sk-ant-")}
`,t.stdout+=`  openai_key:    ${e(n,"sk-")}
`,t.stdout+=`  google_key:    ${e(c,"AIza")}
`,t.stdout+=`  github_token:  ${e(s,"ghp_")}
`,0}return t.stdout=["Usage:","  shiro config set anthropic_key <key>  Set Anthropic (Claude) API key","  shiro config set openai_key <key>     Set OpenAI (GPT) API key","  shiro config set google_key <key>     Set Google (Gemini) API key","  shiro config set github_token <tok>   Set GitHub token for git push/pull","  shiro config get <key_name>           Show a config value","  shiro config list                     Show all configuration","","Get API keys at:","  Anthropic: https://console.anthropic.com/settings/keys","  OpenAI:    https://platform.openai.com/api-keys","  Google:    https://aistudio.google.com/app/apikey","  GitHub:    https://github.com/settings/tokens",""].join(`
`),0}},sourceCmd={name:"source",description:"Execute a script file in the current shell context",async exec(t){if(t.args.length===0)return t.stderr=`source: missing file argument
`,1;const e=t.fs.resolvePath(t.args[0],t.cwd);let r;try{r=await t.fs.readFile(e,"utf8")}catch{return t.stderr=`source: ${t.args[0]}: No such file or directory
`,1}const n=r.split(/\r?\n/),c=[];let s=0;for(;s<n.length;){const d=n[s],f=d.trim().match(/<<-?\s*(?:'([^']+)'|"([^"]+)"|(\S+))/);if(f){const p=f[1]||f[2]||f[3],S=[d];for(s++;s<n.length&&(S.push(n[s]),n[s].trim()!==p);)s++;c.push(S.join(`
`)),s++;continue}c.push(d),s++}let h=0,o="",a="";for(const d of c){const l=d.trim();if(!l||l.startsWith("#"))continue;const f=l.match(/^export\s+([A-Za-z_][A-Za-z0-9_]*)=(.*)/);if(f){let k=f[2];(k.startsWith('"')&&k.endsWith('"')||k.startsWith("'")&&k.endsWith("'"))&&(k=k.slice(1,-1)),t.env[f[1]]=k,t.shell.env[f[1]]=k;continue}const p=l.match(/^([A-Za-z_][A-Za-z0-9_]*)=(.*)/);if(p){let k=p[2];(k.startsWith('"')&&k.endsWith('"')||k.startsWith("'")&&k.endsWith("'"))&&(k=k.slice(1,-1)),t.env[p[1]]=k,t.shell.env[p[1]]=k;continue}const S=await t.shell.exec(d);o+=S.stdout,a+=S.stderr,h=S.exitCode}return t.stdout=o,t.stderr+=a,h}},jobsCmd={name:"jobs",description:"List background jobs",async exec(t){const e=t.shell;if(e.backgroundJobs.size===0)return t.stdout=`No background jobs.
`,0;for(const[r,n]of e.backgroundJobs){const c=n.status==="running"?"Running":n.status==="done"?`Done (${n.exitCode})`:`Failed (${n.exitCode})`;t.stdout+=`[${r}] ${c}	${n.command}
`}for(const[r,n]of e.backgroundJobs)n.status!=="running"&&e.backgroundJobs.delete(r);return 0}},fgCmd={name:"fg",description:"Bring background job to foreground",async exec(t){const e=t.shell;let r;if(t.args.length===0){const s=[...e.backgroundJobs.keys()];if(s.length===0)return t.stderr=`fg: no current job
`,1;r=s[s.length-1]}else r=parseInt(t.args[0].replace("%",""),10);const n=e.backgroundJobs.get(r);if(!n)return t.stderr=`fg: %${r}: no such job
`,1;if(n.status!=="running")return t.stdout=`[${r}] Already ${n.status}
`,e.backgroundJobs.delete(r),n.exitCode;t.stdout=`[${r}] ${n.command}
`;const c=await n.promise;return e.backgroundJobs.delete(r),c}},bgCmd={name:"bg",description:"Resume a stopped job in the background",async exec(t){return t.stdout=`bg: job control not fully supported in browser environment
`,0}},waitCmd={name:"wait",description:"Wait for background jobs to complete",async exec(t){const e=t.shell;let r=0;if(t.args.length>0){const n=parseInt(t.args[0].replace("%",""),10),c=e.backgroundJobs.get(n);c&&(r=await c.promise,e.backgroundJobs.delete(n))}else for(const[n,c]of e.backgroundJobs)r=await c.promise,e.backgroundJobs.delete(n);return r}};class HCSession{doc;source;current;lastResults=[];lastGrid=null;vars={};constructor(e,r="page"){this.doc=e,this.source=r,this.current=e.body||e.documentElement}_depth(e){let r=0;for(;e&&e!==this.doc.body&&e!==this.doc.documentElement;)r++,e=e.parentElement;return r}s(){const e=this.source.split("/").pop(),r=this.lastResults.length,n=this._depth(this.current),c=this.current.tagName?.toLowerCase()||"doc";return`p:${e} c:${r} d:${n} @${c}`}t(e){let r=(this.current.textContent||"").replace(/\s+/g," ").trim();return e&&r.length>e&&(r=r.slice(0,e)+""),r}q(e,r=10){try{const n=Array.from(this.doc.querySelectorAll(e));return this.lastResults=n,n.length===0?"":n.slice(0,r).map((c,s)=>{const h=(c.textContent||"").replace(/\s+/g," ").trim().slice(0,60);return`[${s}]${h}`}).join(`
`)}catch(n){return" "+n.message}}q1(e){try{const r=this.doc.querySelector(e);return r?(this.current=r,this.lastResults=[r],(r.textContent||"").replace(/\s+/g," ").trim().slice(0,200)):""}catch(r){return" "+r.message}}n(e){return e>=this.lastResults.length?" out of range":(this.current=this.lastResults[e],` [${e}] ${(this.current.textContent||"").replace(/\s+/g," ").trim().slice(0,100)}`)}up(e=1){for(let r=0;r<e;r++)this.current.parentElement&&(this.current=this.current.parentElement);return` @${this.current.tagName?.toLowerCase()}`}ch(){const e=Array.from(this.current.children);return e.length===0?" no children":e.slice(0,15).map((r,n)=>{const c=r.tagName.toLowerCase(),s=r.className?"."+String(r.className).split(" ")[0]:"";return`[${n}]<${c}${s}>${(r.textContent||"").replace(/\s+/g," ").trim().slice(0,30)}`}).join(`
`)}g(e,r=10){const n=(this.current.textContent||"").split(`
`),c=new RegExp(e,"gi"),s=[];return n.forEach((h,o)=>{if(c.test(h)){const a=h.replace(/\s+/g," ").trim();a&&s.push(`L${o+1}: ${a.slice(0,60)}`)}}),s.length===0?" no matches":s.slice(0,r).join(`
`)}look(){const e=this.current.querySelectorAll('a, button, input, select, textarea, [onclick], [href], .btn, [role="button"]'),r=[];if(e.forEach((c,s)=>{const h=(c.textContent||c.value||c.placeholder||c.getAttribute("title")||c.getAttribute("aria-label")||"").replace(/\s+/g," ").trim().slice(0,20);(h||c.tagName.toLowerCase()==="input")&&r.push({text:h||`[${c.type||"input"}]`,el:c,idx:s})}),this.lastGrid=r,r.length===0)return" no interactive elements";let n=`${r.length} elements
`;return r.slice(0,20).forEach((c,s)=>{const h=c.el.tagName.toLowerCase(),o=c.el.getAttribute("href");n+=`@${s} <${h}> "${c.text}"${o?` ${o.slice(0,25)}`:""}
`}),n.trim()}click(e){if(!this.lastGrid||e>=this.lastGrid.length)return" call look first or index out of range";const r=this.lastGrid[e];try{r.el.click()}catch{}return` clicked "${r.text}"`}a(){if(!this.current.attributes)return"";const e=[];for(const r of Array.from(this.current.attributes))e.push(`${r.name}=${r.value.slice(0,30)}`);return e.length===0?" no attrs":e.join(" ")}h(e){let r=this.current.outerHTML;return e&&r.length>e&&(r=r.slice(0,e)+"[truncated]"),r}store(e){return this.vars[e]=this.current.textContent||"",` $${e} (${this.vars[e].length} chars)`}recall(e){const r=e.match(/^\$(\w+)(\.(\w+))?$/);if(!r)return" invalid var syntax";const n=r[1],c=r[3];return this.vars[n]?c==="length"?String(this.vars[n].length):c?" unknown property":this.vars[n].slice(0,500):` $${n} not set`}exec(e){e=e.trim();let r;return e.includes(";")&&!e.startsWith(";")?e.split(";").map(n=>n.trim()).filter(Boolean).map(n=>this.exec(n)).join(`
---
`):e==="s"?this.s():e==="t"?this.t():(r=e.match(/^t(\d+)$/))?this.t(parseInt(r[1])):e.startsWith("q1 ")?this.q1(e.slice(3).trim()):e.startsWith("q ")?this.q(e.slice(2).trim()):(r=e.match(/^n(\d+)$/))?this.n(parseInt(r[1])):e==="up"?this.up():(r=e.match(/^up(\d+)$/))?this.up(parseInt(r[1])):e==="ch"?this.ch():e.startsWith("g ")?this.g(e.slice(2).trim()):e==="look"?this.look():(r=e.match(/^@(\d+)$/))?this.click(parseInt(r[1])):e==="a"?this.a():e==="h"?this.h():(r=e.match(/^h(\d+)$/))?this.h(parseInt(r[1])):(r=e.match(/^>\$(\w+)$/))?this.store(r[1]):(r=e.match(/^(\$\w+(\.\w+)?)$/))?this.recall(r[1]):` unknown: ${e}`}}typeof window<"u"&&!window.__hc&&(window.__hc={session:null,HCSession},window.hc=t=>window.__hc.session?window.__hc.session.exec(t):" no session");const hcCmd={name:"hc",description:"Hypercompact - token-efficient DOM navigation",async exec(t){const e=t.args,r=e[0];if(!r)return t.stdout=`Hypercompact - Token-efficient DOM navigation

Usage:
  hc open <file>     Load HTML file from filesystem
  hc live            Attach to live page DOM
  hc <cmd>           Run HC command

Commands:
  s              State: "p:file c:N d:N @tag"
  t, t100        Text content (optional limit)
  q <sel>        Query all matching elements
  q1 <sel>       Query one, set as current
  n<N>           Select Nth from results
  up, up<N>      Go to parent element
  ch             Show children
  g <pattern>    Grep for text
  look           List interactive elements
  @<N>           Click Nth element
  a              Show attributes
  h, h<N>        Show HTML
  >$name         Store to variable
  $name          Recall variable

Example:
  hc open page.html
  hc t100
  hc q .price
  hc n0
  hc a
`,0;if(r==="open"){const s=e[1];if(!s)return t.stderr=`hc open: missing file
`,1;try{const h=t.fs.resolvePath(s,t.cwd),o=await t.fs.readFile(h,"utf8"),d=new DOMParser().parseFromString(o,"text/html");return window.__hc.session=new HCSession(d,s),t.stdout=` opened ${s} (${o.length} chars)
`,0}catch(h){return t.stderr=`hc open: ${h.message}
`,1}}if(r==="live")return window.__hc.session=new HCSession(document,"live"),t.stdout=` attached to live DOM
`,0;if(r==="close")return window.__hc.session=null,t.stdout=` session closed
`,0;if(!window.__hc.session)return t.stderr=`hc: no session. Use "hc open <file>" or "hc live" first.
`,1;const n=e.join(" "),c=window.__hc.session.exec(n);return t.stdout=c+`
`,0}},testCmd={name:"test",description:"Run JavaScript test files with Jest-like syntax",async exec(t){if(t.args[0]==="--help"||t.args[0]==="-h")return t.stdout+=`Usage: test [files...]

`,t.stdout+=`Run JavaScript tests with Jest-like syntax.

`,t.stdout+=`Options:
`,t.stdout+=`  --help, -h    Show this help
`,t.stdout+=`  --verbose     Show all test names
`,t.stdout+=`
If no files specified, runs all *.test.js in current directory.
`,t.stdout+=`
Test syntax:
`,t.stdout+=`  describe('suite', () => {
`,t.stdout+=`    it('test name', () => {
`,t.stdout+=`      expect(1 + 1).toBe(2);
`,t.stdout+=`    });
`,t.stdout+=`  });
`,0;const e=t.args.includes("--verbose")||t.args.includes("-v"),r=t.args.filter(a=>!a.startsWith("-"));let n=[];if(r.length>0)n=r.map(a=>t.fs.resolvePath(a,t.cwd));else try{const a=await t.fs.readdir(t.cwd);for(const d of a)d.endsWith(".test.js")&&n.push(t.fs.resolvePath(d,t.cwd))}catch(a){return t.stderr+=`test: cannot read directory: ${a.message}
`,1}if(n.length===0)return t.stderr+=`test: no test files found
`,t.stderr+=`Run "test --help" for usage.
`,1;const c=[];let s=0,h=0,o=0;for(const a of n){t.stdout+=`
${getFileName(a)}
`;try{const d=await runTestFile(t,a);c.push(...d);for(const l of d)for(const f of l.tests)s++,f.passed?(h++,e&&(t.stdout+=`   ${f.name}
`)):(o++,t.stdout+=`   ${f.name}
`,f.error&&(t.stdout+=`    ${f.error}
`))}catch(d){t.stderr+=`  Error running ${a}: ${d.message}
`,o++,s++}}return t.stdout+=`
`,o===0?(t.stdout+=` ${h} test${h!==1?"s":""} passed
`,0):(t.stdout+=` ${o} failed, ${h} passed (${s} total)
`,1)}};function getFileName(t){return t.split("/").pop()||t}async function runTestFile(t,e){const r=await t.fs.readFile(e,"utf8"),n=[];let c={name:"default",tests:[]};n.push(c);function s(l,f){const p=c;c={name:l,tests:[]},n.push(c);try{f()}finally{c=p}}function h(l,f){const p=c.name!=="default"?`${c.name} > ${l}`:l;try{const S=f();S instanceof Promise?(c.tests.push({name:p,passed:!0,error:void 0}),S.catch(k=>{const A=c.tests.find(w=>w.name===p);A&&(A.passed=!1,A.error=k.message||String(k))})):c.tests.push({name:p,passed:!0})}catch(S){c.tests.push({name:p,passed:!1,error:S.message||String(S)})}}const o=h;function a(l){return{toBe(f){if(l!==f)throw new Error(`Expected ${JSON.stringify(f)}, got ${JSON.stringify(l)}`)},toEqual(f){if(JSON.stringify(l)!==JSON.stringify(f))throw new Error(`Expected ${JSON.stringify(f)}, got ${JSON.stringify(l)}`)},toBeTruthy(){if(!l)throw new Error(`Expected truthy value, got ${JSON.stringify(l)}`)},toBeFalsy(){if(l)throw new Error(`Expected falsy value, got ${JSON.stringify(l)}`)},toBeNull(){if(l!==null)throw new Error(`Expected null, got ${JSON.stringify(l)}`)},toBeUndefined(){if(l!==void 0)throw new Error(`Expected undefined, got ${JSON.stringify(l)}`)},toBeDefined(){if(l===void 0)throw new Error("Expected defined value, got undefined")},toBeGreaterThan(f){if(!(l>f))throw new Error(`Expected ${l} > ${f}`)},toBeLessThan(f){if(!(l<f))throw new Error(`Expected ${l} < ${f}`)},toContain(f){if(typeof l=="string"){if(!l.includes(f))throw new Error(`Expected "${l}" to contain "${f}"`)}else if(Array.isArray(l)){if(!l.includes(f))throw new Error(`Expected array to contain ${JSON.stringify(f)}`)}else throw new Error("toContain only works with strings and arrays")},toHaveLength(f){if(l.length!==f)throw new Error(`Expected length ${f}, got ${l.length}`)},toMatch(f){if(!(f instanceof RegExp?f:new RegExp(f)).test(l))throw new Error(`Expected "${l}" to match ${f}`)},toThrow(f){if(typeof l!="function")throw new Error("toThrow requires a function");let p=!1,S;try{l()}catch(k){p=!0,S=k}if(!p)throw new Error("Expected function to throw");if(f!==void 0){const k=S?.message||String(S);if(f instanceof RegExp){if(!f.test(k))throw new Error(`Expected error matching ${f}, got "${k}"`)}else if(!k.includes(f))throw new Error(`Expected error containing "${f}", got "${k}"`)}},not:{toBe(f){if(l===f)throw new Error(`Expected not ${JSON.stringify(f)}`)},toEqual(f){if(JSON.stringify(l)===JSON.stringify(f))throw new Error(`Expected not ${JSON.stringify(f)}`)},toBeTruthy(){if(l)throw new Error(`Expected falsy, got ${JSON.stringify(l)}`)},toBeFalsy(){if(!l)throw new Error(`Expected truthy, got ${JSON.stringify(l)}`)},toBeNull(){if(l===null)throw new Error("Expected not null")},toBeUndefined(){if(l===void 0)throw new Error("Expected not undefined")},toContain(f){if(typeof l=="string"&&l.includes(f))throw new Error(`Expected "${l}" not to contain "${f}"`);if(Array.isArray(l)&&l.includes(f))throw new Error(`Expected array not to contain ${JSON.stringify(f)}`)},toThrow(){if(typeof l!="function")throw new Error("toThrow requires a function");try{l()}catch{throw new Error("Expected function not to throw")}}}}}const d={log:(...l)=>{t.stdout+=l.map(String).join(" ")+`
`},warn:(...l)=>{t.stderr+=l.map(String).join(" ")+`
`},error:(...l)=>{t.stderr+=l.map(String).join(" ")+`
`}};try{const l=Object.getPrototypeOf(async function(){}).constructor;await new l("describe","it","test","expect","console",r)(s,h,o,a,d)}catch(l){n.push({name:"execution error",tests:[{name:"test file execution",passed:!1,error:l.message}]})}return n.filter(l=>l.tests.length>0)}let esbuildInitialized=!1,initPromise=null;const ESBUILD_WASM_URL="https://unpkg.com/esbuild-wasm@0.27.2/esbuild.wasm",WASM_CACHE_DB="shiro-wasm-cache",WASM_CACHE_STORE="wasm-binaries",WASM_CACHE_KEY="esbuild-0.27.2";async function openWasmCacheDB(){return new Promise((t,e)=>{const r=indexedDB.open(WASM_CACHE_DB,1);r.onerror=()=>e(r.error),r.onsuccess=()=>t(r.result),r.onupgradeneeded=()=>{const n=r.result;n.objectStoreNames.contains(WASM_CACHE_STORE)||n.createObjectStore(WASM_CACHE_STORE)}})}async function getCachedWasm(){try{const t=await openWasmCacheDB();return new Promise(e=>{const r=t.transaction(WASM_CACHE_STORE,"readonly"),c=r.objectStore(WASM_CACHE_STORE).get(WASM_CACHE_KEY);c.onsuccess=()=>e(c.result||null),c.onerror=()=>e(null),r.oncomplete=()=>t.close()})}catch{return null}}async function cacheWasm(t){try{const e=await openWasmCacheDB();return new Promise((r,n)=>{const c=e.transaction(WASM_CACHE_STORE,"readwrite"),h=c.objectStore(WASM_CACHE_STORE).put(t,WASM_CACHE_KEY);h.onsuccess=()=>r(),h.onerror=()=>n(h.error),c.oncomplete=()=>e.close()})}catch{}}async function ensureEsbuildInitialized(){if(!esbuildInitialized){if(initPromise){await initPromise;return}initPromise=(async()=>{try{let t=await getCachedWasm();t?await browserExports.initialize({wasmModule:await WebAssembly.compile(t),worker:!1}):(t=await(await fetch(ESBUILD_WASM_URL)).arrayBuffer(),await browserExports.initialize({wasmModule:await WebAssembly.compile(t),worker:!1}),cacheWasm(t)),esbuildInitialized=!0}catch(t){throw initPromise=null,new Error(`Failed to initialize esbuild: ${t.message}`)}})(),await initPromise}}async function compileFromVFS(t,e){await ensureEsbuildInitialized();const r=await t.fs.readFile(e,"utf8");let n="ts";e.endsWith(".tsx")?n="tsx":e.endsWith(".js")?n="js":e.endsWith(".jsx")&&(n="jsx");const c=await browserExports.transform(r,{loader:n,format:"esm",target:"es2020"});if(c.warnings.length>0)for(const s of c.warnings)console.warn(`[reload] Warning in ${e}: ${s.text}`);return c.code}async function loadCompiledModule(t,e){const r=new Blob([t],{type:"application/javascript"}),n=URL.createObjectURL(r);try{const c=await import(n);return c.default||c}finally{URL.revokeObjectURL(n)}}const reloadCmd={name:"reload",description:"Hot-reload modules from virtual filesystem",async exec(t){const e=t.args[0];if(e==="--list"||e==="-l"){const c=registry.list();if(c.length===0)t.stdout+=`No modules registered.
`;else{t.stdout+=`Registered modules:
`;for(const s of c.sort())t.stdout+=`  ${s}
`}return 0}if(e==="--status"||e==="-s"){const c=registry.list();if(c.length===0)t.stdout+=`No modules registered.
`;else{t.stdout+=`Module registry status:

`;for(const s of c.sort()){const h=registry.getMetadata(s);if(h){const o=Math.floor((Date.now()-h.lastUpdatedAt)/1e3);t.stdout+=`  ${s}
`,t.stdout+=`    version: ${h.version}
`,t.stdout+=`    updated: ${o}s ago
`,h.source&&(t.stdout+=`    source: ${h.source}
`),t.stdout+=`
`}}}return 0}if(e==="--all"||e==="-a"){const c=registry.list();let s=0,h=0;for(const o of c){const a=registry.getMetadata(o);if(a?.source)try{t.stdout+=`Reloading ${o} from ${a.source}...
`;const d=await compileFromVFS(t,a.source),l=await loadCompiledModule(d,o),f=registry.replace(o,l,a.source);f.migrated?t.stdout+=`   Reloaded with state migration
`:f.error?t.stdout+=`   Reloaded but migration failed: ${f.error.message}
`:t.stdout+=`   Reloaded (no migration needed)
`,s++}catch(d){t.stderr+=`   Failed: ${d.message}
`,h++}}return t.stdout+=`
Reloaded ${s} module(s)`,h>0&&(t.stdout+=`, ${h} failed`),t.stdout+=`.
`,h>0?1:0}if(!e||e==="--help"||e==="-h")return t.stdout+=`Usage: reload <module-name> [source-path]
`,t.stdout+=`       reload --list          List registered modules
`,t.stdout+=`       reload --status        Show module versions and sources
`,t.stdout+=`       reload --all           Reload all modules with sources
`,t.stdout+=`
`,t.stdout+=`Examples:
`,t.stdout+=`  reload commands/ls                    # Reload from registered source
`,t.stdout+=`  reload commands/ls /src/commands/ls.ts  # Reload from specific path
`,t.stdout+=`
`,t.stdout+=`Modules can implement migrateFrom(old) to preserve state during reload.
`,0;const r=e,n=t.args[1]||registry.getMetadata(r)?.source;if(!n)return t.stderr+=`reload: no source path for '${r}'
`,t.stderr+=`Specify a source path: reload ${r} /path/to/source.ts
`,1;try{await t.fs.stat(n)}catch{return t.stderr+=`reload: source not found: ${n}
`,1}t.stdout+=`Compiling ${n}...
`;try{const c=await compileFromVFS(t,n);t.stdout+=`Loading module...
`;const s=await loadCompiledModule(c,r);if(registry.has(r)){const h=registry.replace(r,s,n);h.migrated?t.stdout+=` Hot-reloaded '${r}' with state migration
`:h.error?t.stdout+=` Hot-reloaded '${r}' but migration failed: ${h.error.message}
`:t.stdout+=` Hot-reloaded '${r}'
`}else registry.register(r,s,n),t.stdout+=` Registered new module '${r}'
`;return 0}catch(c){return t.stderr+=`reload: ${c.message}
`,1}}};function formatDuration(t){const e=Math.floor(t/1e3),r=Math.floor(e/60),n=e%60;return r>0?`${r}m ${n}s`:`${n}s`}const termcastCmd={name:"termcast",description:"Record terminal sessions in asciicast format",async exec(t){const e=t.args[0];if(!e||e==="--help"||e==="-h")return t.stdout+=`Usage: termcast <command> [args]

`,t.stdout+=`Commands:
`,t.stdout+=`  start [filename]   Start recording (default: recording.cast)
`,t.stdout+=`  stop               Stop recording and save to file
`,t.stdout+=`  status             Show recording status
`,t.stdout+=`  play <file>        Play back a recording (prints to terminal)
`,t.stdout+=`  export <file>      Export recording as JSON for embedding
`,t.stdout+=`
`,t.stdout+=`The output is in asciicast v2 format, compatible with:
`,t.stdout+=`  - asciinema-player (web)
`,t.stdout+=`  - asciinema (CLI)
`,t.stdout+=`  - Various converters (GIF, SVG, etc.)
`,0;switch(e){case"start":{if(window.__termcastSession)return t.stderr+=`termcast: already recording. Use "termcast stop" first.
`,1;const r=t.args[1]||"recording.cast",n=t.fs.resolvePath(r,t.cwd),c=window.__shiro?.terminal,s=c?.cols||120,h=c?.rows||30;return window.__termcastSession={filename:n,startTime:Date.now(),events:[],width:s,height:h},c&&c.write&&!window.__termcastOriginalWrite&&(window.__termcastOriginalWrite=c.write.bind(c),c.write=o=>{if(window.__termcastSession){const a=(Date.now()-window.__termcastSession.startTime)/1e3;window.__termcastSession.events.push([a,"o",o])}window.__termcastOriginalWrite(o)}),t.stdout+=`Recording started: ${n}
`,t.stdout+=`Terminal size: ${s}x${h}
`,t.stdout+=`Run commands normally. Use "termcast stop" when done.
`,0}case"stop":{const r=window.__termcastSession;if(!r)return t.stderr+=`termcast: not recording. Use "termcast start" first.
`,1;const n=window.__shiro?.terminal;n&&window.__termcastOriginalWrite&&(n.write=window.__termcastOriginalWrite,window.__termcastOriginalWrite=void 0);const c={version:2,width:r.width,height:r.height,timestamp:Math.floor(r.startTime/1e3),title:"Shiro Terminal Recording",env:{SHELL:"/bin/sh",TERM:"xterm-256color"}},s=[JSON.stringify(c)];for(const l of r.events)s.push(JSON.stringify(l));const h=s.join(`
`)+`
`;await t.fs.writeFile(r.filename,h);const o=formatDuration(Date.now()-r.startTime),a=r.events.length,d=(h.length/1024).toFixed(2);return t.stdout+=`Recording saved: ${r.filename}
`,t.stdout+=`Duration: ${o}
`,t.stdout+=`Events: ${a}
`,t.stdout+=`Size: ${d} KB
`,window.__termcastSession=null,0}case"status":{const r=window.__termcastSession;if(!r)t.stdout+=`Not recording.
`;else{const n=formatDuration(Date.now()-r.startTime);t.stdout+=`Recording: ${r.filename}
`,t.stdout+=`Duration: ${n}
`,t.stdout+=`Events: ${r.events.length}
`,t.stdout+=`Size: ${r.width}x${r.height}
`}return 0}case"play":{const r=t.args[1];if(!r)return t.stderr+=`termcast play: missing filename
`,1;try{const c=(await t.fs.readFile(t.fs.resolvePath(r,t.cwd),"utf8")).trim().split(`
`);if(c.length===0)return t.stderr+=`termcast: empty recording
`,1;const s=JSON.parse(c[0]);t.stdout+=`Playing: ${r}
`,t.stdout+=`Size: ${s.width}x${s.height}
`,t.stdout+=`---
`;for(let h=1;h<c.length;h++){const o=JSON.parse(c[h]);o[1]==="o"&&(t.stdout+=o[2])}return t.stdout+=`
---
End of recording.
`,0}catch(n){return t.stderr+=`termcast play: ${n.message}
`,1}}case"export":{const r=t.args[1];if(!r)return t.stderr+=`termcast export: missing filename
`,1;try{const n=await t.fs.readFile(t.fs.resolvePath(r,t.cwd),"utf8"),c=btoa(n);return t.stdout+=`data:application/json;base64,${c}
`,0}catch(n){return t.stderr+=`termcast export: ${n.message}
`,1}}default:return t.stderr+=`termcast: unknown command '${e}'
`,1}}},activeServers=new Map;async function serveStatic(t,e,r,n){const c=t.fs,s=c.resolvePath(r,t.cwd),h=await c.stat(s);if(!h||h.type!=="dir")return t.stderr=`serve: ${r}: Not a directory
`,1;if(iframeServer.isPortInUse(e))return t.stderr=`serve: port ${e} already in use
`,t.stderr+=`Use 'serve stop ${e}' to stop the existing server
`,1;const o=createStaticServer({readFile:d=>c.readFile(d),stat:async d=>{const l=await c.stat(d);return l?{isDirectory:()=>l.type==="dir"}:null}},s,{index:["index.html","index.htm"]}),a=iframeServer.serve(e,o,`static:${r}`);if(activeServers.set(e,{cleanup:a,directory:s,type:"static"}),t.stdout=`Serving ${r} on port ${e}
`,n){const d=t.shell._terminal;if(d&&typeof d.getIframeContainer=="function"){const l=d.getIframeContainer();try{const f=await iframeServer.createIframe(e,l,{height:"300px"});t.stdout+=`Iframe opened (${f.style.width} x ${f.style.height})
`}catch(f){t.stdout+=`Note: Could not open iframe: ${f instanceof Error?f.message:"unknown error"}
`}}else t.stdout+=`To view in iframe, run: serve open ${e}
`}return t.stdout+=`Use 'serve stop ${e}' to stop
`,t.stdout+=`Use 'serve open ${e}' to open in iframe
`,0}async function openInIframe(t,e,r="/"){if(!iframeServer.isPortInUse(e))return t.stderr=`serve: no server on port ${e}
`,1;const n=t.shell._terminal;if(!n||typeof n.getIframeContainer!="function")return t.stderr=`serve: terminal does not support iframes
`,t.stderr+=`You can use __iframeServer.createIframe(${e}, document.body) in the browser console
`,1;const c=n.getIframeContainer();try{const s=await iframeServer.createIframe(e,c,{path:r,height:"300px"});return t.stdout=`Opened port ${e} in iframe
`,t.stdout+=`Path: ${r}
`,0}catch(s){return t.stderr=`serve: failed to open iframe: ${s instanceof Error?s.message:"unknown error"}
`,1}}async function fetchFromServer(t,e,r){if(!iframeServer.isPortInUse(e))return t.stderr=`serve: no server on port ${e}
`,1;const n=await iframeServer.fetch(e,r);if(t.stdout=`Status: ${n.status||200}
`,n.headers)for(const[c,s]of Object.entries(n.headers))t.stdout+=`${c}: ${s}
`;return t.stdout+=`
`,typeof n.body=="string"?(t.stdout+=n.body,n.body.endsWith(`
`)||(t.stdout+=`
`)):n.body instanceof Uint8Array?t.stdout+=`[Binary data: ${n.body.length} bytes]
`:n.body&&(t.stdout+=JSON.stringify(n.body,null,2)+`
`),0}const SERVE_USAGE=`serve [options] [directory]
  serve <directory> [port]    Serve static files from directory (default port: 8080)
  serve stop <port>           Stop server on port
  serve list                  List active servers
  serve open <port> [path]    Open server content in iframe
  serve fetch <port> <path>   Fetch content from server (for debugging)

Options:
  -p, --port <n>    Port number (default: 8080)
  -i, --iframe      Immediately open in iframe after starting

Examples:
  serve .                     Serve current directory on port 8080
  serve ./dist 3000           Serve ./dist on port 3000
  serve -p 9000 /var/www      Serve /var/www on port 9000
  serve -i . 8080             Serve and open iframe
  serve open 8080             Open existing server in iframe
  serve fetch 8080 /          Fetch root from server
  serve stop 8080             Stop the server on port 8080`,serveCmd={name:"serve",description:"Start a virtual HTTP server (iframe-based)",async exec(t){const e=t.args.slice(1);if(e.length===0||e[0]==="--help"||e[0]==="-h")return t.stdout=SERVE_USAGE+`
`,0;if(e[0]==="list")return listServers(t);if(e[0]==="stop")return e.length<2?(t.stderr=`serve stop: missing port number
`,1):stopServer(t,parseInt(e[1]));if(e[0]==="open"){if(e.length<2)return t.stderr=`serve open: missing port number
`,1;const h=parseInt(e[1]),o=e[2]||"/";return openInIframe(t,h,o)}if(e[0]==="fetch"){if(e.length<3)return t.stderr=`serve fetch: usage: serve fetch <port> <path>
`,1;const h=parseInt(e[1]),o=e[2];return fetchFromServer(t,h,o)}let r=8080,n=".",c=!1,s=0;for(;s<e.length;)if(e[s]==="-p"||e[s]==="--port")r=parseInt(e[++s]),s++;else if(e[s]==="-i"||e[s]==="--iframe")c=!0,s++;else if(!e[s].startsWith("-"))n=e[s],e[s+1]&&/^\d+$/.test(e[s+1])&&(r=parseInt(e[++s])),s++;else return t.stderr=`serve: unknown option: ${e[s]}
`,1;return serveStatic(t,r,n,c)}};function listServers(t){const e=iframeServer.list();if(e.length===0)return t.stdout=`No active servers
`,0;t.stdout=`Active servers:
`;for(const r of e){const n=activeServers.get(r.port);t.stdout+=`  :${r.port} ${n?.type||"unknown"} ${n?.directory||""}
`,t.stdout+=`    iframe: ${r.hasIframe?"open":"not open"}
`}return 0}function stopServer(t,e){const r=activeServers.get(e);return r?(r.cleanup(),activeServers.delete(e),t.stdout=`Stopped server on port ${e}
`,0):(t.stderr=`serve: no server on port ${e}
`,1)}const serversCmd={name:"servers",description:"List active virtual servers",async exec(t){return listServers(t)}};async function collectFiles(t,e,r,n){const c=await t.readdir(e);for(const s of c){const h=e+(e.endsWith("/")?"":"/")+s,o=await t.stat(h);if(o){if(o.type==="dir")n.directories++,await collectFiles(t,h,r,n);else if(o.type==="file"){const a=await t.readFile(h),d=typeof a=="string"||isTextContent(a);let l,f;typeof a=="string"?(l=a,f="utf8"):d?(l=new TextDecoder().decode(a),f="utf8"):(l=btoa(String.fromCharCode(...a)),f="base64"),r.push({path:h,content:l,encoding:f,mode:o.mode||420,mtime:o.mtime?.getTime()||Date.now()}),n.fileCount++,n.totalSize+=a.length}}}}function isTextContent(t){const e=t.slice(0,1e3);let r=0;for(const n of e)(n<9||n>13&&n<32||n===127)&&r++;return r/e.length<.1}async function saveImage(t,e,r,n){const c=t.fs,s="/home/user/shiro-images";await c.stat(s)||await c.mkdir(s,{recursive:!0});const h={version:"1.0",created:new Date().toISOString(),description:r,files:[],stats:{fileCount:0,totalSize:0,directories:0}};t.stdout=`Collecting files...
`;for(const f of n){const p=c.resolvePath(f,t.cwd),S=await c.stat(p);if(!S){t.stderr=`image: directory not found: ${f}
`;continue}if(S.type!=="dir"){t.stderr=`image: not a directory: ${f}
`;continue}h.stats.directories++,await collectFiles(c,p,h.files,h.stats)}const o=["HOME","USER","PWD","PATH","SHELL","TERM","NODE_ENV"];h.env={};for(const f of o)t.env[f]&&(h.env[f]=t.env[f]);const a=`${s}/${e}.json`,d=JSON.stringify(h,null,2);await c.writeFile(a,d);const l=(d.length/1024).toFixed(1);return t.stdout=`Saved image "${e}" to ${a}
`,t.stdout+=`  Files: ${h.stats.fileCount}
`,t.stdout+=`  Directories: ${h.stats.directories}
`,t.stdout+=`  Size: ${l} KB
`,t.stdout+=`  Description: ${r}
`,0}async function loadImage(t,e,r){const n=t.fs,c=[`/home/user/shiro-images/${e}.json`,`/home/user/shiro-images/${e}`,e];let s=null;for(const f of c){const p=n.resolvePath(f,t.cwd);if(await n.stat(p)){s=p;break}}if(!s){t.stderr=`image: image not found: ${e}
`,t.stderr+=`Searched:
`;for(const f of c)t.stderr+=`  ${n.resolvePath(f,t.cwd)}
`;return 1}const h=await n.readFile(s,"utf8");let o;try{o=JSON.parse(h)}catch(f){return t.stderr=`image: invalid image file: ${f instanceof Error?f.message:"parse error"}
`,1}if(!o.version||!o.files)return t.stderr=`image: invalid image format
`,1;t.stdout=`Loading image "${e}"...
`,t.stdout+=`  Description: ${o.description}
`,t.stdout+=`  Created: ${o.created}
`,t.stdout+=`  Files: ${o.stats?.fileCount||o.files.length}
`;const a=r?n.resolvePath(r,t.cwd):"";let d=0,l=0;for(const f of o.files)try{let p=f.path;if(a){const A=f.path.indexOf("/",1),w=A>0?f.path.substring(A):f.path;p=a+w}const S=p.substring(0,p.lastIndexOf("/"));S&&!await n.stat(S)&&await n.mkdir(S,{recursive:!0});let k;if(f.encoding==="base64"){const A=atob(f.content);k=new Uint8Array(A.length);for(let w=0;w<A.length;w++)k[w]=A.charCodeAt(w)}else k=f.content;await n.writeFile(p,k),d++}catch(p){t.stderr+=`  Error restoring ${f.path}: ${p instanceof Error?p.message:"unknown"}
`,l++}if(o.env)for(const[f,p]of Object.entries(o.env))t.env[f]=p;return t.stdout+=`Restored ${d} files
`,l>0&&(t.stdout+=`Errors: ${l}
`),l>0?1:0}async function listImages(t){const e=t.fs,r="/home/user/shiro-images";if(!await e.stat(r))return t.stdout=`No images found
`,t.stdout+=`Images are stored in ${r}
`,0;const s=(await e.readdir(r)).filter(h=>h.endsWith(".json"));if(s.length===0)return t.stdout=`No images found
`,0;t.stdout=`Available images:
`;for(const h of s){const o=`${r}/${h}`;try{const a=await e.readFile(o,"utf8"),d=JSON.parse(a),l=(a.length/1024).toFixed(1),f=h.replace(".json","");t.stdout+=`  ${f}
`,t.stdout+=`    ${d.description||"No description"}
`,t.stdout+=`    ${d.stats?.fileCount||d.files?.length||"?"} files, ${l} KB
`,t.stdout+=`    Created: ${d.created||"unknown"}
`}catch{t.stdout+=`  ${h.replace(".json","")} (unreadable)
`}}return 0}async function deleteImage(t,e){const r=t.fs,n=`/home/user/shiro-images/${e}.json`;return await r.stat(n)?(await r.unlink(n),t.stdout=`Deleted image: ${e}
`,0):(t.stderr=`image: image not found: ${e}
`,1)}const IMAGE_USAGE=`shiro image <command> [options]

Commands:
  save <name> [directories...]   Save filesystem state to an image
  load <name> [target]           Load an image into the filesystem
  list                           List available images
  delete <name>                  Delete an image

Options:
  -d, --description <text>       Description for saved image

Examples:
  # Save node_modules as an image
  shiro image save react-18 /home/user/myapp/node_modules -d "React 18 + deps"

  # Load an image
  shiro image load react-18

  # Load image to a specific directory
  shiro image load react-18 /home/user/newproject

  # List images
  shiro image list

  # Delete an image
  shiro image delete old-image

Use Cases:
  - Fast test setup: Pre-install dependencies once, load instantly in tests
  - Share configurations: Export and share development environments
  - Backup state: Save filesystem state before risky operations`,imageCmd={name:"image",description:"Manage shiro images (filesystem snapshots)",async exec(t){const e=t.args.slice(1);if(e.length===0||e[0]==="--help"||e[0]==="-h")return t.stdout=IMAGE_USAGE+`
`,0;const r=e[0];switch(r){case"save":{if(e.length<2)return t.stderr=`image save: missing name
`,1;const n=e[1];let c="";const s=[];for(let h=2;h<e.length;h++)e[h]==="-d"||e[h]==="--description"?c=e[++h]||"":s.push(e[h]);return s.length===0&&s.push(t.cwd),saveImage(t,n,c||`Image created ${new Date().toLocaleDateString()}`,s)}case"load":{if(e.length<2)return t.stderr=`image load: missing name
`,1;const n=e[1],c=e[2];return loadImage(t,n,c)}case"list":case"ls":return listImages(t);case"delete":case"rm":return e.length<2?(t.stderr=`image delete: missing name
`,1):deleteImage(t,e[1]);default:return t.stderr=`image: unknown command: ${r}
`,t.stderr+=`Run 'shiro image --help' for usage
`,1}}},clipReportCmd={name:"clip-report",description:"Copy terminal session and errors to clipboard",async exec(t){const e=t.args.slice(1);let r=100,n=!1,c=!1;for(let l=0;l<e.length;l++)if(e[l]==="-l"||e[l]==="--limit")r=parseInt(e[++l])||100;else if(e[l]==="--clear"||e[l]==="-c")n=!0;else if(e[l]==="--errors"||e[l]==="-e")c=!0;else if(e[l]==="--help"||e[l]==="-h")return t.stdout=`clip-report [options]
  -l, --limit N    Character limit per message (default: 100)
  -c, --clear      Clear captured messages after copying
  -e, --errors     Only copy errors section, not terminal output
  -h, --help       Show this help
`,0;const s=window.__shiroCapturedMessages||[],h=window.__shiroClearMessages;let o="";if(!c){const l=t.shell._terminal;l&&typeof l.getBufferContent=="function"&&(o=l.getBufferContent())}let a="";if(s.length>0){const l=s.filter(p=>p.type==="error"),f=s.filter(p=>p.type==="warn");l.length>0&&(a+=`
--- Errors (${l.length}) ---
`,l.forEach(p=>{a+=`E: ${p.message.slice(0,r)}
`})),f.length>0&&(a+=`
--- Warnings (${f.length}) ---
`,f.forEach(p=>{a+=`W: ${p.message.slice(0,r)}
`}))}let d="";if(!c&&o&&(d=o),a&&(d+=a),!d.trim())return t.stdout=`Nothing to copy (no terminal content or captured messages)
`,0;try{await navigator.clipboard.writeText(d);const l=[];!c&&o&&l.push(`${o.split(`
`).length} lines`);const f=s.filter(S=>S.type==="error").length,p=s.filter(S=>S.type==="warn").length;return f>0&&l.push(`${f} errors`),p>0&&l.push(`${p} warnings`),t.stdout=`Copied to clipboard: ${l.join(", ")}
`,n&&h&&(h(),t.stdout+=`Captured messages cleared.
`),0}catch(l){return t.stderr=`Failed to copy to clipboard: ${l instanceof Error?l.message:"unknown error"}
`,1}}};function parseArgs(t,e=[]){const r={},n={},c=[],s=new Set(e);for(let h=0;h<t.length;h++){const o=t[h];if(o==="--"){c.push(...t.slice(h+1));break}if(o.startsWith("--")){const a=o.slice(2);s.has(a)&&h+1<t.length?n[a]=t[++h]:r[a]=!0}else if(o.startsWith("-")&&o.length>1&&!/^-\d/.test(o)){const a=o.slice(1);if(s.has(a)&&h+1<t.length)n[a]=t[++h];else for(let d=0;d<a.length;d++){const l=a[d];if(s.has(l)){const f=a.slice(d+1);f?n[l]=f:h+1<t.length&&(n[l]=t[++h]);break}r[l]=!0}}else c.push(o)}return{flags:r,values:n,positional:c}}async function readInput(t,e,r,n,c){if(t.length===0)return{content:e,files:[]};const s=[],h=[];for(const o of t){const a=c(o,n);s.push(a),h.push(await r.readFile(a))}return{content:h.join(""),files:s}}const alias={name:"alias",description:"Define or display aliases",async exec(t,e){const{positional:r,flags:n}=parseArgs(t);if(r.length===0)return{stdout:"",stderr:"",exitCode:0};const c=[];for(const s of r)n.p&&c.push(`alias ${s}`);return{stdout:c.join(`
`)+(c.length>0?`
`:""),stderr:"",exitCode:0}}},arrayHelper={name:"array",description:"Helper for array variable operations (shell feature)",async exec(t,e){return t.length>0&&t[0]==="--help"?{stdout:`array: This is a shell language feature, not a command.

Array syntax must be implemented at the shell variable level:

Declaration:
  arr=(value1 value2 value3)
  arr=()  # empty array
  arr[0]=value1
  arr[5]=value5  # sparse array

Access:
  \${arr[0]}      # First element (0-indexed)
  \${arr[1]}      # Second element
  \${arr[-1]}     # Last element (bash 4.3+)
  \${arr[@]}      # All elements as separate words
  \${arr[*]}      # All elements as single word
  \${#arr[@]}     # Array length
  \${!arr[@]}     # Array indices

Operations:
  arr+=(value4 value5)           # Append elements
  unset arr[2]                   # Remove element
  \${arr[@]:start}               # Slice from start
  \${arr[@]:start:length}        # Slice with length
  \${arr[@]/pattern/replacement} # Replace in all elements

Iteration:
  for item in "\${arr[@]}"; do
    echo "$item"
  done

  for i in "\${!arr[@]}"; do
    echo "arr[$i] = \${arr[$i]}"
  done

Implementation guidance for shells:
1. Store arrays as objects/maps with numeric keys
2. Implement expansion patterns for \${arr[...]} syntax
3. Handle @ vs * difference (word splitting)
4. Support sparse arrays (missing indices)
5. Implement array-specific operations (length, slice, etc.)

Example shell pseudo-code:
  arrays = {}  // Map of variable name to array

  // Assignment: arr=(a b c)
  arrays['arr'] = ['a', 'b', 'c']

  // Access: \${arr[1]}
  value = arrays['arr'][1]  // 'b'

  // All elements: \${arr[@]}
  values = arrays['arr'].join(' ')  // 'a b c'

  // Length: \${#arr[@]}
  length = arrays['arr'].length  // 3

Shell implementers: Parse array syntax at the variable expansion level.

`,stderr:"",exitCode:0}:{stdout:"",stderr:`array: This is a shell feature. Use --help for implementation guidance.
`,exitCode:1}}},awk={name:"awk",description:"Pattern scanning and processing language",async exec(t,e){const{values:r,positional:n}=parseArgs(t,["F","v"]);if(n.length===0)return{stdout:"",stderr:`awk: missing program
`,exitCode:1};const c=n[0],s=n.slice(1),h={FS:r.F||" ",OFS:" ",RS:`
`,ORS:`
`,NR:0,NF:0,FILENAME:s[0]||"-",variables:{}};if(r.v){const o=r.v.split("=");o.length===2&&(h.variables[o[0]]=o[1])}try{const{content:o}=await readInput(s,e.stdin,e.fs,e.cwd,e.fs.resolvePath),a=o.endsWith(`
`)?o.slice(0,-1).split(`
`):o.split(`
`),d=[],l=c.match(/BEGIN\s*\{\s*([^}]*)\s*\}/),f=c.match(/END\s*\{\s*([^}]*)\s*\}/),p=c.match(/(?:\/([^/]*)\/\s*)?\{\s*([^}]*)\s*\}/);if(l){const S=executeAction(l[1],[],h);S&&d.push(S)}for(const S of a){h.NR++;const k=typeof h.FS=="string"&&h.FS!==" "?new RegExp(h.FS):/\s+/,A=S.split(k).filter(v=>v!=="");h.NF=A.length;let w=!0;if(p){const v=p[1],g=p[2];if(v)try{w=new RegExp(v).test(S)}catch{w=!1}if(w){const m=executeAction(g,A,h);m!==null&&d.push(m)}}else if(!l&&!f){const v=executeAction(c,A,h);v!==null&&d.push(v)}}if(f){const S=executeAction(f[1],[],h);S&&d.push(S)}return{stdout:d.join(`
`)+(d.length>0?`
`:""),stderr:"",exitCode:0}}catch(o){return{stdout:"",stderr:`awk: ${o instanceof Error?o.message:o}
`,exitCode:1}}}};function executeAction(t,e,r){let n=t.trim();if(n=processStringFunctions(n,e,r),n.startsWith("printf")){const c=n.match(/printf\s+(.+)/);if(c)return formatPrintf(c[1],e,r)}if(n.startsWith("print")){const c=n.substring(5).trim();if(!c||c==="")return e.join(r.OFS);if(c.includes(","))return c.split(/\s*,\s*/).map(a=>{let d=substituteVariables(a.trim(),e,r);return d=evaluateArithmetic$1(d),d.replace(/^["'](.*)["']$/,"$1")}).join(r.OFS);let s=c;return s=substituteVariables(s,e,r),s=evaluateArithmetic$1(s),s=s.replace(/^["'](.*)["']$/,"$1"),s=s.replace(/\s+/g," ").trim(),s}return null}function substituteVariables(t,e,r){let n=t;n=n.replace(/\$0/g,e.join(r.OFS)),n=n.replace(/\$NF/g,e[e.length-1]||"");for(let c=1;c<=e.length;c++)n=n.replace(new RegExp(`\\$${c}\\b`,"g"),e[c-1]||"");n=n.replace(/\bNR\b/g,String(r.NR)),n=n.replace(/\bNF\b/g,String(r.NF)),n=n.replace(/\bFS\b/g,r.FS),n=n.replace(/\bOFS\b/g,r.OFS),n=n.replace(/\bRS\b/g,r.RS),n=n.replace(/\bORS\b/g,r.ORS),n=n.replace(/\bFILENAME\b/g,r.FILENAME);for(const[c,s]of Object.entries(r.variables))n=n.replace(new RegExp(`\\b${c}\\b`,"g"),s);return n}function evaluateArithmetic$1(t){const e=/^([\d.]+)\s*([\+\-\*\/])\s*([\d.]+)$/,r=t.match(e);if(r){const n=parseFloat(r[1]),c=r[2],s=parseFloat(r[3]);let h;switch(c){case"+":h=n+s;break;case"-":h=n-s;break;case"*":h=n*s;break;case"/":h=n/s;break;default:return t}return String(h)}return t}function formatPrintf(t,e,r){const n=t.split(/,\s*/);if(n.length===0)return"";let c=n[0].trim().replace(/^["'](.*)["']$/,"$1");const s=[];for(let a=1;a<n.length;a++){const d=substituteVariables(n[a].trim(),e,r);s.push(d)}let h=c,o=0;return h=h.replace(/%(-)?(\d+)?(?:\.(\d+))?([sdifgex%])/g,(a,d,l,f,p)=>{if(p==="%")return"%";if(o>=s.length)return a;const S=s[o++];let k;switch(p){case"s":k=S;break;case"d":case"i":k=String(parseInt(S)||0);break;case"f":const A=parseFloat(S)||0;k=f?A.toFixed(parseInt(f)):String(A);break;case"g":case"e":case"x":k=S;break;default:k=S}if(l){const A=parseInt(l);d?k=k.padEnd(A," "):k=k.padStart(A," ")}return k}),h=h.replace(/\\n/g,`
`),h=h.replace(/\\t/g,"	"),h=h.replace(/\\r/g,"\r"),h=h.replace(/\\\\/g,"\\"),h.endsWith(`
`)&&(h=h.slice(0,-1)),h}function processStringFunctions(t,e,r){let n=t;return n=n.replace(/length\s*\(\s*([^)]*)\s*\)/g,(c,s)=>{const h=s?substituteVariables(s,e,r):e.join(r.OFS);return String(h.length)}),n=n.replace(/substr\s*\(\s*([^,)]+)\s*,\s*([^,)]+)(?:\s*,\s*([^)]+))?\s*\)/g,(c,s,h,o)=>{const a=substituteVariables(s.trim(),e,r),d=parseInt(substituteVariables(h.trim(),e,r))-1,l=o?parseInt(substituteVariables(o.trim(),e,r)):void 0;return l?a.slice(d,d+l):a.slice(d)}),n=n.replace(/index\s*\(\s*([^,)]+)\s*,\s*([^)]+)\s*\)/g,(c,s,h)=>{const o=substituteVariables(s.trim(),e,r),a=substituteVariables(h.trim(),e,r).replace(/^["'](.*)["']$/,"$1"),d=o.indexOf(a);return String(d===-1?0:d+1)}),n=n.replace(/tolower\s*\(\s*([^)]*)\s*\)/g,(c,s)=>substituteVariables(s,e,r).toLowerCase()),n=n.replace(/toupper\s*\(\s*([^)]*)\s*\)/g,(c,s)=>substituteVariables(s,e,r).toUpperCase()),n=n.replace(/split\s*\(\s*([^,)]+)\s*,\s*([^,)]+)(?:\s*,\s*([^)]+))?\s*\)/g,(c,s,h,o)=>{const a=substituteVariables(s.trim(),e,r),d=o?substituteVariables(o.trim(),e,r).replace(/^["'](.*)["']$/,"$1"):r.FS,l=a.split(new RegExp(d));return String(l.length)}),n=n.replace(/gsub\s*\(\s*([^,)]+)\s*,\s*([^,)]+)(?:\s*,\s*([^)]+))?\s*\)/g,(c,s,h,o)=>{const a=substituteVariables(s.trim(),e,r).replace(/^["'](.*)["']$/,"$1"),d=substituteVariables(h.trim(),e,r).replace(/^["'](.*)["']$/,"$1"),l=o?substituteVariables(o.trim(),e,r):e[0]||"";try{const f=new RegExp(a,"g");return l.replace(f,d)}catch{return l}}),n=n.replace(/sub\s*\(\s*([^,)]+)\s*,\s*([^,)]+)(?:\s*,\s*([^)]+))?\s*\)/g,(c,s,h,o)=>{const a=substituteVariables(s.trim(),e,r).replace(/^["'](.*)["']$/,"$1"),d=substituteVariables(h.trim(),e,r).replace(/^["'](.*)["']$/,"$1"),l=o?substituteVariables(o.trim(),e,r):e[0]||"";try{const f=new RegExp(a);return l.replace(f,d)}catch{return l}}),n=n.replace(/match\s*\(\s*([^,)]+)\s*,\s*([^)]+)\s*\)/g,(c,s,h)=>{const o=substituteVariables(s.trim(),e,r),a=substituteVariables(h.trim(),e,r).replace(/^["'](.*)["']$/,"$1");try{const d=new RegExp(a),l=o.match(d);return l?String(l.index+1):"0"}catch{return"0"}}),n}const base64={name:"base64",description:"Base64 encode or decode",async exec(t,e){const{flags:r,positional:n}=parseArgs(t),c=r.d||r.decode,s=r.w?parseInt(r.w):76,h=r.i||r["ignore-garbage"];try{const{content:o}=await readInput(n,e.stdin,e.fs,e.cwd,e.fs.resolvePath);let a;if(c){const d=h?o.replace(/[^A-Za-z0-9+/=]/g,""):o.replace(/\s/g,"");try{a=globalThis.atob(d)}catch{return{stdout:"",stderr:`base64: invalid input
`,exitCode:1}}}else{const d=globalThis.btoa(o);if(s>0){const l=[];for(let f=0;f<d.length;f+=s)l.push(d.substring(f,f+s));a=l.join(`
`)}else a=d}return{stdout:a+(a?`
`:""),stderr:"",exitCode:0}}catch(o){return{stdout:"",stderr:`base64: ${o instanceof Error?o.message:o}
`,exitCode:1}}}},basename={name:"basename",description:"Strip directory and suffix from filenames",async exec(t){if(t.length===0)return{stdout:"",stderr:`basename: missing operand
`,exitCode:1};let e=t[0].replace(/\/+$/,"").split("/").pop()||"/";return t.length>1&&e.endsWith(t[1])&&(e=e.slice(0,-t[1].length)),{stdout:e+`
`,stderr:"",exitCode:0}}},bc={name:"bc",description:"Arbitrary precision calculator language",async exec(t,e){const{flags:r,positional:n,values:c}=parseArgs(t,["l","q","s","w"]),s=r.l;r.q;const h=c.s?parseInt(c.s):0;r.w;let o;if(n.length>0)try{const p=e.fs.resolvePath(n[0],e.cwd);o=await e.fs.readFile(p)}catch(p){return{stdout:"",stderr:`bc: ${n[0]}: ${p instanceof Error?p.message:String(p)}
`,exitCode:1}}else o=e.stdin;if(!o.trim())return{stdout:"",stderr:"",exitCode:0};const a=o.split(`
`).map(p=>p.trim()).filter(Boolean),d=[],l=new Map;let f=h;s&&(f=20);for(const p of a){if(p.startsWith("#")||p.startsWith("/*"))continue;if(p==="quit"||p==="q")break;if(p.startsWith("scale=")){f=parseInt(p.substring(6))||0;continue}if(p==="scale"){d.push(String(f));continue}const S=p.match(/^([a-z_][a-z0-9_]*)\s*=\s*(.+)$/i);if(S){const k=S[1],A=S[2];try{const w=evaluateExpression$1(A,l,f,s);l.set(k,w);continue}catch(w){return{stdout:"",stderr:`bc: ${w instanceof Error?w.message:String(w)}
`,exitCode:1}}}try{const k=evaluateExpression$1(p,l,f,s),A=formatNumber$1(k,f);d.push(A)}catch(k){return{stdout:"",stderr:`bc: ${k instanceof Error?k.message:String(k)}
`,exitCode:1}}}return{stdout:d.join(`
`)+(d.length>0?`
`:""),stderr:"",exitCode:0}}};function evaluateExpression$1(expr,variables,scale,mathLib){let normalized=expr.trim();for(const[t,e]of variables)normalized=normalized.replace(new RegExp(`\\b${t}\\b`,"g"),String(e));mathLib&&(normalized=handleMathFunctions(normalized)),normalized=normalized.replace(/(\d+(?:\.\d+)?)\s*\^\s*(\d+(?:\.\d+)?)/g,(t,e,r)=>String(Math.pow(parseFloat(e),parseFloat(r)))),normalized=normalized.replace(/sqrt\s*\(\s*([^)]+)\s*\)/g,(t,e)=>{const r=parseFloat(e);return String(Math.sqrt(r))});try{const result=eval(normalized);if(typeof result!="number"||!isFinite(result))throw new Error("invalid expression");return result}catch(t){throw new Error(`parse error: ${expr}`)}}function handleMathFunctions(t){let e=t;return e=e.replace(/s\s*\(\s*([^)]+)\s*\)/g,(r,n)=>String(Math.sin(parseFloat(n)))),e=e.replace(/c\s*\(\s*([^)]+)\s*\)/g,(r,n)=>String(Math.cos(parseFloat(n)))),e=e.replace(/a\s*\(\s*([^)]+)\s*\)/g,(r,n)=>String(Math.atan(parseFloat(n)))),e=e.replace(/l\s*\(\s*([^)]+)\s*\)/g,(r,n)=>String(Math.log(parseFloat(n)))),e=e.replace(/e\s*\(\s*([^)]+)\s*\)/g,(r,n)=>String(Math.exp(parseFloat(n)))),e}function formatNumber$1(t,e){return e===0?String(Math.floor(t)):t.toFixed(e).replace(/(\.\d*?)0+$/,"$1").replace(/\.$/,"")}const breakCmd={name:"break",description:"Exit from a for, while, or until loop",async exec(t,e){const{positional:r}=parseArgs(t),n=r.length>0?parseInt(r[0]):1;return isNaN(n)||n<1?{stdout:"",stderr:`break: numeric argument required
`,exitCode:1}:{stdout:"",stderr:"",exitCode:0}}},caseCmd={name:"case",description:"Pattern matching (shell language construct)",async exec(t,e){return{stdout:"",stderr:`case: this is a shell language construct that must be interpreted by the shell
Usage: case WORD in PATTERN) COMMANDS ;; esac
`,exitCode:2}}},esac={name:"esac",description:"End case statement (shell language construct)",async exec(t,e){return{stdout:"",stderr:`esac: can only be used to close a case statement
`,exitCode:2}}},cat={name:"cat",description:"Concatenate and display files",async exec(t,e){const{flags:r,positional:n}=parseArgs(t);try{const{content:c}=await readInput(n,e.stdin,e.fs,e.cwd,e.fs.resolvePath);return r.n?{stdout:c.split(`
`).map((o,a)=>`${String(a+1).padStart(6)}	${o}`).join(`
`),stderr:"",exitCode:0}:{stdout:c,stderr:"",exitCode:0}}catch(c){return{stdout:"",stderr:`cat: ${c instanceof Error?c.message:c}
`,exitCode:1}}}},gcc={name:"gcc",description:"GNU C Compiler (stub)",async exec(t,e){const{flags:r,values:n,positional:c}=parseArgs(t,["c","S","E","o","I","L","l","D","Wall","Werror","O0","O1","O2","O3","Os","g","shared","static","fPIC","fpic","std","pedantic","ansi","v","version","M","MM","MD","MMD","MF","MT","MQ"]);if(r.version||r.v)return{stdout:`gcc (GCC) 9.3.0 (stub)
Copyright (C) 2019 Free Software Foundation, Inc.
This is a stub implementation for browser-based environments.
To enable real C compilation, integrate WASM-based tcc or Emscripten.

`,stderr:"",exitCode:0};if(c.length===0)return{stdout:"",stderr:`gcc: fatal error: no input files
compilation terminated.
`,exitCode:1};const s=c,h=n.o||"a.out";for(const p of s){const S=e.fs.resolvePath(p,e.cwd);if(!await e.fs.exists(S))return{stdout:"",stderr:`gcc: error: ${p}: No such file or directory
gcc: fatal error: no input files
compilation terminated.
`,exitCode:1}}let o=!1,a="";for(const p of s)if(p.endsWith(".c")||p.endsWith(".cc")||p.endsWith(".cpp"))try{const S=e.fs.resolvePath(p,e.cwd),k=await e.fs.readFile(S);a+=k+`
`,(/int\s+main\s*\(/.test(k)||/void\s+main\s*\(/.test(k))&&(o=!0)}catch(S){return{stdout:"",stderr:`gcc: error: ${p}: ${S.message}
`,exitCode:1}}if(r.E)return{stdout:a.split(`
`).filter(S=>!S.trim().startsWith("#")).join(`
`),stderr:"",exitCode:0};if(r.c){for(const p of s)if(p.endsWith(".c")||p.endsWith(".cc")||p.endsWith(".cpp")){const S=p.replace(/\.(c|cc|cpp)$/,".o"),k=e.fs.resolvePath(S,e.cwd);await e.fs.writeFile(k,`# Object file stub for ${p}
`)}return{stdout:"",stderr:"",exitCode:0}}if(r.S){for(const p of s)if(p.endsWith(".c")||p.endsWith(".cc")||p.endsWith(".cpp")){const S=p.replace(/\.(c|cc|cpp)$/,".s"),k=e.fs.resolvePath(S,e.cwd);await e.fs.writeFile(k,`# Assembly stub for ${p}
.text
.globl main
main:
  ret
`)}return{stdout:"",stderr:"",exitCode:0}}if(!o&&!r.shared&&!r.c)return{stdout:"",stderr:`gcc: error: undefined reference to 'main'
collect2: error: ld returned 1 exit status
`,exitCode:1};const d=e.fs.resolvePath(h,e.cwd),l=/printf\s*\(\s*["'].*[Hh]ello.*["']/.test(a)||/puts\s*\(\s*["'].*[Hh]ello.*["']/.test(a);let f=`#!/bin/sh
`;return l?f+=`echo 'Hello, World!'
`:f+=`# Compiled binary stub
`,await e.fs.writeFile(d,f),{stdout:"",stderr:"",exitCode:0}}},cc={name:"cc",description:"C Compiler (alias for gcc)",async exec(t,e){return gcc.exec(t,e)}},chmod={name:"chmod",description:"Change file mode bits",async exec(t,e){const{flags:r,positional:n}=parseArgs(t),c=r.R;if(n.length<2)return{stdout:"",stderr:`chmod: missing operand
`,exitCode:1};const s=n[0],h=n.slice(1),o=parseInt(s,8);if(isNaN(o))return{stdout:"",stderr:`chmod: invalid mode: '${s}'
`,exitCode:1};async function a(d){const l=e.fs.resolvePath(d,e.cwd);if(c)try{if((await e.fs.stat(l)).type==="dir"){const p=await e.fs.readdir(l);for(const S of p)await a(l+"/"+S.name)}}catch{}}try{for(const d of h)await a(d);return{stdout:"",stderr:"",exitCode:0}}catch(d){return{stdout:"",stderr:`chmod: ${d instanceof Error?d.message:d}
`,exitCode:1}}}},chown={name:"chown",description:"Change file owner and group",async exec(t,e){const{flags:r,positional:n}=parseArgs(t);if(n.length<2)return{stdout:"",stderr:`chown: missing operand
`,exitCode:1};const c=n[0],s=n.slice(1);r.R;const h=r.v,o=c.split(":");o[0],o[1];const a=[];try{for(const d of s)h&&a.push(`ownership of '${d}' retained as ${c}`);return{stdout:a.join(`
`)+(a.length>0?`
`:""),stderr:"",exitCode:0}}catch(d){return{stdout:"",stderr:`chown: ${d instanceof Error?d.message:d}
`,exitCode:1}}}},clear={name:"clear",description:"Clear the terminal screen",async exec(){return{stdout:"\x1B[2J\x1B[H",stderr:"",exitCode:0}}},column={name:"column",description:"Format input into columns",async exec(t,e){const{flags:r,values:n,positional:c}=parseArgs(t,["t","s","c","x","n"]);try{const{content:s}=await readInput(c,e.stdin,e.fs,e.cwd,e.fs.resolvePath),h=s.split(`
`);if(h.length>0&&h[h.length-1]===""&&h.pop(),r.t){const p=n.s||"	",S=new RegExp(p),k=h.map(g=>g.split(S)),A=Math.max(...k.map(g=>g.length)),w=new Array(A).fill(0);for(const g of k)for(let m=0;m<g.length;m++)w[m]=Math.max(w[m]||0,g[m].length);const v=k.map(g=>g.map((m,$)=>{const I=w[$];return m.padEnd(I)}).join("  ")).join(`
`);return{stdout:v?v+`
`:"",stderr:"",exitCode:0}}const o=n.c?parseInt(n.c):80,a=h.flatMap(p=>p.split(/\s+/).filter(S=>S));if(a.length===0)return{stdout:"",stderr:"",exitCode:0};const l=Math.max(...a.map(p=>p.length))+2,f=Math.max(1,Math.floor(o/l));if(r.x){const p=Math.ceil(a.length/f),S=Array(p).fill(null).map(()=>[]);for(let A=0;A<a.length;A++){const w=A%p;S[w].push(a[A])}const k=S.map(A=>A.map(w=>w.padEnd(l)).join("").trimEnd()).join(`
`);return{stdout:k?k+`
`:"",stderr:"",exitCode:0}}else{const p=[];for(let S=0;S<a.length;S+=f){const k=a.slice(S,S+f);p.push(k.map(A=>A.padEnd(l)).join("").trimEnd())}return{stdout:p.join(`
`)+`
`,stderr:"",exitCode:0}}}catch(s){return{stdout:"",stderr:`column: ${s.message}
`,exitCode:1}}}},comm={name:"comm",description:"Compare two sorted files line by line",async exec(t,e){const{flags:r,positional:n}=parseArgs(t);if(n.length<2)return{stdout:"",stderr:`comm: missing operand
`,exitCode:1};const c=r[1],s=r[2],h=r[3];try{const o=e.fs.resolvePath(n[0],e.cwd),a=e.fs.resolvePath(n[1],e.cwd),d=await e.fs.readFile(o),l=await e.fs.readFile(a),f=d.split(`
`).filter(w=>w!==""||d.endsWith(`
`)),p=l.split(`
`).filter(w=>w!==""||l.endsWith(`
`));f.length>0&&f[f.length-1]===""&&f.pop(),p.length>0&&p[p.length-1]===""&&p.pop();const S=[];let k=0,A=0;for(;k<f.length||A<p.length;){const w=k<f.length?f[k]:null,v=A<p.length?p[A]:null;if(w===null){if(!s){const g=c?"":"	";S.push(g+v)}A++}else if(v===null)c||S.push(w),k++;else if(w<v)c||S.push(w),k++;else if(w>v){if(!s){const g=c?"":"	";S.push(g+v)}A++}else{if(!h){let g="";c||(g+="	"),s||(g+="	"),S.push(g+w)}k++,A++}}return{stdout:S.join(`
`)+(S.length>0?`
`:""),stderr:"",exitCode:0}}catch(o){return{stdout:"",stderr:`comm: ${o instanceof Error?o.message:o}
`,exitCode:1}}}},continueCmd={name:"continue",description:"Continue to next iteration of a for, while, or until loop",async exec(t,e){const{positional:r}=parseArgs(t),n=r.length>0?parseInt(r[0]):1;return isNaN(n)||n<1?{stdout:"",stderr:`continue: numeric argument required
`,exitCode:1}:{stdout:"",stderr:"",exitCode:0}}},cp={name:"cp",description:"Copy files and directories",async exec(t,e){const{flags:r,positional:n}=parseArgs(t),c=r.r||r.R;if(n.length<2)return{stdout:"",stderr:`cp: missing operand
`,exitCode:1};const s=e.fs.resolvePath(n[n.length-1],e.cwd),h=n.slice(0,-1);let o=!1;try{o=(await e.fs.stat(s)).type==="dir"}catch{}if(h.length>1&&!o)return{stdout:"",stderr:`cp: target is not a directory
`,exitCode:1};async function a(l,f){const p=await e.fs.readFile(l);await e.fs.writeFile(f,p)}async function d(l,f){await e.fs.mkdir(f,{recursive:!0});const p=await e.fs.readdir(l);for(const S of p){const k=l+"/"+S.name,A=f+"/"+S.name;S.type==="dir"?await d(k,A):await a(k,A)}}try{for(const l of h){const f=e.fs.resolvePath(l,e.cwd),p=await e.fs.stat(f),S=l.split("/").pop(),k=o?s+"/"+S:s;if(p.type==="dir"){if(!c)return{stdout:"",stderr:`cp: -r not specified; omitting directory '${l}'
`,exitCode:1};await d(f,k)}else await a(f,k)}return{stdout:"",stderr:"",exitCode:0}}catch(l){return{stdout:"",stderr:`cp: ${l instanceof Error?l.message:l}
`,exitCode:1}}}},curl={name:"curl",description:"Transfer data from or to a server",async exec(t,e){const{flags:r,values:n,positional:c}=parseArgs(t,["X","H","d","o","user-agent","header","data","request","output"]);if(c.length===0)return{stdout:"",stderr:`curl: no URL specified!
`,exitCode:1};const s=c[0],h=n.X||n.request||(n.d||n.data?"POST":"GET"),o=n.o||n.output,a=r.s||r.silent,d=r.i||r.include,l=r.I||r.head,f=r.L||r.location,p={},S=n.H||n.header;if(S){const w=S.split(":");w.length>=2&&(p[w[0].trim()]=w.slice(1).join(":").trim())}const k=n["user-agent"]||"fluffycoreutils-curl/0.1.0";p["User-Agent"]=k;let A;(n.d||n.data)&&(A=n.d||n.data,p["Content-Type"]||(p["Content-Type"]="application/x-www-form-urlencoded"));try{const w={method:l?"HEAD":h,headers:p,redirect:f?"follow":"manual"};A&&h!=="GET"&&h!=="HEAD"&&(w.body=A);const v=await fetch(s,w);let g="";if((d||l)&&(g+=`HTTP/1.1 ${v.status} ${v.statusText}
`,v.headers.forEach((m,$)=>{g+=`${$}: ${m}
`}),g+=`
`),!l){const m=await v.text();g+=m}if(o){const m=e.fs.resolvePath(o,e.cwd);return await e.fs.writeFile(m,l?"":await v.text()),a?{stdout:"",stderr:"",exitCode:0}:{stdout:"",stderr:`  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100  ${g.length}  100  ${g.length}    0     0   ${g.length}      0 --:--:-- --:--:-- --:--:--  ${g.length}
`,exitCode:0}}return!a&&!v.ok?{stdout:g,stderr:`curl: (22) The requested URL returned error: ${v.status}
`,exitCode:22}:{stdout:g,stderr:"",exitCode:0}}catch(w){return{stdout:"",stderr:`curl: (6) Could not resolve host: ${w instanceof Error?w.message:String(w)}
`,exitCode:6}}}},cut={name:"cut",description:"Remove sections from each line of files",async exec(t,e){const{values:r,positional:n}=parseArgs(t,["d","f","c"]),c=r.d??"	",s=r.f,h=r.c;if(!s&&!h)return{stdout:"",stderr:`cut: you must specify -f or -c
`,exitCode:1};try{const{content:o}=await readInput(n,e.stdin,e.fs,e.cwd,e.fs.resolvePath),a=parseRanges(s??h),d=o.split(`
`);d.length>0&&d[d.length-1]===""&&d.pop();const l=[];for(const f of d)if(s){const p=f.split(c),S=a.flatMap(k=>p.slice(k.start-1,k.end)).filter(k=>k!==void 0);l.push(S.join(c))}else{const p=f.split(""),S=a.flatMap(k=>p.slice(k.start-1,k.end)).filter(k=>k!==void 0);l.push(S.join(""))}return{stdout:l.join(`
`)+`
`,stderr:"",exitCode:0}}catch(o){return{stdout:"",stderr:`cut: ${o instanceof Error?o.message:o}
`,exitCode:1}}}};function parseRanges(t){return t.split(",").map(e=>{if(e.includes("-")){const[n,c]=e.split("-");return{start:n?parseInt(n,10):1,end:c?parseInt(c,10):1/0}}const r=parseInt(e,10);return{start:r,end:r}})}const date={name:"date",description:"Display date and time",async exec(t,e){const{flags:r,positional:n,values:c}=parseArgs(t,["d","date","r","reference","u"]);let s;if(c.d||c.date){const a=c.d||c.date;if(s=new Date(a),isNaN(s.getTime()))return{stdout:"",stderr:`date: invalid date '${a}'
`,exitCode:1}}else{if(c.r||c.reference)return{stdout:"",stderr:`date: -r/--reference not supported in browser environment
`,exitCode:1};s=new Date}const h=r.u||r.utc;if(n.length>0&&n[0].startsWith("+")){const a=n[0].slice(1);return{stdout:formatDate$1(s,a,h)+`
`,stderr:"",exitCode:0}}return{stdout:(h?s.toUTCString():s.toString())+`
`,stderr:"",exitCode:0}}};function formatDate$1(t,e,r=!1){const n=g=>String(g).padStart(2,"0"),c=g=>String(g).padStart(3,"0"),s=g=>r?t[`getUTC${g}`]():t[`get${g}`](),h=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],o=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],a=["January","February","March","April","May","June","July","August","September","October","November","December"],d=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],l=s("FullYear"),f=s("Month"),p=s("Date"),S=s("Hours"),k=s("Minutes"),A=s("Seconds"),w=s("Milliseconds"),v=s("Day");return e.replace(/%Y/g,String(l)).replace(/%y/g,String(l).slice(-2)).replace(/%m/g,n(f+1)).replace(/%d/g,n(p)).replace(/%e/g,String(p).padStart(2," ")).replace(/%H/g,n(S)).replace(/%I/g,n(S%12||12)).replace(/%M/g,n(k)).replace(/%S/g,n(A)).replace(/%N/g,c(w)+"000000").replace(/%p/g,S>=12?"PM":"AM").replace(/%P/g,S>=12?"pm":"am").replace(/%s/g,String(Math.floor(t.getTime()/1e3))).replace(/%A/g,h[v]).replace(/%a/g,o[v]).replace(/%w/g,String(v)).replace(/%u/g,String(v||7)).replace(/%B/g,a[f]).replace(/%b/g,d[f]).replace(/%h/g,d[f]).replace(/%F/g,`${l}-${n(f+1)}-${n(p)}`).replace(/%T/g,`${n(S)}:${n(k)}:${n(A)}`).replace(/%R/g,`${n(S)}:${n(k)}`).replace(/%n/g,`
`).replace(/%t/g,"	").replace(/%%/g,"%")}const local={name:"local",description:"Declare local variables in shell functions",async exec(t,e){const{positional:r}=parseArgs(t,["r","a","i","x"]);return r.length===0?{stdout:"",stderr:`local: usage: local [-r] [-a] [-i] [-x] [name[=value] ...]
`,exitCode:1}:(r.map(n=>{const[c,s]=n.split("=",2);return s!==void 0?`${c}=${s}`:c}),{stdout:"",stderr:"",exitCode:0})}},declare={name:"declare",description:"Declare variables and give them attributes",async exec(t,e){const{flags:r,positional:n}=parseArgs(t,["r","a","A","i","x","p","f","g"]);if(r.p)return n.length===0?{stdout:`# Shell variables would be listed here
`,stderr:"",exitCode:0}:{stdout:n.map(s=>{const h=e.env[s];return h!==void 0?`declare -- ${s}="${h}"
`:""}).join(""),stderr:"",exitCode:0};for(const c of n){const[s,h]=c.split("=",2);h!==void 0&&e.env&&(e.env[s]=h)}return{stdout:"",stderr:"",exitCode:0}}},readonly={name:"readonly",description:"Mark variables as readonly",async exec(t,e){const{flags:r,positional:n}=parseArgs(t,["p","f"]);if(r.p)return{stdout:`# Readonly variables would be listed here
`,stderr:"",exitCode:0};if(n.length===0)return{stdout:"",stderr:`readonly: usage: readonly [-p] [name[=value] ...]
`,exitCode:1};for(const c of n){const[s,h]=c.split("=",2);h!==void 0&&e.env&&(e.env[s]=h)}return{stdout:"",stderr:"",exitCode:0}}},unset={name:"unset",description:"Unset variables or functions",async exec(t,e){const{flags:r,positional:n}=parseArgs(t,["v","f"]);if(n.length===0)return{stdout:"",stderr:`unset: usage: unset [-v] [-f] [name ...]
`,exitCode:1};if(!r.f&&e.env)for(const c of n)delete e.env[c];return{stdout:"",stderr:"",exitCode:0}}},df={name:"df",description:"Report file system disk space usage",async exec(t,e){const{flags:r}=parseArgs(t),n=r.h,c=r.i,s=[];return c?(s.push("Filesystem      Inodes  IUsed   IFree IUse% Mounted on"),s.push("virtual             0      0       0    0% /")):n?(s.push("Filesystem      Size  Used Avail Use% Mounted on"),s.push("virtual         100G   10G   90G  10% /")):(s.push("Filesystem     1K-blocks    Used Available Use% Mounted on"),s.push("virtual        104857600 10485760  94371840  10% /")),{stdout:s.join(`
`)+`
`,stderr:"",exitCode:0}}},diff={name:"diff",description:"Compare files line by line",async exec(t,e){const{flags:r,positional:n,values:c}=parseArgs(t,["U","context","C"]),s=r.u||c.U!==void 0,h=c.U||c.context||c.C||(r.u?3:0),o=typeof h=="string"?parseInt(h):3,a=r.q||r.brief,d=r.i,l=r.w||r["ignore-all-space"],f=r.y||r["side-by-side"];if(n.length<2)return{stdout:"",stderr:`diff: missing operand
`,exitCode:2};try{const p=e.fs.resolvePath(n[0],e.cwd),S=e.fs.resolvePath(n[1],e.cwd),k=await e.fs.readFile(p),A=await e.fs.readFile(S);if(k===A)return{stdout:"",stderr:"",exitCode:0};if(a)return{stdout:`Files ${n[0]} and ${n[1]} differ
`,stderr:"",exitCode:1};const w=k.split(`
`),v=A.split(`
`),g=computeDiff(w,v,{ignoreCase:d,ignoreWhitespace:l}),m=[];if(s){m.push(`--- ${n[0]}`),m.push(`+++ ${n[1]}`);let $=0;for(;$<g.length;){if(g[$].type==="equal"){$++;continue}const B=Math.max(0,$-1);let P=$;for(;P<g.length;){const W=g[P];if(W.type!=="equal")P++;else if(W.lines.length<=o*2)P++;else break}const x=(g[B]?.line1??0)+1,N=(g[B]?.line2??0)+1;let J=0,Q=0;for(let W=B;W<P;W++)(g[W].type==="equal"||g[W].type==="delete")&&(J+=g[W].lines.length),(g[W].type==="equal"||g[W].type==="add")&&(Q+=g[W].lines.length);m.push(`@@ -${x},${J} +${N},${Q} @@`);for(let W=B;W<P;W++){const Y=g[W];Y.type==="equal"?Y.lines.forEach(ve=>m.push(` ${ve}`)):Y.type==="delete"?Y.lines.forEach(ve=>m.push(`-${ve}`)):Y.type==="add"&&Y.lines.forEach(ve=>m.push(`+${ve}`))}$=P}}else if(f)for(const I of g)I.type==="equal"?I.lines.forEach(B=>{const P=B.substring(0,40).padEnd(40);m.push(`${P} | ${B}`)}):I.type==="delete"?I.lines.forEach(B=>{const P=B.substring(0,40).padEnd(40);m.push(`${P} <`)}):I.type==="add"&&I.lines.forEach(B=>{m.push(`${" ".repeat(40)} > ${B}`)});else for(const $ of g){if($.type==="equal")continue;const I=($.line1??0)+1,B=($.line2??0)+1;$.type==="delete"?(m.push(`${I},${I+$.lines.length-1}d${B-1}`),$.lines.forEach(P=>m.push(`< ${P}`))):$.type==="add"&&(m.push(`${I-1}a${B},${B+$.lines.length-1}`),$.lines.forEach(P=>m.push(`> ${P}`)))}return{stdout:m.join(`
`)+(m.length>0?`
`:""),stderr:"",exitCode:1}}catch(p){return{stdout:"",stderr:`diff: ${p instanceof Error?p.message:p}
`,exitCode:2}}}};function computeDiff(t,e,r={}){const n=t.length,c=e.length,s=l=>{let f=l;return r.ignoreWhitespace&&(f=f.replace(/\s+/g,"")),r.ignoreCase&&(f=f.toLowerCase()),f},h=Array(n+1).fill(0).map(()=>Array(c+1).fill(0));for(let l=1;l<=n;l++)for(let f=1;f<=c;f++)s(t[l-1])===s(e[f-1])?h[l][f]=h[l-1][f-1]+1:h[l][f]=Math.max(h[l-1][f],h[l][f-1]);const o=[];let a=n,d=c;for(;a>0||d>0;)a>0&&d>0&&s(t[a-1])===s(e[d-1])?(o.length>0&&o[o.length-1].type==="equal"?o[o.length-1].lines.unshift(t[a-1]):o.push({type:"equal",lines:[t[a-1]],line1:a-1,line2:d-1}),a--,d--):d>0&&(a===0||h[a][d-1]>=h[a-1][d])?(o.length>0&&o[o.length-1].type==="add"?o[o.length-1].lines.unshift(e[d-1]):o.push({type:"add",lines:[e[d-1]],line1:a,line2:d-1}),d--):(o.length>0&&o[o.length-1].type==="delete"?o[o.length-1].lines.unshift(t[a-1]):o.push({type:"delete",lines:[t[a-1]],line1:a-1,line2:d}),a--);return o.reverse()}const dirname={name:"dirname",description:"Strip last component from file name",async exec(t){if(t.length===0)return{stdout:"",stderr:`dirname: missing operand
`,exitCode:1};const e=t[0].replace(/\/+$/,""),r=e.lastIndexOf("/");return{stdout:(r===-1?".":r===0?"/":e.slice(0,r))+`
`,stderr:"",exitCode:0}}},whileCmd={name:"while",description:"Loop while condition is true (shell language construct)",async exec(t,e){return{stdout:"",stderr:`while: this is a shell language construct that must be interpreted by the shell
Usage: while CONDITION; do COMMANDS; done
`,exitCode:2}}},until={name:"until",description:"Loop until condition is true (shell language construct)",async exec(t,e){return{stdout:"",stderr:`until: this is a shell language construct that must be interpreted by the shell
Usage: until CONDITION; do COMMANDS; done
`,exitCode:2}}},doCmd={name:"do",description:"Start loop body (shell language construct)",async exec(t,e){return{stdout:"",stderr:`do: can only be used as part of a for/while/until loop
`,exitCode:2}}},done={name:"done",description:"End loop (shell language construct)",async exec(t,e){return{stdout:"",stderr:`done: can only be used to close a for/while/until loop
`,exitCode:2}}},du={name:"du",description:"Estimate file space usage",async exec(t,e){const{flags:r,positional:n,values:c}=parseArgs(t,["max-depth","d"]),s=n.length>0?n:["."],h=r.s,o=r.a,a=r.h,d=c["max-depth"]||c.d,l=d?parseInt(d):1/0,f=[];try{for(const p of s){const S=e.fs.resolvePath(p,e.cwd),k=await calculateSize(S,e.fs,0,l,o,!h,f,a),A=a?formatHuman(k):String(Math.ceil(k/1024));f.push(`${A}	${p}`)}return{stdout:f.join(`
`)+`
`,stderr:"",exitCode:0}}catch(p){return{stdout:"",stderr:`du: ${p instanceof Error?p.message:p}
`,exitCode:1}}}};async function calculateSize(t,e,r,n,c,s,h,o){try{const a=await e.stat(t);if(a.type==="file")return a.size;if(a.type==="dir"&&r<n){const d=await e.readdir(t);let l=0;for(const f of d){const p=t+"/"+f.name,S=await calculateSize(p,e,r+1,n,c,s,h,o);if(l+=S,c&&f.type==="file"){const k=o?formatHuman(S):String(Math.ceil(S/1024));h.push(`${k}	${p}`)}if(s&&f.type==="dir"&&r+1<n){const k=o?formatHuman(S):String(Math.ceil(S/1024));h.push(`${k}	${p}`)}}return l}return 0}catch{return 0}}function formatHuman(t){const e=["","K","M","G","T"];let r=t,n=0;for(;r>=1024&&n<e.length-1;)r/=1024,n++;return Math.ceil(r)+e[n]}const echo={name:"echo",description:"Display text",async exec(t){const{flags:e}=parseArgs(t),r=e.n,n=t.filter(s=>s!=="-n"&&s!=="-e").join(" ");let c=e.e?n.replace(/\\n/g,`
`).replace(/\\t/g,"	").replace(/\\\\/g,"\\"):n;return r||(c+=`
`),{stdout:c,stderr:"",exitCode:0}}},ifCmd={name:"if",description:"Conditional execution (shell language construct)",async exec(t,e){return{stdout:"",stderr:`if: this is a shell language construct that must be interpreted by the shell
Usage: if CONDITION; then COMMANDS; [elif CONDITION; then COMMANDS;] [else COMMANDS;] fi
`,exitCode:2}}},then={name:"then",description:"Part of if/elif statement (shell language construct)",async exec(t,e){return{stdout:"",stderr:`then: can only be used as part of an if/elif statement
`,exitCode:2}}},elif={name:"elif",description:"Else-if branch (shell language construct)",async exec(t,e){return{stdout:"",stderr:`elif: can only be used as part of an if statement
`,exitCode:2}}},elseCmd={name:"else",description:"Else branch (shell language construct)",async exec(t,e){return{stdout:"",stderr:`else: can only be used as part of an if statement
`,exitCode:2}}},fi={name:"fi",description:"End if statement (shell language construct)",async exec(t,e){return{stdout:"",stderr:`fi: can only be used to close an if statement
`,exitCode:2}}},env={name:"env",description:"Print environment variables",async exec(t,e){return{stdout:Object.entries(e.env).map(([n,c])=>`${n}=${c}`).sort().join(`
`)+`
`,stderr:"",exitCode:0}}},evalCmd={name:"eval",description:"Evaluate and execute arguments as a shell command",async exec(t,e){const{positional:r}=parseArgs(t);return r.join(" "),{stdout:"",stderr:"",exitCode:0}}},exit={name:"exit",description:"Exit the shell with a status code",async exec(t,e){const{positional:r}=parseArgs(t),n=r.length>0?parseInt(r[0]):0;return{stdout:"",stderr:"",exitCode:isNaN(n)?2:n}}},expand={name:"expand",description:"Convert tabs to spaces",async exec(t,e){const{values:r,positional:n,flags:c}=parseArgs(t,["t","tabs"]),s=r.t||r.tabs||"8",h=parseInt(s,10);if(isNaN(h)||h<=0)return{stdout:"",stderr:`expand: invalid tab size: '${s}'
`,exitCode:1};const o=c.i||c.initial;try{const{content:a}=await readInput(n,e.stdin,e.fs,e.cwd,e.fs.resolvePath),d=a.split(`
`),l=[];for(const f of d){let p="",S=0;for(let k=0;k<f.length;k++){const A=f[k];if(A==="	")if(!o||o&&p.trim()===""){const w=h-S%h;p+=" ".repeat(w),S+=w}else p+=A,S++;else p+=A,S++}l.push(p)}return{stdout:l.join(`
`)+(a.endsWith(`
`)?`
`:""),stderr:"",exitCode:0}}catch(a){return{stdout:"",stderr:`expand: ${a instanceof Error?a.message:a}
`,exitCode:1}}}},expr={name:"expr",description:"Evaluate expressions",async exec(t,e){const{positional:r}=parseArgs(t);if(r.length===0)return{stdout:"",stderr:`expr: missing operand
`,exitCode:1};try{const n=evaluateExpression(r);return{stdout:String(n)+`
`,stderr:"",exitCode:n===0||n===""?1:0}}catch(n){return{stdout:"",stderr:`expr: ${n instanceof Error?n.message:n}
`,exitCode:2}}}};function evaluateExpression(t){if(t.length===0)throw new Error("syntax error");if(t.length===1)return t[0];for(let e=0;e<t.length;e++)if(t[e]==="|"){const r=evaluateExpression(t.slice(0,e)),n=evaluateExpression(t.slice(e+1));return r&&r!=="0"&&r!==""?r:n}for(let e=0;e<t.length;e++)if(t[e]==="&"){const r=evaluateExpression(t.slice(0,e)),n=evaluateExpression(t.slice(e+1));return r&&r!=="0"&&r!==""&&n&&n!=="0"&&n!==""?r:0}for(let e=0;e<t.length;e++){const r=t[e];if(["=","!=","<",">","<=",">="].includes(r)){const n=String(evaluateExpression(t.slice(0,e))),c=String(evaluateExpression(t.slice(e+1))),s=parseFloat(n),h=parseFloat(c),o=!isNaN(s)&&!isNaN(h);let a=!1;if(o)switch(r){case"=":a=s===h;break;case"!=":a=s!==h;break;case"<":a=s<h;break;case">":a=s>h;break;case"<=":a=s<=h;break;case">=":a=s>=h;break}else switch(r){case"=":a=n===c;break;case"!=":a=n!==c;break;case"<":a=n<c;break;case">":a=n>c;break;case"<=":a=n<=c;break;case">=":a=n>=c;break}return a?1:0}}for(let e=t.length-1;e>=0;e--)if(t[e]==="+"||t[e]==="-"){const r=Number(evaluateExpression(t.slice(0,e))),n=Number(evaluateExpression(t.slice(e+1)));return t[e]==="+"?r+n:r-n}for(let e=t.length-1;e>=0;e--)if(["*","/","%"].includes(t[e])){const r=Number(evaluateExpression(t.slice(0,e))),n=Number(evaluateExpression(t.slice(e+1)));if(t[e]==="*")return r*n;if(t[e]==="/"){if(n===0)throw new Error("division by zero");return Math.floor(r/n)}if(t[e]==="%"){if(n===0)throw new Error("division by zero");return r%n}}if(t.length===3){if(t[1]===":"){const e=t[0],r=t[2];try{const n=new RegExp("^"+r),c=e.match(n);return c?c[0].length:0}catch{throw new Error("invalid regular expression")}}if(t[0]==="length")return String(t[1]).length;if(t[0]==="index"){const e=t[1],r=t[2];for(let n=0;n<e.length;n++)if(r.includes(e[n]))return n+1;return 0}}if(t.length===4&&t[0]==="substr"){const e=t[1],r=Number(t[2])-1,n=Number(t[3]);return e.substring(r,r+n)}if(t.length===1){const e=parseFloat(t[0]);return isNaN(e)?t[0]:e}throw new Error("syntax error")}const exportCmd={name:"export",description:"Set environment variables (note: in a real shell, this modifies parent environment)",async exec(t,e){if(t.length===0)return{stdout:Object.entries(e.env).map(([s,h])=>`export ${s}="${h}"`).sort().join(`
`)+`
`,stderr:"",exitCode:0};const r=[],n=[];for(const c of t){const s=c.indexOf("=");if(s===-1){const h=c;if(!/^[a-zA-Z_][a-zA-Z0-9_]*$/.test(h)){n.push(`export: \`${h}': not a valid identifier`);continue}h in e.env?r.push(`export ${h}="${e.env[h]}"`):r.push(`export ${h}=""`)}else{const h=c.slice(0,s);let o=c.slice(s+1);if(!/^[a-zA-Z_][a-zA-Z0-9_]*$/.test(h)){n.push(`export: \`${h}': not a valid identifier`);continue}(o.startsWith('"')&&o.endsWith('"')||o.startsWith("'")&&o.endsWith("'"))&&(o=o.slice(1,-1)),e.env[h]=o,r.push(`export ${h}="${o}"`)}}return n.length>0?{stdout:"",stderr:n.join(`
`)+`
`,exitCode:1}:{stdout:"",stderr:"",exitCode:0}}},falseCmd={name:"false",description:"Return failure",async exec(){return{stdout:"",stderr:"",exitCode:1}}},forCmd={name:"for",description:"Iterate over list (shell language construct)",async exec(t,e){return{stdout:"",stderr:`for: this is a shell language construct that must be interpreted by the shell
Usage: for VAR in LIST; do COMMANDS; done
`,exitCode:2}}},inCmd={name:"in",description:"Part of for loop (shell language construct)",async exec(t,e){return{stdout:"",stderr:`in: can only be used as part of a for loop or case statement
`,exitCode:2}}},functionCmd={name:"function",description:"Define shell function (shell language construct)",async exec(t,e){return{stdout:"",stderr:`function: this is a shell language construct that must be interpreted by the shell
Usage: function NAME { COMMANDS; } or NAME() { COMMANDS; }
`,exitCode:2}}},file={name:"file",description:"Determine file type",async exec(t,e){const{positional:r,flags:n}=parseArgs(t);if(r.length===0)return{stdout:"",stderr:`file: missing operand
`,exitCode:1};const c=n.b,s=n.i||n.mime,h=n["mime-type"],o=n["mime-encoding"],a=[];try{for(const d of r){const l=e.fs.resolvePath(d,e.cwd);try{if((await e.fs.stat(l)).type==="dir"){const A=c?"directory":`${d}: directory`;a.push(A);continue}const p=await e.fs.readFile(l),S=detectFileType(p,d);let k;h?k=c?S.mimeType:`${d}: ${S.mimeType}`:o?k=c?S.encoding:`${d}: ${S.encoding}`:s?k=c?`${S.mimeType}; charset=${S.encoding}`:`${d}: ${S.mimeType}; charset=${S.encoding}`:k=c?S.description:`${d}: ${S.description}`,a.push(k)}catch(f){a.push(`${d}: cannot open (${f instanceof Error?f.message:f})`)}}return{stdout:a.join(`
`)+(a.length>0?`
`:""),stderr:"",exitCode:0}}catch(d){return{stdout:"",stderr:`file: ${d instanceof Error?d.message:d}
`,exitCode:1}}}};function detectFileType(t,e){let r="text/plain",n="us-ascii",c="ASCII text";if(/[^\x00-\x7F]/.test(t)&&(n="utf-8",c="UTF-8 Unicode text"),t.length===0)return r="application/x-empty",c="empty",{mimeType:r,encoding:n,description:c};const s=e.split(".").pop()?.toLowerCase();if(s)switch(s){case"js":case"mjs":r="text/javascript",c="JavaScript source";break;case"ts":r="text/x-typescript",c="TypeScript source";break;case"json":r="application/json",c="JSON data";break;case"html":case"htm":r="text/html",c="HTML document";break;case"css":r="text/css",c="CSS stylesheet";break;case"xml":r="text/xml",c="XML document";break;case"md":r="text/markdown",c="Markdown text";break;case"sh":r="text/x-shellscript",c="shell script";break;case"py":r="text/x-python",c="Python script";break;case"txt":r="text/plain",c="ASCII text";break}if(t.startsWith("#!/bin/sh")||t.startsWith("#!/bin/bash"))r="text/x-shellscript",c="Bourne-Again shell script";else if(t.startsWith("#!/usr/bin/env node"))r="text/javascript",c="Node.js script";else if(t.startsWith("#!/usr/bin/env python"))r="text/x-python",c="Python script";else if(t.startsWith("{")&&t.trim().endsWith("}"))try{JSON.parse(t),r="application/json",c="JSON data"}catch{}else t.startsWith("<?xml")?(r="text/xml",c="XML document"):(t.startsWith("<!DOCTYPE html")||t.startsWith("<html"))&&(r="text/html",c="HTML document");return{mimeType:r,encoding:n,description:c}}const find={name:"find",description:"Search for files in a directory hierarchy",async exec(t,e){const{values:r,positional:n,flags:c}=parseArgs(t,["name","type","exec","maxdepth","mindepth","path","iname"]),s=n[0]??".",h=r.name,o=r.iname,a=r.path,d=r.type,l=r.maxdepth?parseInt(r.maxdepth):1/0,f=r.mindepth?parseInt(r.mindepth):0,p=r.exec,S=c.print!==!1,k=e.fs.resolvePath(s,e.cwd),A=[],w=[];let v;if(h){const B=h.replace(/[.+^${}()|[\]\\]/g,"\\$&").replace(/\*/g,".*").replace(/\?/g,".");v=new RegExp(`^${B}$`)}let g;if(o){const B=o.replace(/[.+^${}()|[\]\\]/g,"\\$&").replace(/\*/g,".*").replace(/\?/g,".");g=new RegExp(`^${B}$`,"i")}let m;if(a){const B=a.replace(/[.+^${}()|[\]\\]/g,"\\$&").replace(/\*/g,".*").replace(/\?/g,".");m=new RegExp(B)}async function $(B,P,x){let N;try{N=await e.fs.readdir(B)}catch{return}for(const J of N){const Q=B+"/"+J.name,W=P?P+"/"+J.name:J.name,Y=s==="."?"./"+W:s+"/"+W,ve=x+1;let Be=!0;if(!(ve>l)){if(ve<f&&(Be=!1),v&&!v.test(J.name)&&(Be=!1),g&&!g.test(J.name)&&(Be=!1),m&&!m.test(Y)&&(Be=!1),d==="f"&&J.type!=="file"&&(Be=!1),d==="d"&&J.type!=="dir"&&(Be=!1),Be&&(S&&A.push(Y),p)){const je=p.replace(/\{\}/g,Y);w.push(`Executing: ${je}`)}J.type==="dir"&&ve<l&&await $(Q,W,ve)}}}0>=f&&(!d||d==="d")&&!v&&!g&&!m&&S&&A.push(s==="."?".":s),await $(k,"",0);let I="";return A.length>0&&(I=A.join(`
`)+`
`),w.length>0&&(I+=w.join(`
`)+`
`),{stdout:I,stderr:"",exitCode:0}}},fmt={name:"fmt",description:"Simple optimal text formatter",async exec(t,e){const{values:r,positional:n,flags:c}=parseArgs(t,["w","width"]),s=parseInt(r.w||r.width||"75",10);c.u;const h=c.s;if(isNaN(s)||s<=0)return{stdout:"",stderr:`fmt: invalid width: '${r.w||r.width}'
`,exitCode:1};try{const{content:o}=await readInput(n,e.stdin,e.fs,e.cwd,e.fs.resolvePath),a=o.split(`
`),d=[];let l=[];const f=()=>{if(l.length!==0){if(h)for(const p of l)d.push(...wrapLine(p,s));else{const p=l.join(" ").trim();p&&d.push(...wrapLine(p,s))}l=[]}};for(const p of a){const S=p.trim();S===""?(f(),d.push("")):l.push(S)}return f(),{stdout:d.join(`
`)+(d.length>0?`
`:""),stderr:"",exitCode:0}}catch(o){return{stdout:"",stderr:`fmt: ${o instanceof Error?o.message:o}
`,exitCode:1}}}};function wrapLine(t,e){const r=[],n=t.split(/\s+/);let c="";for(const s of n)c.length===0?c=s:c.length+1+s.length<=e?c+=" "+s:(r.push(c),c=s);return c.length>0&&r.push(c),r}const fold={name:"fold",description:"Wrap each input line to fit in specified width",async exec(t,e){const{values:r,positional:n,flags:c}=parseArgs(t,["w","width"]),s=parseInt(r.w||r.width||"80",10);c.b;const h=c.s;if(isNaN(s)||s<=0)return{stdout:"",stderr:`fold: invalid width: '${r.w||r.width}'
`,exitCode:1};try{const{content:o}=await readInput(n,e.stdin,e.fs,e.cwd,e.fs.resolvePath),a=o.split(`
`),d=[];for(const l of a){if(l.length<=s){d.push(l);continue}let f=l;for(;f.length>s;){let p=s;if(h){const S=f.substring(0,s).lastIndexOf(" ");S>0&&(p=S+1)}d.push(f.substring(0,p)),f=f.substring(p)}f.length>0&&d.push(f)}return{stdout:d.join(`
`)+(o.endsWith(`
`)?`
`:""),stderr:"",exitCode:0}}catch(o){return{stdout:"",stderr:`fold: ${o instanceof Error?o.message:o}
`,exitCode:1}}}},free={name:"free",description:"Display amount of free and used memory",async exec(t,e){const{flags:r}=parseArgs(t),n=r.h,c=r.b,s=r.m,h=r.g,o=[],a=8388608,d=4194304,l=4194304,f=524288,p=1048576,S=5242880;return n?(o.push("               total        used        free      shared  buff/cache   available"),o.push("Mem:            8.0G        4.0G        4.0G       512M        1.0G        5.0G"),o.push("Swap:           2.0G          0B        2.0G")):c?(o.push("               total        used        free      shared  buff/cache   available"),o.push(`Mem:    ${a*1024} ${d*1024} ${l*1024} ${f*1024} ${p*1024} ${S*1024}`),o.push(`Swap:   ${2097152*1024}           0 ${2097152*1024}`)):s?(o.push("               total        used        free      shared  buff/cache   available"),o.push(`Mem:           ${Math.floor(a/1024)}        ${Math.floor(d/1024)}        ${Math.floor(l/1024)}         ${Math.floor(f/1024)}        ${Math.floor(p/1024)}        ${Math.floor(S/1024)}`),o.push("Swap:          2048           0        2048")):h?(o.push("               total        used        free      shared  buff/cache   available"),o.push("Mem:               8           4           4           0           1           5"),o.push("Swap:              2           0           2")):(o.push("               total        used        free      shared  buff/cache   available"),o.push(`Mem:        ${a}     ${d}     ${l}      ${f}     ${p}     ${S}`),o.push("Swap:       2097152           0     2097152")),{stdout:o.join(`
`)+`
`,stderr:"",exitCode:0}}},getopts={name:"getopts",description:"Parse option arguments (shell built-in)",async exec(t,e){if(t.length<2)return{stdout:"",stderr:`getopts: usage: getopts OPTSTRING NAME [args...]
`,exitCode:1};const r=t[0],n=t[1],c=t.slice(2);let s=parseInt(e.env?.OPTIND||"1");const h=r.startsWith(":"),o=h?r.slice(1):r,a=new Map;for(let S=0;S<o.length;S++){const k=o[S];if(k===":")continue;const A=o[S+1]===":";a.set(k,A)}const d=c.length>0?c:e.env?.$1?[e.env.$1,e.env.$2,e.env.$3].filter(Boolean):[];if(d.length===0||s>d.length)return e.env&&(e.env.OPTIND="1"),{stdout:"",stderr:"",exitCode:1};const l=d[s-1];if(!l||!l.startsWith("-")||l==="-"||l==="--")return e.env&&(e.env.OPTIND="1"),{stdout:"",stderr:"",exitCode:1};const f=l[1];if(!a.has(f))return e.env&&(e.env[n]="?",e.env.OPTARG=f,e.env.OPTIND=String(s+1)),h?{stdout:"",stderr:"",exitCode:0}:{stdout:"",stderr:`getopts: illegal option -- ${f}
`,exitCode:0};if(a.get(f)){let S;if(l.length>2)S=l.slice(2);else if(s<d.length)S=d[s],e.env&&(e.env.OPTIND=String(s+2));else return e.env&&(e.env[n]="?",e.env.OPTARG=f,e.env.OPTIND=String(s+1)),h?{stdout:"",stderr:"",exitCode:0}:{stdout:"",stderr:`getopts: option requires an argument -- ${f}
`,exitCode:0};e.env&&(e.env[n]=f,e.env.OPTARG=S,e.env.OPTIND||(e.env.OPTIND=String(s+1)))}else e.env&&(e.env[n]=f,e.env.OPTIND=String(s+1),delete e.env.OPTARG);return{stdout:"",stderr:"",exitCode:0}}},grep={name:"grep",description:"Search for patterns in files",async exec(t,e){const{flags:r,values:n,positional:c}=parseArgs(t,["e"]),s=!!r.i,h=!!r.v,o=!!r.c,a=!!r.l,d=!!r.n,l=!!(r.r||r.R),f=n.e??c.shift();if(!f)return{stdout:"",stderr:`grep: missing pattern
`,exitCode:2};const p=s?"i":"";let S;try{S=new RegExp(f,p)}catch{return{stdout:"",stderr:`grep: invalid pattern: ${f}
`,exitCode:2}}const k=c.length>0?c:["-"],A=k.length>1||l,w=[];let v=!1;async function g(I,B){let P;try{if(I==="-")P=e.stdin;else{const J=e.fs.resolvePath(I,e.cwd);P=await e.fs.readFile(J)}}catch{w.push(`grep: ${I}: No such file or directory`);return}const x=P.split(`
`);x.length>0&&x[x.length-1]===""&&x.pop();let N=0;for(let J=0;J<x.length;J++)if(S.test(x[J])!==h&&(v=!0,N++,!o&&!a)){const W=A?`${B}:`:"",Y=d?`${J+1}:`:"";w.push(`${W}${Y}${x[J]}`)}o&&w.push(A?`${B}:${N}`:String(N)),a&&N>0&&w.push(B)}async function m(I){const B=e.fs.resolvePath(I,e.cwd);let P;try{P=await e.fs.readdir(B)}catch{return}for(const x of P){const N=B+"/"+x.name;x.type==="dir"?await m(N):await g(N,N)}}for(const I of k)if(I==="-")await g("-","(standard input)");else if(l){const B=e.fs.resolvePath(I,e.cwd);let P;try{P=await e.fs.stat(B)}catch{continue}P.type==="dir"?await m(B):await g(I,I)}else await g(I,I);return{stdout:w.length>0?w.join(`
`)+`
`:"",stderr:"",exitCode:v?0:1}}},hash={name:"hash",description:"Remember or report command locations",async exec(t,e){const{flags:r,positional:n}=parseArgs(t,["r","d","l","p","t"]);return r.r?{stdout:"",stderr:"",exitCode:0}:r.d?n.length===0?{stdout:"",stderr:`hash: -d: option requires an argument
`,exitCode:1}:{stdout:"",stderr:"",exitCode:0}:r.l?{stdout:n.length===0?"":n.map(s=>`builtin hash ${s}=/usr/bin/${s}`).join(`
`)+`
`,stderr:"",exitCode:0}:r.p?{stdout:"",stderr:"",exitCode:0}:r.t?n.length===0?{stdout:"",stderr:`hash: -t: option requires an argument
`,exitCode:1}:{stdout:n.map(s=>`/usr/bin/${s}`).join(`
`)+`
`,stderr:"",exitCode:0}:n.length===0?{stdout:`hits	command
   0	/usr/bin/ls
   0	/usr/bin/cat
   0	/usr/bin/grep
`,stderr:"",exitCode:0}:{stdout:"",stderr:"",exitCode:0}}},head={name:"head",description:"Output the first part of files",async exec(t,e){const r=t.flatMap(h=>{const o=h.match(/^-(\d+)$/);return o?["-n",o[1]]:[h]}),{values:n,positional:c}=parseArgs(r,["n"]),s=parseInt(n.n??"10",10);try{const{content:h}=await readInput(c,e.stdin,e.fs,e.cwd,e.fs.resolvePath);return{stdout:h.split(`
`).slice(0,s).join(`
`)+`
`,stderr:"",exitCode:0}}catch(h){return{stdout:"",stderr:`head: ${h instanceof Error?h.message:h}
`,exitCode:1}}}},heredoc={name:"heredoc",description:"Helper for here-document processing (shell feature)",async exec(t,e){return{stdout:`heredoc: This is a shell language feature, not a command.

Here-document syntax must be implemented at the shell parser level:

Syntax:
  command << DELIMITER
  content line 1
  content line 2
  DELIMITER

Variants:
  <<  DELIMITER  - Normal mode (variable expansion enabled)
  << 'DELIMITER' - Literal mode (no expansion)
  <<- DELIMITER  - Strip leading tabs from content lines

Implementation guidance for shell parsers:
1. When encountering <<, capture the delimiter (next token)
2. Read subsequent lines until line exactly matches delimiter
3. Apply expansions ($var, $(cmd), \`cmd\`) unless in literal mode
4. If <<-, strip leading tabs from each line
5. Pass the collected content as stdin to the command

Examples:
  cat << EOF
  Hello, \${USER}!
  The date is $(date)
  EOF

  cat << 'EOF'
  Literal \${USER} - no expansion
  EOF

  cat <<- EOF
  \\tThis line had a leading tab that was stripped
  EOF

Shell implementers: Parse heredoc at the token/syntax level before command execution.

`,stderr:"",exitCode:0}}},hexdump={name:"hexdump",description:"Display file contents in hexadecimal",async exec(t,e){const{values:r,positional:n,flags:c}=parseArgs(t,["n","s","C"]),s=c.C,h=r.n?parseInt(r.n):void 0,o=r.s?parseInt(r.s):0;try{const{content:a}=await readInput(n,e.stdin,e.fs,e.cwd,e.fs.resolvePath);let d=a.substring(o,h?o+h:void 0);const l=[];if(s){for(let p=0;p<d.length;p+=16){const S=d.substring(p,p+16),k=(o+p).toString(16).padStart(8,"0"),A=formatHexGroup(S.substring(0,8)),w=formatHexGroup(S.substring(8,16)),v=formatAscii(S);l.push(`${k}  ${A}  ${w}  |${v}|`)}const f=(o+d.length).toString(16).padStart(8,"0");l.push(f)}else{for(let p=0;p<d.length;p+=16){const S=d.substring(p,p+16),k=(o+p).toString(16).padStart(7,"0"),A=[];for(let w=0;w<S.length;w+=2){const v=S.charCodeAt(w),g=w+1<S.length?S.charCodeAt(w+1):0,m=(v<<8|g).toString(16).padStart(4,"0");A.push(m)}l.push(`${k} ${A.join(" ")}`)}const f=(o+d.length).toString(16).padStart(7,"0");l.push(f)}return{stdout:l.join(`
`)+`
`,stderr:"",exitCode:0}}catch(a){return{stdout:"",stderr:`hexdump: ${a instanceof Error?a.message:a}
`,exitCode:1}}}};function formatHexGroup(t){const e=[];for(let r=0;r<8;r++)r<t.length?e.push(t.charCodeAt(r).toString(16).padStart(2,"0")):e.push("  ");return e.join(" ")}function formatAscii(t){let e="";for(let r=0;r<16;r++)if(r<t.length){const n=t.charCodeAt(r);e+=n>=32&&n<127?t[r]:"."}else e+=" ";return e}const hostname={name:"hostname",description:"Print system hostname",async exec(t,e){return{stdout:(e.env.HOSTNAME??"localhost")+`
`,stderr:"",exitCode:0}}},id={name:"id",description:"Print user identity",async exec(t,e){const{positional:r,flags:n}=parseArgs(t),c=r[0]||e.env.USER||"user",s=n.u||n.user,h=n.g||n.group,o=n.G||n.groups,a=n.n||n.name;n.r||n.real;const d=1e3,l=1e3,f=[1e3],p=c,S="users",k=[];if(s)a?k.push(p):k.push(String(d));else if(h)a?k.push(S):k.push(String(l));else if(o)a?k.push(S):k.push(f.join(" "));else{const A=f.map(w=>`${w}(${S})`).join(",");k.push(`uid=${d}(${p}) gid=${l}(${S}) groups=${A}`)}return{stdout:k.join(`
`)+(k.length>0?`
`:""),stderr:"",exitCode:0}}},install={name:"install",description:"Copy files and set attributes",async exec(t,e){const{values:r,positional:n,flags:c}=parseArgs(t,["m","mode","o","owner","g","group","t","target-directory"]);r.m||r.mode;const s=r.t||r["target-directory"],h=c.d||c.directory,o=c.v||c.verbose;if(n.length===0)return{stdout:"",stderr:`install: missing operand
`,exitCode:1};const a=[];try{if(h)for(const d of n){const l=e.fs.resolvePath(d,e.cwd);await e.fs.mkdir(l,{recursive:!0}),o&&a.push(`install: creating directory '${d}'`)}else if(s){const d=e.fs.resolvePath(s,e.cwd);for(const l of n){const f=e.fs.resolvePath(l,e.cwd),p=l.split("/").pop()||l,S=d+"/"+p,k=await e.fs.readFile(f);await e.fs.writeFile(S,k),o&&a.push(`'${l}' -> '${s}/${p}'`)}}else{if(n.length<2)return{stdout:"",stderr:`install: missing destination
`,exitCode:1};const d=n[n.length-1],l=n.slice(0,-1),f=e.fs.resolvePath(d,e.cwd);let p=!1;try{p=(await e.fs.stat(f)).type==="dir"}catch{p=l.length>1}if(p&&l.length>1)for(const S of l){const k=e.fs.resolvePath(S,e.cwd),A=S.split("/").pop()||S,w=f+"/"+A,v=await e.fs.readFile(k);await e.fs.writeFile(w,v),o&&a.push(`'${S}' -> '${d}/${A}'`)}else{const S=e.fs.resolvePath(l[0],e.cwd),k=await e.fs.readFile(S);await e.fs.writeFile(f,k),o&&a.push(`'${l[0]}' -> '${d}'`)}}return{stdout:a.join(`
`)+(a.length>0?`
`:""),stderr:"",exitCode:0}}catch(d){return{stdout:"",stderr:`install: ${d instanceof Error?d.message:d}
`,exitCode:1}}}},join={name:"join",description:"Join lines of two files on a common field",async exec(t,e){const{values:r,positional:n,flags:c}=parseArgs(t,["1","2","t","o"]);if(n.length<2)return{stdout:"",stderr:`join: missing file operand
`,exitCode:1};const s=r[1]?parseInt(r[1])-1:0,h=r[2]?parseInt(r[2])-1:0,o=r.t||/\s+/,a=r.o,d=c.i;try{const l=e.fs.resolvePath(n[0],e.cwd),f=e.fs.resolvePath(n[1],e.cwd),p=await e.fs.readFile(l),S=await e.fs.readFile(f),k=p.split(`
`).filter(I=>I.trim()!==""),A=S.split(`
`).filter(I=>I.trim()!==""),w=I=>I.map(B=>B.split(o)),v=w(k),g=w(A),m=new Map;for(const I of g){const B=(I[h]||"").trim(),P=d?B.toLowerCase():B;m.has(P)||m.set(P,[]),m.get(P).push(I)}const $=[];for(const I of v){const B=(I[s]||"").trim(),P=d?B.toLowerCase():B,x=m.get(P)||[];for(const N of x){let J;if(a)J=a.split(",").map(W=>{const[Y,ve]=W.split(".").map(je=>parseInt(je));return(Y===1?I:N)[ve-1]||""}).join(" ");else{const Q=I[s]||"",W=I.filter((ve,Be)=>Be!==s),Y=N.filter((ve,Be)=>Be!==h);J=[Q,...W,...Y].join(" ")}$.push(J)}}return{stdout:$.join(`
`)+($.length>0?`
`:""),stderr:"",exitCode:0}}catch(l){return{stdout:"",stderr:`join: ${l instanceof Error?l.message:l}
`,exitCode:1}}}},less={name:"less",description:"View file contents with pagination",async exec(t,e){const{flags:r,positional:n}=parseArgs(t);try{const{content:c}=await readInput(n,e.stdin,e.fs,e.cwd,e.fs.resolvePath),s=c.split(`
`),h=r.N||r.n;let o="";return h?o=s.map((a,d)=>`${String(d+1).padStart(6)}  ${a}`).join(`
`):o=c,o&&!o.endsWith(`
`)&&(o+=`
`),{stdout:o,stderr:"",exitCode:0}}catch(c){return{stdout:"",stderr:`less: ${c instanceof Error?c.message:c}
`,exitCode:1}}}},letCmd={name:"let",description:"Evaluate arithmetic expressions",async exec(t,e){if(t.length===0)return{stdout:"",stderr:`let: usage: let arg [arg ...]
`,exitCode:1};try{const r=t.join(" "),n=r.match(/^([a-zA-Z_][a-zA-Z0-9_]*)\s*=\s*(.+)$/);if(n){const s=n[1],h=n[2],o=evaluateArithmetic(h,e.env||{});return e.env&&(e.env[s]=String(o)),{stdout:"",stderr:"",exitCode:o===0?1:0}}return{stdout:"",stderr:"",exitCode:evaluateArithmetic(r,e.env||{})===0?1:0}}catch(r){return{stdout:"",stderr:`let: ${r.message}
`,exitCode:1}}}};function evaluateArithmetic(t,e){let r=t.trim();r=r.replace(/\$\{?([a-zA-Z_][a-zA-Z0-9_]*)\}?/g,(n,c)=>e[c]||"0");try{if(r=r.replace(/\s+/g,""),/^[\d+\-*/%()]+$/.test(r)){const c=new Function(`return (${r})`)();return Math.floor(c)}if(r.includes("==")||r.includes("!=")||r.includes("<=")||r.includes(">=")||r.includes("<")||r.includes(">"))return new Function(`return (${r}) ? 1 : 0`)();if(r.includes("&&")||r.includes("||"))return new Function(`return (${r}) ? 1 : 0`)();const n=parseFloat(r);if(!isNaN(n))return Math.floor(n);throw new Error(`invalid arithmetic expression: ${t}`)}catch{throw new Error(`invalid arithmetic expression: ${t}`)}}const ln={name:"ln",description:"Make links between files",async exec(t,e){const{flags:r,positional:n}=parseArgs(t),c=r.s,s=r.f,h=r.v;if(n.length<2)return{stdout:"",stderr:`ln: missing operand
`,exitCode:1};const o=e.fs.resolvePath(n[0],e.cwd),a=e.fs.resolvePath(n[1],e.cwd),d=[];try{if(await e.fs.exists(a))if(s)try{await e.fs.unlink(a)}catch{}else return{stdout:"",stderr:`ln: ${a}: File exists
`,exitCode:1};if(c&&e.fs.symlink)await e.fs.symlink(o,a),h&&d.push(`'${a}' -> '${o}'`);else{const l=await e.fs.readFile(o);await e.fs.writeFile(a,l),h&&d.push(`'${a}' => '${o}'`)}return{stdout:d.join(`
`)+(d.length>0?`
`:""),stderr:"",exitCode:0}}catch(l){return{stdout:"",stderr:`ln: ${l instanceof Error?l.message:l}
`,exitCode:1}}}},ls={name:"ls",description:"List directory contents",async exec(t,e){const{flags:r,positional:n}=parseArgs(t),c=n.length>0?n:["."],s=r.a,h=r.l,o=r.h,a=[];for(const d of c){const l=e.fs.resolvePath(d,e.cwd),f=await e.fs.stat(l);if(f.type==="file"){a.push(h?formatLong(l.split("/").pop(),f,o):l.split("/").pop());continue}c.length>1&&a.push(`${d}:`);const p=await e.fs.readdir(l),S=s?p:p.filter(k=>!k.name.startsWith("."));if(S.sort((k,A)=>k.name.localeCompare(A.name)),h){a.push(`total ${S.length}`);for(const k of S)a.push(formatLong(k.name,k,o))}else a.push(S.map(k=>k.type==="dir"?k.name+"/":k.name).join("  "))}return{stdout:a.join(`
`)+`
`,stderr:"",exitCode:0}}};function formatLong(t,e,r){const n=e.type==="dir"?"d":"-",c=e.mode??(e.type==="dir"?493:420),s=formatPerms(c),h=r?humanSize(e.size):String(e.size).padStart(8),o=new Date(e.mtime),a=formatDate(o);return`${n}${s}  1 user user ${h} ${a} ${t}`}function formatPerms(t){let r="";for(let n=2;n>=0;n--){const c=t>>n*3&7;for(let s=2;s>=0;s--)r+=c&1<<s?"rwx"[2-s]:"-"}return r}function formatDate(t){const r=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][t.getMonth()],n=String(t.getDate()).padStart(2),c=String(t.getHours()).padStart(2,"0"),s=String(t.getMinutes()).padStart(2,"0");return`${r} ${n} ${c}:${s}`}function humanSize(t){return t<1024?String(t).padStart(5):t<1024*1024?(t/1024).toFixed(1)+"K":(t/(1024*1024)).toFixed(1)+"M"}const make={name:"make",description:"Build automation (basic Makefile support)",async exec(t,e){const{values:r,positional:n,flags:c}=parseArgs(t,["f","file","C","j"]),s=r.f||r.file||"Makefile",h=r.C;r.j;const o=c.n||c["dry-run"],a=c.p||c.print,d=n.length>0?n:["all"];try{const l=h?e.fs.resolvePath(h,e.cwd):e.cwd,f=e.fs.resolvePath(s,l);let p;try{p=await e.fs.readFile(f)}catch{return{stdout:"",stderr:`make: ${s}: No such file or directory
`,exitCode:2}}const S=parseMakefile(p),k=[];for(const A of d){const w=S.get(A);if(!w)return{stdout:"",stderr:`make: *** No rule to make target '${A}'. Stop.
`,exitCode:2};for(const v of w.prerequisites){const g=S.get(v);if(g)for(const m of g.commands)a||o?k.push(m):k.push(`# ${m}`)}for(const v of w.commands)a||o?k.push(v):k.push(`# ${v}`)}return{stdout:k.join(`
`)+(k.length>0?`
`:""),stderr:"",exitCode:0}}catch(l){return{stdout:"",stderr:`make: ${l instanceof Error?l.message:l}
`,exitCode:2}}}};function parseMakefile(t){const e=new Map,r=t.split(`
`);let n=null;for(let c=0;c<r.length;c++){const s=r[c];if(!(s.trim().startsWith("#")||s.trim()===""))if(s.includes(":")&&!s.startsWith("	")){const h=s.indexOf(":"),o=s.substring(0,h).trim(),a=s.substring(h+1).trim(),d=a?a.split(/\s+/):[];n={target:o,prerequisites:d,commands:[]},e.set(o,n)}else s.startsWith("	")&&n&&n.commands.push(s.substring(1))}return e}const md5sum={name:"md5sum",description:"Compute MD5 message digest",async exec(t,e){const{flags:r,positional:n}=parseArgs(t),c=r.c||r.check,s=r.b||r.binary;if(c)return{stdout:"",stderr:`md5sum: --check not implemented in browser environment
`,exitCode:1};const h=n.length>0?n:["-"],o=[];try{for(const a of h){let d;if(a==="-")d=e.stdin;else{const p=e.fs.resolvePath(a,e.cwd);d=await e.fs.readFile(p)}const l=await md5(d),f=s?"*":" ";o.push(`${l}${f}${a==="-"?"-":a}`)}return{stdout:o.join(`
`)+`
`,stderr:"",exitCode:0}}catch(a){return{stdout:"",stderr:`md5sum: ${a instanceof Error?a.message:a}
`,exitCode:1}}}};async function md5(t){let e=0;for(let n=0;n<t.length;n++){const c=t.charCodeAt(n);e=(e<<5)-e+c,e=e&e}return Math.abs(e).toString(16).padStart(32,"0")}const mkdir={name:"mkdir",description:"Make directories",async exec(t,e){const{flags:r,positional:n}=parseArgs(t),c=r.p;if(n.length===0)return{stdout:"",stderr:`mkdir: missing operand
`,exitCode:1};try{for(const s of n){const h=e.fs.resolvePath(s,e.cwd);await e.fs.mkdir(h,{recursive:c})}return{stdout:"",stderr:"",exitCode:0}}catch(s){return{stdout:"",stderr:`mkdir: ${s instanceof Error?s.message:s}
`,exitCode:1}}}},mv={name:"mv",description:"Move or rename files",async exec(t,e){const{positional:r}=parseArgs(t);if(r.length<2)return{stdout:"",stderr:`mv: missing operand
`,exitCode:1};const n=e.fs.resolvePath(r[r.length-1],e.cwd),c=r.slice(0,-1);let s=!1;try{s=(await e.fs.stat(n)).type==="dir"}catch{}if(c.length>1&&!s)return{stdout:"",stderr:`mv: target is not a directory
`,exitCode:1};try{for(const h of c){const o=e.fs.resolvePath(h,e.cwd),a=h.split("/").pop(),d=s?n+"/"+a:n;await e.fs.rename(o,d)}return{stdout:"",stderr:"",exitCode:0}}catch(h){return{stdout:"",stderr:`mv: ${h instanceof Error?h.message:h}
`,exitCode:1}}}},nl={name:"nl",description:"Number lines of files",async exec(t,e){const{values:r,positional:n,flags:c}=parseArgs(t,["b","s","w","n","v"]),s=r.b||"t",h=r.s||"	",o=parseInt(r.w||"6",10),a=r.n||"rn",d=parseInt(r.v||"1",10);c.p;const l=c.ba;try{const{content:f}=await readInput(n,e.stdin,e.fs,e.cwd,e.fs.resolvePath),p=f.split(`
`),S=[];let k=d;for(const A of p){let w=!1;const v=l?"a":s;switch(v){case"a":w=!0;break;case"t":w=A.trim()!=="";break;case"n":w=!1;break;default:if(v.startsWith("p")){const g=v.substring(1);try{w=new RegExp(g).test(A)}catch{w=!1}}}if(w){const g=formatNumber(k,o,a);S.push(g+h+A),k++}else S.push(" ".repeat(o)+h+A)}return{stdout:S.join(`
`)+(f.endsWith(`
`)?`
`:""),stderr:"",exitCode:0}}catch(f){return{stdout:"",stderr:`nl: ${f instanceof Error?f.message:f}
`,exitCode:1}}}};function formatNumber(t,e,r){const n=String(t);switch(r){case"ln":return n.padEnd(e," ");case"rn":return n.padStart(e," ");case"rz":return n.padStart(e,"0");default:return n.padStart(e," ")}}const nohup={name:"nohup",description:"Run a command immune to hangups",async exec(t,e){if(t.length===0)return{stdout:"",stderr:`nohup: missing operand
Try 'nohup --help' for more information.
`,exitCode:125};const r=t[0],n=t.slice(1),c=`nohup: ignoring input and appending output to 'nohup.out'
`;try{const s=e.fs.resolvePath("nohup.out",e.cwd),o=`[${new Date().toISOString()}] Command: ${r} ${n.join(" ")}
`;let a="";try{a=await e.fs.readFile(s)}catch{}await e.fs.writeFile(s,a+o)}catch(s){return{stdout:"",stderr:`nohup: cannot create nohup.out: ${s.message}
`,exitCode:125}}return{stdout:"",stderr:c,exitCode:0}}},od={name:"od",description:"Dump files in octal and other formats",async exec(t,e){const{values:r,positional:n,flags:c}=parseArgs(t,["t","N","j","w","A"]),s=r.t||"o2",h=r.N?parseInt(r.N):void 0,o=r.j?parseInt(r.j):0,a=r.w?parseInt(r.w):16,d=r.A||"o",l=c.b||c.c||c.d||c.o||c.s||c.x;try{const{content:f}=await readInput(n,e.stdin,e.fs,e.cwd,e.fs.resolvePath);let p=f.substring(o,h?o+h:void 0);const S=[];let k="o",A=2;l?c.b?(k="o",A=1):c.c?(k="c",A=1):c.d||c.s?(k="d",A=2):c.o?(k="o",A=2):c.x&&(k="x",A=2):s&&(k=s[0]||"o",A=parseInt(s.substring(1))||2);let w=o;for(let v=0;v<p.length;v+=a){const g=p.substring(v,v+a),m=formatAddress(w,d),$=formatChunk(g,k,A);S.push(`${m} ${$}`),w+=g.length}return d!=="n"&&S.push(formatAddress(w,d)),{stdout:S.join(`
`)+`
`,stderr:"",exitCode:0}}catch(f){return{stdout:"",stderr:`od: ${f instanceof Error?f.message:f}
`,exitCode:1}}}};function formatAddress(t,e){switch(e){case"o":return t.toString(8).padStart(7,"0");case"d":return t.toString(10).padStart(7," ");case"x":return t.toString(16).padStart(7,"0");case"n":return"";default:return t.toString(8).padStart(7,"0")}}function formatChunk(t,e,r){const n=[];for(let c=0;c<t.length;c+=r){const s=t.substring(c,c+r);let h=0;for(let o=0;o<s.length;o++)h=h<<8|s.charCodeAt(o);switch(e){case"o":n.push(h.toString(8).padStart(r*3,"0"));break;case"x":n.push(h.toString(16).padStart(r*2,"0"));break;case"d":n.push(h.toString(10).padStart(r*3," "));break;case"c":n.push(formatChar(s.charCodeAt(0)));break;case"a":n.push(namedChar(s.charCodeAt(0)));break;default:n.push(h.toString(8).padStart(r*3,"0"))}}return n.join(" ")}function formatChar(t){return t>=32&&t<127?`  ${String.fromCharCode(t)}`:t===0?" \\0":t===7?" \\a":t===8?" \\b":t===9?" \\t":t===10?" \\n":t===11?" \\v":t===12?" \\f":t===13?" \\r":t.toString(8).padStart(3,"0")}function namedChar(t){return{0:"nul",7:"bel",8:"bs",9:"ht",10:"nl",11:"vt",12:"ff",13:"cr",32:"sp",127:"del"}[t]||String.fromCharCode(t)}const paste={name:"paste",description:"Merge lines of files",async exec(t,e){const{values:r,positional:n,flags:c}=parseArgs(t,["d","delimiters"]),s=r.d||r.delimiters||"	",h=c.s;n.length===0&&n.push("-");try{const o=[];for(const d of n){let l;if(d==="-")l=e.stdin;else{const f=e.fs.resolvePath(d,e.cwd);l=await e.fs.readFile(f)}o.push(l.split(`
`).filter((f,p,S)=>p<S.length-1||f!==""))}const a=[];if(h)for(const d of o){const l=s.split(""),f=[];for(let p=0;p<d.length;p++)f.push(d[p]),p<d.length-1&&f.push(l[p%l.length]);a.push(f.join(""))}else{const d=Math.max(...o.map(f=>f.length)),l=s.split("");for(let f=0;f<d;f++){const p=[];for(let S=0;S<o.length;S++){const k=o[S][f]||"";p.push(k),S<o.length-1&&p.push(l[S%l.length])}a.push(p.join(""))}}return{stdout:a.join(`
`)+(a.length>0?`
`:""),stderr:"",exitCode:0}}catch(o){return{stdout:"",stderr:`paste: ${o instanceof Error?o.message:o}
`,exitCode:1}}}},patch={name:"patch",description:"Apply a diff file to an original",async exec(t,e){const{values:r,positional:n,flags:c}=parseArgs(t,["p","i","input","o","output"]),s=r.p?parseInt(r.p):0,h=r.i||r.input,o=r.o||r.output,a=c.R||c.reverse,d=c["dry-run"];try{let l;if(h){const S=e.fs.resolvePath(h,e.cwd);l=await e.fs.readFile(S)}else if(n.length>0){const S=e.fs.resolvePath(n[0],e.cwd);l=await e.fs.readFile(S)}else l=e.stdin;const f=parseUnifiedDiff(l),p=[];for(const S of f){const k=stripPath(S.newFile,s),A=stripPath(S.oldFile,s);if(p.push(`patching file ${k}`),!d){let w;try{const g=e.fs.resolvePath(k,e.cwd);w=await e.fs.readFile(g)}catch{w=""}const v=applyPatch(w,S.hunks,a);if(o){const g=e.fs.resolvePath(o,e.cwd);await e.fs.writeFile(g,v)}else{const g=e.fs.resolvePath(k,e.cwd);await e.fs.writeFile(g,v)}}}return{stdout:p.join(`
`)+(p.length>0?`
`:""),stderr:"",exitCode:0}}catch(l){return{stdout:"",stderr:`patch: ${l instanceof Error?l.message:l}
`,exitCode:1}}}};function parseUnifiedDiff(t){const e=[],r=t.split(`
`);let n=null,c=null;for(const s of r)if(s.startsWith("--- "))n={oldFile:s.substring(4).split("	")[0],newFile:"",hunks:[]};else if(s.startsWith("+++ ")&&n)n.newFile=s.substring(4).split("	")[0],e.push(n);else if(s.startsWith("@@ ")&&n){const h=s.match(/@@ -(\d+),(\d+) \+(\d+),(\d+) @@/);h&&(c={oldStart:parseInt(h[1]),oldLines:parseInt(h[2]),newStart:parseInt(h[3]),newLines:parseInt(h[4]),lines:[]},n.hunks.push(c))}else c&&(s.startsWith(" ")||s.startsWith("+")||s.startsWith("-"))&&c.lines.push(s);return e}function stripPath(t,e){return t.split("/").slice(e).join("/")}function applyPatch(t,e,r){const n=t.split(`
`);for(const c of e){const s=c.oldStart-1,h=c.oldLines,o=[];for(const a of c.lines){const d=a[0],l=a.substring(1);if(r){if(d==="+")continue;o.push(l)}else(d==="+"||d===" ")&&o.push(l)}n.splice(s,h,...o)}return n.join(`
`)}const pkgConfig={name:"pkg-config",description:"Return metainformation about installed libraries",async exec(t,e){const{flags:r,positional:n}=parseArgs(t,["cflags","libs","modversion","version","exists","atleast-version","exact-version","max-version","list-all","print-errors","short-errors","silence-errors","static","print-provides","print-requires"]);if(r.version)return{stdout:`0.29.2
`,stderr:"",exitCode:0};if(r["list-all"])return{stdout:["zlib                    zlib - zlib compression library","openssl                 OpenSSL - Secure Sockets Layer toolkit","libcurl                 libcurl - Library for transferring data"].join(`
`)+`
`,stderr:"",exitCode:0};if(n.length===0)return{stdout:"",stderr:`pkg-config: Must specify package names on the command line
`,exitCode:1};const c=n[0];if(r.exists)return{stdout:"",stderr:"",exitCode:0};if(r.modversion)return{stdout:({zlib:"1.2.11",openssl:"1.1.1",libcurl:"7.68.0",sqlite3:"3.31.1",libpng:"1.6.37",libjpeg:"9c","libxml-2.0":"2.9.10","glib-2.0":"2.64.0"}[c]||"1.0.0")+`
`,stderr:"",exitCode:0};if(r.cflags){const h={zlib:"-I/usr/include",openssl:"-I/usr/include/openssl",libcurl:"-I/usr/include/curl",sqlite3:"-I/usr/include","glib-2.0":"-I/usr/include/glib-2.0 -I/usr/lib/glib-2.0/include"}[c]||"";return{stdout:h?h+`
`:`
`,stderr:"",exitCode:0}}if(r.libs){const h={zlib:"-lz",openssl:"-lssl -lcrypto",libcurl:"-lcurl",sqlite3:"-lsqlite3",libpng:"-lpng",libjpeg:"-ljpeg","libxml-2.0":"-lxml2","glib-2.0":"-lglib-2.0"}[c]||"";return{stdout:h?h+`
`:`
`,stderr:"",exitCode:0}}return r["print-provides"]?{stdout:`${c} = 1.0.0
`,stderr:"",exitCode:0}:r["print-requires"]?{stdout:"",stderr:"",exitCode:0}:{stdout:"",stderr:`pkg-config: Must specify at least one option (--cflags, --libs, --modversion, etc.)
`,exitCode:1}}},pr={name:"pr",description:"Convert text files for printing with headers and page breaks",async exec(t,e){const{flags:r,positional:n,values:c}=parseArgs(t,["h","header","l","length","w","width","t","omit-header","d","double-space","n","number-lines","m","merge","s","separator","a","across","columns"]),s=c.h||c.header||"",h=parseInt(c.l||c.length||"66"),o=parseInt(c.w||c.width||"72"),a=r.t||r["omit-header"],d=r.d||r["double-space"],l=r.n||r["number-lines"],f=r.m||r.merge,p=c.s||c.separator||"	",S=r.a||r.across,k=parseInt(c.columns||"1"),A=n.length>0?n:["-"];let w="";for(const v of A){let g;try{if(v==="-")g=e.stdin;else{const Q=e.fs.resolvePath(v,e.cwd);g=await e.fs.readFile(Q)}}catch(Q){return{stdout:"",stderr:`pr: ${v}: ${Q instanceof Error?Q.message:String(Q)}
`,exitCode:1}}const m=g.split(`
`),$=v==="-"?"":v,I=new Date().toISOString().split("T")[0],B=s||$,P=a?[]:["","",`${I}  ${B}  Page 1`,"",""];let x=[...m];d&&(x=x.flatMap(Q=>[Q,""])),l&&(x=x.map((Q,W)=>`${(W+1).toString().padStart(6," ")}  ${Q}`)),k>1?x=formatColumns(x,k,o,p,S):f&&A.length>1;const N=h-P.length-5,J=[];for(let Q=0;Q<x.length;Q+=N)J.push(x.slice(Q,Q+N));for(let Q=0;Q<J.length;Q++){if(!a){const W=`${I}  ${B}  Page ${Q+1}`;w+=`

`+W+`


`}w+=J[Q].join(`
`)+`
`}}return{stdout:w,stderr:"",exitCode:0}}};function formatColumns(t,e,r,n,c){const s=Math.floor((r-(e-1)*n.length)/e),h=[];if(c)for(let o=0;o<t.length;o+=e){const d=t.slice(o,o+e).map(l=>l.padEnd(s).slice(0,s));h.push(d.join(n))}else{const o=Math.ceil(t.length/e);for(let a=0;a<o;a++){const d=[];for(let l=0;l<e;l++){const f=l*o+a,p=f<t.length?t[f]:"";d.push(p.padEnd(s).slice(0,s))}h.push(d.join(n))}}return h}const printenv={name:"printenv",description:"Print all or part of environment",async exec(t,e){const{positional:r,flags:n}=parseArgs(t),c=n[0]||n.null;if(r.length===0){const s=[];for(const[o,a]of Object.entries(e.env))s.push(`${o}=${a}`);const h=c?"\0":`
`;return{stdout:s.join(h)+(s.length>0?h:""),stderr:"",exitCode:0}}else{const s=[];for(const o of r)if(o in e.env)s.push(e.env[o]);else return{stdout:"",stderr:"",exitCode:1};const h=c?"\0":`
`;return{stdout:s.join(h)+(s.length>0?h:""),stderr:"",exitCode:0}}}},printf={name:"printf",description:"Format and print data",async exec(t){if(t.length===0)return{stdout:"",stderr:"",exitCode:0};const e=t[0],r=t.slice(1);let n=0,c="",s=0;for(;s<e.length;)if(e[s]==="\\"){switch(s++,e[s]){case"n":c+=`
`;break;case"t":c+="	";break;case"\\":c+="\\";break;case'"':c+='"';break;default:c+="\\"+(e[s]??"");break}s++}else if(e[s]==="%")if(s++,e[s]==="%")c+="%",s++;else{let h="";for(;s<e.length&&!/[sdf]/.test(e[s]);)h+=e[s],s++;const o=e[s]??"s";s++;const a=r[n++]??"";switch(o){case"s":c+=a;break;case"d":c+=String(parseInt(a,10)||0);break;case"f":{const d=h.includes(".")?parseInt(h.split(".")[1],10):6;c+=(parseFloat(a)||0).toFixed(d);break}}}else c+=e[s],s++;return{stdout:c,stderr:"",exitCode:0}}},processSubstitution={name:"process-substitution",description:"Helper for process substitution (shell feature)",async exec(t,e){return{stdout:`process-substitution: This is a shell language feature, not a command.

Process substitution must be implemented at the shell parser level:

Syntax:
  <(command)  # Input substitution - command output as input file
  >(command)  # Output substitution - command input as output file

Input Substitution <(command):
  diff <(sort file1.txt) <(sort file2.txt)

  Shell implementation:
  1. Execute "sort file1.txt" in subshell
  2. Capture output to temporary file or named pipe
  3. Replace <(sort file1.txt) with the temp file path
  4. Run: diff /tmp/subst123 /tmp/subst124
  5. Clean up temp files after diff completes

Output Substitution >(command):
  echo "data" | tee >(process1) >(process2) > output.txt

  Shell implementation:
  1. Create named pipes or temporary files
  2. Start "process1" and "process2" in background reading from pipes
  3. Replace >(process1) with pipe paths
  4. Connect tee output to the pipes
  5. Wait for processes and clean up

Common Use Cases:
  # Compare outputs of two commands
  diff <(ls dir1) <(ls dir2)

  # Multiple outputs
  command | tee >(grep error > errors.log) >(grep warning > warnings.log)

  # Input from multiple sources
  paste <(cut -f1 file1) <(cut -f2 file2)

  # Avoid temporary files
  while read line; do
    echo "$line"
  done < <(find . -type f)

Implementation Steps for Shells:
1. Lexer: Recognize <( and >( as special tokens
2. Parser: Extract command from parentheses
3. Executor:
   a. For <(cmd):
      - Execute cmd, capture stdout
      - Write to temp file (or create named pipe)
      - Return path to temp file
   b. For >(cmd):
      - Create named pipe or temp file
      - Start cmd with stdin from the pipe
      - Return path to the pipe
4. Substitution: Replace in command line with file path
5. Cleanup: Remove temp files/pipes after main command exits

Browser Implementation Notes:
- Named pipes (FIFOs) aren't available in browser
- Use temporary files in virtual filesystem
- For >(cmd), write to temp file then pass to command
- Ensure proper ordering of operations

Example Pseudo-code:
  if (token matches /<\\((.+)\\)/) {
    const cmd = extractCommand(token);
    const output = await executeCommand(cmd);
    const tempPath = createTempFile(output);
    replaceToken(token, tempPath);
    scheduleCleanup(tempPath);
  }

Shell implementers: Parse at lexer/parser level, execute before main command.

`,stderr:"",exitCode:0}}},pwd={name:"pwd",description:"Print working directory",async exec(t,e){return{stdout:e.cwd+`
`,stderr:"",exitCode:0}}},read={name:"read",description:"Read a line from stdin into variables",async exec(t,e){const{positional:r,flags:n,values:c}=parseArgs(t,["r","p","n","t","d","a","s"]);let s=e.stdin||"";c.p;const h=c.d||`
`,o=c.n?parseInt(c.n):void 0;let a;if(o!==void 0)a=s.slice(0,o);else{const d=s.indexOf(h);d>=0?a=s.slice(0,d):a=s}if(n.r||(a=a.replace(/\\n/g,`
`).replace(/\\t/g,"	").replace(/\\\\/g,"\\")),r.length===0)e.env&&(e.env.REPLY=a);else if(r.length===1)e.env&&(e.env[r[0]]=a);else{const d=e.env?.IFS||` 	
`,l=new RegExp(`[${d.replace(/[-\\^$*+?.()|[\]{}]/g,"\\$&")}]+`),f=a.split(l).filter(p=>p);for(let p=0;p<r.length;p++){const S=r[p];p<r.length-1?e.env&&(e.env[S]=f[p]||""):e.env&&(e.env[S]=f.slice(p).join(" "))}}return{stdout:"",stderr:"",exitCode:0}}},readlink={name:"readlink",description:"Print resolved symbolic links or canonical file names",async exec(t,e){const{flags:r,positional:n}=parseArgs(t),c=r.f;if(n.length===0)return{stdout:"",stderr:`readlink: missing operand
`,exitCode:1};const s=e.fs.resolvePath(n[0],e.cwd);return c?{stdout:s+`
`,stderr:"",exitCode:0}:{stdout:s+`
`,stderr:"",exitCode:0}}},realpath={name:"realpath",description:"Print the resolved absolute path",async exec(t,e){const{flags:r,positional:n}=parseArgs(t);if(n.length===0)return{stdout:"",stderr:`realpath: missing operand
`,exitCode:1};const c=r.q||r.quiet,s=!r.s;r.s;const h=[],o=[];for(const l of n)try{let f=e.fs.resolvePath(l,e.cwd);if(s){const p=f.split("/").filter(k=>k!==""&&k!=="."),S=[];for(const k of p)k===".."?S.length>0&&S.pop():S.push(k);f="/"+S.join("/")}await e.fs.exists(f)?h.push(f):c||o.push(`realpath: ${l}: No such file or directory`)}catch(f){c||o.push(`realpath: ${l}: ${f instanceof Error?f.message:f}`)}const a=o.length>0?o.join(`
`)+`
`:"",d=o.length>0?1:0;return{stdout:h.join(`
`)+(h.length>0?`
`:""),stderr:a,exitCode:d}}},returnCmd={name:"return",description:"Return from a shell function",async exec(t,e){const{positional:r}=parseArgs(t),n=r.length>0?parseInt(r[0]):0;return{stdout:"",stderr:"",exitCode:isNaN(n)?2:n}}},rm={name:"rm",description:"Remove files or directories",async exec(t,e){const{flags:r,positional:n}=parseArgs(t),c=r.r||r.R,s=r.f;if(n.length===0&&!s)return{stdout:"",stderr:`rm: missing operand
`,exitCode:1};async function h(o){const a=await e.fs.readdir(o);for(const d of a){const l=o+"/"+d.name;d.type==="dir"?await h(l):await e.fs.unlink(l)}await e.fs.rmdir(o)}try{for(const o of n){const a=e.fs.resolvePath(o,e.cwd);let d;try{d=await e.fs.stat(a)}catch{if(s)continue;return{stdout:"",stderr:`rm: cannot remove '${o}': No such file or directory
`,exitCode:1}}if(d.type==="dir"){if(!c)return{stdout:"",stderr:`rm: cannot remove '${o}': Is a directory
`,exitCode:1};await h(a)}else await e.fs.unlink(a)}return{stdout:"",stderr:"",exitCode:0}}catch(o){return s?{stdout:"",stderr:"",exitCode:0}:{stdout:"",stderr:`rm: ${o instanceof Error?o.message:o}
`,exitCode:1}}}},sed={name:"sed",description:"Stream editor for filtering and transforming text",async exec(t,e){const{flags:r,positional:n}=parseArgs(t),c=r.i,s=n.shift();if(!s)return{stdout:"",stderr:`sed: no expression provided
`,exitCode:1};const h=s.match(/^s(.)(.+?)\1(.*?)\1([gi]*)$/);if(!h)return{stdout:"",stderr:`sed: unsupported expression: ${s}
`,exitCode:1};const[,,o,a,d]=h,l=d.includes("g"),f=d.includes("i");let p;try{const S=(l?"g":"")+(f?"i":"");p=new RegExp(o,S)}catch{return{stdout:"",stderr:`sed: invalid regex: ${o}
`,exitCode:2}}try{const{content:S,files:k}=await readInput(n,e.stdin,e.fs,e.cwd,e.fs.resolvePath),A=S.split(`
`).map(w=>w.replace(p,a)).join(`
`);if(c&&k.length>0){for(const w of k){const v=e.fs.resolvePath(w,e.cwd),m=(await e.fs.readFile(v)).split(`
`).map($=>$.replace(p,a)).join(`
`);await e.fs.writeFile(v,m)}return{stdout:"",stderr:"",exitCode:0}}return{stdout:A,stderr:"",exitCode:0}}catch(S){return{stdout:"",stderr:`sed: ${S instanceof Error?S.message:S}
`,exitCode:1}}}},seq={name:"seq",description:"Generate sequences of numbers",async exec(t,e){const{flags:r,values:n,positional:c}=parseArgs(t,["separator","s","format","f"]);if(c.length===0)return{stdout:"",stderr:`seq: missing operand
`,exitCode:1};let s=1,h=1,o;if(c.length===1?o=parseFloat(c[0]):c.length===2?(s=parseFloat(c[0]),o=parseFloat(c[1])):c.length>=3?(s=parseFloat(c[0]),h=parseFloat(c[1]),o=parseFloat(c[2])):o=1,isNaN(s)||isNaN(h)||isNaN(o))return{stdout:"",stderr:`seq: invalid number
`,exitCode:1};if(h===0)return{stdout:"",stderr:`seq: increment must not be 0
`,exitCode:1};const a=n.s||n.separator||`
`,d=n.f||n.format,l=r.w,f=[];if(h>0)for(let k=s;k<=o;k+=h)f.push(String(k));else for(let k=s;k>=o;k+=h)f.push(String(k));if(l){const k=Math.max(...f.map(A=>A.length));for(let A=0;A<f.length;A++)f[A]=f[A].padStart(k,"0")}if(d&&typeof d=="string")for(let k=0;k<f.length;k++){const A=parseFloat(f[k]);d.includes("%g")||d.includes("%d")||d.includes("%i")?f[k]=d.replace(/%[gdi]/,String(A)):d.includes("%f")?f[k]=d.replace(/%f/,A.toFixed(6)):d.includes("%e")&&(f[k]=d.replace(/%e/,A.toExponential()))}return{stdout:f.join(a)+((typeof a=="string"?a:`
`)===`
`?`
`:""),stderr:"",exitCode:0}}},set={name:"set",description:"Set or unset shell options and positional parameters",async exec(t,e){const{flags:r,values:n,positional:c}=parseArgs(t,["e","u","x","v","n","o"]);if(t.length===0){const s=Object.entries(e.env||{}).map(([h,o])=>`${h}=${o}`).join(`
`);return{stdout:s?s+`
`:"",stderr:"",exitCode:0}}if(r.o||n.o){const s=n.o||c[0],h=["pipefail","errexit","nounset","xtrace","verbose","noclobber","noglob","ignoreeof","monitor","posix"];return s?h.includes(s)?{stdout:"",stderr:"",exitCode:0}:{stdout:"",stderr:`set: ${s}: invalid option name
`,exitCode:1}:{stdout:h.map(o=>`${o}		off`).join(`
`)+`
`,stderr:"",exitCode:0}}return r.e,r.u,r.x,r.v,r.n,{stdout:"",stderr:"",exitCode:0}}},sha256sum={name:"sha256sum",description:"Compute SHA256 message digest",async exec(t,e){const{flags:r,positional:n}=parseArgs(t),c=r.c||r.check,s=r.b||r.binary;if(c)return{stdout:"",stderr:`sha256sum: --check not implemented in browser environment
`,exitCode:1};const h=n.length>0?n:["-"],o=[];try{for(const a of h){let d;if(a==="-")d=e.stdin;else{const p=e.fs.resolvePath(a,e.cwd);d=await e.fs.readFile(p)}const l=await sha256(d),f=s?"*":" ";o.push(`${l}${f}${a==="-"?"-":a}`)}return{stdout:o.join(`
`)+`
`,stderr:"",exitCode:0}}catch(a){return{stdout:"",stderr:`sha256sum: ${a instanceof Error?a.message:a}
`,exitCode:1}}}};async function sha256(t){const e=globalThis;if(typeof e.crypto<"u"&&e.crypto.subtle){const c=new e.TextEncoder().encode(t),s=await e.crypto.subtle.digest("SHA-256",c);return Array.from(new e.Uint8Array(s)).map(a=>a.toString(16).padStart(2,"0")).join("")}let r=0;for(let n=0;n<t.length;n++){const c=t.charCodeAt(n);r=(r<<5)-r+c,r=r&r}return Math.abs(r).toString(16).padStart(64,"0")}const shift={name:"shift",description:"Shift positional parameters",async exec(t,e){const{positional:r}=parseArgs(t),n=r.length>0?parseInt(r[0]):1;return isNaN(n)||n<0?{stdout:"",stderr:`shift: numeric argument required
`,exitCode:1}:{stdout:"",stderr:"",exitCode:0}}},PASSAGES=["The Lord is my shepherd; I shall not want.","Be still and know that I am God.","Ask and it shall be given unto you.","I am the way, the truth, and the life.","Let there be light.","In the beginning was the Word.","Faith can move mountains.","The truth shall set you free.","Love thy neighbor as thyself.","Seek and ye shall find.","Blessed are the pure in heart.","I have called you by name; you are mine.","Fear not, for I am with you.","Come unto me, all ye that labor.","Behold, I stand at the door and knock.","The heavens declare the glory of God.","Thou shalt have no other gods before me.","For God so loved the world.","Be strong and of good courage.","My grace is sufficient for thee."],RESET="\x1B[0m",BOLD="\x1B[1m",DIM="\x1B[2m",YELLOW="\x1B[33m",CYAN="\x1B[36m",WHITE="\x1B[97m",MAGENTA="\x1B[35m",RED="\x1B[31m",GOLD="\x1B[93m";function getRandomPassage(){return PASSAGES[Math.floor(Math.random()*PASSAGES.length)]}function visibleLength(t){return t.replace(/\x1b\[[0-9;]*m/g,"").length}function padCenter(t,e){const r=visibleLength(t),n=e-r,c=Math.floor(n/2),s=n-c;return" ".repeat(Math.max(0,c))+t+" ".repeat(Math.max(0,s))}function wrapText(t,e){const r=t.split(" "),n=[];let c="";for(const s of r)c.length+s.length+1<=e?c+=(c?" ":"")+s:(c&&n.push(c),c=s);return c&&n.push(c),n}const shrine={name:"shrine",description:"A tribute to Terry A. Davis, creator of TempleOS (1969-2018)",async exec(){const t=getRandomPassage(),e=40,r=wrapText(t,e-4),n=[];n.push(`${GOLD}                        ${RESET}`),n.push(`${GOLD}                       ${RESET}`),n.push(`${GOLD}                        ${RESET}`),n.push(`${GOLD}    ${RESET}`),n.push(`${GOLD}    ${CYAN}${GOLD}${YELLOW}      ${GOLD}${CYAN}${GOLD}${RESET}`),n.push(`${GOLD}    ${RESET}`),n.push(`${GOLD}    ${RESET}${padCenter(`${BOLD}${WHITE}  TERRY A. DAVIS  ${RESET}`,e)}${GOLD}${RESET}`),n.push(`${GOLD}    ${RESET}${padCenter(`${DIM}December 15, 1969  August 11, 2018${RESET}`,e)}${GOLD}${RESET}`),n.push(`${GOLD}    ${RESET}`),n.push(`${GOLD}    ${RESET}${padCenter(`${RED})  (  (${RESET}`,e)}${GOLD}${RESET}`),n.push(`${GOLD}    ${RESET}${padCenter(`${YELLOW}(  )  )  )${RESET}`,e)}${GOLD}${RESET}`),n.push(`${GOLD}    ${RESET}${padCenter(`${RED}) (  (  ) (${RESET}`,e)}${GOLD}${RESET}`),n.push(`${GOLD}    ${RESET}${padCenter(`${MAGENTA}\\\\//${RESET}`,e)}${GOLD}${RESET}`),n.push(`${GOLD}    ${RESET}`),n.push(`${GOLD}    ${RESET}${padCenter(`${DIM}~ God Says ~${RESET}`,e)}${GOLD}${RESET}`),n.push(`${GOLD}    ${RESET}${" ".repeat(e)}${GOLD}${RESET}`);for(const c of r)n.push(`${GOLD}    ${RESET}${padCenter(`${CYAN}${c}${RESET}`,e)}${GOLD}${RESET}`);return n.push(`${GOLD}    ${RESET}${" ".repeat(e)}${GOLD}${RESET}`),n.push(`${GOLD}    ${RESET}`),n.push(`${GOLD}    ${RESET}${padCenter(`${DIM}Creator of TempleOS${RESET}`,e)}${GOLD}${RESET}`),n.push(`${GOLD}    ${RESET}${padCenter(`${DIM}640x480  16 Colors  HolyC${RESET}`,e)}${GOLD}${RESET}`),n.push(`${GOLD}    ${RESET}${padCenter(`${DIM}"God's Third Temple"${RESET}`,e)}${GOLD}${RESET}`),n.push(`${GOLD}    ${RESET}`),n.push(`${GOLD}    ${RESET}${" ".repeat(e)}${GOLD}${RESET}`),n.push(`${GOLD}    ${RESET}${padCenter(`${BOLD}${WHITE} REST IN PEACE ${RESET}`,e)}${GOLD}${RESET}`),n.push(`${GOLD}    ${RESET}${padCenter(`${CYAN}Programmer  Prophet  Pioneer${RESET}`,e)}${GOLD}${RESET}`),n.push(`${GOLD}    ${RESET}${" ".repeat(e)}${GOLD}${RESET}`),n.push(`${GOLD}    ${RESET}`),n.push(`${GOLD}         ${RESET}`),n.push(`${DIM}             Run again for new passage ${RESET}`),n.push(""),{stdout:n.join(`
`),stderr:"",exitCode:0}}},sleep={name:"sleep",description:"Delay for a specified amount of time",async exec(t,e){const{positional:r}=parseArgs(t);if(r.length===0)return{stdout:"",stderr:`sleep: missing operand
`,exitCode:1};const n=r[0];let c=0;const s=n.match(/^(\d+(?:\.\d+)?)(s|m|h|d)?$/);if(!s)return{stdout:"",stderr:`sleep: invalid time interval '${n}'
`,exitCode:1};const h=parseFloat(s[1]);switch(s[2]||"s"){case"s":c=h;break;case"m":c=h*60;break;case"h":c=h*3600;break;case"d":c=h*86400;break}return await new Promise(a=>globalThis.setTimeout(a,c*1e3)),{stdout:"",stderr:"",exitCode:0}}},sort={name:"sort",description:"Sort lines of text",async exec(t,e){const{flags:r,positional:n}=parseArgs(t);try{const{content:c}=await readInput(n,e.stdin,e.fs,e.cwd,e.fs.resolvePath);let s=c.split(`
`).filter(Boolean);return r.n?s.sort((h,o)=>parseFloat(h)-parseFloat(o)):s.sort(),r.u&&(s=[...new Set(s)]),r.r&&s.reverse(),{stdout:s.join(`
`)+`
`,stderr:"",exitCode:0}}catch(c){return{stdout:"",stderr:`sort: ${c instanceof Error?c.message:c}
`,exitCode:1}}}},source={name:"source",description:"Execute commands from a file in the current shell",async exec(t,e){const{positional:r}=parseArgs(t);if(r.length===0)return{stdout:"",stderr:`source: filename argument required
`,exitCode:1};const n=r[0];try{const c=e.fs.resolvePath(n,e.cwd),s=await e.fs.readFile(c);return{stdout:"",stderr:"",exitCode:0}}catch(c){return{stdout:"",stderr:`source: ${n}: ${c instanceof Error?c.message:c}
`,exitCode:1}}}},dot={name:".",description:"Execute commands from a file in the current shell (alias for source)",async exec(t,e){return source.exec(t,e)}},stat={name:"stat",description:"Display file status",async exec(t,e){const{positional:r,flags:n,values:c}=parseArgs(t,["c","format"]);if(r.length===0)return{stdout:"",stderr:`stat: missing operand
`,exitCode:1};const s=c.c||c.format,h=n.t;n.f;const o=[];try{for(const a of r){const d=e.fs.resolvePath(a,e.cwd);try{const l=await e.fs.stat(d);if(s){const f=formatStat(a,l,s);o.push(f)}else if(h)o.push(`${a} ${l.size} 0 ${l.mode} 0 0 0 0 0 0 ${l.mtime}`);else{const f=l.type==="dir"?"directory":"regular file",p=formatMode(l.mode),S=new Date(l.mtime).toISOString();o.push(`  File: ${a}`),o.push(`  Size: ${l.size}	Blocks: 0	IO Block: 4096	${f}`),o.push("Device: 0	Inode: 0	Links: 1"),o.push(`Access: (${p})	Uid: (0/root)	Gid: (0/root)`),o.push(`Access: ${S}`),o.push(`Modify: ${S}`),o.push(`Change: ${S}`)}}catch(l){o.push(`stat: cannot stat '${a}': ${l instanceof Error?l.message:l}`)}}return{stdout:o.join(`
`)+(o.length>0?`
`:""),stderr:"",exitCode:0}}catch(a){return{stdout:"",stderr:`stat: ${a instanceof Error?a.message:a}
`,exitCode:1}}}};function formatMode(t){const e=[t&256?"r":"-",t&128?"w":"-",t&64?"x":"-",t&32?"r":"-",t&16?"w":"-",t&8?"x":"-",t&4?"r":"-",t&2?"w":"-",t&1?"x":"-"].join("");return`0${t.toString(8)}/${e}`}function formatStat(t,e,r){return r.replace(/%n/g,t).replace(/%N/g,`'${t}'`).replace(/%s/g,String(e.size)).replace(/%b/g,"0").replace(/%f/g,e.mode.toString(16)).replace(/%a/g,e.mode.toString(8)).replace(/%A/g,formatMode(e.mode).split("/")[1]).replace(/%F/g,e.type==="dir"?"directory":"regular file").replace(/%u/g,"0").replace(/%g/g,"0").replace(/%U/g,"root").replace(/%G/g,"root").replace(/%i/g,"0").replace(/%h/g,"1").replace(/%W/g,String(Math.floor(e.mtime/1e3))).replace(/%X/g,String(Math.floor(e.mtime/1e3))).replace(/%Y/g,String(Math.floor(e.mtime/1e3))).replace(/%y/g,new Date(e.mtime).toISOString()).replace(/%%/g,"%")}const strings={name:"strings",description:"Find printable strings in files",async exec(t,e){const{values:r,positional:n,flags:c}=parseArgs(t,["n","bytes"]),s=parseInt(r.n||r.bytes||"4",10),h=c.f;c.a;try{const o=n.length>0?n:["-"],a=[];for(const d of o){let l,f=d;if(d==="-")l=e.stdin,f="(standard input)";else{const S=e.fs.resolvePath(d,e.cwd);l=await e.fs.readFile(S)}const p=extractStrings(l,s);for(const S of p)h?a.push(`${f}: ${S}`):a.push(S)}return{stdout:a.join(`
`)+(a.length>0?`
`:""),stderr:"",exitCode:0}}catch(o){return{stdout:"",stderr:`strings: ${o instanceof Error?o.message:o}
`,exitCode:1}}}};function extractStrings(t,e){const r=[],n=/[ -~]/;let c="";for(let s=0;s<t.length;s++){const h=t[s];n.test(h)?c+=h:(c.length>=e&&r.push(c),c="")}return c.length>=e&&r.push(c),r}const tail={name:"tail",description:"Output the last part of files",async exec(t,e){const r=t.flatMap(h=>{const o=h.match(/^-(\d+)$/);return o?["-n",o[1]]:[h]}),{values:n,positional:c}=parseArgs(r,["n"]),s=parseInt(n.n??"10",10);try{const{content:h}=await readInput(c,e.stdin,e.fs,e.cwd,e.fs.resolvePath);return{stdout:h.split(`
`).slice(-s).join(`
`)+`
`,stderr:"",exitCode:0}}catch(h){return{stdout:"",stderr:`tail: ${h instanceof Error?h.message:h}
`,exitCode:1}}}},tar={name:"tar",description:"Archive utility (simplified tar format)",async exec(t,e){const{flags:r,values:n,positional:c}=parseArgs(t,["f","C"]),s=r.c||r.create,h=r.x||r.extract,o=r.t||r.list,a=r.v||r.verbose,d=n.f,l=n.C;let f=e.cwd;l&&(f=e.fs.resolvePath(l,e.cwd));const p=[s,h,o].filter(Boolean).length;if(p===0)return{stdout:"",stderr:`tar: You must specify one of -c, -x, or -t
`,exitCode:1};if(p>1)return{stdout:"",stderr:`tar: You may not specify more than one -c, -x, or -t
`,exitCode:1};try{if(s){if(!d)return{stdout:"",stderr:`tar: Refusing to write archive to terminal (missing -f option?)
`,exitCode:1};const S=c;if(S.length===0)return{stdout:"",stderr:`tar: Cowardly refusing to create an empty archive
`,exitCode:1};const k=[];async function A(m,$){const I=e.fs.resolvePath(m,f);if((await e.fs.stat(I)).type==="dir"){k.push({path:$+"/",content:"",isDir:!0});const P=await e.fs.readdir(I);for(const x of P)await A(I+"/"+x.name,$+"/"+x.name)}else{const P=await e.fs.readFile(I);k.push({path:$,content:P,isDir:!1})}}for(const m of S)await A(m,m);const w=["FLUFFY-TAR-V1"];for(const m of k)a&&console.error(m.path),w.push(`FILE:${m.path}`),w.push(`SIZE:${m.content.length}`),w.push(`TYPE:${m.isDir?"dir":"file"}`),w.push("DATA-START"),w.push(m.content),w.push("DATA-END");const v=w.join(`
`),g=e.fs.resolvePath(d,e.cwd);return await e.fs.writeFile(g,v),{stdout:a?k.map(m=>m.path).join(`
`)+`
`:"",stderr:"",exitCode:0}}if(h){if(!d)return{stdout:"",stderr:`tar: Refusing to read archive from terminal (missing -f option?)
`,exitCode:1};const S=e.fs.resolvePath(d,e.cwd),A=(await e.fs.readFile(S)).split(`
`);if(A[0]!=="FLUFFY-TAR-V1")return{stdout:"",stderr:`tar: This does not look like a tar archive
`,exitCode:1};let w=1;const v=[];for(;w<A.length&&A[w].startsWith("FILE:");){const g=A[w].slice(5),m=parseInt(A[w+1].slice(5),10),$=A[w+2].slice(5);w+=4;const I=[];for(;w<A.length&&A[w]!=="DATA-END";)I.push(A[w]),w++;const B=I.join(`
`);w++;const P=e.fs.resolvePath(g,f);if($==="dir")await e.fs.mkdir(P,{recursive:!0});else{const x=P.lastIndexOf("/");if(x>0){const N=P.slice(0,x);try{await e.fs.mkdir(N,{recursive:!0})}catch{}}await e.fs.writeFile(P,B)}v.push(g),a&&console.error(g)}return{stdout:a?v.join(`
`)+`
`:"",stderr:"",exitCode:0}}if(o){if(!d)return{stdout:"",stderr:`tar: Refusing to read archive from terminal (missing -f option?)
`,exitCode:1};const S=e.fs.resolvePath(d,e.cwd),A=(await e.fs.readFile(S)).split(`
`);if(A[0]!=="FLUFFY-TAR-V1")return{stdout:"",stderr:`tar: This does not look like a tar archive
`,exitCode:1};const w=[];for(let v=1;v<A.length;v++)A[v].startsWith("FILE:")&&w.push(A[v].slice(5));return{stdout:w.join(`
`)+`
`,stderr:"",exitCode:0}}return{stdout:"",stderr:`tar: Unknown error
`,exitCode:1}}catch(S){return{stdout:"",stderr:`tar: ${S instanceof Error?S.message:S}
`,exitCode:1}}}},tee={name:"tee",description:"Read from stdin and write to stdout and files",async exec(t,e){const{flags:r,positional:n}=parseArgs(t),c=r.a,s=e.stdin;try{for(const h of n){const o=e.fs.resolvePath(h,e.cwd);if(c){let a="";try{a=await e.fs.readFile(o)}catch{}await e.fs.writeFile(o,a+s)}else await e.fs.writeFile(o,s)}return{stdout:s,stderr:"",exitCode:0}}catch(h){return{stdout:s,stderr:`tee: ${h instanceof Error?h.message:h}
`,exitCode:1}}}},test={name:"test",description:"Evaluate conditional expression",async exec(t,e){const r=t[t.length-1]==="]"?t.slice(0,-1):[...t];try{return{stdout:"",stderr:"",exitCode:await evaluate(r,e)?0:1}}catch(n){return{stdout:"",stderr:`test: ${n instanceof Error?n.message:n}
`,exitCode:2}}}};async function evaluate(t,e){if(t.length===0)return!1;if(t.length===1)return t[0]!=="";if(t.length===2){const[c,s]=t;switch(c){case"-z":return s==="";case"-n":return s!=="";case"!":return s==="";case"-e":case"-f":case"-d":case"-L":case"-h":case"-S":case"-p":case"-b":case"-c":try{const h=e.fs.resolvePath(s,e.cwd),o=await e.fs.stat(h);return c==="-f"?o.type==="file":c==="-d"?o.type==="dir":c==="-L"||c==="-h"?o.type==="symlink":c==="-S"?o.type==="socket":c==="-p"?o.type==="fifo":c==="-b"?o.type==="block":c==="-c"?o.type==="char":!0}catch{return!1}case"-r":case"-w":case"-x":case"-s":case"-u":case"-g":case"-k":try{const h=e.fs.resolvePath(s,e.cwd);if(await e.fs.stat(h),c==="-s")try{const o=await e.fs.readFile?.(h);return o&&o.length>0}catch{return!1}return c==="-r"||c==="-w"}catch{return!1}case"-t":return!1}}if(t[0]==="!"&&t.length>1)return!await evaluate(t.slice(1),e);if(t.length===3){const[c,s,h]=t;switch(s){case"=":case"==":return c===h;case"!=":return c!==h;case"-eq":return parseInt(c)===parseInt(h);case"-ne":return parseInt(c)!==parseInt(h);case"-lt":return parseInt(c)<parseInt(h);case"-le":return parseInt(c)<=parseInt(h);case"-gt":return parseInt(c)>parseInt(h);case"-ge":return parseInt(c)>=parseInt(h)}}const r=t.indexOf("-a");if(r>0)return await evaluate(t.slice(0,r),e)&&await evaluate(t.slice(r+1),e);const n=t.indexOf("-o");return n>0?await evaluate(t.slice(0,n),e)||await evaluate(t.slice(n+1),e):!1}const time={name:"time",description:"Time a command execution",async exec(t,e){const{positional:r,flags:n}=parseArgs(t);if(r.length===0)return{stdout:"",stderr:`time: missing command
`,exitCode:1};const c=n.v||n.verbose,s=n.p,h=r.join(" "),o=globalThis.performance,a=o?o.now():Date.now();await new Promise(A=>globalThis.setTimeout(A,0));const f=((o?o.now():Date.now())-a)/1e3,p=Math.floor(f/60),S=f%60;let k;return s?k=`real ${f.toFixed(2)}
user 0.00
sys 0.00
`:c?k=`        ${f.toFixed(3)} real         0.000 user         0.000 sys
`:k=`
real    ${p}m${S.toFixed(3)}s
user    0m0.000s
sys     0m0.000s
`,{stdout:"",stderr:`Command: ${h}
${k}`,exitCode:0}}},timeout={name:"timeout",description:"Run a command with a time limit",async exec(t,e){const{positional:r,flags:n,values:c}=parseArgs(t,["k","kill-after","s","signal"]);if(r.length===0)return{stdout:"",stderr:`timeout: missing duration
`,exitCode:1};const s=r[0],h=r.slice(1);if(h.length===0)return{stdout:"",stderr:`timeout: missing command
`,exitCode:1};let o=parseDuration(s);if(o===null)return{stdout:"",stderr:`timeout: invalid time interval '${s}'
`,exitCode:1};c.k||c["kill-after"];const a=c.s||c.signal||"TERM",d=n["preserve-status"];n.foreground;const l=n.v||n.verbose;try{const f=h.join(" ");if(l)return{stdout:"",stderr:`timeout: would run command '${f}' with ${o}s timeout using signal ${a}
`,exitCode:0};const p=o*1e3;let S=!1;if(await new Promise(k=>{const A=globalThis.setTimeout(()=>{S=!0,k(null)},p);globalThis.clearTimeout(A),k(null)}),S){const k=d?143:124;return{stdout:"",stderr:`timeout: command '${f}' timed out after ${o}s
`,exitCode:k}}return{stdout:`Command: ${f}
`,stderr:"",exitCode:0}}catch(f){return{stdout:"",stderr:`timeout: ${f instanceof Error?f.message:f}
`,exitCode:1}}}};function parseDuration(t){const e=t.match(/^(\d+(?:\.\d+)?)(s|m|h|d)?$/);if(!e)return null;const r=parseFloat(e[1]);switch(e[2]||"s"){case"s":return r;case"m":return r*60;case"h":return r*3600;case"d":return r*86400;default:return null}}const touch={name:"touch",description:"Change file timestamps or create empty files",async exec(t,e){const{positional:r,flags:n}=parseArgs(t);if(r.length===0)return{stdout:"",stderr:`touch: missing operand
`,exitCode:1};const c=n.c;try{for(const s of r){const h=e.fs.resolvePath(s,e.cwd);let o=!1;try{await e.fs.stat(h),o=!0}catch{o=!1}if(o){const a=await e.fs.readFile(h);await e.fs.writeFile(h,a)}else{if(c)continue;await e.fs.writeFile(h,"")}}return{stdout:"",stderr:"",exitCode:0}}catch(s){return{stdout:"",stderr:`touch: ${s instanceof Error?s.message:s}
`,exitCode:1}}}},tr={name:"tr",description:"Translate or delete characters",async exec(t,e){const{flags:r,positional:n}=parseArgs(t,[]),c=r.d,s=r.s,h=r.c||r.C,o=r.t;let a=expandSet(n[0]??""),d=expandSet(n[1]??"");const l=e.stdin;h&&a&&(a=getComplement(a)),o&&d&&(a=a.slice(0,d.length));let f;if(c){const p=new Set(a.split(""));f=l.split("").filter(S=>!p.has(S)).join("")}else if(a&&d){const p=new Map;for(let S=0;S<a.length;S++)p.set(a[S],d[Math.min(S,d.length-1)]);f=l.split("").map(S=>p.get(S)??S).join("")}else f=l;if(s){const p=d?new Set(d.split("")):a?new Set(a.split("")):null;if(p){let S="",k="";for(const A of f)p.has(A)&&A===k||(S+=A,k=A);f=S}}return{stdout:f,stderr:"",exitCode:0}}};function expandSet(t){let e=t;e=e.replace(/\[:upper:\]/g,"ABCDEFGHIJKLMNOPQRSTUVWXYZ"),e=e.replace(/\[:lower:\]/g,"abcdefghijklmnopqrstuvwxyz"),e=e.replace(/\[:digit:\]/g,"0123456789"),e=e.replace(/\[:space:\]/g,` 	
\r`),e=e.replace(/\[:alpha:\]/g,"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz"),e=e.replace(/\[:alnum:\]/g,"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789"),e=e.replace(/\[:punct:\]/g,"!\"#$%&'()*+,-./:;<=>?@[\\]^_`{|}~"),e=e.replace(/\[:print:\]/g," !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~");let r="",n=0;for(;n<e.length;)if(n+2<e.length&&e[n+1]==="-"){const c=e.charCodeAt(n),s=e.charCodeAt(n+2);for(let h=c;h<=s;h++)r+=String.fromCharCode(h);n+=3}else r+=e[n],n++;return r}function getComplement(t){const e=new Set(t.split(""));let r="";for(let n=9;n<=126;n++)if(n===9||n===10||n===13||n>=32&&n<=126){const c=String.fromCharCode(n);e.has(c)||(r+=c)}return r}const trap={name:"trap",description:"Trap signals and execute commands",async exec(t,e){const{flags:r,positional:n}=parseArgs(t,["l","p"]);return r.l?{stdout:["EXIT","HUP","INT","QUIT","ILL","TRAP","ABRT","BUS","FPE","KILL","USR1","SEGV","USR2","PIPE","ALRM","TERM","STKFLT","CHLD","CONT","STOP","TSTP","TTIN","TTOU","URG","XCPU","XFSZ","VTALRM","PROF","WINCH","IO","PWR","SYS","ERR","DEBUG","RETURN"].map((h,o)=>`${o}) SIG${h}`).join(`
`)+`
`,stderr:"",exitCode:0}:r.p?n.length===0?{stdout:`# Trap handlers would be listed here
`,stderr:"",exitCode:0}:{stdout:n.map(s=>`# trap for ${s} would be shown here`).join(`
`)+`
`,stderr:"",exitCode:0}:n.length===0?{stdout:"",stderr:`trap: usage: trap [-lp] [ACTION] [SIGNAL...]
`,exitCode:1}:(n[0],n.slice(1).length===0?{stdout:"",stderr:`trap: usage: trap ACTION SIGNAL...
`,exitCode:1}:{stdout:"",stderr:"",exitCode:0})}},kill={name:"kill",description:"Send signal to process",async exec(t,e){const{flags:r,values:n,positional:c}=parseArgs(t,["l","L","s"]);if(r.l||r.L){const h=["HUP","INT","QUIT","ILL","TRAP","ABRT","BUS","FPE","KILL","USR1","SEGV","USR2","PIPE","ALRM","TERM","STKFLT","CHLD","CONT","STOP","TSTP","TTIN","TTOU","URG","XCPU","XFSZ","VTALRM","PROF","WINCH","IO","PWR","SYS"];return r.L?{stdout:h.map((o,a)=>`${a+1}) SIG${o}`).join(`
`)+`
`,stderr:"",exitCode:0}:{stdout:h.join(" ")+`
`,stderr:"",exitCode:0}}const s=n.s||"TERM";return c.length===0?{stdout:"",stderr:`kill: usage: kill [-s SIGNAL] PID...
`,exitCode:1}:{stdout:"",stderr:`kill: sending signal ${s} to processes: ${c.join(", ")}
`,exitCode:0}}},trueCmd={name:"true",description:"Return success",async exec(){return{stdout:"",stderr:"",exitCode:0}}},tsort={name:"tsort",description:"Perform topological sort",async exec(t,e){const r=t.length>0?t:["-"];let n;try{if(r[0]==="-"||r.length===0)n=e.stdin;else{const l=e.fs.resolvePath(r[0],e.cwd);n=await e.fs.readFile(l)}}catch(l){return{stdout:"",stderr:`tsort: ${r[0]}: ${l instanceof Error?l.message:String(l)}
`,exitCode:1}}const c=n.trim().split(/\s+/).filter(Boolean);if(c.length%2!==0)return{stdout:"",stderr:`tsort: odd number of tokens
`,exitCode:1};const s=new Map,h=new Map,o=new Set;for(let l=0;l<c.length;l+=2){const f=c[l],p=c[l+1];o.add(f),o.add(p),s.has(f)||s.set(f,new Set),s.get(f).add(p)}for(const l of o)h.has(l)||h.set(l,0);for(const[l,f]of s)for(const p of f)h.set(p,(h.get(p)||0)+1);const a=[],d=[];for(const[l,f]of h)f===0&&a.push(l);for(a.sort();a.length>0;){a.sort();const l=a.shift();d.push(l);const f=s.get(l);if(f)for(const p of f){const S=h.get(p)-1;h.set(p,S),S===0&&a.push(p)}}return d.length!==o.size?{stdout:"",stderr:`tsort: cycle detected
`,exitCode:1}:{stdout:d.join(`
`)+`
`,stderr:"",exitCode:0}}},type={name:"type",description:"Display information about command type",async exec(t,e){const{positional:r,flags:n}=parseArgs(t);if(r.length===0)return{stdout:"",stderr:`type: missing operand
`,exitCode:1};const c=n.a,s=n.t,h=n.p,o=[];let a=0;for(const d of r){const l=(e.env.PATH||"/bin:/usr/bin").split(":");let f=!1;for(const p of l){const S=p+"/"+d;try{if(await e.fs.exists(S)&&(f=!0,s?o.push("file"):h?o.push(S):o.push(`${d} is ${S}`),!c))break}catch{}}f||(!s&&!h&&o.push(`type: ${d}: not found`),a=1)}return{stdout:o.join(`
`)+(o.length>0?`
`:""),stderr:"",exitCode:a}}},ulimit={name:"ulimit",description:"Control user resource limits",async exec(t,e){const{flags:r,positional:n}=parseArgs(t,["S","soft","H","hard","a","all","c","core-size","d","data-size","f","file-size","l","lock-memory","m","memory-size","n","open-files","s","stack-size","t","cpu-time","u","user-processes","v","virtual-memory"]);r.S||r.soft,r.H||r.hard;const c=r.a||r.all,s={"core file size":{value:"unlimited",unit:"blocks"},"data seg size":{value:"unlimited",unit:"kbytes"},"file size":{value:"unlimited",unit:"blocks"},"max locked memory":{value:"unlimited",unit:"kbytes"},"max memory size":{value:"unlimited",unit:"kbytes"},"open files":{value:"1024",unit:""},"stack size":{value:"8192",unit:"kbytes"},"cpu time":{value:"unlimited",unit:"seconds"},"max user processes":{value:"2048",unit:""},"virtual memory":{value:"unlimited",unit:"kbytes"}};if(c)return{stdout:Object.entries(s).map(([d,{value:l,unit:f}])=>{const p=f?` (${f})`:"";return`${d}${p.padEnd(25-d.length)} ${l}`}).join(`
`)+`
`,stderr:"",exitCode:0};let h=null;r.c||r["core-size"]?h="core file size":r.d||r["data-size"]?h="data seg size":r.f||r["file-size"]?h="file size":r.l||r["lock-memory"]?h="max locked memory":r.m||r["memory-size"]?h="max memory size":r.n||r["open-files"]?h="open files":r.s||r["stack-size"]?h="stack size":r.t||r["cpu-time"]?h="cpu time":r.u||r["user-processes"]?h="max user processes":(r.v||r["virtual-memory"])&&(h="virtual memory"),h||(h="file size");const o=s[h];if(!o)return{stdout:"",stderr:`ulimit: invalid resource
`,exitCode:1};if(n.length>0){const a=n[0];return a!=="unlimited"&&isNaN(parseInt(a))?{stdout:"",stderr:`ulimit: ${a}: invalid number
`,exitCode:1}:{stdout:"",stderr:"",exitCode:0}}return{stdout:o.value+`
`,stderr:"",exitCode:0}}},umask={name:"umask",description:"Set or display file creation mask",async exec(t,e){const{flags:r,positional:n}=parseArgs(t,["S","p"]),c=r.S,s=r.p,h="0022";if(n.length===0)if(c){const a=parseInt(h,8);return{stdout:maskToSymbolic(a)+`
`,stderr:"",exitCode:0}}else return s?{stdout:`umask ${h}
`,stderr:"",exitCode:0}:{stdout:h+`
`,stderr:"",exitCode:0};const o=n[0];return/^[0-7]{3,4}$/.test(o)?{stdout:"",stderr:"",exitCode:0}:/^[ugoa]*[+-=][rwxXst]*$/.test(o)?{stdout:"",stderr:"",exitCode:0}:{stdout:"",stderr:`umask: ${o}: invalid symbolic mode
`,exitCode:1}}};function maskToSymbolic(t){const e=511&~t,r=e>>6&7,n=e>>3&7,c=e&7,s=h=>(h&4?"r":"-")+(h&2?"w":"-")+(h&1?"x":"-");return`u=${s(r)},g=${s(n)},o=${s(c)}`}const unalias={name:"unalias",description:"Remove alias definitions",async exec(t,e){const{positional:r,flags:n}=parseArgs(t);return r.length===0&&!n.a?{stdout:"",stderr:`unalias: usage: unalias [-a] name [name ...]
`,exitCode:2}:{stdout:"",stderr:"",exitCode:0}}},unexpand={name:"unexpand",description:"Convert spaces to tabs",async exec(t,e){const{values:r,positional:n,flags:c}=parseArgs(t,["t","tabs"]),s=r.t||r.tabs||"8",h=parseInt(s,10);if(isNaN(h)||h<=0)return{stdout:"",stderr:`unexpand: invalid tab size: '${s}'
`,exitCode:1};const o=c.a||c.all;try{const{content:a}=await readInput(n,e.stdin,e.fs,e.cwd,e.fs.resolvePath),d=a.split(`
`),l=[];for(const f of d){let p="",S=0,k=0;for(let A=0;A<f.length;A++){const w=f[A];w===" "?(k++,S++,S%h===0&&(o||p.trim()===""?(k>=h&&(p+="	".repeat(Math.floor(k/h)),k=k%h),k>0&&(p+=" ".repeat(k),k=0)):(p+=" ".repeat(k),k=0))):(k>0&&(p+=" ".repeat(k),k=0),p+=w,S++)}k>0&&(p+=" ".repeat(k)),l.push(p)}return{stdout:l.join(`
`)+(a.endsWith(`
`)?`
`:""),stderr:"",exitCode:0}}catch(a){return{stdout:"",stderr:`unexpand: ${a instanceof Error?a.message:a}
`,exitCode:1}}}},uniq={name:"uniq",description:"Report or omit repeated lines",async exec(t,e){const{flags:r,positional:n,values:c}=parseArgs(t,["f","s","w"]),s=c.f?parseInt(c.f):0,h=c.s?parseInt(c.s):0,o=c.w?parseInt(c.w):void 0,a=r.i;try{const{content:d}=await readInput(n,e.stdin,e.fs,e.cwd,e.fs.resolvePath),l=d.split(`
`);l.length>0&&l[l.length-1]===""&&l.pop();const f=[];let p="",S="",k=0;for(const A of l){const w=getComparisonKey(A,s,h,o,a);w===S?k++:(k>0&&emitLine(p,k,r,f),p=A,S=w,k=1)}return k>0&&emitLine(p,k,r,f),{stdout:f.join(`
`)+(f.length>0?`
`:""),stderr:"",exitCode:0}}catch(d){return{stdout:"",stderr:`uniq: ${d instanceof Error?d.message:d}
`,exitCode:1}}}};function getComparisonKey(t,e,r,n,c){let s=t;return e>0&&(s=t.split(/\s+/).slice(e).join(" ")),r>0&&(s=s.substring(r)),n!==void 0&&(s=s.substring(0,n)),c&&(s=s.toLowerCase()),s}function emitLine(t,e,r,n){r.d&&e<2||r.u&&e>1||(r.c?n.push(`${String(e).padStart(7)} ${t}`):n.push(t))}const uname={name:"uname",description:"Print system information",async exec(t,e){const{flags:r}=parseArgs(t),n=r.a,c=e.env.UNAME_SYSNAME??"FluffyOS",s=e.env.HOSTNAME??"localhost",h=e.env.UNAME_RELEASE??"1.0.0",o=e.env.UNAME_VERSION??"#1",a=e.env.UNAME_MACHINE??"wasm64";if(n)return{stdout:`${c} ${s} ${h} ${o} ${a}
`,stderr:"",exitCode:0};if(r.s||!r.n&&!r.r&&!r.v&&!r.m)return{stdout:c+`
`,stderr:"",exitCode:0};const d=[];return r.s&&d.push(c),r.n&&d.push(s),r.r&&d.push(h),r.v&&d.push(o),r.m&&d.push(a),{stdout:d.join(" ")+`
`,stderr:"",exitCode:0}}},uptime={name:"uptime",description:"Tell how long the system has been running",async exec(t,e){const{flags:r}=parseArgs(t),n=r.p||r.pretty,c=r.s||r.since,s=86400+3600*5+1380,h=Math.floor(s/86400),o=Math.floor(s%86400/3600),a=Math.floor(s%3600/60),d=new Date,l=new Date(d.getTime()-s*1e3),f=[];if(c)f.push(l.toISOString());else if(n){const p=[];h>0&&p.push(`${h} day${h!==1?"s":""}`),o>0&&p.push(`${o} hour${o!==1?"s":""}`),a>0&&p.push(`${a} minute${a!==1?"s":""}`),f.push(`up ${p.join(", ")}`)}else{const p=d.toTimeString().split(" ")[0],S=h>0?`${h} day${h!==1?"s":""}, ${o}:${String(a).padStart(2,"0")}`:`${o}:${String(a).padStart(2,"0")}`;f.push(` ${p} up ${S}, 1 user, load average: 0.50, 0.40, 0.35`)}return{stdout:f.join(`
`)+`
`,stderr:"",exitCode:0}}},watch={name:"watch",description:"Execute a program periodically, showing output",async exec(t,e){const{values:r,positional:n,flags:c}=parseArgs(t,["n","interval","d","differences","t","no-title","b","beep","e","errexit","g","chgexit","help"]);if(c.help)return{stdout:`Usage: watch [options] command
Execute a program periodically, showing output fullscreen.

Options:
  -n, --interval <secs>  Seconds to wait between updates (default: 2)
  -d, --differences      Highlight changes between updates
  -t, --no-title        Turn off header showing interval, command, and time
  -b, --beep            Beep if command has a non-zero exit status
  -e, --errexit         Exit if command has a non-zero exit status
  -g, --chgexit         Exit when output from command changes
  -h, --help            Display this help and exit

Examples:
  watch -n 5 ls -l       # Update every 5 seconds
  watch -d df -h         # Highlight differences in disk usage
  watch date             # Show current time, updating every 2 seconds

`,stderr:"",exitCode:0};if(n.length===0)return{stdout:"",stderr:`watch: missing command
Try 'watch --help' for more information.
`,exitCode:1};const s=parseFloat(r.n||r.interval||"2"),h=n.join(" ");return{stdout:(c.t||c["no-title"]?"":`Every ${s}s: ${h}

`)+`watch: This is a stub implementation.
In a real shell, this would execute '${h}' every ${s} seconds.

To implement watch in a browser environment:
1. Use setInterval to run command periodically
2. Update a dedicated output area
3. Handle options like -d (differences), -e (errexit), -g (chgexit)
4. Provide a way to stop watching (Ctrl+C)

Browser shells should implement watch at the shell level for proper integration.

`,stderr:"",exitCode:0}}},wc={name:"wc",description:"Word, line, and byte count",async exec(t,e){const{flags:r,positional:n}=parseArgs(t),c=r.l,s=r.w,h=r.c,o=!c&&!s&&!h;try{const{content:a,files:d}=await readInput(n,e.stdin,e.fs,e.cwd,e.fs.resolvePath),l=a.split(`
`).length-(a.endsWith(`
`)?1:0),f=a.split(/\s+/).filter(Boolean).length,p=a.length,S=[];return(o||c)&&S.push(String(l).padStart(6)),(o||s)&&S.push(String(f).padStart(6)),(o||h)&&S.push(String(p).padStart(6)),d.length===1&&S.push(" "+n[0]),{stdout:S.join(" ")+`
`,stderr:"",exitCode:0}}catch(a){return{stdout:"",stderr:`wc: ${a instanceof Error?a.message:a}
`,exitCode:1}}}},which={name:"which",description:"Locate a command in PATH",async exec(t,e){const{flags:r,positional:n}=parseArgs(t),c=r.a;if(n.length===0)return{stdout:"",stderr:`which: missing argument
`,exitCode:1};const s=n[0],h=e.env.PATH||"/bin:/usr/bin:/usr/local/bin",o=h.split(":"),a=[];for(const d of o){const l=`${d}/${s}`;try{if(await e.fs.exists(l)&&(await e.fs.stat(l)).type==="file"&&(a.push(l),!c))break}catch{continue}}return a.length===0?{stdout:"",stderr:`which: no ${s} in (${h})
`,exitCode:1}:{stdout:a.join(`
`)+`
`,stderr:"",exitCode:0}}},whoami={name:"whoami",description:"Print current user name",async exec(t,e){return{stdout:(e.env.USER??e.env.USERNAME??"user")+`
`,stderr:"",exitCode:0}}},xargs={name:"xargs",description:"Build and execute command lines from stdin",async exec(t,e){const{flags:r,positional:n,values:c}=parseArgs(t,["n","I","i","d","delimiter"]),s=r.I||r.L||r.l,h=c.I||c.i,o=c.n?parseInt(c.n):void 0,a=c.d||c.delimiter||/\s+/,d=r.t||r.verbose,l=r.r,f=n.length>0?n.join(" "):"echo";let p;if(typeof a=="string"?p=e.stdin.split(a).filter(Boolean):p=e.stdin.trim().split(a).filter(Boolean),p.length===0){if(l)return{stdout:"",stderr:"",exitCode:0};p=[""]}const S=[],k=[];if(h){const A=typeof h=="string"?h:"{}";for(const w of p){const v=f.replace(new RegExp(escapeRegex(A),"g"),w);k.push(v),d&&S.push(`+ ${v}`)}}else if(o)for(let A=0;A<p.length;A+=o){const w=p.slice(A,A+o),v=`${f} ${w.map(escapeArg).join(" ")}`;k.push(v),d&&S.push(`+ ${v}`)}else if(s)for(const A of p){const w=`${f} ${escapeArg(A)}`;k.push(w),d&&S.push(`+ ${w}`)}else{const A=f==="echo"?p.join(" "):`${f} ${p.map(escapeArg).join(" ")}`;k.push(A),d&&S.push(`+ ${A}`)}return f==="echo"&&!h&&!o?S.push(...p):S.push(...k),{stdout:S.join(`
`)+(S.length>0?`
`:""),stderr:"",exitCode:0}}};function escapeArg(t){return/[^a-zA-Z0-9._\-/=]/.test(t)?`'${t.replace(/'/g,"'\\''")}'`:t}function escapeRegex(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}const yes={name:"yes",description:"Output a string repeatedly until killed",async exec(t,e){const{positional:r}=parseArgs(t),n=r.length>0?r.join(" "):"y",c=[],s=1e3;for(let h=0;h<s;h++)c.push(n);return{stdout:c.join(`
`)+`
`,stderr:"",exitCode:0}}},allCommands={".":dot,alias,array:arrayHelper,awk,base64,basename,bc,break:breakCmd,case:caseCmd,cc,cat,chmod,chown,clear,column,comm,continue:continueCmd,cp,curl,cut,date,declare,df,diff,dirname,do:doCmd,done,du,echo,elif,else:elseCmd,env,esac,eval:evalCmd,exit,expand,expr,export:exportCmd,false:falseCmd,fi,file,find,fmt,fold,for:forCmd,free,function:functionCmd,gcc,getopts,grep,hash,head,heredoc,hexdump,hostname,id,if:ifCmd,in:inCmd,install,join,kill,less,let:letCmd,ln,local,ls,make,md5sum,mkdir,mv,nl,nohup,od,paste,patch,"pkg-config":pkgConfig,pr,"process-substitution":processSubstitution,printenv,printf,pwd,read,readlink,readonly,realpath,return:returnCmd,rm,sed,seq,set,sha256sum,shift,shrine,sleep,sort,source,stat,strings,tail,tar,tee,test,then,time,timeout,touch,tr,trap,true:trueCmd,tsort,type,ulimit,umask,unalias,unexpand,uniq,unset,uname,until,uptime,watch,wc,which,while:whileCmd,whoami,xargs,yes};function createFluffyFS(t){return{async readFile(e){return await t.readFile(e,"utf8")},async writeFile(e,r){await t.writeFile(e,r)},async mkdir(e,r){await t.mkdir(e,r)},async readdir(e){const r=await t.readdir(e),n=[];for(const c of r){const s=e==="/"?"/"+c:e+"/"+c,h=await t.stat(s);n.push({name:c,type:h.isDirectory()?"dir":"file",size:h.size,mtime:h.mtime.getTime()})}return n},async stat(e){const r=await t.stat(e);return{type:r.isDirectory()?"dir":"file",size:r.size,mode:r.mode,mtime:r.mtime.getTime()}},async exists(e){return await t.exists(e)},async unlink(e){await t.unlink(e)},async rename(e,r){await t.rename(e,r)},async rmdir(e,r){r?.recursive?await t.rm(e,{recursive:!0}):await t.rmdir(e)},resolvePath(e,r){return t.resolvePath(e,r)}}}function wrapFluffyCommand(t){return{name:t.name,description:t.description,async exec(e){const r=createFluffyFS(e.fs),n=await t.exec(e.args,{stdin:e.stdin,env:e.env,cwd:e.cwd,fs:r});return e.stdout+=n.stdout,e.stderr+=n.stderr,n.exitCode}}}var xterm={exports:{}},hasRequiredXterm;function requireXterm(){return hasRequiredXterm||(hasRequiredXterm=1,(function(t,e){(function(r,n){t.exports=n()})(globalThis,(()=>(()=>{var r={4567:function(h,o,a){var d=this&&this.__decorate||function(g,m,$,I){var B,P=arguments.length,x=P<3?m:I===null?I=Object.getOwnPropertyDescriptor(m,$):I;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")x=Reflect.decorate(g,m,$,I);else for(var N=g.length-1;N>=0;N--)(B=g[N])&&(x=(P<3?B(x):P>3?B(m,$,x):B(m,$))||x);return P>3&&x&&Object.defineProperty(m,$,x),x},l=this&&this.__param||function(g,m){return function($,I){m($,I,g)}};Object.defineProperty(o,"__esModule",{value:!0}),o.AccessibilityManager=void 0;const f=a(9042),p=a(9924),S=a(844),k=a(4725),A=a(2585),w=a(3656);let v=o.AccessibilityManager=class extends S.Disposable{constructor(g,m,$,I){super(),this._terminal=g,this._coreBrowserService=$,this._renderService=I,this._rowColumns=new WeakMap,this._liveRegionLineCount=0,this._charsToConsume=[],this._charsToAnnounce="",this._accessibilityContainer=this._coreBrowserService.mainDocument.createElement("div"),this._accessibilityContainer.classList.add("xterm-accessibility"),this._rowContainer=this._coreBrowserService.mainDocument.createElement("div"),this._rowContainer.setAttribute("role","list"),this._rowContainer.classList.add("xterm-accessibility-tree"),this._rowElements=[];for(let B=0;B<this._terminal.rows;B++)this._rowElements[B]=this._createAccessibilityTreeNode(),this._rowContainer.appendChild(this._rowElements[B]);if(this._topBoundaryFocusListener=B=>this._handleBoundaryFocus(B,0),this._bottomBoundaryFocusListener=B=>this._handleBoundaryFocus(B,1),this._rowElements[0].addEventListener("focus",this._topBoundaryFocusListener),this._rowElements[this._rowElements.length-1].addEventListener("focus",this._bottomBoundaryFocusListener),this._refreshRowsDimensions(),this._accessibilityContainer.appendChild(this._rowContainer),this._liveRegion=this._coreBrowserService.mainDocument.createElement("div"),this._liveRegion.classList.add("live-region"),this._liveRegion.setAttribute("aria-live","assertive"),this._accessibilityContainer.appendChild(this._liveRegion),this._liveRegionDebouncer=this.register(new p.TimeBasedDebouncer(this._renderRows.bind(this))),!this._terminal.element)throw new Error("Cannot enable accessibility before Terminal.open");this._terminal.element.insertAdjacentElement("afterbegin",this._accessibilityContainer),this.register(this._terminal.onResize((B=>this._handleResize(B.rows)))),this.register(this._terminal.onRender((B=>this._refreshRows(B.start,B.end)))),this.register(this._terminal.onScroll((()=>this._refreshRows()))),this.register(this._terminal.onA11yChar((B=>this._handleChar(B)))),this.register(this._terminal.onLineFeed((()=>this._handleChar(`
`)))),this.register(this._terminal.onA11yTab((B=>this._handleTab(B)))),this.register(this._terminal.onKey((B=>this._handleKey(B.key)))),this.register(this._terminal.onBlur((()=>this._clearLiveRegion()))),this.register(this._renderService.onDimensionsChange((()=>this._refreshRowsDimensions()))),this.register((0,w.addDisposableDomListener)(document,"selectionchange",(()=>this._handleSelectionChange()))),this.register(this._coreBrowserService.onDprChange((()=>this._refreshRowsDimensions()))),this._refreshRows(),this.register((0,S.toDisposable)((()=>{this._accessibilityContainer.remove(),this._rowElements.length=0})))}_handleTab(g){for(let m=0;m<g;m++)this._handleChar(" ")}_handleChar(g){this._liveRegionLineCount<21&&(this._charsToConsume.length>0?this._charsToConsume.shift()!==g&&(this._charsToAnnounce+=g):this._charsToAnnounce+=g,g===`
`&&(this._liveRegionLineCount++,this._liveRegionLineCount===21&&(this._liveRegion.textContent+=f.tooMuchOutput)))}_clearLiveRegion(){this._liveRegion.textContent="",this._liveRegionLineCount=0}_handleKey(g){this._clearLiveRegion(),/\p{Control}/u.test(g)||this._charsToConsume.push(g)}_refreshRows(g,m){this._liveRegionDebouncer.refresh(g,m,this._terminal.rows)}_renderRows(g,m){const $=this._terminal.buffer,I=$.lines.length.toString();for(let B=g;B<=m;B++){const P=$.lines.get($.ydisp+B),x=[],N=P?.translateToString(!0,void 0,void 0,x)||"",J=($.ydisp+B+1).toString(),Q=this._rowElements[B];Q&&(N.length===0?(Q.innerText="",this._rowColumns.set(Q,[0,1])):(Q.textContent=N,this._rowColumns.set(Q,x)),Q.setAttribute("aria-posinset",J),Q.setAttribute("aria-setsize",I))}this._announceCharacters()}_announceCharacters(){this._charsToAnnounce.length!==0&&(this._liveRegion.textContent+=this._charsToAnnounce,this._charsToAnnounce="")}_handleBoundaryFocus(g,m){const $=g.target,I=this._rowElements[m===0?1:this._rowElements.length-2];if($.getAttribute("aria-posinset")===(m===0?"1":`${this._terminal.buffer.lines.length}`)||g.relatedTarget!==I)return;let B,P;if(m===0?(B=$,P=this._rowElements.pop(),this._rowContainer.removeChild(P)):(B=this._rowElements.shift(),P=$,this._rowContainer.removeChild(B)),B.removeEventListener("focus",this._topBoundaryFocusListener),P.removeEventListener("focus",this._bottomBoundaryFocusListener),m===0){const x=this._createAccessibilityTreeNode();this._rowElements.unshift(x),this._rowContainer.insertAdjacentElement("afterbegin",x)}else{const x=this._createAccessibilityTreeNode();this._rowElements.push(x),this._rowContainer.appendChild(x)}this._rowElements[0].addEventListener("focus",this._topBoundaryFocusListener),this._rowElements[this._rowElements.length-1].addEventListener("focus",this._bottomBoundaryFocusListener),this._terminal.scrollLines(m===0?-1:1),this._rowElements[m===0?1:this._rowElements.length-2].focus(),g.preventDefault(),g.stopImmediatePropagation()}_handleSelectionChange(){if(this._rowElements.length===0)return;const g=document.getSelection();if(!g)return;if(g.isCollapsed)return void(this._rowContainer.contains(g.anchorNode)&&this._terminal.clearSelection());if(!g.anchorNode||!g.focusNode)return void console.error("anchorNode and/or focusNode are null");let m={node:g.anchorNode,offset:g.anchorOffset},$={node:g.focusNode,offset:g.focusOffset};if((m.node.compareDocumentPosition($.node)&Node.DOCUMENT_POSITION_PRECEDING||m.node===$.node&&m.offset>$.offset)&&([m,$]=[$,m]),m.node.compareDocumentPosition(this._rowElements[0])&(Node.DOCUMENT_POSITION_CONTAINED_BY|Node.DOCUMENT_POSITION_FOLLOWING)&&(m={node:this._rowElements[0].childNodes[0],offset:0}),!this._rowContainer.contains(m.node))return;const I=this._rowElements.slice(-1)[0];if($.node.compareDocumentPosition(I)&(Node.DOCUMENT_POSITION_CONTAINED_BY|Node.DOCUMENT_POSITION_PRECEDING)&&($={node:I,offset:I.textContent?.length??0}),!this._rowContainer.contains($.node))return;const B=({node:N,offset:J})=>{const Q=N instanceof Text?N.parentNode:N;let W=parseInt(Q?.getAttribute("aria-posinset"),10)-1;if(isNaN(W))return console.warn("row is invalid. Race condition?"),null;const Y=this._rowColumns.get(Q);if(!Y)return console.warn("columns is null. Race condition?"),null;let ve=J<Y.length?Y[J]:Y.slice(-1)[0]+1;return ve>=this._terminal.cols&&(++W,ve=0),{row:W,column:ve}},P=B(m),x=B($);if(P&&x){if(P.row>x.row||P.row===x.row&&P.column>=x.column)throw new Error("invalid range");this._terminal.select(P.column,P.row,(x.row-P.row)*this._terminal.cols-P.column+x.column)}}_handleResize(g){this._rowElements[this._rowElements.length-1].removeEventListener("focus",this._bottomBoundaryFocusListener);for(let m=this._rowContainer.children.length;m<this._terminal.rows;m++)this._rowElements[m]=this._createAccessibilityTreeNode(),this._rowContainer.appendChild(this._rowElements[m]);for(;this._rowElements.length>g;)this._rowContainer.removeChild(this._rowElements.pop());this._rowElements[this._rowElements.length-1].addEventListener("focus",this._bottomBoundaryFocusListener),this._refreshRowsDimensions()}_createAccessibilityTreeNode(){const g=this._coreBrowserService.mainDocument.createElement("div");return g.setAttribute("role","listitem"),g.tabIndex=-1,this._refreshRowDimensions(g),g}_refreshRowsDimensions(){if(this._renderService.dimensions.css.cell.height){this._accessibilityContainer.style.width=`${this._renderService.dimensions.css.canvas.width}px`,this._rowElements.length!==this._terminal.rows&&this._handleResize(this._terminal.rows);for(let g=0;g<this._terminal.rows;g++)this._refreshRowDimensions(this._rowElements[g])}}_refreshRowDimensions(g){g.style.height=`${this._renderService.dimensions.css.cell.height}px`}};o.AccessibilityManager=v=d([l(1,A.IInstantiationService),l(2,k.ICoreBrowserService),l(3,k.IRenderService)],v)},3614:(h,o)=>{function a(p){return p.replace(/\r?\n/g,"\r")}function d(p,S){return S?"\x1B[200~"+p+"\x1B[201~":p}function l(p,S,k,A){p=d(p=a(p),k.decPrivateModes.bracketedPasteMode&&A.rawOptions.ignoreBracketedPasteMode!==!0),k.triggerDataEvent(p,!0),S.value=""}function f(p,S,k){const A=k.getBoundingClientRect(),w=p.clientX-A.left-10,v=p.clientY-A.top-10;S.style.width="20px",S.style.height="20px",S.style.left=`${w}px`,S.style.top=`${v}px`,S.style.zIndex="1000",S.focus()}Object.defineProperty(o,"__esModule",{value:!0}),o.rightClickHandler=o.moveTextAreaUnderMouseCursor=o.paste=o.handlePasteEvent=o.copyHandler=o.bracketTextForPaste=o.prepareTextForTerminal=void 0,o.prepareTextForTerminal=a,o.bracketTextForPaste=d,o.copyHandler=function(p,S){p.clipboardData&&p.clipboardData.setData("text/plain",S.selectionText),p.preventDefault()},o.handlePasteEvent=function(p,S,k,A){p.stopPropagation(),p.clipboardData&&l(p.clipboardData.getData("text/plain"),S,k,A)},o.paste=l,o.moveTextAreaUnderMouseCursor=f,o.rightClickHandler=function(p,S,k,A,w){f(p,S,k),w&&A.rightClickSelect(p),S.value=A.selectionText,S.select()}},7239:(h,o,a)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.ColorContrastCache=void 0;const d=a(1505);o.ColorContrastCache=class{constructor(){this._color=new d.TwoKeyMap,this._css=new d.TwoKeyMap}setCss(l,f,p){this._css.set(l,f,p)}getCss(l,f){return this._css.get(l,f)}setColor(l,f,p){this._color.set(l,f,p)}getColor(l,f){return this._color.get(l,f)}clear(){this._color.clear(),this._css.clear()}}},3656:(h,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.addDisposableDomListener=void 0,o.addDisposableDomListener=function(a,d,l,f){a.addEventListener(d,l,f);let p=!1;return{dispose:()=>{p||(p=!0,a.removeEventListener(d,l,f))}}}},3551:function(h,o,a){var d=this&&this.__decorate||function(v,g,m,$){var I,B=arguments.length,P=B<3?g:$===null?$=Object.getOwnPropertyDescriptor(g,m):$;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")P=Reflect.decorate(v,g,m,$);else for(var x=v.length-1;x>=0;x--)(I=v[x])&&(P=(B<3?I(P):B>3?I(g,m,P):I(g,m))||P);return B>3&&P&&Object.defineProperty(g,m,P),P},l=this&&this.__param||function(v,g){return function(m,$){g(m,$,v)}};Object.defineProperty(o,"__esModule",{value:!0}),o.Linkifier=void 0;const f=a(3656),p=a(8460),S=a(844),k=a(2585),A=a(4725);let w=o.Linkifier=class extends S.Disposable{get currentLink(){return this._currentLink}constructor(v,g,m,$,I){super(),this._element=v,this._mouseService=g,this._renderService=m,this._bufferService=$,this._linkProviderService=I,this._linkCacheDisposables=[],this._isMouseOut=!0,this._wasResized=!1,this._activeLine=-1,this._onShowLinkUnderline=this.register(new p.EventEmitter),this.onShowLinkUnderline=this._onShowLinkUnderline.event,this._onHideLinkUnderline=this.register(new p.EventEmitter),this.onHideLinkUnderline=this._onHideLinkUnderline.event,this.register((0,S.getDisposeArrayDisposable)(this._linkCacheDisposables)),this.register((0,S.toDisposable)((()=>{this._lastMouseEvent=void 0,this._activeProviderReplies?.clear()}))),this.register(this._bufferService.onResize((()=>{this._clearCurrentLink(),this._wasResized=!0}))),this.register((0,f.addDisposableDomListener)(this._element,"mouseleave",(()=>{this._isMouseOut=!0,this._clearCurrentLink()}))),this.register((0,f.addDisposableDomListener)(this._element,"mousemove",this._handleMouseMove.bind(this))),this.register((0,f.addDisposableDomListener)(this._element,"mousedown",this._handleMouseDown.bind(this))),this.register((0,f.addDisposableDomListener)(this._element,"mouseup",this._handleMouseUp.bind(this)))}_handleMouseMove(v){this._lastMouseEvent=v;const g=this._positionFromMouseEvent(v,this._element,this._mouseService);if(!g)return;this._isMouseOut=!1;const m=v.composedPath();for(let $=0;$<m.length;$++){const I=m[$];if(I.classList.contains("xterm"))break;if(I.classList.contains("xterm-hover"))return}this._lastBufferCell&&g.x===this._lastBufferCell.x&&g.y===this._lastBufferCell.y||(this._handleHover(g),this._lastBufferCell=g)}_handleHover(v){if(this._activeLine!==v.y||this._wasResized)return this._clearCurrentLink(),this._askForLink(v,!1),void(this._wasResized=!1);this._currentLink&&this._linkAtPosition(this._currentLink.link,v)||(this._clearCurrentLink(),this._askForLink(v,!0))}_askForLink(v,g){this._activeProviderReplies&&g||(this._activeProviderReplies?.forEach(($=>{$?.forEach((I=>{I.link.dispose&&I.link.dispose()}))})),this._activeProviderReplies=new Map,this._activeLine=v.y);let m=!1;for(const[$,I]of this._linkProviderService.linkProviders.entries())g?this._activeProviderReplies?.get($)&&(m=this._checkLinkProviderResult($,v,m)):I.provideLinks(v.y,(B=>{if(this._isMouseOut)return;const P=B?.map((x=>({link:x})));this._activeProviderReplies?.set($,P),m=this._checkLinkProviderResult($,v,m),this._activeProviderReplies?.size===this._linkProviderService.linkProviders.length&&this._removeIntersectingLinks(v.y,this._activeProviderReplies)}))}_removeIntersectingLinks(v,g){const m=new Set;for(let $=0;$<g.size;$++){const I=g.get($);if(I)for(let B=0;B<I.length;B++){const P=I[B],x=P.link.range.start.y<v?0:P.link.range.start.x,N=P.link.range.end.y>v?this._bufferService.cols:P.link.range.end.x;for(let J=x;J<=N;J++){if(m.has(J)){I.splice(B--,1);break}m.add(J)}}}}_checkLinkProviderResult(v,g,m){if(!this._activeProviderReplies)return m;const $=this._activeProviderReplies.get(v);let I=!1;for(let B=0;B<v;B++)this._activeProviderReplies.has(B)&&!this._activeProviderReplies.get(B)||(I=!0);if(!I&&$){const B=$.find((P=>this._linkAtPosition(P.link,g)));B&&(m=!0,this._handleNewLink(B))}if(this._activeProviderReplies.size===this._linkProviderService.linkProviders.length&&!m)for(let B=0;B<this._activeProviderReplies.size;B++){const P=this._activeProviderReplies.get(B)?.find((x=>this._linkAtPosition(x.link,g)));if(P){m=!0,this._handleNewLink(P);break}}return m}_handleMouseDown(){this._mouseDownLink=this._currentLink}_handleMouseUp(v){if(!this._currentLink)return;const g=this._positionFromMouseEvent(v,this._element,this._mouseService);g&&this._mouseDownLink===this._currentLink&&this._linkAtPosition(this._currentLink.link,g)&&this._currentLink.link.activate(v,this._currentLink.link.text)}_clearCurrentLink(v,g){this._currentLink&&this._lastMouseEvent&&(!v||!g||this._currentLink.link.range.start.y>=v&&this._currentLink.link.range.end.y<=g)&&(this._linkLeave(this._element,this._currentLink.link,this._lastMouseEvent),this._currentLink=void 0,(0,S.disposeArray)(this._linkCacheDisposables))}_handleNewLink(v){if(!this._lastMouseEvent)return;const g=this._positionFromMouseEvent(this._lastMouseEvent,this._element,this._mouseService);g&&this._linkAtPosition(v.link,g)&&(this._currentLink=v,this._currentLink.state={decorations:{underline:v.link.decorations===void 0||v.link.decorations.underline,pointerCursor:v.link.decorations===void 0||v.link.decorations.pointerCursor},isHovered:!0},this._linkHover(this._element,v.link,this._lastMouseEvent),v.link.decorations={},Object.defineProperties(v.link.decorations,{pointerCursor:{get:()=>this._currentLink?.state?.decorations.pointerCursor,set:m=>{this._currentLink?.state&&this._currentLink.state.decorations.pointerCursor!==m&&(this._currentLink.state.decorations.pointerCursor=m,this._currentLink.state.isHovered&&this._element.classList.toggle("xterm-cursor-pointer",m))}},underline:{get:()=>this._currentLink?.state?.decorations.underline,set:m=>{this._currentLink?.state&&this._currentLink?.state?.decorations.underline!==m&&(this._currentLink.state.decorations.underline=m,this._currentLink.state.isHovered&&this._fireUnderlineEvent(v.link,m))}}}),this._linkCacheDisposables.push(this._renderService.onRenderedViewportChange((m=>{if(!this._currentLink)return;const $=m.start===0?0:m.start+1+this._bufferService.buffer.ydisp,I=this._bufferService.buffer.ydisp+1+m.end;if(this._currentLink.link.range.start.y>=$&&this._currentLink.link.range.end.y<=I&&(this._clearCurrentLink($,I),this._lastMouseEvent)){const B=this._positionFromMouseEvent(this._lastMouseEvent,this._element,this._mouseService);B&&this._askForLink(B,!1)}}))))}_linkHover(v,g,m){this._currentLink?.state&&(this._currentLink.state.isHovered=!0,this._currentLink.state.decorations.underline&&this._fireUnderlineEvent(g,!0),this._currentLink.state.decorations.pointerCursor&&v.classList.add("xterm-cursor-pointer")),g.hover&&g.hover(m,g.text)}_fireUnderlineEvent(v,g){const m=v.range,$=this._bufferService.buffer.ydisp,I=this._createLinkUnderlineEvent(m.start.x-1,m.start.y-$-1,m.end.x,m.end.y-$-1,void 0);(g?this._onShowLinkUnderline:this._onHideLinkUnderline).fire(I)}_linkLeave(v,g,m){this._currentLink?.state&&(this._currentLink.state.isHovered=!1,this._currentLink.state.decorations.underline&&this._fireUnderlineEvent(g,!1),this._currentLink.state.decorations.pointerCursor&&v.classList.remove("xterm-cursor-pointer")),g.leave&&g.leave(m,g.text)}_linkAtPosition(v,g){const m=v.range.start.y*this._bufferService.cols+v.range.start.x,$=v.range.end.y*this._bufferService.cols+v.range.end.x,I=g.y*this._bufferService.cols+g.x;return m<=I&&I<=$}_positionFromMouseEvent(v,g,m){const $=m.getCoords(v,g,this._bufferService.cols,this._bufferService.rows);if($)return{x:$[0],y:$[1]+this._bufferService.buffer.ydisp}}_createLinkUnderlineEvent(v,g,m,$,I){return{x1:v,y1:g,x2:m,y2:$,cols:this._bufferService.cols,fg:I}}};o.Linkifier=w=d([l(1,A.IMouseService),l(2,A.IRenderService),l(3,k.IBufferService),l(4,A.ILinkProviderService)],w)},9042:(h,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.tooMuchOutput=o.promptLabel=void 0,o.promptLabel="Terminal input",o.tooMuchOutput="Too much output to announce, navigate to rows manually to read"},3730:function(h,o,a){var d=this&&this.__decorate||function(A,w,v,g){var m,$=arguments.length,I=$<3?w:g===null?g=Object.getOwnPropertyDescriptor(w,v):g;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")I=Reflect.decorate(A,w,v,g);else for(var B=A.length-1;B>=0;B--)(m=A[B])&&(I=($<3?m(I):$>3?m(w,v,I):m(w,v))||I);return $>3&&I&&Object.defineProperty(w,v,I),I},l=this&&this.__param||function(A,w){return function(v,g){w(v,g,A)}};Object.defineProperty(o,"__esModule",{value:!0}),o.OscLinkProvider=void 0;const f=a(511),p=a(2585);let S=o.OscLinkProvider=class{constructor(A,w,v){this._bufferService=A,this._optionsService=w,this._oscLinkService=v}provideLinks(A,w){const v=this._bufferService.buffer.lines.get(A-1);if(!v)return void w(void 0);const g=[],m=this._optionsService.rawOptions.linkHandler,$=new f.CellData,I=v.getTrimmedLength();let B=-1,P=-1,x=!1;for(let N=0;N<I;N++)if(P!==-1||v.hasContent(N)){if(v.loadCell(N,$),$.hasExtendedAttrs()&&$.extended.urlId){if(P===-1){P=N,B=$.extended.urlId;continue}x=$.extended.urlId!==B}else P!==-1&&(x=!0);if(x||P!==-1&&N===I-1){const J=this._oscLinkService.getLinkData(B)?.uri;if(J){const Q={start:{x:P+1,y:A},end:{x:N+(x||N!==I-1?0:1),y:A}};let W=!1;if(!m?.allowNonHttpProtocols)try{const Y=new URL(J);["http:","https:"].includes(Y.protocol)||(W=!0)}catch{W=!0}W||g.push({text:J,range:Q,activate:(Y,ve)=>m?m.activate(Y,ve,Q):k(0,ve),hover:(Y,ve)=>m?.hover?.(Y,ve,Q),leave:(Y,ve)=>m?.leave?.(Y,ve,Q)})}x=!1,$.hasExtendedAttrs()&&$.extended.urlId?(P=N,B=$.extended.urlId):(P=-1,B=-1)}}w(g)}};function k(A,w){if(confirm(`Do you want to navigate to ${w}?

WARNING: This link could potentially be dangerous`)){const v=window.open();if(v){try{v.opener=null}catch{}v.location.href=w}else console.warn("Opening link blocked as opener could not be cleared")}}o.OscLinkProvider=S=d([l(0,p.IBufferService),l(1,p.IOptionsService),l(2,p.IOscLinkService)],S)},6193:(h,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.RenderDebouncer=void 0,o.RenderDebouncer=class{constructor(a,d){this._renderCallback=a,this._coreBrowserService=d,this._refreshCallbacks=[]}dispose(){this._animationFrame&&(this._coreBrowserService.window.cancelAnimationFrame(this._animationFrame),this._animationFrame=void 0)}addRefreshCallback(a){return this._refreshCallbacks.push(a),this._animationFrame||(this._animationFrame=this._coreBrowserService.window.requestAnimationFrame((()=>this._innerRefresh()))),this._animationFrame}refresh(a,d,l){this._rowCount=l,a=a!==void 0?a:0,d=d!==void 0?d:this._rowCount-1,this._rowStart=this._rowStart!==void 0?Math.min(this._rowStart,a):a,this._rowEnd=this._rowEnd!==void 0?Math.max(this._rowEnd,d):d,this._animationFrame||(this._animationFrame=this._coreBrowserService.window.requestAnimationFrame((()=>this._innerRefresh())))}_innerRefresh(){if(this._animationFrame=void 0,this._rowStart===void 0||this._rowEnd===void 0||this._rowCount===void 0)return void this._runRefreshCallbacks();const a=Math.max(this._rowStart,0),d=Math.min(this._rowEnd,this._rowCount-1);this._rowStart=void 0,this._rowEnd=void 0,this._renderCallback(a,d),this._runRefreshCallbacks()}_runRefreshCallbacks(){for(const a of this._refreshCallbacks)a(0);this._refreshCallbacks=[]}}},3236:(h,o,a)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.Terminal=void 0;const d=a(3614),l=a(3656),f=a(3551),p=a(9042),S=a(3730),k=a(1680),A=a(3107),w=a(5744),v=a(2950),g=a(1296),m=a(428),$=a(4269),I=a(5114),B=a(8934),P=a(3230),x=a(9312),N=a(4725),J=a(6731),Q=a(8055),W=a(8969),Y=a(8460),ve=a(844),Be=a(6114),je=a(8437),xe=a(2584),ke=a(7399),q=a(5941),j=a(9074),H=a(2585),G=a(5435),V=a(4567),oe=a(779);class Z extends W.CoreTerminal{get onFocus(){return this._onFocus.event}get onBlur(){return this._onBlur.event}get onA11yChar(){return this._onA11yCharEmitter.event}get onA11yTab(){return this._onA11yTabEmitter.event}get onWillOpen(){return this._onWillOpen.event}constructor(ce={}){super(ce),this.browser=Be,this._keyDownHandled=!1,this._keyDownSeen=!1,this._keyPressHandled=!1,this._unprocessedDeadKey=!1,this._accessibilityManager=this.register(new ve.MutableDisposable),this._onCursorMove=this.register(new Y.EventEmitter),this.onCursorMove=this._onCursorMove.event,this._onKey=this.register(new Y.EventEmitter),this.onKey=this._onKey.event,this._onRender=this.register(new Y.EventEmitter),this.onRender=this._onRender.event,this._onSelectionChange=this.register(new Y.EventEmitter),this.onSelectionChange=this._onSelectionChange.event,this._onTitleChange=this.register(new Y.EventEmitter),this.onTitleChange=this._onTitleChange.event,this._onBell=this.register(new Y.EventEmitter),this.onBell=this._onBell.event,this._onFocus=this.register(new Y.EventEmitter),this._onBlur=this.register(new Y.EventEmitter),this._onA11yCharEmitter=this.register(new Y.EventEmitter),this._onA11yTabEmitter=this.register(new Y.EventEmitter),this._onWillOpen=this.register(new Y.EventEmitter),this._setup(),this._decorationService=this._instantiationService.createInstance(j.DecorationService),this._instantiationService.setService(H.IDecorationService,this._decorationService),this._linkProviderService=this._instantiationService.createInstance(oe.LinkProviderService),this._instantiationService.setService(N.ILinkProviderService,this._linkProviderService),this._linkProviderService.registerLinkProvider(this._instantiationService.createInstance(S.OscLinkProvider)),this.register(this._inputHandler.onRequestBell((()=>this._onBell.fire()))),this.register(this._inputHandler.onRequestRefreshRows(((U,ye)=>this.refresh(U,ye)))),this.register(this._inputHandler.onRequestSendFocus((()=>this._reportFocus()))),this.register(this._inputHandler.onRequestReset((()=>this.reset()))),this.register(this._inputHandler.onRequestWindowsOptionsReport((U=>this._reportWindowsOptions(U)))),this.register(this._inputHandler.onColor((U=>this._handleColorEvent(U)))),this.register((0,Y.forwardEvent)(this._inputHandler.onCursorMove,this._onCursorMove)),this.register((0,Y.forwardEvent)(this._inputHandler.onTitleChange,this._onTitleChange)),this.register((0,Y.forwardEvent)(this._inputHandler.onA11yChar,this._onA11yCharEmitter)),this.register((0,Y.forwardEvent)(this._inputHandler.onA11yTab,this._onA11yTabEmitter)),this.register(this._bufferService.onResize((U=>this._afterResize(U.cols,U.rows)))),this.register((0,ve.toDisposable)((()=>{this._customKeyEventHandler=void 0,this.element?.parentNode?.removeChild(this.element)})))}_handleColorEvent(ce){if(this._themeService)for(const U of ce){let ye,be="";switch(U.index){case 256:ye="foreground",be="10";break;case 257:ye="background",be="11";break;case 258:ye="cursor",be="12";break;default:ye="ansi",be="4;"+U.index}switch(U.type){case 0:const Pe=Q.color.toColorRGB(ye==="ansi"?this._themeService.colors.ansi[U.index]:this._themeService.colors[ye]);this.coreService.triggerDataEvent(`${xe.C0.ESC}]${be};${(0,q.toRgbString)(Pe)}${xe.C1_ESCAPED.ST}`);break;case 1:if(ye==="ansi")this._themeService.modifyColors((Oe=>Oe.ansi[U.index]=Q.channels.toColor(...U.color)));else{const Oe=ye;this._themeService.modifyColors((Ue=>Ue[Oe]=Q.channels.toColor(...U.color)))}break;case 2:this._themeService.restoreColor(U.index)}}}_setup(){super._setup(),this._customKeyEventHandler=void 0}get buffer(){return this.buffers.active}focus(){this.textarea&&this.textarea.focus({preventScroll:!0})}_handleScreenReaderModeOptionChange(ce){ce?!this._accessibilityManager.value&&this._renderService&&(this._accessibilityManager.value=this._instantiationService.createInstance(V.AccessibilityManager,this)):this._accessibilityManager.clear()}_handleTextAreaFocus(ce){this.coreService.decPrivateModes.sendFocus&&this.coreService.triggerDataEvent(xe.C0.ESC+"[I"),this.element.classList.add("focus"),this._showCursor(),this._onFocus.fire()}blur(){return this.textarea?.blur()}_handleTextAreaBlur(){this.textarea.value="",this.refresh(this.buffer.y,this.buffer.y),this.coreService.decPrivateModes.sendFocus&&this.coreService.triggerDataEvent(xe.C0.ESC+"[O"),this.element.classList.remove("focus"),this._onBlur.fire()}_syncTextArea(){if(!this.textarea||!this.buffer.isCursorInViewport||this._compositionHelper.isComposing||!this._renderService)return;const ce=this.buffer.ybase+this.buffer.y,U=this.buffer.lines.get(ce);if(!U)return;const ye=Math.min(this.buffer.x,this.cols-1),be=this._renderService.dimensions.css.cell.height,Pe=U.getWidth(ye),Oe=this._renderService.dimensions.css.cell.width*Pe,Ue=this.buffer.y*this._renderService.dimensions.css.cell.height,rt=ye*this._renderService.dimensions.css.cell.width;this.textarea.style.left=rt+"px",this.textarea.style.top=Ue+"px",this.textarea.style.width=Oe+"px",this.textarea.style.height=be+"px",this.textarea.style.lineHeight=be+"px",this.textarea.style.zIndex="-5"}_initGlobal(){this._bindKeys(),this.register((0,l.addDisposableDomListener)(this.element,"copy",(U=>{this.hasSelection()&&(0,d.copyHandler)(U,this._selectionService)})));const ce=U=>(0,d.handlePasteEvent)(U,this.textarea,this.coreService,this.optionsService);this.register((0,l.addDisposableDomListener)(this.textarea,"paste",ce)),this.register((0,l.addDisposableDomListener)(this.element,"paste",ce)),Be.isFirefox?this.register((0,l.addDisposableDomListener)(this.element,"mousedown",(U=>{U.button===2&&(0,d.rightClickHandler)(U,this.textarea,this.screenElement,this._selectionService,this.options.rightClickSelectsWord)}))):this.register((0,l.addDisposableDomListener)(this.element,"contextmenu",(U=>{(0,d.rightClickHandler)(U,this.textarea,this.screenElement,this._selectionService,this.options.rightClickSelectsWord)}))),Be.isLinux&&this.register((0,l.addDisposableDomListener)(this.element,"auxclick",(U=>{U.button===1&&(0,d.moveTextAreaUnderMouseCursor)(U,this.textarea,this.screenElement)})))}_bindKeys(){this.register((0,l.addDisposableDomListener)(this.textarea,"keyup",(ce=>this._keyUp(ce)),!0)),this.register((0,l.addDisposableDomListener)(this.textarea,"keydown",(ce=>this._keyDown(ce)),!0)),this.register((0,l.addDisposableDomListener)(this.textarea,"keypress",(ce=>this._keyPress(ce)),!0)),this.register((0,l.addDisposableDomListener)(this.textarea,"compositionstart",(()=>this._compositionHelper.compositionstart()))),this.register((0,l.addDisposableDomListener)(this.textarea,"compositionupdate",(ce=>this._compositionHelper.compositionupdate(ce)))),this.register((0,l.addDisposableDomListener)(this.textarea,"compositionend",(()=>this._compositionHelper.compositionend()))),this.register((0,l.addDisposableDomListener)(this.textarea,"input",(ce=>this._inputEvent(ce)),!0)),this.register(this.onRender((()=>this._compositionHelper.updateCompositionElements())))}open(ce){if(!ce)throw new Error("Terminal requires a parent element.");if(ce.isConnected||this._logService.debug("Terminal.open was called on an element that was not attached to the DOM"),this.element?.ownerDocument.defaultView&&this._coreBrowserService)return void(this.element.ownerDocument.defaultView!==this._coreBrowserService.window&&(this._coreBrowserService.window=this.element.ownerDocument.defaultView));this._document=ce.ownerDocument,this.options.documentOverride&&this.options.documentOverride instanceof Document&&(this._document=this.optionsService.rawOptions.documentOverride),this.element=this._document.createElement("div"),this.element.dir="ltr",this.element.classList.add("terminal"),this.element.classList.add("xterm"),ce.appendChild(this.element);const U=this._document.createDocumentFragment();this._viewportElement=this._document.createElement("div"),this._viewportElement.classList.add("xterm-viewport"),U.appendChild(this._viewportElement),this._viewportScrollArea=this._document.createElement("div"),this._viewportScrollArea.classList.add("xterm-scroll-area"),this._viewportElement.appendChild(this._viewportScrollArea),this.screenElement=this._document.createElement("div"),this.screenElement.classList.add("xterm-screen"),this.register((0,l.addDisposableDomListener)(this.screenElement,"mousemove",(ye=>this.updateCursorStyle(ye)))),this._helperContainer=this._document.createElement("div"),this._helperContainer.classList.add("xterm-helpers"),this.screenElement.appendChild(this._helperContainer),U.appendChild(this.screenElement),this.textarea=this._document.createElement("textarea"),this.textarea.classList.add("xterm-helper-textarea"),this.textarea.setAttribute("aria-label",p.promptLabel),Be.isChromeOS||this.textarea.setAttribute("aria-multiline","false"),this.textarea.setAttribute("autocorrect","off"),this.textarea.setAttribute("autocapitalize","off"),this.textarea.setAttribute("spellcheck","false"),this.textarea.tabIndex=0,this._coreBrowserService=this.register(this._instantiationService.createInstance(I.CoreBrowserService,this.textarea,ce.ownerDocument.defaultView??window,this._document??typeof window<"u"?window.document:null)),this._instantiationService.setService(N.ICoreBrowserService,this._coreBrowserService),this.register((0,l.addDisposableDomListener)(this.textarea,"focus",(ye=>this._handleTextAreaFocus(ye)))),this.register((0,l.addDisposableDomListener)(this.textarea,"blur",(()=>this._handleTextAreaBlur()))),this._helperContainer.appendChild(this.textarea),this._charSizeService=this._instantiationService.createInstance(m.CharSizeService,this._document,this._helperContainer),this._instantiationService.setService(N.ICharSizeService,this._charSizeService),this._themeService=this._instantiationService.createInstance(J.ThemeService),this._instantiationService.setService(N.IThemeService,this._themeService),this._characterJoinerService=this._instantiationService.createInstance($.CharacterJoinerService),this._instantiationService.setService(N.ICharacterJoinerService,this._characterJoinerService),this._renderService=this.register(this._instantiationService.createInstance(P.RenderService,this.rows,this.screenElement)),this._instantiationService.setService(N.IRenderService,this._renderService),this.register(this._renderService.onRenderedViewportChange((ye=>this._onRender.fire(ye)))),this.onResize((ye=>this._renderService.resize(ye.cols,ye.rows))),this._compositionView=this._document.createElement("div"),this._compositionView.classList.add("composition-view"),this._compositionHelper=this._instantiationService.createInstance(v.CompositionHelper,this.textarea,this._compositionView),this._helperContainer.appendChild(this._compositionView),this._mouseService=this._instantiationService.createInstance(B.MouseService),this._instantiationService.setService(N.IMouseService,this._mouseService),this.linkifier=this.register(this._instantiationService.createInstance(f.Linkifier,this.screenElement)),this.element.appendChild(U);try{this._onWillOpen.fire(this.element)}catch{}this._renderService.hasRenderer()||this._renderService.setRenderer(this._createRenderer()),this.viewport=this._instantiationService.createInstance(k.Viewport,this._viewportElement,this._viewportScrollArea),this.viewport.onRequestScrollLines((ye=>this.scrollLines(ye.amount,ye.suppressScrollEvent,1))),this.register(this._inputHandler.onRequestSyncScrollBar((()=>this.viewport.syncScrollArea()))),this.register(this.viewport),this.register(this.onCursorMove((()=>{this._renderService.handleCursorMove(),this._syncTextArea()}))),this.register(this.onResize((()=>this._renderService.handleResize(this.cols,this.rows)))),this.register(this.onBlur((()=>this._renderService.handleBlur()))),this.register(this.onFocus((()=>this._renderService.handleFocus()))),this.register(this._renderService.onDimensionsChange((()=>this.viewport.syncScrollArea()))),this._selectionService=this.register(this._instantiationService.createInstance(x.SelectionService,this.element,this.screenElement,this.linkifier)),this._instantiationService.setService(N.ISelectionService,this._selectionService),this.register(this._selectionService.onRequestScrollLines((ye=>this.scrollLines(ye.amount,ye.suppressScrollEvent)))),this.register(this._selectionService.onSelectionChange((()=>this._onSelectionChange.fire()))),this.register(this._selectionService.onRequestRedraw((ye=>this._renderService.handleSelectionChanged(ye.start,ye.end,ye.columnSelectMode)))),this.register(this._selectionService.onLinuxMouseSelection((ye=>{this.textarea.value=ye,this.textarea.focus(),this.textarea.select()}))),this.register(this._onScroll.event((ye=>{this.viewport.syncScrollArea(),this._selectionService.refresh()}))),this.register((0,l.addDisposableDomListener)(this._viewportElement,"scroll",(()=>this._selectionService.refresh()))),this.register(this._instantiationService.createInstance(A.BufferDecorationRenderer,this.screenElement)),this.register((0,l.addDisposableDomListener)(this.element,"mousedown",(ye=>this._selectionService.handleMouseDown(ye)))),this.coreMouseService.areMouseEventsActive?(this._selectionService.disable(),this.element.classList.add("enable-mouse-events")):this._selectionService.enable(),this.options.screenReaderMode&&(this._accessibilityManager.value=this._instantiationService.createInstance(V.AccessibilityManager,this)),this.register(this.optionsService.onSpecificOptionChange("screenReaderMode",(ye=>this._handleScreenReaderModeOptionChange(ye)))),this.options.overviewRulerWidth&&(this._overviewRulerRenderer=this.register(this._instantiationService.createInstance(w.OverviewRulerRenderer,this._viewportElement,this.screenElement))),this.optionsService.onSpecificOptionChange("overviewRulerWidth",(ye=>{!this._overviewRulerRenderer&&ye&&this._viewportElement&&this.screenElement&&(this._overviewRulerRenderer=this.register(this._instantiationService.createInstance(w.OverviewRulerRenderer,this._viewportElement,this.screenElement)))})),this._charSizeService.measure(),this.refresh(0,this.rows-1),this._initGlobal(),this.bindMouse()}_createRenderer(){return this._instantiationService.createInstance(g.DomRenderer,this,this._document,this.element,this.screenElement,this._viewportElement,this._helperContainer,this.linkifier)}bindMouse(){const ce=this,U=this.element;function ye(Oe){const Ue=ce._mouseService.getMouseReportCoords(Oe,ce.screenElement);if(!Ue)return!1;let rt,yt;switch(Oe.overrideType||Oe.type){case"mousemove":yt=32,Oe.buttons===void 0?(rt=3,Oe.button!==void 0&&(rt=Oe.button<3?Oe.button:3)):rt=1&Oe.buttons?0:4&Oe.buttons?1:2&Oe.buttons?2:3;break;case"mouseup":yt=0,rt=Oe.button<3?Oe.button:3;break;case"mousedown":yt=1,rt=Oe.button<3?Oe.button:3;break;case"wheel":if(ce._customWheelEventHandler&&ce._customWheelEventHandler(Oe)===!1||ce.viewport.getLinesScrolled(Oe)===0)return!1;yt=Oe.deltaY<0?0:1,rt=4;break;default:return!1}return!(yt===void 0||rt===void 0||rt>4)&&ce.coreMouseService.triggerMouseEvent({col:Ue.col,row:Ue.row,x:Ue.x,y:Ue.y,button:rt,action:yt,ctrl:Oe.ctrlKey,alt:Oe.altKey,shift:Oe.shiftKey})}const be={mouseup:null,wheel:null,mousedrag:null,mousemove:null},Pe={mouseup:Oe=>(ye(Oe),Oe.buttons||(this._document.removeEventListener("mouseup",be.mouseup),be.mousedrag&&this._document.removeEventListener("mousemove",be.mousedrag)),this.cancel(Oe)),wheel:Oe=>(ye(Oe),this.cancel(Oe,!0)),mousedrag:Oe=>{Oe.buttons&&ye(Oe)},mousemove:Oe=>{Oe.buttons||ye(Oe)}};this.register(this.coreMouseService.onProtocolChange((Oe=>{Oe?(this.optionsService.rawOptions.logLevel==="debug"&&this._logService.debug("Binding to mouse events:",this.coreMouseService.explainEvents(Oe)),this.element.classList.add("enable-mouse-events"),this._selectionService.disable()):(this._logService.debug("Unbinding from mouse events."),this.element.classList.remove("enable-mouse-events"),this._selectionService.enable()),8&Oe?be.mousemove||(U.addEventListener("mousemove",Pe.mousemove),be.mousemove=Pe.mousemove):(U.removeEventListener("mousemove",be.mousemove),be.mousemove=null),16&Oe?be.wheel||(U.addEventListener("wheel",Pe.wheel,{passive:!1}),be.wheel=Pe.wheel):(U.removeEventListener("wheel",be.wheel),be.wheel=null),2&Oe?be.mouseup||(be.mouseup=Pe.mouseup):(this._document.removeEventListener("mouseup",be.mouseup),be.mouseup=null),4&Oe?be.mousedrag||(be.mousedrag=Pe.mousedrag):(this._document.removeEventListener("mousemove",be.mousedrag),be.mousedrag=null)}))),this.coreMouseService.activeProtocol=this.coreMouseService.activeProtocol,this.register((0,l.addDisposableDomListener)(U,"mousedown",(Oe=>{if(Oe.preventDefault(),this.focus(),this.coreMouseService.areMouseEventsActive&&!this._selectionService.shouldForceSelection(Oe))return ye(Oe),be.mouseup&&this._document.addEventListener("mouseup",be.mouseup),be.mousedrag&&this._document.addEventListener("mousemove",be.mousedrag),this.cancel(Oe)}))),this.register((0,l.addDisposableDomListener)(U,"wheel",(Oe=>{if(!be.wheel){if(this._customWheelEventHandler&&this._customWheelEventHandler(Oe)===!1)return!1;if(!this.buffer.hasScrollback){const Ue=this.viewport.getLinesScrolled(Oe);if(Ue===0)return;const rt=xe.C0.ESC+(this.coreService.decPrivateModes.applicationCursorKeys?"O":"[")+(Oe.deltaY<0?"A":"B");let yt="";for(let dt=0;dt<Math.abs(Ue);dt++)yt+=rt;return this.coreService.triggerDataEvent(yt,!0),this.cancel(Oe,!0)}return this.viewport.handleWheel(Oe)?this.cancel(Oe):void 0}}),{passive:!1})),this.register((0,l.addDisposableDomListener)(U,"touchstart",(Oe=>{if(!this.coreMouseService.areMouseEventsActive)return this.viewport.handleTouchStart(Oe),this.cancel(Oe)}),{passive:!0})),this.register((0,l.addDisposableDomListener)(U,"touchmove",(Oe=>{if(!this.coreMouseService.areMouseEventsActive)return this.viewport.handleTouchMove(Oe)?void 0:this.cancel(Oe)}),{passive:!1}))}refresh(ce,U){this._renderService?.refreshRows(ce,U)}updateCursorStyle(ce){this._selectionService?.shouldColumnSelect(ce)?this.element.classList.add("column-select"):this.element.classList.remove("column-select")}_showCursor(){this.coreService.isCursorInitialized||(this.coreService.isCursorInitialized=!0,this.refresh(this.buffer.y,this.buffer.y))}scrollLines(ce,U,ye=0){ye===1?(super.scrollLines(ce,U,ye),this.refresh(0,this.rows-1)):this.viewport?.scrollLines(ce)}paste(ce){(0,d.paste)(ce,this.textarea,this.coreService,this.optionsService)}attachCustomKeyEventHandler(ce){this._customKeyEventHandler=ce}attachCustomWheelEventHandler(ce){this._customWheelEventHandler=ce}registerLinkProvider(ce){return this._linkProviderService.registerLinkProvider(ce)}registerCharacterJoiner(ce){if(!this._characterJoinerService)throw new Error("Terminal must be opened first");const U=this._characterJoinerService.register(ce);return this.refresh(0,this.rows-1),U}deregisterCharacterJoiner(ce){if(!this._characterJoinerService)throw new Error("Terminal must be opened first");this._characterJoinerService.deregister(ce)&&this.refresh(0,this.rows-1)}get markers(){return this.buffer.markers}registerMarker(ce){return this.buffer.addMarker(this.buffer.ybase+this.buffer.y+ce)}registerDecoration(ce){return this._decorationService.registerDecoration(ce)}hasSelection(){return!!this._selectionService&&this._selectionService.hasSelection}select(ce,U,ye){this._selectionService.setSelection(ce,U,ye)}getSelection(){return this._selectionService?this._selectionService.selectionText:""}getSelectionPosition(){if(this._selectionService&&this._selectionService.hasSelection)return{start:{x:this._selectionService.selectionStart[0],y:this._selectionService.selectionStart[1]},end:{x:this._selectionService.selectionEnd[0],y:this._selectionService.selectionEnd[1]}}}clearSelection(){this._selectionService?.clearSelection()}selectAll(){this._selectionService?.selectAll()}selectLines(ce,U){this._selectionService?.selectLines(ce,U)}_keyDown(ce){if(this._keyDownHandled=!1,this._keyDownSeen=!0,this._customKeyEventHandler&&this._customKeyEventHandler(ce)===!1)return!1;const U=this.browser.isMac&&this.options.macOptionIsMeta&&ce.altKey;if(!U&&!this._compositionHelper.keydown(ce))return this.options.scrollOnUserInput&&this.buffer.ybase!==this.buffer.ydisp&&this.scrollToBottom(),!1;U||ce.key!=="Dead"&&ce.key!=="AltGraph"||(this._unprocessedDeadKey=!0);const ye=(0,ke.evaluateKeyboardEvent)(ce,this.coreService.decPrivateModes.applicationCursorKeys,this.browser.isMac,this.options.macOptionIsMeta);if(this.updateCursorStyle(ce),ye.type===3||ye.type===2){const be=this.rows-1;return this.scrollLines(ye.type===2?-be:be),this.cancel(ce,!0)}return ye.type===1&&this.selectAll(),!!this._isThirdLevelShift(this.browser,ce)||(ye.cancel&&this.cancel(ce,!0),!ye.key||!!(ce.key&&!ce.ctrlKey&&!ce.altKey&&!ce.metaKey&&ce.key.length===1&&ce.key.charCodeAt(0)>=65&&ce.key.charCodeAt(0)<=90)||(this._unprocessedDeadKey?(this._unprocessedDeadKey=!1,!0):(ye.key!==xe.C0.ETX&&ye.key!==xe.C0.CR||(this.textarea.value=""),this._onKey.fire({key:ye.key,domEvent:ce}),this._showCursor(),this.coreService.triggerDataEvent(ye.key,!0),!this.optionsService.rawOptions.screenReaderMode||ce.altKey||ce.ctrlKey?this.cancel(ce,!0):void(this._keyDownHandled=!0))))}_isThirdLevelShift(ce,U){const ye=ce.isMac&&!this.options.macOptionIsMeta&&U.altKey&&!U.ctrlKey&&!U.metaKey||ce.isWindows&&U.altKey&&U.ctrlKey&&!U.metaKey||ce.isWindows&&U.getModifierState("AltGraph");return U.type==="keypress"?ye:ye&&(!U.keyCode||U.keyCode>47)}_keyUp(ce){this._keyDownSeen=!1,this._customKeyEventHandler&&this._customKeyEventHandler(ce)===!1||((function(U){return U.keyCode===16||U.keyCode===17||U.keyCode===18})(ce)||this.focus(),this.updateCursorStyle(ce),this._keyPressHandled=!1)}_keyPress(ce){let U;if(this._keyPressHandled=!1,this._keyDownHandled||this._customKeyEventHandler&&this._customKeyEventHandler(ce)===!1)return!1;if(this.cancel(ce),ce.charCode)U=ce.charCode;else if(ce.which===null||ce.which===void 0)U=ce.keyCode;else{if(ce.which===0||ce.charCode===0)return!1;U=ce.which}return!(!U||(ce.altKey||ce.ctrlKey||ce.metaKey)&&!this._isThirdLevelShift(this.browser,ce)||(U=String.fromCharCode(U),this._onKey.fire({key:U,domEvent:ce}),this._showCursor(),this.coreService.triggerDataEvent(U,!0),this._keyPressHandled=!0,this._unprocessedDeadKey=!1,0))}_inputEvent(ce){if(ce.data&&ce.inputType==="insertText"&&(!ce.composed||!this._keyDownSeen)&&!this.optionsService.rawOptions.screenReaderMode){if(this._keyPressHandled)return!1;this._unprocessedDeadKey=!1;const U=ce.data;return this.coreService.triggerDataEvent(U,!0),this.cancel(ce),!0}return!1}resize(ce,U){ce!==this.cols||U!==this.rows?super.resize(ce,U):this._charSizeService&&!this._charSizeService.hasValidSize&&this._charSizeService.measure()}_afterResize(ce,U){this._charSizeService?.measure(),this.viewport?.syncScrollArea(!0)}clear(){if(this.buffer.ybase!==0||this.buffer.y!==0){this.buffer.clearAllMarkers(),this.buffer.lines.set(0,this.buffer.lines.get(this.buffer.ybase+this.buffer.y)),this.buffer.lines.length=1,this.buffer.ydisp=0,this.buffer.ybase=0,this.buffer.y=0;for(let ce=1;ce<this.rows;ce++)this.buffer.lines.push(this.buffer.getBlankLine(je.DEFAULT_ATTR_DATA));this._onScroll.fire({position:this.buffer.ydisp,source:0}),this.viewport?.reset(),this.refresh(0,this.rows-1)}}reset(){this.options.rows=this.rows,this.options.cols=this.cols;const ce=this._customKeyEventHandler;this._setup(),super.reset(),this._selectionService?.reset(),this._decorationService.reset(),this.viewport?.reset(),this._customKeyEventHandler=ce,this.refresh(0,this.rows-1)}clearTextureAtlas(){this._renderService?.clearTextureAtlas()}_reportFocus(){this.element?.classList.contains("focus")?this.coreService.triggerDataEvent(xe.C0.ESC+"[I"):this.coreService.triggerDataEvent(xe.C0.ESC+"[O")}_reportWindowsOptions(ce){if(this._renderService)switch(ce){case G.WindowsOptionsReportType.GET_WIN_SIZE_PIXELS:const U=this._renderService.dimensions.css.canvas.width.toFixed(0),ye=this._renderService.dimensions.css.canvas.height.toFixed(0);this.coreService.triggerDataEvent(`${xe.C0.ESC}[4;${ye};${U}t`);break;case G.WindowsOptionsReportType.GET_CELL_SIZE_PIXELS:const be=this._renderService.dimensions.css.cell.width.toFixed(0),Pe=this._renderService.dimensions.css.cell.height.toFixed(0);this.coreService.triggerDataEvent(`${xe.C0.ESC}[6;${Pe};${be}t`)}}cancel(ce,U){if(this.options.cancelEvents||U)return ce.preventDefault(),ce.stopPropagation(),!1}}o.Terminal=Z},9924:(h,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.TimeBasedDebouncer=void 0,o.TimeBasedDebouncer=class{constructor(a,d=1e3){this._renderCallback=a,this._debounceThresholdMS=d,this._lastRefreshMs=0,this._additionalRefreshRequested=!1}dispose(){this._refreshTimeoutID&&clearTimeout(this._refreshTimeoutID)}refresh(a,d,l){this._rowCount=l,a=a!==void 0?a:0,d=d!==void 0?d:this._rowCount-1,this._rowStart=this._rowStart!==void 0?Math.min(this._rowStart,a):a,this._rowEnd=this._rowEnd!==void 0?Math.max(this._rowEnd,d):d;const f=Date.now();if(f-this._lastRefreshMs>=this._debounceThresholdMS)this._lastRefreshMs=f,this._innerRefresh();else if(!this._additionalRefreshRequested){const p=f-this._lastRefreshMs,S=this._debounceThresholdMS-p;this._additionalRefreshRequested=!0,this._refreshTimeoutID=window.setTimeout((()=>{this._lastRefreshMs=Date.now(),this._innerRefresh(),this._additionalRefreshRequested=!1,this._refreshTimeoutID=void 0}),S)}}_innerRefresh(){if(this._rowStart===void 0||this._rowEnd===void 0||this._rowCount===void 0)return;const a=Math.max(this._rowStart,0),d=Math.min(this._rowEnd,this._rowCount-1);this._rowStart=void 0,this._rowEnd=void 0,this._renderCallback(a,d)}}},1680:function(h,o,a){var d=this&&this.__decorate||function(v,g,m,$){var I,B=arguments.length,P=B<3?g:$===null?$=Object.getOwnPropertyDescriptor(g,m):$;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")P=Reflect.decorate(v,g,m,$);else for(var x=v.length-1;x>=0;x--)(I=v[x])&&(P=(B<3?I(P):B>3?I(g,m,P):I(g,m))||P);return B>3&&P&&Object.defineProperty(g,m,P),P},l=this&&this.__param||function(v,g){return function(m,$){g(m,$,v)}};Object.defineProperty(o,"__esModule",{value:!0}),o.Viewport=void 0;const f=a(3656),p=a(4725),S=a(8460),k=a(844),A=a(2585);let w=o.Viewport=class extends k.Disposable{constructor(v,g,m,$,I,B,P,x){super(),this._viewportElement=v,this._scrollArea=g,this._bufferService=m,this._optionsService=$,this._charSizeService=I,this._renderService=B,this._coreBrowserService=P,this.scrollBarWidth=0,this._currentRowHeight=0,this._currentDeviceCellHeight=0,this._lastRecordedBufferLength=0,this._lastRecordedViewportHeight=0,this._lastRecordedBufferHeight=0,this._lastTouchY=0,this._lastScrollTop=0,this._wheelPartialScroll=0,this._refreshAnimationFrame=null,this._ignoreNextScrollEvent=!1,this._smoothScrollState={startTime:0,origin:-1,target:-1},this._onRequestScrollLines=this.register(new S.EventEmitter),this.onRequestScrollLines=this._onRequestScrollLines.event,this.scrollBarWidth=this._viewportElement.offsetWidth-this._scrollArea.offsetWidth||15,this.register((0,f.addDisposableDomListener)(this._viewportElement,"scroll",this._handleScroll.bind(this))),this._activeBuffer=this._bufferService.buffer,this.register(this._bufferService.buffers.onBufferActivate((N=>this._activeBuffer=N.activeBuffer))),this._renderDimensions=this._renderService.dimensions,this.register(this._renderService.onDimensionsChange((N=>this._renderDimensions=N))),this._handleThemeChange(x.colors),this.register(x.onChangeColors((N=>this._handleThemeChange(N)))),this.register(this._optionsService.onSpecificOptionChange("scrollback",(()=>this.syncScrollArea()))),setTimeout((()=>this.syncScrollArea()))}_handleThemeChange(v){this._viewportElement.style.backgroundColor=v.background.css}reset(){this._currentRowHeight=0,this._currentDeviceCellHeight=0,this._lastRecordedBufferLength=0,this._lastRecordedViewportHeight=0,this._lastRecordedBufferHeight=0,this._lastTouchY=0,this._lastScrollTop=0,this._coreBrowserService.window.requestAnimationFrame((()=>this.syncScrollArea()))}_refresh(v){if(v)return this._innerRefresh(),void(this._refreshAnimationFrame!==null&&this._coreBrowserService.window.cancelAnimationFrame(this._refreshAnimationFrame));this._refreshAnimationFrame===null&&(this._refreshAnimationFrame=this._coreBrowserService.window.requestAnimationFrame((()=>this._innerRefresh())))}_innerRefresh(){if(this._charSizeService.height>0){this._currentRowHeight=this._renderDimensions.device.cell.height/this._coreBrowserService.dpr,this._currentDeviceCellHeight=this._renderDimensions.device.cell.height,this._lastRecordedViewportHeight=this._viewportElement.offsetHeight;const g=Math.round(this._currentRowHeight*this._lastRecordedBufferLength)+(this._lastRecordedViewportHeight-this._renderDimensions.css.canvas.height);this._lastRecordedBufferHeight!==g&&(this._lastRecordedBufferHeight=g,this._scrollArea.style.height=this._lastRecordedBufferHeight+"px")}const v=this._bufferService.buffer.ydisp*this._currentRowHeight;this._viewportElement.scrollTop!==v&&(this._ignoreNextScrollEvent=!0,this._viewportElement.scrollTop=v),this._refreshAnimationFrame=null}syncScrollArea(v=!1){if(this._lastRecordedBufferLength!==this._bufferService.buffer.lines.length)return this._lastRecordedBufferLength=this._bufferService.buffer.lines.length,void this._refresh(v);this._lastRecordedViewportHeight===this._renderService.dimensions.css.canvas.height&&this._lastScrollTop===this._activeBuffer.ydisp*this._currentRowHeight&&this._renderDimensions.device.cell.height===this._currentDeviceCellHeight||this._refresh(v)}_handleScroll(v){if(this._lastScrollTop=this._viewportElement.scrollTop,!this._viewportElement.offsetParent)return;if(this._ignoreNextScrollEvent)return this._ignoreNextScrollEvent=!1,void this._onRequestScrollLines.fire({amount:0,suppressScrollEvent:!0});const g=Math.round(this._lastScrollTop/this._currentRowHeight)-this._bufferService.buffer.ydisp;this._onRequestScrollLines.fire({amount:g,suppressScrollEvent:!0})}_smoothScroll(){if(this._isDisposed||this._smoothScrollState.origin===-1||this._smoothScrollState.target===-1)return;const v=this._smoothScrollPercent();this._viewportElement.scrollTop=this._smoothScrollState.origin+Math.round(v*(this._smoothScrollState.target-this._smoothScrollState.origin)),v<1?this._coreBrowserService.window.requestAnimationFrame((()=>this._smoothScroll())):this._clearSmoothScrollState()}_smoothScrollPercent(){return this._optionsService.rawOptions.smoothScrollDuration&&this._smoothScrollState.startTime?Math.max(Math.min((Date.now()-this._smoothScrollState.startTime)/this._optionsService.rawOptions.smoothScrollDuration,1),0):1}_clearSmoothScrollState(){this._smoothScrollState.startTime=0,this._smoothScrollState.origin=-1,this._smoothScrollState.target=-1}_bubbleScroll(v,g){const m=this._viewportElement.scrollTop+this._lastRecordedViewportHeight;return!(g<0&&this._viewportElement.scrollTop!==0||g>0&&m<this._lastRecordedBufferHeight)||(v.cancelable&&v.preventDefault(),!1)}handleWheel(v){const g=this._getPixelsScrolled(v);return g!==0&&(this._optionsService.rawOptions.smoothScrollDuration?(this._smoothScrollState.startTime=Date.now(),this._smoothScrollPercent()<1?(this._smoothScrollState.origin=this._viewportElement.scrollTop,this._smoothScrollState.target===-1?this._smoothScrollState.target=this._viewportElement.scrollTop+g:this._smoothScrollState.target+=g,this._smoothScrollState.target=Math.max(Math.min(this._smoothScrollState.target,this._viewportElement.scrollHeight),0),this._smoothScroll()):this._clearSmoothScrollState()):this._viewportElement.scrollTop+=g,this._bubbleScroll(v,g))}scrollLines(v){if(v!==0)if(this._optionsService.rawOptions.smoothScrollDuration){const g=v*this._currentRowHeight;this._smoothScrollState.startTime=Date.now(),this._smoothScrollPercent()<1?(this._smoothScrollState.origin=this._viewportElement.scrollTop,this._smoothScrollState.target=this._smoothScrollState.origin+g,this._smoothScrollState.target=Math.max(Math.min(this._smoothScrollState.target,this._viewportElement.scrollHeight),0),this._smoothScroll()):this._clearSmoothScrollState()}else this._onRequestScrollLines.fire({amount:v,suppressScrollEvent:!1})}_getPixelsScrolled(v){if(v.deltaY===0||v.shiftKey)return 0;let g=this._applyScrollModifier(v.deltaY,v);return v.deltaMode===WheelEvent.DOM_DELTA_LINE?g*=this._currentRowHeight:v.deltaMode===WheelEvent.DOM_DELTA_PAGE&&(g*=this._currentRowHeight*this._bufferService.rows),g}getBufferElements(v,g){let m,$="";const I=[],B=g??this._bufferService.buffer.lines.length,P=this._bufferService.buffer.lines;for(let x=v;x<B;x++){const N=P.get(x);if(!N)continue;const J=P.get(x+1)?.isWrapped;if($+=N.translateToString(!J),!J||x===P.length-1){const Q=document.createElement("div");Q.textContent=$,I.push(Q),$.length>0&&(m=Q),$=""}}return{bufferElements:I,cursorElement:m}}getLinesScrolled(v){if(v.deltaY===0||v.shiftKey)return 0;let g=this._applyScrollModifier(v.deltaY,v);return v.deltaMode===WheelEvent.DOM_DELTA_PIXEL?(g/=this._currentRowHeight+0,this._wheelPartialScroll+=g,g=Math.floor(Math.abs(this._wheelPartialScroll))*(this._wheelPartialScroll>0?1:-1),this._wheelPartialScroll%=1):v.deltaMode===WheelEvent.DOM_DELTA_PAGE&&(g*=this._bufferService.rows),g}_applyScrollModifier(v,g){const m=this._optionsService.rawOptions.fastScrollModifier;return m==="alt"&&g.altKey||m==="ctrl"&&g.ctrlKey||m==="shift"&&g.shiftKey?v*this._optionsService.rawOptions.fastScrollSensitivity*this._optionsService.rawOptions.scrollSensitivity:v*this._optionsService.rawOptions.scrollSensitivity}handleTouchStart(v){this._lastTouchY=v.touches[0].pageY}handleTouchMove(v){const g=this._lastTouchY-v.touches[0].pageY;return this._lastTouchY=v.touches[0].pageY,g!==0&&(this._viewportElement.scrollTop+=g,this._bubbleScroll(v,g))}};o.Viewport=w=d([l(2,A.IBufferService),l(3,A.IOptionsService),l(4,p.ICharSizeService),l(5,p.IRenderService),l(6,p.ICoreBrowserService),l(7,p.IThemeService)],w)},3107:function(h,o,a){var d=this&&this.__decorate||function(A,w,v,g){var m,$=arguments.length,I=$<3?w:g===null?g=Object.getOwnPropertyDescriptor(w,v):g;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")I=Reflect.decorate(A,w,v,g);else for(var B=A.length-1;B>=0;B--)(m=A[B])&&(I=($<3?m(I):$>3?m(w,v,I):m(w,v))||I);return $>3&&I&&Object.defineProperty(w,v,I),I},l=this&&this.__param||function(A,w){return function(v,g){w(v,g,A)}};Object.defineProperty(o,"__esModule",{value:!0}),o.BufferDecorationRenderer=void 0;const f=a(4725),p=a(844),S=a(2585);let k=o.BufferDecorationRenderer=class extends p.Disposable{constructor(A,w,v,g,m){super(),this._screenElement=A,this._bufferService=w,this._coreBrowserService=v,this._decorationService=g,this._renderService=m,this._decorationElements=new Map,this._altBufferIsActive=!1,this._dimensionsChanged=!1,this._container=document.createElement("div"),this._container.classList.add("xterm-decoration-container"),this._screenElement.appendChild(this._container),this.register(this._renderService.onRenderedViewportChange((()=>this._doRefreshDecorations()))),this.register(this._renderService.onDimensionsChange((()=>{this._dimensionsChanged=!0,this._queueRefresh()}))),this.register(this._coreBrowserService.onDprChange((()=>this._queueRefresh()))),this.register(this._bufferService.buffers.onBufferActivate((()=>{this._altBufferIsActive=this._bufferService.buffer===this._bufferService.buffers.alt}))),this.register(this._decorationService.onDecorationRegistered((()=>this._queueRefresh()))),this.register(this._decorationService.onDecorationRemoved(($=>this._removeDecoration($)))),this.register((0,p.toDisposable)((()=>{this._container.remove(),this._decorationElements.clear()})))}_queueRefresh(){this._animationFrame===void 0&&(this._animationFrame=this._renderService.addRefreshCallback((()=>{this._doRefreshDecorations(),this._animationFrame=void 0})))}_doRefreshDecorations(){for(const A of this._decorationService.decorations)this._renderDecoration(A);this._dimensionsChanged=!1}_renderDecoration(A){this._refreshStyle(A),this._dimensionsChanged&&this._refreshXPosition(A)}_createElement(A){const w=this._coreBrowserService.mainDocument.createElement("div");w.classList.add("xterm-decoration"),w.classList.toggle("xterm-decoration-top-layer",A?.options?.layer==="top"),w.style.width=`${Math.round((A.options.width||1)*this._renderService.dimensions.css.cell.width)}px`,w.style.height=(A.options.height||1)*this._renderService.dimensions.css.cell.height+"px",w.style.top=(A.marker.line-this._bufferService.buffers.active.ydisp)*this._renderService.dimensions.css.cell.height+"px",w.style.lineHeight=`${this._renderService.dimensions.css.cell.height}px`;const v=A.options.x??0;return v&&v>this._bufferService.cols&&(w.style.display="none"),this._refreshXPosition(A,w),w}_refreshStyle(A){const w=A.marker.line-this._bufferService.buffers.active.ydisp;if(w<0||w>=this._bufferService.rows)A.element&&(A.element.style.display="none",A.onRenderEmitter.fire(A.element));else{let v=this._decorationElements.get(A);v||(v=this._createElement(A),A.element=v,this._decorationElements.set(A,v),this._container.appendChild(v),A.onDispose((()=>{this._decorationElements.delete(A),v.remove()}))),v.style.top=w*this._renderService.dimensions.css.cell.height+"px",v.style.display=this._altBufferIsActive?"none":"block",A.onRenderEmitter.fire(v)}}_refreshXPosition(A,w=A.element){if(!w)return;const v=A.options.x??0;(A.options.anchor||"left")==="right"?w.style.right=v?v*this._renderService.dimensions.css.cell.width+"px":"":w.style.left=v?v*this._renderService.dimensions.css.cell.width+"px":""}_removeDecoration(A){this._decorationElements.get(A)?.remove(),this._decorationElements.delete(A),A.dispose()}};o.BufferDecorationRenderer=k=d([l(1,S.IBufferService),l(2,f.ICoreBrowserService),l(3,S.IDecorationService),l(4,f.IRenderService)],k)},5871:(h,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.ColorZoneStore=void 0,o.ColorZoneStore=class{constructor(){this._zones=[],this._zonePool=[],this._zonePoolIndex=0,this._linePadding={full:0,left:0,center:0,right:0}}get zones(){return this._zonePool.length=Math.min(this._zonePool.length,this._zones.length),this._zones}clear(){this._zones.length=0,this._zonePoolIndex=0}addDecoration(a){if(a.options.overviewRulerOptions){for(const d of this._zones)if(d.color===a.options.overviewRulerOptions.color&&d.position===a.options.overviewRulerOptions.position){if(this._lineIntersectsZone(d,a.marker.line))return;if(this._lineAdjacentToZone(d,a.marker.line,a.options.overviewRulerOptions.position))return void this._addLineToZone(d,a.marker.line)}if(this._zonePoolIndex<this._zonePool.length)return this._zonePool[this._zonePoolIndex].color=a.options.overviewRulerOptions.color,this._zonePool[this._zonePoolIndex].position=a.options.overviewRulerOptions.position,this._zonePool[this._zonePoolIndex].startBufferLine=a.marker.line,this._zonePool[this._zonePoolIndex].endBufferLine=a.marker.line,void this._zones.push(this._zonePool[this._zonePoolIndex++]);this._zones.push({color:a.options.overviewRulerOptions.color,position:a.options.overviewRulerOptions.position,startBufferLine:a.marker.line,endBufferLine:a.marker.line}),this._zonePool.push(this._zones[this._zones.length-1]),this._zonePoolIndex++}}setPadding(a){this._linePadding=a}_lineIntersectsZone(a,d){return d>=a.startBufferLine&&d<=a.endBufferLine}_lineAdjacentToZone(a,d,l){return d>=a.startBufferLine-this._linePadding[l||"full"]&&d<=a.endBufferLine+this._linePadding[l||"full"]}_addLineToZone(a,d){a.startBufferLine=Math.min(a.startBufferLine,d),a.endBufferLine=Math.max(a.endBufferLine,d)}}},5744:function(h,o,a){var d=this&&this.__decorate||function(m,$,I,B){var P,x=arguments.length,N=x<3?$:B===null?B=Object.getOwnPropertyDescriptor($,I):B;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")N=Reflect.decorate(m,$,I,B);else for(var J=m.length-1;J>=0;J--)(P=m[J])&&(N=(x<3?P(N):x>3?P($,I,N):P($,I))||N);return x>3&&N&&Object.defineProperty($,I,N),N},l=this&&this.__param||function(m,$){return function(I,B){$(I,B,m)}};Object.defineProperty(o,"__esModule",{value:!0}),o.OverviewRulerRenderer=void 0;const f=a(5871),p=a(4725),S=a(844),k=a(2585),A={full:0,left:0,center:0,right:0},w={full:0,left:0,center:0,right:0},v={full:0,left:0,center:0,right:0};let g=o.OverviewRulerRenderer=class extends S.Disposable{get _width(){return this._optionsService.options.overviewRulerWidth||0}constructor(m,$,I,B,P,x,N){super(),this._viewportElement=m,this._screenElement=$,this._bufferService=I,this._decorationService=B,this._renderService=P,this._optionsService=x,this._coreBrowserService=N,this._colorZoneStore=new f.ColorZoneStore,this._shouldUpdateDimensions=!0,this._shouldUpdateAnchor=!0,this._lastKnownBufferLength=0,this._canvas=this._coreBrowserService.mainDocument.createElement("canvas"),this._canvas.classList.add("xterm-decoration-overview-ruler"),this._refreshCanvasDimensions(),this._viewportElement.parentElement?.insertBefore(this._canvas,this._viewportElement);const J=this._canvas.getContext("2d");if(!J)throw new Error("Ctx cannot be null");this._ctx=J,this._registerDecorationListeners(),this._registerBufferChangeListeners(),this._registerDimensionChangeListeners(),this.register((0,S.toDisposable)((()=>{this._canvas?.remove()})))}_registerDecorationListeners(){this.register(this._decorationService.onDecorationRegistered((()=>this._queueRefresh(void 0,!0)))),this.register(this._decorationService.onDecorationRemoved((()=>this._queueRefresh(void 0,!0))))}_registerBufferChangeListeners(){this.register(this._renderService.onRenderedViewportChange((()=>this._queueRefresh()))),this.register(this._bufferService.buffers.onBufferActivate((()=>{this._canvas.style.display=this._bufferService.buffer===this._bufferService.buffers.alt?"none":"block"}))),this.register(this._bufferService.onScroll((()=>{this._lastKnownBufferLength!==this._bufferService.buffers.normal.lines.length&&(this._refreshDrawHeightConstants(),this._refreshColorZonePadding())})))}_registerDimensionChangeListeners(){this.register(this._renderService.onRender((()=>{this._containerHeight&&this._containerHeight===this._screenElement.clientHeight||(this._queueRefresh(!0),this._containerHeight=this._screenElement.clientHeight)}))),this.register(this._optionsService.onSpecificOptionChange("overviewRulerWidth",(()=>this._queueRefresh(!0)))),this.register(this._coreBrowserService.onDprChange((()=>this._queueRefresh(!0)))),this._queueRefresh(!0)}_refreshDrawConstants(){const m=Math.floor(this._canvas.width/3),$=Math.ceil(this._canvas.width/3);w.full=this._canvas.width,w.left=m,w.center=$,w.right=m,this._refreshDrawHeightConstants(),v.full=0,v.left=0,v.center=w.left,v.right=w.left+w.center}_refreshDrawHeightConstants(){A.full=Math.round(2*this._coreBrowserService.dpr);const m=this._canvas.height/this._bufferService.buffer.lines.length,$=Math.round(Math.max(Math.min(m,12),6)*this._coreBrowserService.dpr);A.left=$,A.center=$,A.right=$}_refreshColorZonePadding(){this._colorZoneStore.setPadding({full:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*A.full),left:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*A.left),center:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*A.center),right:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*A.right)}),this._lastKnownBufferLength=this._bufferService.buffers.normal.lines.length}_refreshCanvasDimensions(){this._canvas.style.width=`${this._width}px`,this._canvas.width=Math.round(this._width*this._coreBrowserService.dpr),this._canvas.style.height=`${this._screenElement.clientHeight}px`,this._canvas.height=Math.round(this._screenElement.clientHeight*this._coreBrowserService.dpr),this._refreshDrawConstants(),this._refreshColorZonePadding()}_refreshDecorations(){this._shouldUpdateDimensions&&this._refreshCanvasDimensions(),this._ctx.clearRect(0,0,this._canvas.width,this._canvas.height),this._colorZoneStore.clear();for(const $ of this._decorationService.decorations)this._colorZoneStore.addDecoration($);this._ctx.lineWidth=1;const m=this._colorZoneStore.zones;for(const $ of m)$.position!=="full"&&this._renderColorZone($);for(const $ of m)$.position==="full"&&this._renderColorZone($);this._shouldUpdateDimensions=!1,this._shouldUpdateAnchor=!1}_renderColorZone(m){this._ctx.fillStyle=m.color,this._ctx.fillRect(v[m.position||"full"],Math.round((this._canvas.height-1)*(m.startBufferLine/this._bufferService.buffers.active.lines.length)-A[m.position||"full"]/2),w[m.position||"full"],Math.round((this._canvas.height-1)*((m.endBufferLine-m.startBufferLine)/this._bufferService.buffers.active.lines.length)+A[m.position||"full"]))}_queueRefresh(m,$){this._shouldUpdateDimensions=m||this._shouldUpdateDimensions,this._shouldUpdateAnchor=$||this._shouldUpdateAnchor,this._animationFrame===void 0&&(this._animationFrame=this._coreBrowserService.window.requestAnimationFrame((()=>{this._refreshDecorations(),this._animationFrame=void 0})))}};o.OverviewRulerRenderer=g=d([l(2,k.IBufferService),l(3,k.IDecorationService),l(4,p.IRenderService),l(5,k.IOptionsService),l(6,p.ICoreBrowserService)],g)},2950:function(h,o,a){var d=this&&this.__decorate||function(A,w,v,g){var m,$=arguments.length,I=$<3?w:g===null?g=Object.getOwnPropertyDescriptor(w,v):g;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")I=Reflect.decorate(A,w,v,g);else for(var B=A.length-1;B>=0;B--)(m=A[B])&&(I=($<3?m(I):$>3?m(w,v,I):m(w,v))||I);return $>3&&I&&Object.defineProperty(w,v,I),I},l=this&&this.__param||function(A,w){return function(v,g){w(v,g,A)}};Object.defineProperty(o,"__esModule",{value:!0}),o.CompositionHelper=void 0;const f=a(4725),p=a(2585),S=a(2584);let k=o.CompositionHelper=class{get isComposing(){return this._isComposing}constructor(A,w,v,g,m,$){this._textarea=A,this._compositionView=w,this._bufferService=v,this._optionsService=g,this._coreService=m,this._renderService=$,this._isComposing=!1,this._isSendingComposition=!1,this._compositionPosition={start:0,end:0},this._dataAlreadySent=""}compositionstart(){this._isComposing=!0,this._compositionPosition.start=this._textarea.value.length,this._compositionView.textContent="",this._dataAlreadySent="",this._compositionView.classList.add("active")}compositionupdate(A){this._compositionView.textContent=A.data,this.updateCompositionElements(),setTimeout((()=>{this._compositionPosition.end=this._textarea.value.length}),0)}compositionend(){this._finalizeComposition(!0)}keydown(A){if(this._isComposing||this._isSendingComposition){if(A.keyCode===229||A.keyCode===16||A.keyCode===17||A.keyCode===18)return!1;this._finalizeComposition(!1)}return A.keyCode!==229||(this._handleAnyTextareaChanges(),!1)}_finalizeComposition(A){if(this._compositionView.classList.remove("active"),this._isComposing=!1,A){const w={start:this._compositionPosition.start,end:this._compositionPosition.end};this._isSendingComposition=!0,setTimeout((()=>{if(this._isSendingComposition){let v;this._isSendingComposition=!1,w.start+=this._dataAlreadySent.length,v=this._isComposing?this._textarea.value.substring(w.start,w.end):this._textarea.value.substring(w.start),v.length>0&&this._coreService.triggerDataEvent(v,!0)}}),0)}else{this._isSendingComposition=!1;const w=this._textarea.value.substring(this._compositionPosition.start,this._compositionPosition.end);this._coreService.triggerDataEvent(w,!0)}}_handleAnyTextareaChanges(){const A=this._textarea.value;setTimeout((()=>{if(!this._isComposing){const w=this._textarea.value,v=w.replace(A,"");this._dataAlreadySent=v,w.length>A.length?this._coreService.triggerDataEvent(v,!0):w.length<A.length?this._coreService.triggerDataEvent(`${S.C0.DEL}`,!0):w.length===A.length&&w!==A&&this._coreService.triggerDataEvent(w,!0)}}),0)}updateCompositionElements(A){if(this._isComposing){if(this._bufferService.buffer.isCursorInViewport){const w=Math.min(this._bufferService.buffer.x,this._bufferService.cols-1),v=this._renderService.dimensions.css.cell.height,g=this._bufferService.buffer.y*this._renderService.dimensions.css.cell.height,m=w*this._renderService.dimensions.css.cell.width;this._compositionView.style.left=m+"px",this._compositionView.style.top=g+"px",this._compositionView.style.height=v+"px",this._compositionView.style.lineHeight=v+"px",this._compositionView.style.fontFamily=this._optionsService.rawOptions.fontFamily,this._compositionView.style.fontSize=this._optionsService.rawOptions.fontSize+"px";const $=this._compositionView.getBoundingClientRect();this._textarea.style.left=m+"px",this._textarea.style.top=g+"px",this._textarea.style.width=Math.max($.width,1)+"px",this._textarea.style.height=Math.max($.height,1)+"px",this._textarea.style.lineHeight=$.height+"px"}A||setTimeout((()=>this.updateCompositionElements(!0)),0)}}};o.CompositionHelper=k=d([l(2,p.IBufferService),l(3,p.IOptionsService),l(4,p.ICoreService),l(5,f.IRenderService)],k)},9806:(h,o)=>{function a(d,l,f){const p=f.getBoundingClientRect(),S=d.getComputedStyle(f),k=parseInt(S.getPropertyValue("padding-left")),A=parseInt(S.getPropertyValue("padding-top"));return[l.clientX-p.left-k,l.clientY-p.top-A]}Object.defineProperty(o,"__esModule",{value:!0}),o.getCoords=o.getCoordsRelativeToElement=void 0,o.getCoordsRelativeToElement=a,o.getCoords=function(d,l,f,p,S,k,A,w,v){if(!k)return;const g=a(d,l,f);return g?(g[0]=Math.ceil((g[0]+(v?A/2:0))/A),g[1]=Math.ceil(g[1]/w),g[0]=Math.min(Math.max(g[0],1),p+(v?1:0)),g[1]=Math.min(Math.max(g[1],1),S),g):void 0}},9504:(h,o,a)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.moveToCellSequence=void 0;const d=a(2584);function l(w,v,g,m){const $=w-f(w,g),I=v-f(v,g),B=Math.abs($-I)-(function(P,x,N){let J=0;const Q=P-f(P,N),W=x-f(x,N);for(let Y=0;Y<Math.abs(Q-W);Y++){const ve=p(P,x)==="A"?-1:1;N.buffer.lines.get(Q+ve*Y)?.isWrapped&&J++}return J})(w,v,g);return A(B,k(p(w,v),m))}function f(w,v){let g=0,m=v.buffer.lines.get(w),$=m?.isWrapped;for(;$&&w>=0&&w<v.rows;)g++,m=v.buffer.lines.get(--w),$=m?.isWrapped;return g}function p(w,v){return w>v?"A":"B"}function S(w,v,g,m,$,I){let B=w,P=v,x="";for(;B!==g||P!==m;)B+=$?1:-1,$&&B>I.cols-1?(x+=I.buffer.translateBufferLineToString(P,!1,w,B),B=0,w=0,P++):!$&&B<0&&(x+=I.buffer.translateBufferLineToString(P,!1,0,w+1),B=I.cols-1,w=B,P--);return x+I.buffer.translateBufferLineToString(P,!1,w,B)}function k(w,v){const g=v?"O":"[";return d.C0.ESC+g+w}function A(w,v){w=Math.floor(w);let g="";for(let m=0;m<w;m++)g+=v;return g}o.moveToCellSequence=function(w,v,g,m){const $=g.buffer.x,I=g.buffer.y;if(!g.buffer.hasScrollback)return(function(x,N,J,Q,W,Y){return l(N,Q,W,Y).length===0?"":A(S(x,N,x,N-f(N,W),!1,W).length,k("D",Y))})($,I,0,v,g,m)+l(I,v,g,m)+(function(x,N,J,Q,W,Y){let ve;ve=l(N,Q,W,Y).length>0?Q-f(Q,W):N;const Be=Q,je=(function(xe,ke,q,j,H,G){let V;return V=l(q,j,H,G).length>0?j-f(j,H):ke,xe<q&&V<=j||xe>=q&&V<j?"C":"D"})(x,N,J,Q,W,Y);return A(S(x,ve,J,Be,je==="C",W).length,k(je,Y))})($,I,w,v,g,m);let B;if(I===v)return B=$>w?"D":"C",A(Math.abs($-w),k(B,m));B=I>v?"D":"C";const P=Math.abs(I-v);return A((function(x,N){return N.cols-x})(I>v?w:$,g)+(P-1)*g.cols+1+((I>v?$:w)-1),k(B,m))}},1296:function(h,o,a){var d=this&&this.__decorate||function(Y,ve,Be,je){var xe,ke=arguments.length,q=ke<3?ve:je===null?je=Object.getOwnPropertyDescriptor(ve,Be):je;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")q=Reflect.decorate(Y,ve,Be,je);else for(var j=Y.length-1;j>=0;j--)(xe=Y[j])&&(q=(ke<3?xe(q):ke>3?xe(ve,Be,q):xe(ve,Be))||q);return ke>3&&q&&Object.defineProperty(ve,Be,q),q},l=this&&this.__param||function(Y,ve){return function(Be,je){ve(Be,je,Y)}};Object.defineProperty(o,"__esModule",{value:!0}),o.DomRenderer=void 0;const f=a(3787),p=a(2550),S=a(2223),k=a(6171),A=a(6052),w=a(4725),v=a(8055),g=a(8460),m=a(844),$=a(2585),I="xterm-dom-renderer-owner-",B="xterm-rows",P="xterm-fg-",x="xterm-bg-",N="xterm-focus",J="xterm-selection";let Q=1,W=o.DomRenderer=class extends m.Disposable{constructor(Y,ve,Be,je,xe,ke,q,j,H,G,V,oe,Z){super(),this._terminal=Y,this._document=ve,this._element=Be,this._screenElement=je,this._viewportElement=xe,this._helperContainer=ke,this._linkifier2=q,this._charSizeService=H,this._optionsService=G,this._bufferService=V,this._coreBrowserService=oe,this._themeService=Z,this._terminalClass=Q++,this._rowElements=[],this._selectionRenderModel=(0,A.createSelectionRenderModel)(),this.onRequestRedraw=this.register(new g.EventEmitter).event,this._rowContainer=this._document.createElement("div"),this._rowContainer.classList.add(B),this._rowContainer.style.lineHeight="normal",this._rowContainer.setAttribute("aria-hidden","true"),this._refreshRowElements(this._bufferService.cols,this._bufferService.rows),this._selectionContainer=this._document.createElement("div"),this._selectionContainer.classList.add(J),this._selectionContainer.setAttribute("aria-hidden","true"),this.dimensions=(0,k.createRenderDimensions)(),this._updateDimensions(),this.register(this._optionsService.onOptionChange((()=>this._handleOptionsChanged()))),this.register(this._themeService.onChangeColors((pe=>this._injectCss(pe)))),this._injectCss(this._themeService.colors),this._rowFactory=j.createInstance(f.DomRendererRowFactory,document),this._element.classList.add(I+this._terminalClass),this._screenElement.appendChild(this._rowContainer),this._screenElement.appendChild(this._selectionContainer),this.register(this._linkifier2.onShowLinkUnderline((pe=>this._handleLinkHover(pe)))),this.register(this._linkifier2.onHideLinkUnderline((pe=>this._handleLinkLeave(pe)))),this.register((0,m.toDisposable)((()=>{this._element.classList.remove(I+this._terminalClass),this._rowContainer.remove(),this._selectionContainer.remove(),this._widthCache.dispose(),this._themeStyleElement.remove(),this._dimensionsStyleElement.remove()}))),this._widthCache=new p.WidthCache(this._document,this._helperContainer),this._widthCache.setFont(this._optionsService.rawOptions.fontFamily,this._optionsService.rawOptions.fontSize,this._optionsService.rawOptions.fontWeight,this._optionsService.rawOptions.fontWeightBold),this._setDefaultSpacing()}_updateDimensions(){const Y=this._coreBrowserService.dpr;this.dimensions.device.char.width=this._charSizeService.width*Y,this.dimensions.device.char.height=Math.ceil(this._charSizeService.height*Y),this.dimensions.device.cell.width=this.dimensions.device.char.width+Math.round(this._optionsService.rawOptions.letterSpacing),this.dimensions.device.cell.height=Math.floor(this.dimensions.device.char.height*this._optionsService.rawOptions.lineHeight),this.dimensions.device.char.left=0,this.dimensions.device.char.top=0,this.dimensions.device.canvas.width=this.dimensions.device.cell.width*this._bufferService.cols,this.dimensions.device.canvas.height=this.dimensions.device.cell.height*this._bufferService.rows,this.dimensions.css.canvas.width=Math.round(this.dimensions.device.canvas.width/Y),this.dimensions.css.canvas.height=Math.round(this.dimensions.device.canvas.height/Y),this.dimensions.css.cell.width=this.dimensions.css.canvas.width/this._bufferService.cols,this.dimensions.css.cell.height=this.dimensions.css.canvas.height/this._bufferService.rows;for(const Be of this._rowElements)Be.style.width=`${this.dimensions.css.canvas.width}px`,Be.style.height=`${this.dimensions.css.cell.height}px`,Be.style.lineHeight=`${this.dimensions.css.cell.height}px`,Be.style.overflow="hidden";this._dimensionsStyleElement||(this._dimensionsStyleElement=this._document.createElement("style"),this._screenElement.appendChild(this._dimensionsStyleElement));const ve=`${this._terminalSelector} .${B} span { display: inline-block; height: 100%; vertical-align: top;}`;this._dimensionsStyleElement.textContent=ve,this._selectionContainer.style.height=this._viewportElement.style.height,this._screenElement.style.width=`${this.dimensions.css.canvas.width}px`,this._screenElement.style.height=`${this.dimensions.css.canvas.height}px`}_injectCss(Y){this._themeStyleElement||(this._themeStyleElement=this._document.createElement("style"),this._screenElement.appendChild(this._themeStyleElement));let ve=`${this._terminalSelector} .${B} { color: ${Y.foreground.css}; font-family: ${this._optionsService.rawOptions.fontFamily}; font-size: ${this._optionsService.rawOptions.fontSize}px; font-kerning: none; white-space: pre}`;ve+=`${this._terminalSelector} .${B} .xterm-dim { color: ${v.color.multiplyOpacity(Y.foreground,.5).css};}`,ve+=`${this._terminalSelector} span:not(.xterm-bold) { font-weight: ${this._optionsService.rawOptions.fontWeight};}${this._terminalSelector} span.xterm-bold { font-weight: ${this._optionsService.rawOptions.fontWeightBold};}${this._terminalSelector} span.xterm-italic { font-style: italic;}`;const Be=`blink_underline_${this._terminalClass}`,je=`blink_bar_${this._terminalClass}`,xe=`blink_block_${this._terminalClass}`;ve+=`@keyframes ${Be} { 50% {  border-bottom-style: hidden; }}`,ve+=`@keyframes ${je} { 50% {  box-shadow: none; }}`,ve+=`@keyframes ${xe} { 0% {  background-color: ${Y.cursor.css};  color: ${Y.cursorAccent.css}; } 50% {  background-color: inherit;  color: ${Y.cursor.css}; }}`,ve+=`${this._terminalSelector} .${B}.${N} .xterm-cursor.xterm-cursor-blink.xterm-cursor-underline { animation: ${Be} 1s step-end infinite;}${this._terminalSelector} .${B}.${N} .xterm-cursor.xterm-cursor-blink.xterm-cursor-bar { animation: ${je} 1s step-end infinite;}${this._terminalSelector} .${B}.${N} .xterm-cursor.xterm-cursor-blink.xterm-cursor-block { animation: ${xe} 1s step-end infinite;}${this._terminalSelector} .${B} .xterm-cursor.xterm-cursor-block { background-color: ${Y.cursor.css}; color: ${Y.cursorAccent.css};}${this._terminalSelector} .${B} .xterm-cursor.xterm-cursor-block:not(.xterm-cursor-blink) { background-color: ${Y.cursor.css} !important; color: ${Y.cursorAccent.css} !important;}${this._terminalSelector} .${B} .xterm-cursor.xterm-cursor-outline { outline: 1px solid ${Y.cursor.css}; outline-offset: -1px;}${this._terminalSelector} .${B} .xterm-cursor.xterm-cursor-bar { box-shadow: ${this._optionsService.rawOptions.cursorWidth}px 0 0 ${Y.cursor.css} inset;}${this._terminalSelector} .${B} .xterm-cursor.xterm-cursor-underline { border-bottom: 1px ${Y.cursor.css}; border-bottom-style: solid; height: calc(100% - 1px);}`,ve+=`${this._terminalSelector} .${J} { position: absolute; top: 0; left: 0; z-index: 1; pointer-events: none;}${this._terminalSelector}.focus .${J} div { position: absolute; background-color: ${Y.selectionBackgroundOpaque.css};}${this._terminalSelector} .${J} div { position: absolute; background-color: ${Y.selectionInactiveBackgroundOpaque.css};}`;for(const[ke,q]of Y.ansi.entries())ve+=`${this._terminalSelector} .${P}${ke} { color: ${q.css}; }${this._terminalSelector} .${P}${ke}.xterm-dim { color: ${v.color.multiplyOpacity(q,.5).css}; }${this._terminalSelector} .${x}${ke} { background-color: ${q.css}; }`;ve+=`${this._terminalSelector} .${P}${S.INVERTED_DEFAULT_COLOR} { color: ${v.color.opaque(Y.background).css}; }${this._terminalSelector} .${P}${S.INVERTED_DEFAULT_COLOR}.xterm-dim { color: ${v.color.multiplyOpacity(v.color.opaque(Y.background),.5).css}; }${this._terminalSelector} .${x}${S.INVERTED_DEFAULT_COLOR} { background-color: ${Y.foreground.css}; }`,this._themeStyleElement.textContent=ve}_setDefaultSpacing(){const Y=this.dimensions.css.cell.width-this._widthCache.get("W",!1,!1);this._rowContainer.style.letterSpacing=`${Y}px`,this._rowFactory.defaultSpacing=Y}handleDevicePixelRatioChange(){this._updateDimensions(),this._widthCache.clear(),this._setDefaultSpacing()}_refreshRowElements(Y,ve){for(let Be=this._rowElements.length;Be<=ve;Be++){const je=this._document.createElement("div");this._rowContainer.appendChild(je),this._rowElements.push(je)}for(;this._rowElements.length>ve;)this._rowContainer.removeChild(this._rowElements.pop())}handleResize(Y,ve){this._refreshRowElements(Y,ve),this._updateDimensions(),this.handleSelectionChanged(this._selectionRenderModel.selectionStart,this._selectionRenderModel.selectionEnd,this._selectionRenderModel.columnSelectMode)}handleCharSizeChanged(){this._updateDimensions(),this._widthCache.clear(),this._setDefaultSpacing()}handleBlur(){this._rowContainer.classList.remove(N),this.renderRows(0,this._bufferService.rows-1)}handleFocus(){this._rowContainer.classList.add(N),this.renderRows(this._bufferService.buffer.y,this._bufferService.buffer.y)}handleSelectionChanged(Y,ve,Be){if(this._selectionContainer.replaceChildren(),this._rowFactory.handleSelectionChanged(Y,ve,Be),this.renderRows(0,this._bufferService.rows-1),!Y||!ve)return;this._selectionRenderModel.update(this._terminal,Y,ve,Be);const je=this._selectionRenderModel.viewportStartRow,xe=this._selectionRenderModel.viewportEndRow,ke=this._selectionRenderModel.viewportCappedStartRow,q=this._selectionRenderModel.viewportCappedEndRow;if(ke>=this._bufferService.rows||q<0)return;const j=this._document.createDocumentFragment();if(Be){const H=Y[0]>ve[0];j.appendChild(this._createSelectionElement(ke,H?ve[0]:Y[0],H?Y[0]:ve[0],q-ke+1))}else{const H=je===ke?Y[0]:0,G=ke===xe?ve[0]:this._bufferService.cols;j.appendChild(this._createSelectionElement(ke,H,G));const V=q-ke-1;if(j.appendChild(this._createSelectionElement(ke+1,0,this._bufferService.cols,V)),ke!==q){const oe=xe===q?ve[0]:this._bufferService.cols;j.appendChild(this._createSelectionElement(q,0,oe))}}this._selectionContainer.appendChild(j)}_createSelectionElement(Y,ve,Be,je=1){const xe=this._document.createElement("div"),ke=ve*this.dimensions.css.cell.width;let q=this.dimensions.css.cell.width*(Be-ve);return ke+q>this.dimensions.css.canvas.width&&(q=this.dimensions.css.canvas.width-ke),xe.style.height=je*this.dimensions.css.cell.height+"px",xe.style.top=Y*this.dimensions.css.cell.height+"px",xe.style.left=`${ke}px`,xe.style.width=`${q}px`,xe}handleCursorMove(){}_handleOptionsChanged(){this._updateDimensions(),this._injectCss(this._themeService.colors),this._widthCache.setFont(this._optionsService.rawOptions.fontFamily,this._optionsService.rawOptions.fontSize,this._optionsService.rawOptions.fontWeight,this._optionsService.rawOptions.fontWeightBold),this._setDefaultSpacing()}clear(){for(const Y of this._rowElements)Y.replaceChildren()}renderRows(Y,ve){const Be=this._bufferService.buffer,je=Be.ybase+Be.y,xe=Math.min(Be.x,this._bufferService.cols-1),ke=this._optionsService.rawOptions.cursorBlink,q=this._optionsService.rawOptions.cursorStyle,j=this._optionsService.rawOptions.cursorInactiveStyle;for(let H=Y;H<=ve;H++){const G=H+Be.ydisp,V=this._rowElements[H],oe=Be.lines.get(G);if(!V||!oe)break;V.replaceChildren(...this._rowFactory.createRow(oe,G,G===je,q,j,xe,ke,this.dimensions.css.cell.width,this._widthCache,-1,-1))}}get _terminalSelector(){return`.${I}${this._terminalClass}`}_handleLinkHover(Y){this._setCellUnderline(Y.x1,Y.x2,Y.y1,Y.y2,Y.cols,!0)}_handleLinkLeave(Y){this._setCellUnderline(Y.x1,Y.x2,Y.y1,Y.y2,Y.cols,!1)}_setCellUnderline(Y,ve,Be,je,xe,ke){Be<0&&(Y=0),je<0&&(ve=0);const q=this._bufferService.rows-1;Be=Math.max(Math.min(Be,q),0),je=Math.max(Math.min(je,q),0),xe=Math.min(xe,this._bufferService.cols);const j=this._bufferService.buffer,H=j.ybase+j.y,G=Math.min(j.x,xe-1),V=this._optionsService.rawOptions.cursorBlink,oe=this._optionsService.rawOptions.cursorStyle,Z=this._optionsService.rawOptions.cursorInactiveStyle;for(let pe=Be;pe<=je;++pe){const ce=pe+j.ydisp,U=this._rowElements[pe],ye=j.lines.get(ce);if(!U||!ye)break;U.replaceChildren(...this._rowFactory.createRow(ye,ce,ce===H,oe,Z,G,V,this.dimensions.css.cell.width,this._widthCache,ke?pe===Be?Y:0:-1,ke?(pe===je?ve:xe)-1:-1))}}};o.DomRenderer=W=d([l(7,$.IInstantiationService),l(8,w.ICharSizeService),l(9,$.IOptionsService),l(10,$.IBufferService),l(11,w.ICoreBrowserService),l(12,w.IThemeService)],W)},3787:function(h,o,a){var d=this&&this.__decorate||function(B,P,x,N){var J,Q=arguments.length,W=Q<3?P:N===null?N=Object.getOwnPropertyDescriptor(P,x):N;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")W=Reflect.decorate(B,P,x,N);else for(var Y=B.length-1;Y>=0;Y--)(J=B[Y])&&(W=(Q<3?J(W):Q>3?J(P,x,W):J(P,x))||W);return Q>3&&W&&Object.defineProperty(P,x,W),W},l=this&&this.__param||function(B,P){return function(x,N){P(x,N,B)}};Object.defineProperty(o,"__esModule",{value:!0}),o.DomRendererRowFactory=void 0;const f=a(2223),p=a(643),S=a(511),k=a(2585),A=a(8055),w=a(4725),v=a(4269),g=a(6171),m=a(3734);let $=o.DomRendererRowFactory=class{constructor(B,P,x,N,J,Q,W){this._document=B,this._characterJoinerService=P,this._optionsService=x,this._coreBrowserService=N,this._coreService=J,this._decorationService=Q,this._themeService=W,this._workCell=new S.CellData,this._columnSelectMode=!1,this.defaultSpacing=0}handleSelectionChanged(B,P,x){this._selectionStart=B,this._selectionEnd=P,this._columnSelectMode=x}createRow(B,P,x,N,J,Q,W,Y,ve,Be,je){const xe=[],ke=this._characterJoinerService.getJoinedCharacters(P),q=this._themeService.colors;let j,H=B.getNoBgTrimmedLength();x&&H<Q+1&&(H=Q+1);let G=0,V="",oe=0,Z=0,pe=0,ce=!1,U=0,ye=!1,be=0;const Pe=[],Oe=Be!==-1&&je!==-1;for(let Ue=0;Ue<H;Ue++){B.loadCell(Ue,this._workCell);let rt=this._workCell.getWidth();if(rt===0)continue;let yt=!1,dt=Ue,fe=this._workCell;if(ke.length>0&&Ue===ke[0][0]){yt=!0;const O=ke.shift();fe=new v.JoinedCellData(this._workCell,B.translateToString(!0,O[0],O[1]),O[1]-O[0]),dt=O[1]-1,rt=fe.getWidth()}const Re=this._isCellInSelection(Ue,P),Ke=x&&Ue===Q,We=Oe&&Ue>=Be&&Ue<=je;let Ze=!1;this._decorationService.forEachDecorationAtCell(Ue,P,void 0,(O=>{Ze=!0}));let st=fe.getChars()||p.WHITESPACE_CELL_CHAR;if(st===" "&&(fe.isUnderline()||fe.isOverline())&&(st=""),be=rt*Y-ve.get(st,fe.isBold(),fe.isItalic()),j){if(G&&(Re&&ye||!Re&&!ye&&fe.bg===oe)&&(Re&&ye&&q.selectionForeground||fe.fg===Z)&&fe.extended.ext===pe&&We===ce&&be===U&&!Ke&&!yt&&!Ze){fe.isInvisible()?V+=p.WHITESPACE_CELL_CHAR:V+=st,G++;continue}G&&(j.textContent=V),j=this._document.createElement("span"),G=0,V=""}else j=this._document.createElement("span");if(oe=fe.bg,Z=fe.fg,pe=fe.extended.ext,ce=We,U=be,ye=Re,yt&&Q>=Ue&&Q<=dt&&(Q=Ue),!this._coreService.isCursorHidden&&Ke&&this._coreService.isCursorInitialized){if(Pe.push("xterm-cursor"),this._coreBrowserService.isFocused)W&&Pe.push("xterm-cursor-blink"),Pe.push(N==="bar"?"xterm-cursor-bar":N==="underline"?"xterm-cursor-underline":"xterm-cursor-block");else if(J)switch(J){case"outline":Pe.push("xterm-cursor-outline");break;case"block":Pe.push("xterm-cursor-block");break;case"bar":Pe.push("xterm-cursor-bar");break;case"underline":Pe.push("xterm-cursor-underline")}}if(fe.isBold()&&Pe.push("xterm-bold"),fe.isItalic()&&Pe.push("xterm-italic"),fe.isDim()&&Pe.push("xterm-dim"),V=fe.isInvisible()?p.WHITESPACE_CELL_CHAR:fe.getChars()||p.WHITESPACE_CELL_CHAR,fe.isUnderline()&&(Pe.push(`xterm-underline-${fe.extended.underlineStyle}`),V===" "&&(V=""),!fe.isUnderlineColorDefault()))if(fe.isUnderlineColorRGB())j.style.textDecorationColor=`rgb(${m.AttributeData.toColorRGB(fe.getUnderlineColor()).join(",")})`;else{let O=fe.getUnderlineColor();this._optionsService.rawOptions.drawBoldTextInBrightColors&&fe.isBold()&&O<8&&(O+=8),j.style.textDecorationColor=q.ansi[O].css}fe.isOverline()&&(Pe.push("xterm-overline"),V===" "&&(V="")),fe.isStrikethrough()&&Pe.push("xterm-strikethrough"),We&&(j.style.textDecoration="underline");let gt=fe.getFgColor(),Dt=fe.getFgColorMode(),wt=fe.getBgColor(),vt=fe.getBgColorMode();const qt=!!fe.isInverse();if(qt){const O=gt;gt=wt,wt=O;const ee=Dt;Dt=vt,vt=ee}let Lt,Gt,te,C=!1;switch(this._decorationService.forEachDecorationAtCell(Ue,P,void 0,(O=>{O.options.layer!=="top"&&C||(O.backgroundColorRGB&&(vt=50331648,wt=O.backgroundColorRGB.rgba>>8&16777215,Lt=O.backgroundColorRGB),O.foregroundColorRGB&&(Dt=50331648,gt=O.foregroundColorRGB.rgba>>8&16777215,Gt=O.foregroundColorRGB),C=O.options.layer==="top")})),!C&&Re&&(Lt=this._coreBrowserService.isFocused?q.selectionBackgroundOpaque:q.selectionInactiveBackgroundOpaque,wt=Lt.rgba>>8&16777215,vt=50331648,C=!0,q.selectionForeground&&(Dt=50331648,gt=q.selectionForeground.rgba>>8&16777215,Gt=q.selectionForeground)),C&&Pe.push("xterm-decoration-top"),vt){case 16777216:case 33554432:te=q.ansi[wt],Pe.push(`xterm-bg-${wt}`);break;case 50331648:te=A.channels.toColor(wt>>16,wt>>8&255,255&wt),this._addStyle(j,`background-color:#${I((wt>>>0).toString(16),"0",6)}`);break;default:qt?(te=q.foreground,Pe.push(`xterm-bg-${f.INVERTED_DEFAULT_COLOR}`)):te=q.background}switch(Lt||fe.isDim()&&(Lt=A.color.multiplyOpacity(te,.5)),Dt){case 16777216:case 33554432:fe.isBold()&&gt<8&&this._optionsService.rawOptions.drawBoldTextInBrightColors&&(gt+=8),this._applyMinimumContrast(j,te,q.ansi[gt],fe,Lt,void 0)||Pe.push(`xterm-fg-${gt}`);break;case 50331648:const O=A.channels.toColor(gt>>16&255,gt>>8&255,255&gt);this._applyMinimumContrast(j,te,O,fe,Lt,Gt)||this._addStyle(j,`color:#${I(gt.toString(16),"0",6)}`);break;default:this._applyMinimumContrast(j,te,q.foreground,fe,Lt,Gt)||qt&&Pe.push(`xterm-fg-${f.INVERTED_DEFAULT_COLOR}`)}Pe.length&&(j.className=Pe.join(" "),Pe.length=0),Ke||yt||Ze?j.textContent=V:G++,be!==this.defaultSpacing&&(j.style.letterSpacing=`${be}px`),xe.push(j),Ue=dt}return j&&G&&(j.textContent=V),xe}_applyMinimumContrast(B,P,x,N,J,Q){if(this._optionsService.rawOptions.minimumContrastRatio===1||(0,g.treatGlyphAsBackgroundColor)(N.getCode()))return!1;const W=this._getContrastCache(N);let Y;if(J||Q||(Y=W.getColor(P.rgba,x.rgba)),Y===void 0){const ve=this._optionsService.rawOptions.minimumContrastRatio/(N.isDim()?2:1);Y=A.color.ensureContrastRatio(J||P,Q||x,ve),W.setColor((J||P).rgba,(Q||x).rgba,Y??null)}return!!Y&&(this._addStyle(B,`color:${Y.css}`),!0)}_getContrastCache(B){return B.isDim()?this._themeService.colors.halfContrastCache:this._themeService.colors.contrastCache}_addStyle(B,P){B.setAttribute("style",`${B.getAttribute("style")||""}${P};`)}_isCellInSelection(B,P){const x=this._selectionStart,N=this._selectionEnd;return!(!x||!N)&&(this._columnSelectMode?x[0]<=N[0]?B>=x[0]&&P>=x[1]&&B<N[0]&&P<=N[1]:B<x[0]&&P>=x[1]&&B>=N[0]&&P<=N[1]:P>x[1]&&P<N[1]||x[1]===N[1]&&P===x[1]&&B>=x[0]&&B<N[0]||x[1]<N[1]&&P===N[1]&&B<N[0]||x[1]<N[1]&&P===x[1]&&B>=x[0])}};function I(B,P,x){for(;B.length<x;)B=P+B;return B}o.DomRendererRowFactory=$=d([l(1,w.ICharacterJoinerService),l(2,k.IOptionsService),l(3,w.ICoreBrowserService),l(4,k.ICoreService),l(5,k.IDecorationService),l(6,w.IThemeService)],$)},2550:(h,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.WidthCache=void 0,o.WidthCache=class{constructor(a,d){this._flat=new Float32Array(256),this._font="",this._fontSize=0,this._weight="normal",this._weightBold="bold",this._measureElements=[],this._container=a.createElement("div"),this._container.classList.add("xterm-width-cache-measure-container"),this._container.setAttribute("aria-hidden","true"),this._container.style.whiteSpace="pre",this._container.style.fontKerning="none";const l=a.createElement("span");l.classList.add("xterm-char-measure-element");const f=a.createElement("span");f.classList.add("xterm-char-measure-element"),f.style.fontWeight="bold";const p=a.createElement("span");p.classList.add("xterm-char-measure-element"),p.style.fontStyle="italic";const S=a.createElement("span");S.classList.add("xterm-char-measure-element"),S.style.fontWeight="bold",S.style.fontStyle="italic",this._measureElements=[l,f,p,S],this._container.appendChild(l),this._container.appendChild(f),this._container.appendChild(p),this._container.appendChild(S),d.appendChild(this._container),this.clear()}dispose(){this._container.remove(),this._measureElements.length=0,this._holey=void 0}clear(){this._flat.fill(-9999),this._holey=new Map}setFont(a,d,l,f){a===this._font&&d===this._fontSize&&l===this._weight&&f===this._weightBold||(this._font=a,this._fontSize=d,this._weight=l,this._weightBold=f,this._container.style.fontFamily=this._font,this._container.style.fontSize=`${this._fontSize}px`,this._measureElements[0].style.fontWeight=`${l}`,this._measureElements[1].style.fontWeight=`${f}`,this._measureElements[2].style.fontWeight=`${l}`,this._measureElements[3].style.fontWeight=`${f}`,this.clear())}get(a,d,l){let f=0;if(!d&&!l&&a.length===1&&(f=a.charCodeAt(0))<256){if(this._flat[f]!==-9999)return this._flat[f];const k=this._measure(a,0);return k>0&&(this._flat[f]=k),k}let p=a;d&&(p+="B"),l&&(p+="I");let S=this._holey.get(p);if(S===void 0){let k=0;d&&(k|=1),l&&(k|=2),S=this._measure(a,k),S>0&&this._holey.set(p,S)}return S}_measure(a,d){const l=this._measureElements[d];return l.textContent=a.repeat(32),l.offsetWidth/32}}},2223:(h,o,a)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.TEXT_BASELINE=o.DIM_OPACITY=o.INVERTED_DEFAULT_COLOR=void 0;const d=a(6114);o.INVERTED_DEFAULT_COLOR=257,o.DIM_OPACITY=.5,o.TEXT_BASELINE=d.isFirefox||d.isLegacyEdge?"bottom":"ideographic"},6171:(h,o)=>{function a(l){return 57508<=l&&l<=57558}function d(l){return l>=128512&&l<=128591||l>=127744&&l<=128511||l>=128640&&l<=128767||l>=9728&&l<=9983||l>=9984&&l<=10175||l>=65024&&l<=65039||l>=129280&&l<=129535||l>=127462&&l<=127487}Object.defineProperty(o,"__esModule",{value:!0}),o.computeNextVariantOffset=o.createRenderDimensions=o.treatGlyphAsBackgroundColor=o.allowRescaling=o.isEmoji=o.isRestrictedPowerlineGlyph=o.isPowerlineGlyph=o.throwIfFalsy=void 0,o.throwIfFalsy=function(l){if(!l)throw new Error("value must not be falsy");return l},o.isPowerlineGlyph=a,o.isRestrictedPowerlineGlyph=function(l){return 57520<=l&&l<=57527},o.isEmoji=d,o.allowRescaling=function(l,f,p,S){return f===1&&p>Math.ceil(1.5*S)&&l!==void 0&&l>255&&!d(l)&&!a(l)&&!(function(k){return 57344<=k&&k<=63743})(l)},o.treatGlyphAsBackgroundColor=function(l){return a(l)||(function(f){return 9472<=f&&f<=9631})(l)},o.createRenderDimensions=function(){return{css:{canvas:{width:0,height:0},cell:{width:0,height:0}},device:{canvas:{width:0,height:0},cell:{width:0,height:0},char:{width:0,height:0,left:0,top:0}}}},o.computeNextVariantOffset=function(l,f,p=0){return(l-(2*Math.round(f)-p))%(2*Math.round(f))}},6052:(h,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.createSelectionRenderModel=void 0;class a{constructor(){this.clear()}clear(){this.hasSelection=!1,this.columnSelectMode=!1,this.viewportStartRow=0,this.viewportEndRow=0,this.viewportCappedStartRow=0,this.viewportCappedEndRow=0,this.startCol=0,this.endCol=0,this.selectionStart=void 0,this.selectionEnd=void 0}update(l,f,p,S=!1){if(this.selectionStart=f,this.selectionEnd=p,!f||!p||f[0]===p[0]&&f[1]===p[1])return void this.clear();const k=l.buffers.active.ydisp,A=f[1]-k,w=p[1]-k,v=Math.max(A,0),g=Math.min(w,l.rows-1);v>=l.rows||g<0?this.clear():(this.hasSelection=!0,this.columnSelectMode=S,this.viewportStartRow=A,this.viewportEndRow=w,this.viewportCappedStartRow=v,this.viewportCappedEndRow=g,this.startCol=f[0],this.endCol=p[0])}isCellSelected(l,f,p){return!!this.hasSelection&&(p-=l.buffer.active.viewportY,this.columnSelectMode?this.startCol<=this.endCol?f>=this.startCol&&p>=this.viewportCappedStartRow&&f<this.endCol&&p<=this.viewportCappedEndRow:f<this.startCol&&p>=this.viewportCappedStartRow&&f>=this.endCol&&p<=this.viewportCappedEndRow:p>this.viewportStartRow&&p<this.viewportEndRow||this.viewportStartRow===this.viewportEndRow&&p===this.viewportStartRow&&f>=this.startCol&&f<this.endCol||this.viewportStartRow<this.viewportEndRow&&p===this.viewportEndRow&&f<this.endCol||this.viewportStartRow<this.viewportEndRow&&p===this.viewportStartRow&&f>=this.startCol)}}o.createSelectionRenderModel=function(){return new a}},456:(h,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.SelectionModel=void 0,o.SelectionModel=class{constructor(a){this._bufferService=a,this.isSelectAllActive=!1,this.selectionStartLength=0}clearSelection(){this.selectionStart=void 0,this.selectionEnd=void 0,this.isSelectAllActive=!1,this.selectionStartLength=0}get finalSelectionStart(){return this.isSelectAllActive?[0,0]:this.selectionEnd&&this.selectionStart&&this.areSelectionValuesReversed()?this.selectionEnd:this.selectionStart}get finalSelectionEnd(){if(this.isSelectAllActive)return[this._bufferService.cols,this._bufferService.buffer.ybase+this._bufferService.rows-1];if(this.selectionStart){if(!this.selectionEnd||this.areSelectionValuesReversed()){const a=this.selectionStart[0]+this.selectionStartLength;return a>this._bufferService.cols?a%this._bufferService.cols==0?[this._bufferService.cols,this.selectionStart[1]+Math.floor(a/this._bufferService.cols)-1]:[a%this._bufferService.cols,this.selectionStart[1]+Math.floor(a/this._bufferService.cols)]:[a,this.selectionStart[1]]}if(this.selectionStartLength&&this.selectionEnd[1]===this.selectionStart[1]){const a=this.selectionStart[0]+this.selectionStartLength;return a>this._bufferService.cols?[a%this._bufferService.cols,this.selectionStart[1]+Math.floor(a/this._bufferService.cols)]:[Math.max(a,this.selectionEnd[0]),this.selectionEnd[1]]}return this.selectionEnd}}areSelectionValuesReversed(){const a=this.selectionStart,d=this.selectionEnd;return!(!a||!d)&&(a[1]>d[1]||a[1]===d[1]&&a[0]>d[0])}handleTrim(a){return this.selectionStart&&(this.selectionStart[1]-=a),this.selectionEnd&&(this.selectionEnd[1]-=a),this.selectionEnd&&this.selectionEnd[1]<0?(this.clearSelection(),!0):(this.selectionStart&&this.selectionStart[1]<0&&(this.selectionStart[1]=0),!1)}}},428:function(h,o,a){var d=this&&this.__decorate||function(g,m,$,I){var B,P=arguments.length,x=P<3?m:I===null?I=Object.getOwnPropertyDescriptor(m,$):I;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")x=Reflect.decorate(g,m,$,I);else for(var N=g.length-1;N>=0;N--)(B=g[N])&&(x=(P<3?B(x):P>3?B(m,$,x):B(m,$))||x);return P>3&&x&&Object.defineProperty(m,$,x),x},l=this&&this.__param||function(g,m){return function($,I){m($,I,g)}};Object.defineProperty(o,"__esModule",{value:!0}),o.CharSizeService=void 0;const f=a(2585),p=a(8460),S=a(844);let k=o.CharSizeService=class extends S.Disposable{get hasValidSize(){return this.width>0&&this.height>0}constructor(g,m,$){super(),this._optionsService=$,this.width=0,this.height=0,this._onCharSizeChange=this.register(new p.EventEmitter),this.onCharSizeChange=this._onCharSizeChange.event;try{this._measureStrategy=this.register(new v(this._optionsService))}catch{this._measureStrategy=this.register(new w(g,m,this._optionsService))}this.register(this._optionsService.onMultipleOptionChange(["fontFamily","fontSize"],(()=>this.measure())))}measure(){const g=this._measureStrategy.measure();g.width===this.width&&g.height===this.height||(this.width=g.width,this.height=g.height,this._onCharSizeChange.fire())}};o.CharSizeService=k=d([l(2,f.IOptionsService)],k);class A extends S.Disposable{constructor(){super(...arguments),this._result={width:0,height:0}}_validateAndSet(m,$){m!==void 0&&m>0&&$!==void 0&&$>0&&(this._result.width=m,this._result.height=$)}}class w extends A{constructor(m,$,I){super(),this._document=m,this._parentElement=$,this._optionsService=I,this._measureElement=this._document.createElement("span"),this._measureElement.classList.add("xterm-char-measure-element"),this._measureElement.textContent="W".repeat(32),this._measureElement.setAttribute("aria-hidden","true"),this._measureElement.style.whiteSpace="pre",this._measureElement.style.fontKerning="none",this._parentElement.appendChild(this._measureElement)}measure(){return this._measureElement.style.fontFamily=this._optionsService.rawOptions.fontFamily,this._measureElement.style.fontSize=`${this._optionsService.rawOptions.fontSize}px`,this._validateAndSet(Number(this._measureElement.offsetWidth)/32,Number(this._measureElement.offsetHeight)),this._result}}class v extends A{constructor(m){super(),this._optionsService=m,this._canvas=new OffscreenCanvas(100,100),this._ctx=this._canvas.getContext("2d");const $=this._ctx.measureText("W");if(!("width"in $&&"fontBoundingBoxAscent"in $&&"fontBoundingBoxDescent"in $))throw new Error("Required font metrics not supported")}measure(){this._ctx.font=`${this._optionsService.rawOptions.fontSize}px ${this._optionsService.rawOptions.fontFamily}`;const m=this._ctx.measureText("W");return this._validateAndSet(m.width,m.fontBoundingBoxAscent+m.fontBoundingBoxDescent),this._result}}},4269:function(h,o,a){var d=this&&this.__decorate||function(v,g,m,$){var I,B=arguments.length,P=B<3?g:$===null?$=Object.getOwnPropertyDescriptor(g,m):$;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")P=Reflect.decorate(v,g,m,$);else for(var x=v.length-1;x>=0;x--)(I=v[x])&&(P=(B<3?I(P):B>3?I(g,m,P):I(g,m))||P);return B>3&&P&&Object.defineProperty(g,m,P),P},l=this&&this.__param||function(v,g){return function(m,$){g(m,$,v)}};Object.defineProperty(o,"__esModule",{value:!0}),o.CharacterJoinerService=o.JoinedCellData=void 0;const f=a(3734),p=a(643),S=a(511),k=a(2585);class A extends f.AttributeData{constructor(g,m,$){super(),this.content=0,this.combinedData="",this.fg=g.fg,this.bg=g.bg,this.combinedData=m,this._width=$}isCombined(){return 2097152}getWidth(){return this._width}getChars(){return this.combinedData}getCode(){return 2097151}setFromCharData(g){throw new Error("not implemented")}getAsCharData(){return[this.fg,this.getChars(),this.getWidth(),this.getCode()]}}o.JoinedCellData=A;let w=o.CharacterJoinerService=class Bn{constructor(g){this._bufferService=g,this._characterJoiners=[],this._nextCharacterJoinerId=0,this._workCell=new S.CellData}register(g){const m={id:this._nextCharacterJoinerId++,handler:g};return this._characterJoiners.push(m),m.id}deregister(g){for(let m=0;m<this._characterJoiners.length;m++)if(this._characterJoiners[m].id===g)return this._characterJoiners.splice(m,1),!0;return!1}getJoinedCharacters(g){if(this._characterJoiners.length===0)return[];const m=this._bufferService.buffer.lines.get(g);if(!m||m.length===0)return[];const $=[],I=m.translateToString(!0);let B=0,P=0,x=0,N=m.getFg(0),J=m.getBg(0);for(let Q=0;Q<m.getTrimmedLength();Q++)if(m.loadCell(Q,this._workCell),this._workCell.getWidth()!==0){if(this._workCell.fg!==N||this._workCell.bg!==J){if(Q-B>1){const W=this._getJoinedRanges(I,x,P,m,B);for(let Y=0;Y<W.length;Y++)$.push(W[Y])}B=Q,x=P,N=this._workCell.fg,J=this._workCell.bg}P+=this._workCell.getChars().length||p.WHITESPACE_CELL_CHAR.length}if(this._bufferService.cols-B>1){const Q=this._getJoinedRanges(I,x,P,m,B);for(let W=0;W<Q.length;W++)$.push(Q[W])}return $}_getJoinedRanges(g,m,$,I,B){const P=g.substring(m,$);let x=[];try{x=this._characterJoiners[0].handler(P)}catch(N){console.error(N)}for(let N=1;N<this._characterJoiners.length;N++)try{const J=this._characterJoiners[N].handler(P);for(let Q=0;Q<J.length;Q++)Bn._mergeRanges(x,J[Q])}catch(J){console.error(J)}return this._stringRangesToCellRanges(x,I,B),x}_stringRangesToCellRanges(g,m,$){let I=0,B=!1,P=0,x=g[I];if(x){for(let N=$;N<this._bufferService.cols;N++){const J=m.getWidth(N),Q=m.getString(N).length||p.WHITESPACE_CELL_CHAR.length;if(J!==0){if(!B&&x[0]<=P&&(x[0]=N,B=!0),x[1]<=P){if(x[1]=N,x=g[++I],!x)break;x[0]<=P?(x[0]=N,B=!0):B=!1}P+=Q}}x&&(x[1]=this._bufferService.cols)}}static _mergeRanges(g,m){let $=!1;for(let I=0;I<g.length;I++){const B=g[I];if($){if(m[1]<=B[0])return g[I-1][1]=m[1],g;if(m[1]<=B[1])return g[I-1][1]=Math.max(m[1],B[1]),g.splice(I,1),g;g.splice(I,1),I--}else{if(m[1]<=B[0])return g.splice(I,0,m),g;if(m[1]<=B[1])return B[0]=Math.min(m[0],B[0]),g;m[0]<B[1]&&(B[0]=Math.min(m[0],B[0]),$=!0)}}return $?g[g.length-1][1]=m[1]:g.push(m),g}};o.CharacterJoinerService=w=d([l(0,k.IBufferService)],w)},5114:(h,o,a)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.CoreBrowserService=void 0;const d=a(844),l=a(8460),f=a(3656);class p extends d.Disposable{constructor(A,w,v){super(),this._textarea=A,this._window=w,this.mainDocument=v,this._isFocused=!1,this._cachedIsFocused=void 0,this._screenDprMonitor=new S(this._window),this._onDprChange=this.register(new l.EventEmitter),this.onDprChange=this._onDprChange.event,this._onWindowChange=this.register(new l.EventEmitter),this.onWindowChange=this._onWindowChange.event,this.register(this.onWindowChange((g=>this._screenDprMonitor.setWindow(g)))),this.register((0,l.forwardEvent)(this._screenDprMonitor.onDprChange,this._onDprChange)),this._textarea.addEventListener("focus",(()=>this._isFocused=!0)),this._textarea.addEventListener("blur",(()=>this._isFocused=!1))}get window(){return this._window}set window(A){this._window!==A&&(this._window=A,this._onWindowChange.fire(this._window))}get dpr(){return this.window.devicePixelRatio}get isFocused(){return this._cachedIsFocused===void 0&&(this._cachedIsFocused=this._isFocused&&this._textarea.ownerDocument.hasFocus(),queueMicrotask((()=>this._cachedIsFocused=void 0))),this._cachedIsFocused}}o.CoreBrowserService=p;class S extends d.Disposable{constructor(A){super(),this._parentWindow=A,this._windowResizeListener=this.register(new d.MutableDisposable),this._onDprChange=this.register(new l.EventEmitter),this.onDprChange=this._onDprChange.event,this._outerListener=()=>this._setDprAndFireIfDiffers(),this._currentDevicePixelRatio=this._parentWindow.devicePixelRatio,this._updateDpr(),this._setWindowResizeListener(),this.register((0,d.toDisposable)((()=>this.clearListener())))}setWindow(A){this._parentWindow=A,this._setWindowResizeListener(),this._setDprAndFireIfDiffers()}_setWindowResizeListener(){this._windowResizeListener.value=(0,f.addDisposableDomListener)(this._parentWindow,"resize",(()=>this._setDprAndFireIfDiffers()))}_setDprAndFireIfDiffers(){this._parentWindow.devicePixelRatio!==this._currentDevicePixelRatio&&this._onDprChange.fire(this._parentWindow.devicePixelRatio),this._updateDpr()}_updateDpr(){this._outerListener&&(this._resolutionMediaMatchList?.removeListener(this._outerListener),this._currentDevicePixelRatio=this._parentWindow.devicePixelRatio,this._resolutionMediaMatchList=this._parentWindow.matchMedia(`screen and (resolution: ${this._parentWindow.devicePixelRatio}dppx)`),this._resolutionMediaMatchList.addListener(this._outerListener))}clearListener(){this._resolutionMediaMatchList&&this._outerListener&&(this._resolutionMediaMatchList.removeListener(this._outerListener),this._resolutionMediaMatchList=void 0,this._outerListener=void 0)}}},779:(h,o,a)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.LinkProviderService=void 0;const d=a(844);class l extends d.Disposable{constructor(){super(),this.linkProviders=[],this.register((0,d.toDisposable)((()=>this.linkProviders.length=0)))}registerLinkProvider(p){return this.linkProviders.push(p),{dispose:()=>{const S=this.linkProviders.indexOf(p);S!==-1&&this.linkProviders.splice(S,1)}}}}o.LinkProviderService=l},8934:function(h,o,a){var d=this&&this.__decorate||function(k,A,w,v){var g,m=arguments.length,$=m<3?A:v===null?v=Object.getOwnPropertyDescriptor(A,w):v;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")$=Reflect.decorate(k,A,w,v);else for(var I=k.length-1;I>=0;I--)(g=k[I])&&($=(m<3?g($):m>3?g(A,w,$):g(A,w))||$);return m>3&&$&&Object.defineProperty(A,w,$),$},l=this&&this.__param||function(k,A){return function(w,v){A(w,v,k)}};Object.defineProperty(o,"__esModule",{value:!0}),o.MouseService=void 0;const f=a(4725),p=a(9806);let S=o.MouseService=class{constructor(k,A){this._renderService=k,this._charSizeService=A}getCoords(k,A,w,v,g){return(0,p.getCoords)(window,k,A,w,v,this._charSizeService.hasValidSize,this._renderService.dimensions.css.cell.width,this._renderService.dimensions.css.cell.height,g)}getMouseReportCoords(k,A){const w=(0,p.getCoordsRelativeToElement)(window,k,A);if(this._charSizeService.hasValidSize)return w[0]=Math.min(Math.max(w[0],0),this._renderService.dimensions.css.canvas.width-1),w[1]=Math.min(Math.max(w[1],0),this._renderService.dimensions.css.canvas.height-1),{col:Math.floor(w[0]/this._renderService.dimensions.css.cell.width),row:Math.floor(w[1]/this._renderService.dimensions.css.cell.height),x:Math.floor(w[0]),y:Math.floor(w[1])}}};o.MouseService=S=d([l(0,f.IRenderService),l(1,f.ICharSizeService)],S)},3230:function(h,o,a){var d=this&&this.__decorate||function(g,m,$,I){var B,P=arguments.length,x=P<3?m:I===null?I=Object.getOwnPropertyDescriptor(m,$):I;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")x=Reflect.decorate(g,m,$,I);else for(var N=g.length-1;N>=0;N--)(B=g[N])&&(x=(P<3?B(x):P>3?B(m,$,x):B(m,$))||x);return P>3&&x&&Object.defineProperty(m,$,x),x},l=this&&this.__param||function(g,m){return function($,I){m($,I,g)}};Object.defineProperty(o,"__esModule",{value:!0}),o.RenderService=void 0;const f=a(6193),p=a(4725),S=a(8460),k=a(844),A=a(7226),w=a(2585);let v=o.RenderService=class extends k.Disposable{get dimensions(){return this._renderer.value.dimensions}constructor(g,m,$,I,B,P,x,N){super(),this._rowCount=g,this._charSizeService=I,this._renderer=this.register(new k.MutableDisposable),this._pausedResizeTask=new A.DebouncedIdleTask,this._observerDisposable=this.register(new k.MutableDisposable),this._isPaused=!1,this._needsFullRefresh=!1,this._isNextRenderRedrawOnly=!0,this._needsSelectionRefresh=!1,this._canvasWidth=0,this._canvasHeight=0,this._selectionState={start:void 0,end:void 0,columnSelectMode:!1},this._onDimensionsChange=this.register(new S.EventEmitter),this.onDimensionsChange=this._onDimensionsChange.event,this._onRenderedViewportChange=this.register(new S.EventEmitter),this.onRenderedViewportChange=this._onRenderedViewportChange.event,this._onRender=this.register(new S.EventEmitter),this.onRender=this._onRender.event,this._onRefreshRequest=this.register(new S.EventEmitter),this.onRefreshRequest=this._onRefreshRequest.event,this._renderDebouncer=new f.RenderDebouncer(((J,Q)=>this._renderRows(J,Q)),x),this.register(this._renderDebouncer),this.register(x.onDprChange((()=>this.handleDevicePixelRatioChange()))),this.register(P.onResize((()=>this._fullRefresh()))),this.register(P.buffers.onBufferActivate((()=>this._renderer.value?.clear()))),this.register($.onOptionChange((()=>this._handleOptionsChanged()))),this.register(this._charSizeService.onCharSizeChange((()=>this.handleCharSizeChanged()))),this.register(B.onDecorationRegistered((()=>this._fullRefresh()))),this.register(B.onDecorationRemoved((()=>this._fullRefresh()))),this.register($.onMultipleOptionChange(["customGlyphs","drawBoldTextInBrightColors","letterSpacing","lineHeight","fontFamily","fontSize","fontWeight","fontWeightBold","minimumContrastRatio","rescaleOverlappingGlyphs"],(()=>{this.clear(),this.handleResize(P.cols,P.rows),this._fullRefresh()}))),this.register($.onMultipleOptionChange(["cursorBlink","cursorStyle"],(()=>this.refreshRows(P.buffer.y,P.buffer.y,!0)))),this.register(N.onChangeColors((()=>this._fullRefresh()))),this._registerIntersectionObserver(x.window,m),this.register(x.onWindowChange((J=>this._registerIntersectionObserver(J,m))))}_registerIntersectionObserver(g,m){if("IntersectionObserver"in g){const $=new g.IntersectionObserver((I=>this._handleIntersectionChange(I[I.length-1])),{threshold:0});$.observe(m),this._observerDisposable.value=(0,k.toDisposable)((()=>$.disconnect()))}}_handleIntersectionChange(g){this._isPaused=g.isIntersecting===void 0?g.intersectionRatio===0:!g.isIntersecting,this._isPaused||this._charSizeService.hasValidSize||this._charSizeService.measure(),!this._isPaused&&this._needsFullRefresh&&(this._pausedResizeTask.flush(),this.refreshRows(0,this._rowCount-1),this._needsFullRefresh=!1)}refreshRows(g,m,$=!1){this._isPaused?this._needsFullRefresh=!0:($||(this._isNextRenderRedrawOnly=!1),this._renderDebouncer.refresh(g,m,this._rowCount))}_renderRows(g,m){this._renderer.value&&(g=Math.min(g,this._rowCount-1),m=Math.min(m,this._rowCount-1),this._renderer.value.renderRows(g,m),this._needsSelectionRefresh&&(this._renderer.value.handleSelectionChanged(this._selectionState.start,this._selectionState.end,this._selectionState.columnSelectMode),this._needsSelectionRefresh=!1),this._isNextRenderRedrawOnly||this._onRenderedViewportChange.fire({start:g,end:m}),this._onRender.fire({start:g,end:m}),this._isNextRenderRedrawOnly=!0)}resize(g,m){this._rowCount=m,this._fireOnCanvasResize()}_handleOptionsChanged(){this._renderer.value&&(this.refreshRows(0,this._rowCount-1),this._fireOnCanvasResize())}_fireOnCanvasResize(){this._renderer.value&&(this._renderer.value.dimensions.css.canvas.width===this._canvasWidth&&this._renderer.value.dimensions.css.canvas.height===this._canvasHeight||this._onDimensionsChange.fire(this._renderer.value.dimensions))}hasRenderer(){return!!this._renderer.value}setRenderer(g){this._renderer.value=g,this._renderer.value&&(this._renderer.value.onRequestRedraw((m=>this.refreshRows(m.start,m.end,!0))),this._needsSelectionRefresh=!0,this._fullRefresh())}addRefreshCallback(g){return this._renderDebouncer.addRefreshCallback(g)}_fullRefresh(){this._isPaused?this._needsFullRefresh=!0:this.refreshRows(0,this._rowCount-1)}clearTextureAtlas(){this._renderer.value&&(this._renderer.value.clearTextureAtlas?.(),this._fullRefresh())}handleDevicePixelRatioChange(){this._charSizeService.measure(),this._renderer.value&&(this._renderer.value.handleDevicePixelRatioChange(),this.refreshRows(0,this._rowCount-1))}handleResize(g,m){this._renderer.value&&(this._isPaused?this._pausedResizeTask.set((()=>this._renderer.value?.handleResize(g,m))):this._renderer.value.handleResize(g,m),this._fullRefresh())}handleCharSizeChanged(){this._renderer.value?.handleCharSizeChanged()}handleBlur(){this._renderer.value?.handleBlur()}handleFocus(){this._renderer.value?.handleFocus()}handleSelectionChanged(g,m,$){this._selectionState.start=g,this._selectionState.end=m,this._selectionState.columnSelectMode=$,this._renderer.value?.handleSelectionChanged(g,m,$)}handleCursorMove(){this._renderer.value?.handleCursorMove()}clear(){this._renderer.value?.clear()}};o.RenderService=v=d([l(2,w.IOptionsService),l(3,p.ICharSizeService),l(4,w.IDecorationService),l(5,w.IBufferService),l(6,p.ICoreBrowserService),l(7,p.IThemeService)],v)},9312:function(h,o,a){var d=this&&this.__decorate||function(x,N,J,Q){var W,Y=arguments.length,ve=Y<3?N:Q===null?Q=Object.getOwnPropertyDescriptor(N,J):Q;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")ve=Reflect.decorate(x,N,J,Q);else for(var Be=x.length-1;Be>=0;Be--)(W=x[Be])&&(ve=(Y<3?W(ve):Y>3?W(N,J,ve):W(N,J))||ve);return Y>3&&ve&&Object.defineProperty(N,J,ve),ve},l=this&&this.__param||function(x,N){return function(J,Q){N(J,Q,x)}};Object.defineProperty(o,"__esModule",{value:!0}),o.SelectionService=void 0;const f=a(9806),p=a(9504),S=a(456),k=a(4725),A=a(8460),w=a(844),v=a(6114),g=a(4841),m=a(511),$=a(2585),I="",B=new RegExp(I,"g");let P=o.SelectionService=class extends w.Disposable{constructor(x,N,J,Q,W,Y,ve,Be,je){super(),this._element=x,this._screenElement=N,this._linkifier=J,this._bufferService=Q,this._coreService=W,this._mouseService=Y,this._optionsService=ve,this._renderService=Be,this._coreBrowserService=je,this._dragScrollAmount=0,this._enabled=!0,this._workCell=new m.CellData,this._mouseDownTimeStamp=0,this._oldHasSelection=!1,this._oldSelectionStart=void 0,this._oldSelectionEnd=void 0,this._onLinuxMouseSelection=this.register(new A.EventEmitter),this.onLinuxMouseSelection=this._onLinuxMouseSelection.event,this._onRedrawRequest=this.register(new A.EventEmitter),this.onRequestRedraw=this._onRedrawRequest.event,this._onSelectionChange=this.register(new A.EventEmitter),this.onSelectionChange=this._onSelectionChange.event,this._onRequestScrollLines=this.register(new A.EventEmitter),this.onRequestScrollLines=this._onRequestScrollLines.event,this._mouseMoveListener=xe=>this._handleMouseMove(xe),this._mouseUpListener=xe=>this._handleMouseUp(xe),this._coreService.onUserInput((()=>{this.hasSelection&&this.clearSelection()})),this._trimListener=this._bufferService.buffer.lines.onTrim((xe=>this._handleTrim(xe))),this.register(this._bufferService.buffers.onBufferActivate((xe=>this._handleBufferActivate(xe)))),this.enable(),this._model=new S.SelectionModel(this._bufferService),this._activeSelectionMode=0,this.register((0,w.toDisposable)((()=>{this._removeMouseDownListeners()})))}reset(){this.clearSelection()}disable(){this.clearSelection(),this._enabled=!1}enable(){this._enabled=!0}get selectionStart(){return this._model.finalSelectionStart}get selectionEnd(){return this._model.finalSelectionEnd}get hasSelection(){const x=this._model.finalSelectionStart,N=this._model.finalSelectionEnd;return!(!x||!N||x[0]===N[0]&&x[1]===N[1])}get selectionText(){const x=this._model.finalSelectionStart,N=this._model.finalSelectionEnd;if(!x||!N)return"";const J=this._bufferService.buffer,Q=[];if(this._activeSelectionMode===3){if(x[0]===N[0])return"";const W=x[0]<N[0]?x[0]:N[0],Y=x[0]<N[0]?N[0]:x[0];for(let ve=x[1];ve<=N[1];ve++){const Be=J.translateBufferLineToString(ve,!0,W,Y);Q.push(Be)}}else{const W=x[1]===N[1]?N[0]:void 0;Q.push(J.translateBufferLineToString(x[1],!0,x[0],W));for(let Y=x[1]+1;Y<=N[1]-1;Y++){const ve=J.lines.get(Y),Be=J.translateBufferLineToString(Y,!0);ve?.isWrapped?Q[Q.length-1]+=Be:Q.push(Be)}if(x[1]!==N[1]){const Y=J.lines.get(N[1]),ve=J.translateBufferLineToString(N[1],!0,0,N[0]);Y&&Y.isWrapped?Q[Q.length-1]+=ve:Q.push(ve)}}return Q.map((W=>W.replace(B," "))).join(v.isWindows?`\r
`:`
`)}clearSelection(){this._model.clearSelection(),this._removeMouseDownListeners(),this.refresh(),this._onSelectionChange.fire()}refresh(x){this._refreshAnimationFrame||(this._refreshAnimationFrame=this._coreBrowserService.window.requestAnimationFrame((()=>this._refresh()))),v.isLinux&&x&&this.selectionText.length&&this._onLinuxMouseSelection.fire(this.selectionText)}_refresh(){this._refreshAnimationFrame=void 0,this._onRedrawRequest.fire({start:this._model.finalSelectionStart,end:this._model.finalSelectionEnd,columnSelectMode:this._activeSelectionMode===3})}_isClickInSelection(x){const N=this._getMouseBufferCoords(x),J=this._model.finalSelectionStart,Q=this._model.finalSelectionEnd;return!!(J&&Q&&N)&&this._areCoordsInSelection(N,J,Q)}isCellInSelection(x,N){const J=this._model.finalSelectionStart,Q=this._model.finalSelectionEnd;return!(!J||!Q)&&this._areCoordsInSelection([x,N],J,Q)}_areCoordsInSelection(x,N,J){return x[1]>N[1]&&x[1]<J[1]||N[1]===J[1]&&x[1]===N[1]&&x[0]>=N[0]&&x[0]<J[0]||N[1]<J[1]&&x[1]===J[1]&&x[0]<J[0]||N[1]<J[1]&&x[1]===N[1]&&x[0]>=N[0]}_selectWordAtCursor(x,N){const J=this._linkifier.currentLink?.link?.range;if(J)return this._model.selectionStart=[J.start.x-1,J.start.y-1],this._model.selectionStartLength=(0,g.getRangeLength)(J,this._bufferService.cols),this._model.selectionEnd=void 0,!0;const Q=this._getMouseBufferCoords(x);return!!Q&&(this._selectWordAt(Q,N),this._model.selectionEnd=void 0,!0)}selectAll(){this._model.isSelectAllActive=!0,this.refresh(),this._onSelectionChange.fire()}selectLines(x,N){this._model.clearSelection(),x=Math.max(x,0),N=Math.min(N,this._bufferService.buffer.lines.length-1),this._model.selectionStart=[0,x],this._model.selectionEnd=[this._bufferService.cols,N],this.refresh(),this._onSelectionChange.fire()}_handleTrim(x){this._model.handleTrim(x)&&this.refresh()}_getMouseBufferCoords(x){const N=this._mouseService.getCoords(x,this._screenElement,this._bufferService.cols,this._bufferService.rows,!0);if(N)return N[0]--,N[1]--,N[1]+=this._bufferService.buffer.ydisp,N}_getMouseEventScrollAmount(x){let N=(0,f.getCoordsRelativeToElement)(this._coreBrowserService.window,x,this._screenElement)[1];const J=this._renderService.dimensions.css.canvas.height;return N>=0&&N<=J?0:(N>J&&(N-=J),N=Math.min(Math.max(N,-50),50),N/=50,N/Math.abs(N)+Math.round(14*N))}shouldForceSelection(x){return v.isMac?x.altKey&&this._optionsService.rawOptions.macOptionClickForcesSelection:x.shiftKey}handleMouseDown(x){if(this._mouseDownTimeStamp=x.timeStamp,(x.button!==2||!this.hasSelection)&&x.button===0){if(!this._enabled){if(!this.shouldForceSelection(x))return;x.stopPropagation()}x.preventDefault(),this._dragScrollAmount=0,this._enabled&&x.shiftKey?this._handleIncrementalClick(x):x.detail===1?this._handleSingleClick(x):x.detail===2?this._handleDoubleClick(x):x.detail===3&&this._handleTripleClick(x),this._addMouseDownListeners(),this.refresh(!0)}}_addMouseDownListeners(){this._screenElement.ownerDocument&&(this._screenElement.ownerDocument.addEventListener("mousemove",this._mouseMoveListener),this._screenElement.ownerDocument.addEventListener("mouseup",this._mouseUpListener)),this._dragScrollIntervalTimer=this._coreBrowserService.window.setInterval((()=>this._dragScroll()),50)}_removeMouseDownListeners(){this._screenElement.ownerDocument&&(this._screenElement.ownerDocument.removeEventListener("mousemove",this._mouseMoveListener),this._screenElement.ownerDocument.removeEventListener("mouseup",this._mouseUpListener)),this._coreBrowserService.window.clearInterval(this._dragScrollIntervalTimer),this._dragScrollIntervalTimer=void 0}_handleIncrementalClick(x){this._model.selectionStart&&(this._model.selectionEnd=this._getMouseBufferCoords(x))}_handleSingleClick(x){if(this._model.selectionStartLength=0,this._model.isSelectAllActive=!1,this._activeSelectionMode=this.shouldColumnSelect(x)?3:0,this._model.selectionStart=this._getMouseBufferCoords(x),!this._model.selectionStart)return;this._model.selectionEnd=void 0;const N=this._bufferService.buffer.lines.get(this._model.selectionStart[1]);N&&N.length!==this._model.selectionStart[0]&&N.hasWidth(this._model.selectionStart[0])===0&&this._model.selectionStart[0]++}_handleDoubleClick(x){this._selectWordAtCursor(x,!0)&&(this._activeSelectionMode=1)}_handleTripleClick(x){const N=this._getMouseBufferCoords(x);N&&(this._activeSelectionMode=2,this._selectLineAt(N[1]))}shouldColumnSelect(x){return x.altKey&&!(v.isMac&&this._optionsService.rawOptions.macOptionClickForcesSelection)}_handleMouseMove(x){if(x.stopImmediatePropagation(),!this._model.selectionStart)return;const N=this._model.selectionEnd?[this._model.selectionEnd[0],this._model.selectionEnd[1]]:null;if(this._model.selectionEnd=this._getMouseBufferCoords(x),!this._model.selectionEnd)return void this.refresh(!0);this._activeSelectionMode===2?this._model.selectionEnd[1]<this._model.selectionStart[1]?this._model.selectionEnd[0]=0:this._model.selectionEnd[0]=this._bufferService.cols:this._activeSelectionMode===1&&this._selectToWordAt(this._model.selectionEnd),this._dragScrollAmount=this._getMouseEventScrollAmount(x),this._activeSelectionMode!==3&&(this._dragScrollAmount>0?this._model.selectionEnd[0]=this._bufferService.cols:this._dragScrollAmount<0&&(this._model.selectionEnd[0]=0));const J=this._bufferService.buffer;if(this._model.selectionEnd[1]<J.lines.length){const Q=J.lines.get(this._model.selectionEnd[1]);Q&&Q.hasWidth(this._model.selectionEnd[0])===0&&this._model.selectionEnd[0]<this._bufferService.cols&&this._model.selectionEnd[0]++}N&&N[0]===this._model.selectionEnd[0]&&N[1]===this._model.selectionEnd[1]||this.refresh(!0)}_dragScroll(){if(this._model.selectionEnd&&this._model.selectionStart&&this._dragScrollAmount){this._onRequestScrollLines.fire({amount:this._dragScrollAmount,suppressScrollEvent:!1});const x=this._bufferService.buffer;this._dragScrollAmount>0?(this._activeSelectionMode!==3&&(this._model.selectionEnd[0]=this._bufferService.cols),this._model.selectionEnd[1]=Math.min(x.ydisp+this._bufferService.rows,x.lines.length-1)):(this._activeSelectionMode!==3&&(this._model.selectionEnd[0]=0),this._model.selectionEnd[1]=x.ydisp),this.refresh()}}_handleMouseUp(x){const N=x.timeStamp-this._mouseDownTimeStamp;if(this._removeMouseDownListeners(),this.selectionText.length<=1&&N<500&&x.altKey&&this._optionsService.rawOptions.altClickMovesCursor){if(this._bufferService.buffer.ybase===this._bufferService.buffer.ydisp){const J=this._mouseService.getCoords(x,this._element,this._bufferService.cols,this._bufferService.rows,!1);if(J&&J[0]!==void 0&&J[1]!==void 0){const Q=(0,p.moveToCellSequence)(J[0]-1,J[1]-1,this._bufferService,this._coreService.decPrivateModes.applicationCursorKeys);this._coreService.triggerDataEvent(Q,!0)}}}else this._fireEventIfSelectionChanged()}_fireEventIfSelectionChanged(){const x=this._model.finalSelectionStart,N=this._model.finalSelectionEnd,J=!(!x||!N||x[0]===N[0]&&x[1]===N[1]);J?x&&N&&(this._oldSelectionStart&&this._oldSelectionEnd&&x[0]===this._oldSelectionStart[0]&&x[1]===this._oldSelectionStart[1]&&N[0]===this._oldSelectionEnd[0]&&N[1]===this._oldSelectionEnd[1]||this._fireOnSelectionChange(x,N,J)):this._oldHasSelection&&this._fireOnSelectionChange(x,N,J)}_fireOnSelectionChange(x,N,J){this._oldSelectionStart=x,this._oldSelectionEnd=N,this._oldHasSelection=J,this._onSelectionChange.fire()}_handleBufferActivate(x){this.clearSelection(),this._trimListener.dispose(),this._trimListener=x.activeBuffer.lines.onTrim((N=>this._handleTrim(N)))}_convertViewportColToCharacterIndex(x,N){let J=N;for(let Q=0;N>=Q;Q++){const W=x.loadCell(Q,this._workCell).getChars().length;this._workCell.getWidth()===0?J--:W>1&&N!==Q&&(J+=W-1)}return J}setSelection(x,N,J){this._model.clearSelection(),this._removeMouseDownListeners(),this._model.selectionStart=[x,N],this._model.selectionStartLength=J,this.refresh(),this._fireEventIfSelectionChanged()}rightClickSelect(x){this._isClickInSelection(x)||(this._selectWordAtCursor(x,!1)&&this.refresh(!0),this._fireEventIfSelectionChanged())}_getWordAt(x,N,J=!0,Q=!0){if(x[0]>=this._bufferService.cols)return;const W=this._bufferService.buffer,Y=W.lines.get(x[1]);if(!Y)return;const ve=W.translateBufferLineToString(x[1],!1);let Be=this._convertViewportColToCharacterIndex(Y,x[0]),je=Be;const xe=x[0]-Be;let ke=0,q=0,j=0,H=0;if(ve.charAt(Be)===" "){for(;Be>0&&ve.charAt(Be-1)===" ";)Be--;for(;je<ve.length&&ve.charAt(je+1)===" ";)je++}else{let oe=x[0],Z=x[0];Y.getWidth(oe)===0&&(ke++,oe--),Y.getWidth(Z)===2&&(q++,Z++);const pe=Y.getString(Z).length;for(pe>1&&(H+=pe-1,je+=pe-1);oe>0&&Be>0&&!this._isCharWordSeparator(Y.loadCell(oe-1,this._workCell));){Y.loadCell(oe-1,this._workCell);const ce=this._workCell.getChars().length;this._workCell.getWidth()===0?(ke++,oe--):ce>1&&(j+=ce-1,Be-=ce-1),Be--,oe--}for(;Z<Y.length&&je+1<ve.length&&!this._isCharWordSeparator(Y.loadCell(Z+1,this._workCell));){Y.loadCell(Z+1,this._workCell);const ce=this._workCell.getChars().length;this._workCell.getWidth()===2?(q++,Z++):ce>1&&(H+=ce-1,je+=ce-1),je++,Z++}}je++;let G=Be+xe-ke+j,V=Math.min(this._bufferService.cols,je-Be+ke+q-j-H);if(N||ve.slice(Be,je).trim()!==""){if(J&&G===0&&Y.getCodePoint(0)!==32){const oe=W.lines.get(x[1]-1);if(oe&&Y.isWrapped&&oe.getCodePoint(this._bufferService.cols-1)!==32){const Z=this._getWordAt([this._bufferService.cols-1,x[1]-1],!1,!0,!1);if(Z){const pe=this._bufferService.cols-Z.start;G-=pe,V+=pe}}}if(Q&&G+V===this._bufferService.cols&&Y.getCodePoint(this._bufferService.cols-1)!==32){const oe=W.lines.get(x[1]+1);if(oe?.isWrapped&&oe.getCodePoint(0)!==32){const Z=this._getWordAt([0,x[1]+1],!1,!1,!0);Z&&(V+=Z.length)}}return{start:G,length:V}}}_selectWordAt(x,N){const J=this._getWordAt(x,N);if(J){for(;J.start<0;)J.start+=this._bufferService.cols,x[1]--;this._model.selectionStart=[J.start,x[1]],this._model.selectionStartLength=J.length}}_selectToWordAt(x){const N=this._getWordAt(x,!0);if(N){let J=x[1];for(;N.start<0;)N.start+=this._bufferService.cols,J--;if(!this._model.areSelectionValuesReversed())for(;N.start+N.length>this._bufferService.cols;)N.length-=this._bufferService.cols,J++;this._model.selectionEnd=[this._model.areSelectionValuesReversed()?N.start:N.start+N.length,J]}}_isCharWordSeparator(x){return x.getWidth()!==0&&this._optionsService.rawOptions.wordSeparator.indexOf(x.getChars())>=0}_selectLineAt(x){const N=this._bufferService.buffer.getWrappedRangeForLine(x),J={start:{x:0,y:N.first},end:{x:this._bufferService.cols-1,y:N.last}};this._model.selectionStart=[0,N.first],this._model.selectionEnd=void 0,this._model.selectionStartLength=(0,g.getRangeLength)(J,this._bufferService.cols)}};o.SelectionService=P=d([l(3,$.IBufferService),l(4,$.ICoreService),l(5,k.IMouseService),l(6,$.IOptionsService),l(7,k.IRenderService),l(8,k.ICoreBrowserService)],P)},4725:(h,o,a)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.ILinkProviderService=o.IThemeService=o.ICharacterJoinerService=o.ISelectionService=o.IRenderService=o.IMouseService=o.ICoreBrowserService=o.ICharSizeService=void 0;const d=a(8343);o.ICharSizeService=(0,d.createDecorator)("CharSizeService"),o.ICoreBrowserService=(0,d.createDecorator)("CoreBrowserService"),o.IMouseService=(0,d.createDecorator)("MouseService"),o.IRenderService=(0,d.createDecorator)("RenderService"),o.ISelectionService=(0,d.createDecorator)("SelectionService"),o.ICharacterJoinerService=(0,d.createDecorator)("CharacterJoinerService"),o.IThemeService=(0,d.createDecorator)("ThemeService"),o.ILinkProviderService=(0,d.createDecorator)("LinkProviderService")},6731:function(h,o,a){var d=this&&this.__decorate||function(P,x,N,J){var Q,W=arguments.length,Y=W<3?x:J===null?J=Object.getOwnPropertyDescriptor(x,N):J;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")Y=Reflect.decorate(P,x,N,J);else for(var ve=P.length-1;ve>=0;ve--)(Q=P[ve])&&(Y=(W<3?Q(Y):W>3?Q(x,N,Y):Q(x,N))||Y);return W>3&&Y&&Object.defineProperty(x,N,Y),Y},l=this&&this.__param||function(P,x){return function(N,J){x(N,J,P)}};Object.defineProperty(o,"__esModule",{value:!0}),o.ThemeService=o.DEFAULT_ANSI_COLORS=void 0;const f=a(7239),p=a(8055),S=a(8460),k=a(844),A=a(2585),w=p.css.toColor("#ffffff"),v=p.css.toColor("#000000"),g=p.css.toColor("#ffffff"),m=p.css.toColor("#000000"),$={css:"rgba(255, 255, 255, 0.3)",rgba:4294967117};o.DEFAULT_ANSI_COLORS=Object.freeze((()=>{const P=[p.css.toColor("#2e3436"),p.css.toColor("#cc0000"),p.css.toColor("#4e9a06"),p.css.toColor("#c4a000"),p.css.toColor("#3465a4"),p.css.toColor("#75507b"),p.css.toColor("#06989a"),p.css.toColor("#d3d7cf"),p.css.toColor("#555753"),p.css.toColor("#ef2929"),p.css.toColor("#8ae234"),p.css.toColor("#fce94f"),p.css.toColor("#729fcf"),p.css.toColor("#ad7fa8"),p.css.toColor("#34e2e2"),p.css.toColor("#eeeeec")],x=[0,95,135,175,215,255];for(let N=0;N<216;N++){const J=x[N/36%6|0],Q=x[N/6%6|0],W=x[N%6];P.push({css:p.channels.toCss(J,Q,W),rgba:p.channels.toRgba(J,Q,W)})}for(let N=0;N<24;N++){const J=8+10*N;P.push({css:p.channels.toCss(J,J,J),rgba:p.channels.toRgba(J,J,J)})}return P})());let I=o.ThemeService=class extends k.Disposable{get colors(){return this._colors}constructor(P){super(),this._optionsService=P,this._contrastCache=new f.ColorContrastCache,this._halfContrastCache=new f.ColorContrastCache,this._onChangeColors=this.register(new S.EventEmitter),this.onChangeColors=this._onChangeColors.event,this._colors={foreground:w,background:v,cursor:g,cursorAccent:m,selectionForeground:void 0,selectionBackgroundTransparent:$,selectionBackgroundOpaque:p.color.blend(v,$),selectionInactiveBackgroundTransparent:$,selectionInactiveBackgroundOpaque:p.color.blend(v,$),ansi:o.DEFAULT_ANSI_COLORS.slice(),contrastCache:this._contrastCache,halfContrastCache:this._halfContrastCache},this._updateRestoreColors(),this._setTheme(this._optionsService.rawOptions.theme),this.register(this._optionsService.onSpecificOptionChange("minimumContrastRatio",(()=>this._contrastCache.clear()))),this.register(this._optionsService.onSpecificOptionChange("theme",(()=>this._setTheme(this._optionsService.rawOptions.theme))))}_setTheme(P={}){const x=this._colors;if(x.foreground=B(P.foreground,w),x.background=B(P.background,v),x.cursor=B(P.cursor,g),x.cursorAccent=B(P.cursorAccent,m),x.selectionBackgroundTransparent=B(P.selectionBackground,$),x.selectionBackgroundOpaque=p.color.blend(x.background,x.selectionBackgroundTransparent),x.selectionInactiveBackgroundTransparent=B(P.selectionInactiveBackground,x.selectionBackgroundTransparent),x.selectionInactiveBackgroundOpaque=p.color.blend(x.background,x.selectionInactiveBackgroundTransparent),x.selectionForeground=P.selectionForeground?B(P.selectionForeground,p.NULL_COLOR):void 0,x.selectionForeground===p.NULL_COLOR&&(x.selectionForeground=void 0),p.color.isOpaque(x.selectionBackgroundTransparent)&&(x.selectionBackgroundTransparent=p.color.opacity(x.selectionBackgroundTransparent,.3)),p.color.isOpaque(x.selectionInactiveBackgroundTransparent)&&(x.selectionInactiveBackgroundTransparent=p.color.opacity(x.selectionInactiveBackgroundTransparent,.3)),x.ansi=o.DEFAULT_ANSI_COLORS.slice(),x.ansi[0]=B(P.black,o.DEFAULT_ANSI_COLORS[0]),x.ansi[1]=B(P.red,o.DEFAULT_ANSI_COLORS[1]),x.ansi[2]=B(P.green,o.DEFAULT_ANSI_COLORS[2]),x.ansi[3]=B(P.yellow,o.DEFAULT_ANSI_COLORS[3]),x.ansi[4]=B(P.blue,o.DEFAULT_ANSI_COLORS[4]),x.ansi[5]=B(P.magenta,o.DEFAULT_ANSI_COLORS[5]),x.ansi[6]=B(P.cyan,o.DEFAULT_ANSI_COLORS[6]),x.ansi[7]=B(P.white,o.DEFAULT_ANSI_COLORS[7]),x.ansi[8]=B(P.brightBlack,o.DEFAULT_ANSI_COLORS[8]),x.ansi[9]=B(P.brightRed,o.DEFAULT_ANSI_COLORS[9]),x.ansi[10]=B(P.brightGreen,o.DEFAULT_ANSI_COLORS[10]),x.ansi[11]=B(P.brightYellow,o.DEFAULT_ANSI_COLORS[11]),x.ansi[12]=B(P.brightBlue,o.DEFAULT_ANSI_COLORS[12]),x.ansi[13]=B(P.brightMagenta,o.DEFAULT_ANSI_COLORS[13]),x.ansi[14]=B(P.brightCyan,o.DEFAULT_ANSI_COLORS[14]),x.ansi[15]=B(P.brightWhite,o.DEFAULT_ANSI_COLORS[15]),P.extendedAnsi){const N=Math.min(x.ansi.length-16,P.extendedAnsi.length);for(let J=0;J<N;J++)x.ansi[J+16]=B(P.extendedAnsi[J],o.DEFAULT_ANSI_COLORS[J+16])}this._contrastCache.clear(),this._halfContrastCache.clear(),this._updateRestoreColors(),this._onChangeColors.fire(this.colors)}restoreColor(P){this._restoreColor(P),this._onChangeColors.fire(this.colors)}_restoreColor(P){if(P!==void 0)switch(P){case 256:this._colors.foreground=this._restoreColors.foreground;break;case 257:this._colors.background=this._restoreColors.background;break;case 258:this._colors.cursor=this._restoreColors.cursor;break;default:this._colors.ansi[P]=this._restoreColors.ansi[P]}else for(let x=0;x<this._restoreColors.ansi.length;++x)this._colors.ansi[x]=this._restoreColors.ansi[x]}modifyColors(P){P(this._colors),this._onChangeColors.fire(this.colors)}_updateRestoreColors(){this._restoreColors={foreground:this._colors.foreground,background:this._colors.background,cursor:this._colors.cursor,ansi:this._colors.ansi.slice()}}};function B(P,x){if(P!==void 0)try{return p.css.toColor(P)}catch{}return x}o.ThemeService=I=d([l(0,A.IOptionsService)],I)},6349:(h,o,a)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.CircularList=void 0;const d=a(8460),l=a(844);class f extends l.Disposable{constructor(S){super(),this._maxLength=S,this.onDeleteEmitter=this.register(new d.EventEmitter),this.onDelete=this.onDeleteEmitter.event,this.onInsertEmitter=this.register(new d.EventEmitter),this.onInsert=this.onInsertEmitter.event,this.onTrimEmitter=this.register(new d.EventEmitter),this.onTrim=this.onTrimEmitter.event,this._array=new Array(this._maxLength),this._startIndex=0,this._length=0}get maxLength(){return this._maxLength}set maxLength(S){if(this._maxLength===S)return;const k=new Array(S);for(let A=0;A<Math.min(S,this.length);A++)k[A]=this._array[this._getCyclicIndex(A)];this._array=k,this._maxLength=S,this._startIndex=0}get length(){return this._length}set length(S){if(S>this._length)for(let k=this._length;k<S;k++)this._array[k]=void 0;this._length=S}get(S){return this._array[this._getCyclicIndex(S)]}set(S,k){this._array[this._getCyclicIndex(S)]=k}push(S){this._array[this._getCyclicIndex(this._length)]=S,this._length===this._maxLength?(this._startIndex=++this._startIndex%this._maxLength,this.onTrimEmitter.fire(1)):this._length++}recycle(){if(this._length!==this._maxLength)throw new Error("Can only recycle when the buffer is full");return this._startIndex=++this._startIndex%this._maxLength,this.onTrimEmitter.fire(1),this._array[this._getCyclicIndex(this._length-1)]}get isFull(){return this._length===this._maxLength}pop(){return this._array[this._getCyclicIndex(this._length---1)]}splice(S,k,...A){if(k){for(let w=S;w<this._length-k;w++)this._array[this._getCyclicIndex(w)]=this._array[this._getCyclicIndex(w+k)];this._length-=k,this.onDeleteEmitter.fire({index:S,amount:k})}for(let w=this._length-1;w>=S;w--)this._array[this._getCyclicIndex(w+A.length)]=this._array[this._getCyclicIndex(w)];for(let w=0;w<A.length;w++)this._array[this._getCyclicIndex(S+w)]=A[w];if(A.length&&this.onInsertEmitter.fire({index:S,amount:A.length}),this._length+A.length>this._maxLength){const w=this._length+A.length-this._maxLength;this._startIndex+=w,this._length=this._maxLength,this.onTrimEmitter.fire(w)}else this._length+=A.length}trimStart(S){S>this._length&&(S=this._length),this._startIndex+=S,this._length-=S,this.onTrimEmitter.fire(S)}shiftElements(S,k,A){if(!(k<=0)){if(S<0||S>=this._length)throw new Error("start argument out of range");if(S+A<0)throw new Error("Cannot shift elements in list beyond index 0");if(A>0){for(let v=k-1;v>=0;v--)this.set(S+v+A,this.get(S+v));const w=S+k+A-this._length;if(w>0)for(this._length+=w;this._length>this._maxLength;)this._length--,this._startIndex++,this.onTrimEmitter.fire(1)}else for(let w=0;w<k;w++)this.set(S+w+A,this.get(S+w))}}_getCyclicIndex(S){return(this._startIndex+S)%this._maxLength}}o.CircularList=f},1439:(h,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.clone=void 0,o.clone=function a(d,l=5){if(typeof d!="object")return d;const f=Array.isArray(d)?[]:{};for(const p in d)f[p]=l<=1?d[p]:d[p]&&a(d[p],l-1);return f}},8055:(h,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.contrastRatio=o.toPaddedHex=o.rgba=o.rgb=o.css=o.color=o.channels=o.NULL_COLOR=void 0;let a=0,d=0,l=0,f=0;var p,S,k,A,w;function v(m){const $=m.toString(16);return $.length<2?"0"+$:$}function g(m,$){return m<$?($+.05)/(m+.05):(m+.05)/($+.05)}o.NULL_COLOR={css:"#00000000",rgba:0},(function(m){m.toCss=function($,I,B,P){return P!==void 0?`#${v($)}${v(I)}${v(B)}${v(P)}`:`#${v($)}${v(I)}${v(B)}`},m.toRgba=function($,I,B,P=255){return($<<24|I<<16|B<<8|P)>>>0},m.toColor=function($,I,B,P){return{css:m.toCss($,I,B,P),rgba:m.toRgba($,I,B,P)}}})(p||(o.channels=p={})),(function(m){function $(I,B){return f=Math.round(255*B),[a,d,l]=w.toChannels(I.rgba),{css:p.toCss(a,d,l,f),rgba:p.toRgba(a,d,l,f)}}m.blend=function(I,B){if(f=(255&B.rgba)/255,f===1)return{css:B.css,rgba:B.rgba};const P=B.rgba>>24&255,x=B.rgba>>16&255,N=B.rgba>>8&255,J=I.rgba>>24&255,Q=I.rgba>>16&255,W=I.rgba>>8&255;return a=J+Math.round((P-J)*f),d=Q+Math.round((x-Q)*f),l=W+Math.round((N-W)*f),{css:p.toCss(a,d,l),rgba:p.toRgba(a,d,l)}},m.isOpaque=function(I){return(255&I.rgba)==255},m.ensureContrastRatio=function(I,B,P){const x=w.ensureContrastRatio(I.rgba,B.rgba,P);if(x)return p.toColor(x>>24&255,x>>16&255,x>>8&255)},m.opaque=function(I){const B=(255|I.rgba)>>>0;return[a,d,l]=w.toChannels(B),{css:p.toCss(a,d,l),rgba:B}},m.opacity=$,m.multiplyOpacity=function(I,B){return f=255&I.rgba,$(I,f*B/255)},m.toColorRGB=function(I){return[I.rgba>>24&255,I.rgba>>16&255,I.rgba>>8&255]}})(S||(o.color=S={})),(function(m){let $,I;try{const B=document.createElement("canvas");B.width=1,B.height=1;const P=B.getContext("2d",{willReadFrequently:!0});P&&($=P,$.globalCompositeOperation="copy",I=$.createLinearGradient(0,0,1,1))}catch{}m.toColor=function(B){if(B.match(/#[\da-f]{3,8}/i))switch(B.length){case 4:return a=parseInt(B.slice(1,2).repeat(2),16),d=parseInt(B.slice(2,3).repeat(2),16),l=parseInt(B.slice(3,4).repeat(2),16),p.toColor(a,d,l);case 5:return a=parseInt(B.slice(1,2).repeat(2),16),d=parseInt(B.slice(2,3).repeat(2),16),l=parseInt(B.slice(3,4).repeat(2),16),f=parseInt(B.slice(4,5).repeat(2),16),p.toColor(a,d,l,f);case 7:return{css:B,rgba:(parseInt(B.slice(1),16)<<8|255)>>>0};case 9:return{css:B,rgba:parseInt(B.slice(1),16)>>>0}}const P=B.match(/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(,\s*(0|1|\d?\.(\d+))\s*)?\)/);if(P)return a=parseInt(P[1]),d=parseInt(P[2]),l=parseInt(P[3]),f=Math.round(255*(P[5]===void 0?1:parseFloat(P[5]))),p.toColor(a,d,l,f);if(!$||!I)throw new Error("css.toColor: Unsupported css format");if($.fillStyle=I,$.fillStyle=B,typeof $.fillStyle!="string")throw new Error("css.toColor: Unsupported css format");if($.fillRect(0,0,1,1),[a,d,l,f]=$.getImageData(0,0,1,1).data,f!==255)throw new Error("css.toColor: Unsupported css format");return{rgba:p.toRgba(a,d,l,f),css:B}}})(k||(o.css=k={})),(function(m){function $(I,B,P){const x=I/255,N=B/255,J=P/255;return .2126*(x<=.03928?x/12.92:Math.pow((x+.055)/1.055,2.4))+.7152*(N<=.03928?N/12.92:Math.pow((N+.055)/1.055,2.4))+.0722*(J<=.03928?J/12.92:Math.pow((J+.055)/1.055,2.4))}m.relativeLuminance=function(I){return $(I>>16&255,I>>8&255,255&I)},m.relativeLuminance2=$})(A||(o.rgb=A={})),(function(m){function $(B,P,x){const N=B>>24&255,J=B>>16&255,Q=B>>8&255;let W=P>>24&255,Y=P>>16&255,ve=P>>8&255,Be=g(A.relativeLuminance2(W,Y,ve),A.relativeLuminance2(N,J,Q));for(;Be<x&&(W>0||Y>0||ve>0);)W-=Math.max(0,Math.ceil(.1*W)),Y-=Math.max(0,Math.ceil(.1*Y)),ve-=Math.max(0,Math.ceil(.1*ve)),Be=g(A.relativeLuminance2(W,Y,ve),A.relativeLuminance2(N,J,Q));return(W<<24|Y<<16|ve<<8|255)>>>0}function I(B,P,x){const N=B>>24&255,J=B>>16&255,Q=B>>8&255;let W=P>>24&255,Y=P>>16&255,ve=P>>8&255,Be=g(A.relativeLuminance2(W,Y,ve),A.relativeLuminance2(N,J,Q));for(;Be<x&&(W<255||Y<255||ve<255);)W=Math.min(255,W+Math.ceil(.1*(255-W))),Y=Math.min(255,Y+Math.ceil(.1*(255-Y))),ve=Math.min(255,ve+Math.ceil(.1*(255-ve))),Be=g(A.relativeLuminance2(W,Y,ve),A.relativeLuminance2(N,J,Q));return(W<<24|Y<<16|ve<<8|255)>>>0}m.blend=function(B,P){if(f=(255&P)/255,f===1)return P;const x=P>>24&255,N=P>>16&255,J=P>>8&255,Q=B>>24&255,W=B>>16&255,Y=B>>8&255;return a=Q+Math.round((x-Q)*f),d=W+Math.round((N-W)*f),l=Y+Math.round((J-Y)*f),p.toRgba(a,d,l)},m.ensureContrastRatio=function(B,P,x){const N=A.relativeLuminance(B>>8),J=A.relativeLuminance(P>>8);if(g(N,J)<x){if(J<N){const Y=$(B,P,x),ve=g(N,A.relativeLuminance(Y>>8));if(ve<x){const Be=I(B,P,x);return ve>g(N,A.relativeLuminance(Be>>8))?Y:Be}return Y}const Q=I(B,P,x),W=g(N,A.relativeLuminance(Q>>8));if(W<x){const Y=$(B,P,x);return W>g(N,A.relativeLuminance(Y>>8))?Q:Y}return Q}},m.reduceLuminance=$,m.increaseLuminance=I,m.toChannels=function(B){return[B>>24&255,B>>16&255,B>>8&255,255&B]}})(w||(o.rgba=w={})),o.toPaddedHex=v,o.contrastRatio=g},8969:(h,o,a)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.CoreTerminal=void 0;const d=a(844),l=a(2585),f=a(4348),p=a(7866),S=a(744),k=a(7302),A=a(6975),w=a(8460),v=a(1753),g=a(1480),m=a(7994),$=a(9282),I=a(5435),B=a(5981),P=a(2660);let x=!1;class N extends d.Disposable{get onScroll(){return this._onScrollApi||(this._onScrollApi=this.register(new w.EventEmitter),this._onScroll.event((Q=>{this._onScrollApi?.fire(Q.position)}))),this._onScrollApi.event}get cols(){return this._bufferService.cols}get rows(){return this._bufferService.rows}get buffers(){return this._bufferService.buffers}get options(){return this.optionsService.options}set options(Q){for(const W in Q)this.optionsService.options[W]=Q[W]}constructor(Q){super(),this._windowsWrappingHeuristics=this.register(new d.MutableDisposable),this._onBinary=this.register(new w.EventEmitter),this.onBinary=this._onBinary.event,this._onData=this.register(new w.EventEmitter),this.onData=this._onData.event,this._onLineFeed=this.register(new w.EventEmitter),this.onLineFeed=this._onLineFeed.event,this._onResize=this.register(new w.EventEmitter),this.onResize=this._onResize.event,this._onWriteParsed=this.register(new w.EventEmitter),this.onWriteParsed=this._onWriteParsed.event,this._onScroll=this.register(new w.EventEmitter),this._instantiationService=new f.InstantiationService,this.optionsService=this.register(new k.OptionsService(Q)),this._instantiationService.setService(l.IOptionsService,this.optionsService),this._bufferService=this.register(this._instantiationService.createInstance(S.BufferService)),this._instantiationService.setService(l.IBufferService,this._bufferService),this._logService=this.register(this._instantiationService.createInstance(p.LogService)),this._instantiationService.setService(l.ILogService,this._logService),this.coreService=this.register(this._instantiationService.createInstance(A.CoreService)),this._instantiationService.setService(l.ICoreService,this.coreService),this.coreMouseService=this.register(this._instantiationService.createInstance(v.CoreMouseService)),this._instantiationService.setService(l.ICoreMouseService,this.coreMouseService),this.unicodeService=this.register(this._instantiationService.createInstance(g.UnicodeService)),this._instantiationService.setService(l.IUnicodeService,this.unicodeService),this._charsetService=this._instantiationService.createInstance(m.CharsetService),this._instantiationService.setService(l.ICharsetService,this._charsetService),this._oscLinkService=this._instantiationService.createInstance(P.OscLinkService),this._instantiationService.setService(l.IOscLinkService,this._oscLinkService),this._inputHandler=this.register(new I.InputHandler(this._bufferService,this._charsetService,this.coreService,this._logService,this.optionsService,this._oscLinkService,this.coreMouseService,this.unicodeService)),this.register((0,w.forwardEvent)(this._inputHandler.onLineFeed,this._onLineFeed)),this.register(this._inputHandler),this.register((0,w.forwardEvent)(this._bufferService.onResize,this._onResize)),this.register((0,w.forwardEvent)(this.coreService.onData,this._onData)),this.register((0,w.forwardEvent)(this.coreService.onBinary,this._onBinary)),this.register(this.coreService.onRequestScrollToBottom((()=>this.scrollToBottom()))),this.register(this.coreService.onUserInput((()=>this._writeBuffer.handleUserInput()))),this.register(this.optionsService.onMultipleOptionChange(["windowsMode","windowsPty"],(()=>this._handleWindowsPtyOptionChange()))),this.register(this._bufferService.onScroll((W=>{this._onScroll.fire({position:this._bufferService.buffer.ydisp,source:0}),this._inputHandler.markRangeDirty(this._bufferService.buffer.scrollTop,this._bufferService.buffer.scrollBottom)}))),this.register(this._inputHandler.onScroll((W=>{this._onScroll.fire({position:this._bufferService.buffer.ydisp,source:0}),this._inputHandler.markRangeDirty(this._bufferService.buffer.scrollTop,this._bufferService.buffer.scrollBottom)}))),this._writeBuffer=this.register(new B.WriteBuffer(((W,Y)=>this._inputHandler.parse(W,Y)))),this.register((0,w.forwardEvent)(this._writeBuffer.onWriteParsed,this._onWriteParsed))}write(Q,W){this._writeBuffer.write(Q,W)}writeSync(Q,W){this._logService.logLevel<=l.LogLevelEnum.WARN&&!x&&(this._logService.warn("writeSync is unreliable and will be removed soon."),x=!0),this._writeBuffer.writeSync(Q,W)}input(Q,W=!0){this.coreService.triggerDataEvent(Q,W)}resize(Q,W){isNaN(Q)||isNaN(W)||(Q=Math.max(Q,S.MINIMUM_COLS),W=Math.max(W,S.MINIMUM_ROWS),this._bufferService.resize(Q,W))}scroll(Q,W=!1){this._bufferService.scroll(Q,W)}scrollLines(Q,W,Y){this._bufferService.scrollLines(Q,W,Y)}scrollPages(Q){this.scrollLines(Q*(this.rows-1))}scrollToTop(){this.scrollLines(-this._bufferService.buffer.ydisp)}scrollToBottom(){this.scrollLines(this._bufferService.buffer.ybase-this._bufferService.buffer.ydisp)}scrollToLine(Q){const W=Q-this._bufferService.buffer.ydisp;W!==0&&this.scrollLines(W)}registerEscHandler(Q,W){return this._inputHandler.registerEscHandler(Q,W)}registerDcsHandler(Q,W){return this._inputHandler.registerDcsHandler(Q,W)}registerCsiHandler(Q,W){return this._inputHandler.registerCsiHandler(Q,W)}registerOscHandler(Q,W){return this._inputHandler.registerOscHandler(Q,W)}_setup(){this._handleWindowsPtyOptionChange()}reset(){this._inputHandler.reset(),this._bufferService.reset(),this._charsetService.reset(),this.coreService.reset(),this.coreMouseService.reset()}_handleWindowsPtyOptionChange(){let Q=!1;const W=this.optionsService.rawOptions.windowsPty;W&&W.buildNumber!==void 0&&W.buildNumber!==void 0?Q=W.backend==="conpty"&&W.buildNumber<21376:this.optionsService.rawOptions.windowsMode&&(Q=!0),Q?this._enableWindowsWrappingHeuristics():this._windowsWrappingHeuristics.clear()}_enableWindowsWrappingHeuristics(){if(!this._windowsWrappingHeuristics.value){const Q=[];Q.push(this.onLineFeed($.updateWindowsModeWrappedState.bind(null,this._bufferService))),Q.push(this.registerCsiHandler({final:"H"},(()=>((0,$.updateWindowsModeWrappedState)(this._bufferService),!1)))),this._windowsWrappingHeuristics.value=(0,d.toDisposable)((()=>{for(const W of Q)W.dispose()}))}}}o.CoreTerminal=N},8460:(h,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.runAndSubscribe=o.forwardEvent=o.EventEmitter=void 0,o.EventEmitter=class{constructor(){this._listeners=[],this._disposed=!1}get event(){return this._event||(this._event=a=>(this._listeners.push(a),{dispose:()=>{if(!this._disposed){for(let d=0;d<this._listeners.length;d++)if(this._listeners[d]===a)return void this._listeners.splice(d,1)}}})),this._event}fire(a,d){const l=[];for(let f=0;f<this._listeners.length;f++)l.push(this._listeners[f]);for(let f=0;f<l.length;f++)l[f].call(void 0,a,d)}dispose(){this.clearListeners(),this._disposed=!0}clearListeners(){this._listeners&&(this._listeners.length=0)}},o.forwardEvent=function(a,d){return a((l=>d.fire(l)))},o.runAndSubscribe=function(a,d){return d(void 0),a((l=>d(l)))}},5435:function(h,o,a){var d=this&&this.__decorate||function(ke,q,j,H){var G,V=arguments.length,oe=V<3?q:H===null?H=Object.getOwnPropertyDescriptor(q,j):H;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")oe=Reflect.decorate(ke,q,j,H);else for(var Z=ke.length-1;Z>=0;Z--)(G=ke[Z])&&(oe=(V<3?G(oe):V>3?G(q,j,oe):G(q,j))||oe);return V>3&&oe&&Object.defineProperty(q,j,oe),oe},l=this&&this.__param||function(ke,q){return function(j,H){q(j,H,ke)}};Object.defineProperty(o,"__esModule",{value:!0}),o.InputHandler=o.WindowsOptionsReportType=void 0;const f=a(2584),p=a(7116),S=a(2015),k=a(844),A=a(482),w=a(8437),v=a(8460),g=a(643),m=a(511),$=a(3734),I=a(2585),B=a(1480),P=a(6242),x=a(6351),N=a(5941),J={"(":0,")":1,"*":2,"+":3,"-":1,".":2},Q=131072;function W(ke,q){if(ke>24)return q.setWinLines||!1;switch(ke){case 1:return!!q.restoreWin;case 2:return!!q.minimizeWin;case 3:return!!q.setWinPosition;case 4:return!!q.setWinSizePixels;case 5:return!!q.raiseWin;case 6:return!!q.lowerWin;case 7:return!!q.refreshWin;case 8:return!!q.setWinSizeChars;case 9:return!!q.maximizeWin;case 10:return!!q.fullscreenWin;case 11:return!!q.getWinState;case 13:return!!q.getWinPosition;case 14:return!!q.getWinSizePixels;case 15:return!!q.getScreenSizePixels;case 16:return!!q.getCellSizePixels;case 18:return!!q.getWinSizeChars;case 19:return!!q.getScreenSizeChars;case 20:return!!q.getIconTitle;case 21:return!!q.getWinTitle;case 22:return!!q.pushTitle;case 23:return!!q.popTitle;case 24:return!!q.setWinLines}return!1}var Y;(function(ke){ke[ke.GET_WIN_SIZE_PIXELS=0]="GET_WIN_SIZE_PIXELS",ke[ke.GET_CELL_SIZE_PIXELS=1]="GET_CELL_SIZE_PIXELS"})(Y||(o.WindowsOptionsReportType=Y={}));let ve=0;class Be extends k.Disposable{getAttrData(){return this._curAttrData}constructor(q,j,H,G,V,oe,Z,pe,ce=new S.EscapeSequenceParser){super(),this._bufferService=q,this._charsetService=j,this._coreService=H,this._logService=G,this._optionsService=V,this._oscLinkService=oe,this._coreMouseService=Z,this._unicodeService=pe,this._parser=ce,this._parseBuffer=new Uint32Array(4096),this._stringDecoder=new A.StringToUtf32,this._utf8Decoder=new A.Utf8ToUtf32,this._workCell=new m.CellData,this._windowTitle="",this._iconName="",this._windowTitleStack=[],this._iconNameStack=[],this._curAttrData=w.DEFAULT_ATTR_DATA.clone(),this._eraseAttrDataInternal=w.DEFAULT_ATTR_DATA.clone(),this._onRequestBell=this.register(new v.EventEmitter),this.onRequestBell=this._onRequestBell.event,this._onRequestRefreshRows=this.register(new v.EventEmitter),this.onRequestRefreshRows=this._onRequestRefreshRows.event,this._onRequestReset=this.register(new v.EventEmitter),this.onRequestReset=this._onRequestReset.event,this._onRequestSendFocus=this.register(new v.EventEmitter),this.onRequestSendFocus=this._onRequestSendFocus.event,this._onRequestSyncScrollBar=this.register(new v.EventEmitter),this.onRequestSyncScrollBar=this._onRequestSyncScrollBar.event,this._onRequestWindowsOptionsReport=this.register(new v.EventEmitter),this.onRequestWindowsOptionsReport=this._onRequestWindowsOptionsReport.event,this._onA11yChar=this.register(new v.EventEmitter),this.onA11yChar=this._onA11yChar.event,this._onA11yTab=this.register(new v.EventEmitter),this.onA11yTab=this._onA11yTab.event,this._onCursorMove=this.register(new v.EventEmitter),this.onCursorMove=this._onCursorMove.event,this._onLineFeed=this.register(new v.EventEmitter),this.onLineFeed=this._onLineFeed.event,this._onScroll=this.register(new v.EventEmitter),this.onScroll=this._onScroll.event,this._onTitleChange=this.register(new v.EventEmitter),this.onTitleChange=this._onTitleChange.event,this._onColor=this.register(new v.EventEmitter),this.onColor=this._onColor.event,this._parseStack={paused:!1,cursorStartX:0,cursorStartY:0,decodedLength:0,position:0},this._specialColors=[256,257,258],this.register(this._parser),this._dirtyRowTracker=new je(this._bufferService),this._activeBuffer=this._bufferService.buffer,this.register(this._bufferService.buffers.onBufferActivate((U=>this._activeBuffer=U.activeBuffer))),this._parser.setCsiHandlerFallback(((U,ye)=>{this._logService.debug("Unknown CSI code: ",{identifier:this._parser.identToString(U),params:ye.toArray()})})),this._parser.setEscHandlerFallback((U=>{this._logService.debug("Unknown ESC code: ",{identifier:this._parser.identToString(U)})})),this._parser.setExecuteHandlerFallback((U=>{this._logService.debug("Unknown EXECUTE code: ",{code:U})})),this._parser.setOscHandlerFallback(((U,ye,be)=>{this._logService.debug("Unknown OSC code: ",{identifier:U,action:ye,data:be})})),this._parser.setDcsHandlerFallback(((U,ye,be)=>{ye==="HOOK"&&(be=be.toArray()),this._logService.debug("Unknown DCS code: ",{identifier:this._parser.identToString(U),action:ye,payload:be})})),this._parser.setPrintHandler(((U,ye,be)=>this.print(U,ye,be))),this._parser.registerCsiHandler({final:"@"},(U=>this.insertChars(U))),this._parser.registerCsiHandler({intermediates:" ",final:"@"},(U=>this.scrollLeft(U))),this._parser.registerCsiHandler({final:"A"},(U=>this.cursorUp(U))),this._parser.registerCsiHandler({intermediates:" ",final:"A"},(U=>this.scrollRight(U))),this._parser.registerCsiHandler({final:"B"},(U=>this.cursorDown(U))),this._parser.registerCsiHandler({final:"C"},(U=>this.cursorForward(U))),this._parser.registerCsiHandler({final:"D"},(U=>this.cursorBackward(U))),this._parser.registerCsiHandler({final:"E"},(U=>this.cursorNextLine(U))),this._parser.registerCsiHandler({final:"F"},(U=>this.cursorPrecedingLine(U))),this._parser.registerCsiHandler({final:"G"},(U=>this.cursorCharAbsolute(U))),this._parser.registerCsiHandler({final:"H"},(U=>this.cursorPosition(U))),this._parser.registerCsiHandler({final:"I"},(U=>this.cursorForwardTab(U))),this._parser.registerCsiHandler({final:"J"},(U=>this.eraseInDisplay(U,!1))),this._parser.registerCsiHandler({prefix:"?",final:"J"},(U=>this.eraseInDisplay(U,!0))),this._parser.registerCsiHandler({final:"K"},(U=>this.eraseInLine(U,!1))),this._parser.registerCsiHandler({prefix:"?",final:"K"},(U=>this.eraseInLine(U,!0))),this._parser.registerCsiHandler({final:"L"},(U=>this.insertLines(U))),this._parser.registerCsiHandler({final:"M"},(U=>this.deleteLines(U))),this._parser.registerCsiHandler({final:"P"},(U=>this.deleteChars(U))),this._parser.registerCsiHandler({final:"S"},(U=>this.scrollUp(U))),this._parser.registerCsiHandler({final:"T"},(U=>this.scrollDown(U))),this._parser.registerCsiHandler({final:"X"},(U=>this.eraseChars(U))),this._parser.registerCsiHandler({final:"Z"},(U=>this.cursorBackwardTab(U))),this._parser.registerCsiHandler({final:"`"},(U=>this.charPosAbsolute(U))),this._parser.registerCsiHandler({final:"a"},(U=>this.hPositionRelative(U))),this._parser.registerCsiHandler({final:"b"},(U=>this.repeatPrecedingCharacter(U))),this._parser.registerCsiHandler({final:"c"},(U=>this.sendDeviceAttributesPrimary(U))),this._parser.registerCsiHandler({prefix:">",final:"c"},(U=>this.sendDeviceAttributesSecondary(U))),this._parser.registerCsiHandler({final:"d"},(U=>this.linePosAbsolute(U))),this._parser.registerCsiHandler({final:"e"},(U=>this.vPositionRelative(U))),this._parser.registerCsiHandler({final:"f"},(U=>this.hVPosition(U))),this._parser.registerCsiHandler({final:"g"},(U=>this.tabClear(U))),this._parser.registerCsiHandler({final:"h"},(U=>this.setMode(U))),this._parser.registerCsiHandler({prefix:"?",final:"h"},(U=>this.setModePrivate(U))),this._parser.registerCsiHandler({final:"l"},(U=>this.resetMode(U))),this._parser.registerCsiHandler({prefix:"?",final:"l"},(U=>this.resetModePrivate(U))),this._parser.registerCsiHandler({final:"m"},(U=>this.charAttributes(U))),this._parser.registerCsiHandler({final:"n"},(U=>this.deviceStatus(U))),this._parser.registerCsiHandler({prefix:"?",final:"n"},(U=>this.deviceStatusPrivate(U))),this._parser.registerCsiHandler({intermediates:"!",final:"p"},(U=>this.softReset(U))),this._parser.registerCsiHandler({intermediates:" ",final:"q"},(U=>this.setCursorStyle(U))),this._parser.registerCsiHandler({final:"r"},(U=>this.setScrollRegion(U))),this._parser.registerCsiHandler({final:"s"},(U=>this.saveCursor(U))),this._parser.registerCsiHandler({final:"t"},(U=>this.windowOptions(U))),this._parser.registerCsiHandler({final:"u"},(U=>this.restoreCursor(U))),this._parser.registerCsiHandler({intermediates:"'",final:"}"},(U=>this.insertColumns(U))),this._parser.registerCsiHandler({intermediates:"'",final:"~"},(U=>this.deleteColumns(U))),this._parser.registerCsiHandler({intermediates:'"',final:"q"},(U=>this.selectProtected(U))),this._parser.registerCsiHandler({intermediates:"$",final:"p"},(U=>this.requestMode(U,!0))),this._parser.registerCsiHandler({prefix:"?",intermediates:"$",final:"p"},(U=>this.requestMode(U,!1))),this._parser.setExecuteHandler(f.C0.BEL,(()=>this.bell())),this._parser.setExecuteHandler(f.C0.LF,(()=>this.lineFeed())),this._parser.setExecuteHandler(f.C0.VT,(()=>this.lineFeed())),this._parser.setExecuteHandler(f.C0.FF,(()=>this.lineFeed())),this._parser.setExecuteHandler(f.C0.CR,(()=>this.carriageReturn())),this._parser.setExecuteHandler(f.C0.BS,(()=>this.backspace())),this._parser.setExecuteHandler(f.C0.HT,(()=>this.tab())),this._parser.setExecuteHandler(f.C0.SO,(()=>this.shiftOut())),this._parser.setExecuteHandler(f.C0.SI,(()=>this.shiftIn())),this._parser.setExecuteHandler(f.C1.IND,(()=>this.index())),this._parser.setExecuteHandler(f.C1.NEL,(()=>this.nextLine())),this._parser.setExecuteHandler(f.C1.HTS,(()=>this.tabSet())),this._parser.registerOscHandler(0,new P.OscHandler((U=>(this.setTitle(U),this.setIconName(U),!0)))),this._parser.registerOscHandler(1,new P.OscHandler((U=>this.setIconName(U)))),this._parser.registerOscHandler(2,new P.OscHandler((U=>this.setTitle(U)))),this._parser.registerOscHandler(4,new P.OscHandler((U=>this.setOrReportIndexedColor(U)))),this._parser.registerOscHandler(8,new P.OscHandler((U=>this.setHyperlink(U)))),this._parser.registerOscHandler(10,new P.OscHandler((U=>this.setOrReportFgColor(U)))),this._parser.registerOscHandler(11,new P.OscHandler((U=>this.setOrReportBgColor(U)))),this._parser.registerOscHandler(12,new P.OscHandler((U=>this.setOrReportCursorColor(U)))),this._parser.registerOscHandler(104,new P.OscHandler((U=>this.restoreIndexedColor(U)))),this._parser.registerOscHandler(110,new P.OscHandler((U=>this.restoreFgColor(U)))),this._parser.registerOscHandler(111,new P.OscHandler((U=>this.restoreBgColor(U)))),this._parser.registerOscHandler(112,new P.OscHandler((U=>this.restoreCursorColor(U)))),this._parser.registerEscHandler({final:"7"},(()=>this.saveCursor())),this._parser.registerEscHandler({final:"8"},(()=>this.restoreCursor())),this._parser.registerEscHandler({final:"D"},(()=>this.index())),this._parser.registerEscHandler({final:"E"},(()=>this.nextLine())),this._parser.registerEscHandler({final:"H"},(()=>this.tabSet())),this._parser.registerEscHandler({final:"M"},(()=>this.reverseIndex())),this._parser.registerEscHandler({final:"="},(()=>this.keypadApplicationMode())),this._parser.registerEscHandler({final:">"},(()=>this.keypadNumericMode())),this._parser.registerEscHandler({final:"c"},(()=>this.fullReset())),this._parser.registerEscHandler({final:"n"},(()=>this.setgLevel(2))),this._parser.registerEscHandler({final:"o"},(()=>this.setgLevel(3))),this._parser.registerEscHandler({final:"|"},(()=>this.setgLevel(3))),this._parser.registerEscHandler({final:"}"},(()=>this.setgLevel(2))),this._parser.registerEscHandler({final:"~"},(()=>this.setgLevel(1))),this._parser.registerEscHandler({intermediates:"%",final:"@"},(()=>this.selectDefaultCharset())),this._parser.registerEscHandler({intermediates:"%",final:"G"},(()=>this.selectDefaultCharset()));for(const U in p.CHARSETS)this._parser.registerEscHandler({intermediates:"(",final:U},(()=>this.selectCharset("("+U))),this._parser.registerEscHandler({intermediates:")",final:U},(()=>this.selectCharset(")"+U))),this._parser.registerEscHandler({intermediates:"*",final:U},(()=>this.selectCharset("*"+U))),this._parser.registerEscHandler({intermediates:"+",final:U},(()=>this.selectCharset("+"+U))),this._parser.registerEscHandler({intermediates:"-",final:U},(()=>this.selectCharset("-"+U))),this._parser.registerEscHandler({intermediates:".",final:U},(()=>this.selectCharset("."+U))),this._parser.registerEscHandler({intermediates:"/",final:U},(()=>this.selectCharset("/"+U)));this._parser.registerEscHandler({intermediates:"#",final:"8"},(()=>this.screenAlignmentPattern())),this._parser.setErrorHandler((U=>(this._logService.error("Parsing error: ",U),U))),this._parser.registerDcsHandler({intermediates:"$",final:"q"},new x.DcsHandler(((U,ye)=>this.requestStatusString(U,ye))))}_preserveStack(q,j,H,G){this._parseStack.paused=!0,this._parseStack.cursorStartX=q,this._parseStack.cursorStartY=j,this._parseStack.decodedLength=H,this._parseStack.position=G}_logSlowResolvingAsync(q){this._logService.logLevel<=I.LogLevelEnum.WARN&&Promise.race([q,new Promise(((j,H)=>setTimeout((()=>H("#SLOW_TIMEOUT")),5e3)))]).catch((j=>{if(j!=="#SLOW_TIMEOUT")throw j;console.warn("async parser handler taking longer than 5000 ms")}))}_getCurrentLinkId(){return this._curAttrData.extended.urlId}parse(q,j){let H,G=this._activeBuffer.x,V=this._activeBuffer.y,oe=0;const Z=this._parseStack.paused;if(Z){if(H=this._parser.parse(this._parseBuffer,this._parseStack.decodedLength,j))return this._logSlowResolvingAsync(H),H;G=this._parseStack.cursorStartX,V=this._parseStack.cursorStartY,this._parseStack.paused=!1,q.length>Q&&(oe=this._parseStack.position+Q)}if(this._logService.logLevel<=I.LogLevelEnum.DEBUG&&this._logService.debug("parsing data"+(typeof q=="string"?` "${q}"`:` "${Array.prototype.map.call(q,(U=>String.fromCharCode(U))).join("")}"`),typeof q=="string"?q.split("").map((U=>U.charCodeAt(0))):q),this._parseBuffer.length<q.length&&this._parseBuffer.length<Q&&(this._parseBuffer=new Uint32Array(Math.min(q.length,Q))),Z||this._dirtyRowTracker.clearRange(),q.length>Q)for(let U=oe;U<q.length;U+=Q){const ye=U+Q<q.length?U+Q:q.length,be=typeof q=="string"?this._stringDecoder.decode(q.substring(U,ye),this._parseBuffer):this._utf8Decoder.decode(q.subarray(U,ye),this._parseBuffer);if(H=this._parser.parse(this._parseBuffer,be))return this._preserveStack(G,V,be,U),this._logSlowResolvingAsync(H),H}else if(!Z){const U=typeof q=="string"?this._stringDecoder.decode(q,this._parseBuffer):this._utf8Decoder.decode(q,this._parseBuffer);if(H=this._parser.parse(this._parseBuffer,U))return this._preserveStack(G,V,U,0),this._logSlowResolvingAsync(H),H}this._activeBuffer.x===G&&this._activeBuffer.y===V||this._onCursorMove.fire();const pe=this._dirtyRowTracker.end+(this._bufferService.buffer.ybase-this._bufferService.buffer.ydisp),ce=this._dirtyRowTracker.start+(this._bufferService.buffer.ybase-this._bufferService.buffer.ydisp);ce<this._bufferService.rows&&this._onRequestRefreshRows.fire(Math.min(ce,this._bufferService.rows-1),Math.min(pe,this._bufferService.rows-1))}print(q,j,H){let G,V;const oe=this._charsetService.charset,Z=this._optionsService.rawOptions.screenReaderMode,pe=this._bufferService.cols,ce=this._coreService.decPrivateModes.wraparound,U=this._coreService.modes.insertMode,ye=this._curAttrData;let be=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._activeBuffer.x&&H-j>0&&be.getWidth(this._activeBuffer.x-1)===2&&be.setCellFromCodepoint(this._activeBuffer.x-1,0,1,ye);let Pe=this._parser.precedingJoinState;for(let Oe=j;Oe<H;++Oe){if(G=q[Oe],G<127&&oe){const dt=oe[String.fromCharCode(G)];dt&&(G=dt.charCodeAt(0))}const Ue=this._unicodeService.charProperties(G,Pe);V=B.UnicodeService.extractWidth(Ue);const rt=B.UnicodeService.extractShouldJoin(Ue),yt=rt?B.UnicodeService.extractWidth(Pe):0;if(Pe=Ue,Z&&this._onA11yChar.fire((0,A.stringFromCodePoint)(G)),this._getCurrentLinkId()&&this._oscLinkService.addLineToLink(this._getCurrentLinkId(),this._activeBuffer.ybase+this._activeBuffer.y),this._activeBuffer.x+V-yt>pe){if(ce){const dt=be;let fe=this._activeBuffer.x-yt;for(this._activeBuffer.x=yt,this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData(),!0)):(this._activeBuffer.y>=this._bufferService.rows&&(this._activeBuffer.y=this._bufferService.rows-1),this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).isWrapped=!0),be=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y),yt>0&&be instanceof w.BufferLine&&be.copyCellsFrom(dt,fe,0,yt,!1);fe<pe;)dt.setCellFromCodepoint(fe++,0,1,ye)}else if(this._activeBuffer.x=pe-1,V===2)continue}if(rt&&this._activeBuffer.x){const dt=be.getWidth(this._activeBuffer.x-1)?1:2;be.addCodepointToCell(this._activeBuffer.x-dt,G,V);for(let fe=V-yt;--fe>=0;)be.setCellFromCodepoint(this._activeBuffer.x++,0,0,ye)}else if(U&&(be.insertCells(this._activeBuffer.x,V-yt,this._activeBuffer.getNullCell(ye)),be.getWidth(pe-1)===2&&be.setCellFromCodepoint(pe-1,g.NULL_CELL_CODE,g.NULL_CELL_WIDTH,ye)),be.setCellFromCodepoint(this._activeBuffer.x++,G,V,ye),V>0)for(;--V;)be.setCellFromCodepoint(this._activeBuffer.x++,0,0,ye)}this._parser.precedingJoinState=Pe,this._activeBuffer.x<pe&&H-j>0&&be.getWidth(this._activeBuffer.x)===0&&!be.hasContent(this._activeBuffer.x)&&be.setCellFromCodepoint(this._activeBuffer.x,0,1,ye),this._dirtyRowTracker.markDirty(this._activeBuffer.y)}registerCsiHandler(q,j){return q.final!=="t"||q.prefix||q.intermediates?this._parser.registerCsiHandler(q,j):this._parser.registerCsiHandler(q,(H=>!W(H.params[0],this._optionsService.rawOptions.windowOptions)||j(H)))}registerDcsHandler(q,j){return this._parser.registerDcsHandler(q,new x.DcsHandler(j))}registerEscHandler(q,j){return this._parser.registerEscHandler(q,j)}registerOscHandler(q,j){return this._parser.registerOscHandler(q,new P.OscHandler(j))}bell(){return this._onRequestBell.fire(),!0}lineFeed(){return this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._optionsService.rawOptions.convertEol&&(this._activeBuffer.x=0),this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData())):this._activeBuffer.y>=this._bufferService.rows?this._activeBuffer.y=this._bufferService.rows-1:this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).isWrapped=!1,this._activeBuffer.x>=this._bufferService.cols&&this._activeBuffer.x--,this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._onLineFeed.fire(),!0}carriageReturn(){return this._activeBuffer.x=0,!0}backspace(){if(!this._coreService.decPrivateModes.reverseWraparound)return this._restrictCursor(),this._activeBuffer.x>0&&this._activeBuffer.x--,!0;if(this._restrictCursor(this._bufferService.cols),this._activeBuffer.x>0)this._activeBuffer.x--;else if(this._activeBuffer.x===0&&this._activeBuffer.y>this._activeBuffer.scrollTop&&this._activeBuffer.y<=this._activeBuffer.scrollBottom&&this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y)?.isWrapped){this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).isWrapped=!1,this._activeBuffer.y--,this._activeBuffer.x=this._bufferService.cols-1;const q=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);q.hasWidth(this._activeBuffer.x)&&!q.hasContent(this._activeBuffer.x)&&this._activeBuffer.x--}return this._restrictCursor(),!0}tab(){if(this._activeBuffer.x>=this._bufferService.cols)return!0;const q=this._activeBuffer.x;return this._activeBuffer.x=this._activeBuffer.nextStop(),this._optionsService.rawOptions.screenReaderMode&&this._onA11yTab.fire(this._activeBuffer.x-q),!0}shiftOut(){return this._charsetService.setgLevel(1),!0}shiftIn(){return this._charsetService.setgLevel(0),!0}_restrictCursor(q=this._bufferService.cols-1){this._activeBuffer.x=Math.min(q,Math.max(0,this._activeBuffer.x)),this._activeBuffer.y=this._coreService.decPrivateModes.origin?Math.min(this._activeBuffer.scrollBottom,Math.max(this._activeBuffer.scrollTop,this._activeBuffer.y)):Math.min(this._bufferService.rows-1,Math.max(0,this._activeBuffer.y)),this._dirtyRowTracker.markDirty(this._activeBuffer.y)}_setCursor(q,j){this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._coreService.decPrivateModes.origin?(this._activeBuffer.x=q,this._activeBuffer.y=this._activeBuffer.scrollTop+j):(this._activeBuffer.x=q,this._activeBuffer.y=j),this._restrictCursor(),this._dirtyRowTracker.markDirty(this._activeBuffer.y)}_moveCursor(q,j){this._restrictCursor(),this._setCursor(this._activeBuffer.x+q,this._activeBuffer.y+j)}cursorUp(q){const j=this._activeBuffer.y-this._activeBuffer.scrollTop;return j>=0?this._moveCursor(0,-Math.min(j,q.params[0]||1)):this._moveCursor(0,-(q.params[0]||1)),!0}cursorDown(q){const j=this._activeBuffer.scrollBottom-this._activeBuffer.y;return j>=0?this._moveCursor(0,Math.min(j,q.params[0]||1)):this._moveCursor(0,q.params[0]||1),!0}cursorForward(q){return this._moveCursor(q.params[0]||1,0),!0}cursorBackward(q){return this._moveCursor(-(q.params[0]||1),0),!0}cursorNextLine(q){return this.cursorDown(q),this._activeBuffer.x=0,!0}cursorPrecedingLine(q){return this.cursorUp(q),this._activeBuffer.x=0,!0}cursorCharAbsolute(q){return this._setCursor((q.params[0]||1)-1,this._activeBuffer.y),!0}cursorPosition(q){return this._setCursor(q.length>=2?(q.params[1]||1)-1:0,(q.params[0]||1)-1),!0}charPosAbsolute(q){return this._setCursor((q.params[0]||1)-1,this._activeBuffer.y),!0}hPositionRelative(q){return this._moveCursor(q.params[0]||1,0),!0}linePosAbsolute(q){return this._setCursor(this._activeBuffer.x,(q.params[0]||1)-1),!0}vPositionRelative(q){return this._moveCursor(0,q.params[0]||1),!0}hVPosition(q){return this.cursorPosition(q),!0}tabClear(q){const j=q.params[0];return j===0?delete this._activeBuffer.tabs[this._activeBuffer.x]:j===3&&(this._activeBuffer.tabs={}),!0}cursorForwardTab(q){if(this._activeBuffer.x>=this._bufferService.cols)return!0;let j=q.params[0]||1;for(;j--;)this._activeBuffer.x=this._activeBuffer.nextStop();return!0}cursorBackwardTab(q){if(this._activeBuffer.x>=this._bufferService.cols)return!0;let j=q.params[0]||1;for(;j--;)this._activeBuffer.x=this._activeBuffer.prevStop();return!0}selectProtected(q){const j=q.params[0];return j===1&&(this._curAttrData.bg|=536870912),j!==2&&j!==0||(this._curAttrData.bg&=-536870913),!0}_eraseInBufferLine(q,j,H,G=!1,V=!1){const oe=this._activeBuffer.lines.get(this._activeBuffer.ybase+q);oe.replaceCells(j,H,this._activeBuffer.getNullCell(this._eraseAttrData()),V),G&&(oe.isWrapped=!1)}_resetBufferLine(q,j=!1){const H=this._activeBuffer.lines.get(this._activeBuffer.ybase+q);H&&(H.fill(this._activeBuffer.getNullCell(this._eraseAttrData()),j),this._bufferService.buffer.clearMarkers(this._activeBuffer.ybase+q),H.isWrapped=!1)}eraseInDisplay(q,j=!1){let H;switch(this._restrictCursor(this._bufferService.cols),q.params[0]){case 0:for(H=this._activeBuffer.y,this._dirtyRowTracker.markDirty(H),this._eraseInBufferLine(H++,this._activeBuffer.x,this._bufferService.cols,this._activeBuffer.x===0,j);H<this._bufferService.rows;H++)this._resetBufferLine(H,j);this._dirtyRowTracker.markDirty(H);break;case 1:for(H=this._activeBuffer.y,this._dirtyRowTracker.markDirty(H),this._eraseInBufferLine(H,0,this._activeBuffer.x+1,!0,j),this._activeBuffer.x+1>=this._bufferService.cols&&(this._activeBuffer.lines.get(H+1).isWrapped=!1);H--;)this._resetBufferLine(H,j);this._dirtyRowTracker.markDirty(0);break;case 2:for(H=this._bufferService.rows,this._dirtyRowTracker.markDirty(H-1);H--;)this._resetBufferLine(H,j);this._dirtyRowTracker.markDirty(0);break;case 3:const G=this._activeBuffer.lines.length-this._bufferService.rows;G>0&&(this._activeBuffer.lines.trimStart(G),this._activeBuffer.ybase=Math.max(this._activeBuffer.ybase-G,0),this._activeBuffer.ydisp=Math.max(this._activeBuffer.ydisp-G,0),this._onScroll.fire(0))}return!0}eraseInLine(q,j=!1){switch(this._restrictCursor(this._bufferService.cols),q.params[0]){case 0:this._eraseInBufferLine(this._activeBuffer.y,this._activeBuffer.x,this._bufferService.cols,this._activeBuffer.x===0,j);break;case 1:this._eraseInBufferLine(this._activeBuffer.y,0,this._activeBuffer.x+1,!1,j);break;case 2:this._eraseInBufferLine(this._activeBuffer.y,0,this._bufferService.cols,!0,j)}return this._dirtyRowTracker.markDirty(this._activeBuffer.y),!0}insertLines(q){this._restrictCursor();let j=q.params[0]||1;if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;const H=this._activeBuffer.ybase+this._activeBuffer.y,G=this._bufferService.rows-1-this._activeBuffer.scrollBottom,V=this._bufferService.rows-1+this._activeBuffer.ybase-G+1;for(;j--;)this._activeBuffer.lines.splice(V-1,1),this._activeBuffer.lines.splice(H,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.y,this._activeBuffer.scrollBottom),this._activeBuffer.x=0,!0}deleteLines(q){this._restrictCursor();let j=q.params[0]||1;if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;const H=this._activeBuffer.ybase+this._activeBuffer.y;let G;for(G=this._bufferService.rows-1-this._activeBuffer.scrollBottom,G=this._bufferService.rows-1+this._activeBuffer.ybase-G;j--;)this._activeBuffer.lines.splice(H,1),this._activeBuffer.lines.splice(G,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.y,this._activeBuffer.scrollBottom),this._activeBuffer.x=0,!0}insertChars(q){this._restrictCursor();const j=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return j&&(j.insertCells(this._activeBuffer.x,q.params[0]||1,this._activeBuffer.getNullCell(this._eraseAttrData())),this._dirtyRowTracker.markDirty(this._activeBuffer.y)),!0}deleteChars(q){this._restrictCursor();const j=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return j&&(j.deleteCells(this._activeBuffer.x,q.params[0]||1,this._activeBuffer.getNullCell(this._eraseAttrData())),this._dirtyRowTracker.markDirty(this._activeBuffer.y)),!0}scrollUp(q){let j=q.params[0]||1;for(;j--;)this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollTop,1),this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollBottom,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}scrollDown(q){let j=q.params[0]||1;for(;j--;)this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollBottom,1),this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollTop,0,this._activeBuffer.getBlankLine(w.DEFAULT_ATTR_DATA));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}scrollLeft(q){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;const j=q.params[0]||1;for(let H=this._activeBuffer.scrollTop;H<=this._activeBuffer.scrollBottom;++H){const G=this._activeBuffer.lines.get(this._activeBuffer.ybase+H);G.deleteCells(0,j,this._activeBuffer.getNullCell(this._eraseAttrData())),G.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}scrollRight(q){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;const j=q.params[0]||1;for(let H=this._activeBuffer.scrollTop;H<=this._activeBuffer.scrollBottom;++H){const G=this._activeBuffer.lines.get(this._activeBuffer.ybase+H);G.insertCells(0,j,this._activeBuffer.getNullCell(this._eraseAttrData())),G.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}insertColumns(q){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;const j=q.params[0]||1;for(let H=this._activeBuffer.scrollTop;H<=this._activeBuffer.scrollBottom;++H){const G=this._activeBuffer.lines.get(this._activeBuffer.ybase+H);G.insertCells(this._activeBuffer.x,j,this._activeBuffer.getNullCell(this._eraseAttrData())),G.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}deleteColumns(q){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;const j=q.params[0]||1;for(let H=this._activeBuffer.scrollTop;H<=this._activeBuffer.scrollBottom;++H){const G=this._activeBuffer.lines.get(this._activeBuffer.ybase+H);G.deleteCells(this._activeBuffer.x,j,this._activeBuffer.getNullCell(this._eraseAttrData())),G.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}eraseChars(q){this._restrictCursor();const j=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return j&&(j.replaceCells(this._activeBuffer.x,this._activeBuffer.x+(q.params[0]||1),this._activeBuffer.getNullCell(this._eraseAttrData())),this._dirtyRowTracker.markDirty(this._activeBuffer.y)),!0}repeatPrecedingCharacter(q){const j=this._parser.precedingJoinState;if(!j)return!0;const H=q.params[0]||1,G=B.UnicodeService.extractWidth(j),V=this._activeBuffer.x-G,oe=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).getString(V),Z=new Uint32Array(oe.length*H);let pe=0;for(let U=0;U<oe.length;){const ye=oe.codePointAt(U)||0;Z[pe++]=ye,U+=ye>65535?2:1}let ce=pe;for(let U=1;U<H;++U)Z.copyWithin(ce,0,pe),ce+=pe;return this.print(Z,0,ce),!0}sendDeviceAttributesPrimary(q){return q.params[0]>0||(this._is("xterm")||this._is("rxvt-unicode")||this._is("screen")?this._coreService.triggerDataEvent(f.C0.ESC+"[?1;2c"):this._is("linux")&&this._coreService.triggerDataEvent(f.C0.ESC+"[?6c")),!0}sendDeviceAttributesSecondary(q){return q.params[0]>0||(this._is("xterm")?this._coreService.triggerDataEvent(f.C0.ESC+"[>0;276;0c"):this._is("rxvt-unicode")?this._coreService.triggerDataEvent(f.C0.ESC+"[>85;95;0c"):this._is("linux")?this._coreService.triggerDataEvent(q.params[0]+"c"):this._is("screen")&&this._coreService.triggerDataEvent(f.C0.ESC+"[>83;40003;0c")),!0}_is(q){return(this._optionsService.rawOptions.termName+"").indexOf(q)===0}setMode(q){for(let j=0;j<q.length;j++)switch(q.params[j]){case 4:this._coreService.modes.insertMode=!0;break;case 20:this._optionsService.options.convertEol=!0}return!0}setModePrivate(q){for(let j=0;j<q.length;j++)switch(q.params[j]){case 1:this._coreService.decPrivateModes.applicationCursorKeys=!0;break;case 2:this._charsetService.setgCharset(0,p.DEFAULT_CHARSET),this._charsetService.setgCharset(1,p.DEFAULT_CHARSET),this._charsetService.setgCharset(2,p.DEFAULT_CHARSET),this._charsetService.setgCharset(3,p.DEFAULT_CHARSET);break;case 3:this._optionsService.rawOptions.windowOptions.setWinLines&&(this._bufferService.resize(132,this._bufferService.rows),this._onRequestReset.fire());break;case 6:this._coreService.decPrivateModes.origin=!0,this._setCursor(0,0);break;case 7:this._coreService.decPrivateModes.wraparound=!0;break;case 12:this._optionsService.options.cursorBlink=!0;break;case 45:this._coreService.decPrivateModes.reverseWraparound=!0;break;case 66:this._logService.debug("Serial port requested application keypad."),this._coreService.decPrivateModes.applicationKeypad=!0,this._onRequestSyncScrollBar.fire();break;case 9:this._coreMouseService.activeProtocol="X10";break;case 1e3:this._coreMouseService.activeProtocol="VT200";break;case 1002:this._coreMouseService.activeProtocol="DRAG";break;case 1003:this._coreMouseService.activeProtocol="ANY";break;case 1004:this._coreService.decPrivateModes.sendFocus=!0,this._onRequestSendFocus.fire();break;case 1005:this._logService.debug("DECSET 1005 not supported (see #2507)");break;case 1006:this._coreMouseService.activeEncoding="SGR";break;case 1015:this._logService.debug("DECSET 1015 not supported (see #2507)");break;case 1016:this._coreMouseService.activeEncoding="SGR_PIXELS";break;case 25:this._coreService.isCursorHidden=!1;break;case 1048:this.saveCursor();break;case 1049:this.saveCursor();case 47:case 1047:this._bufferService.buffers.activateAltBuffer(this._eraseAttrData()),this._coreService.isCursorInitialized=!0,this._onRequestRefreshRows.fire(0,this._bufferService.rows-1),this._onRequestSyncScrollBar.fire();break;case 2004:this._coreService.decPrivateModes.bracketedPasteMode=!0}return!0}resetMode(q){for(let j=0;j<q.length;j++)switch(q.params[j]){case 4:this._coreService.modes.insertMode=!1;break;case 20:this._optionsService.options.convertEol=!1}return!0}resetModePrivate(q){for(let j=0;j<q.length;j++)switch(q.params[j]){case 1:this._coreService.decPrivateModes.applicationCursorKeys=!1;break;case 3:this._optionsService.rawOptions.windowOptions.setWinLines&&(this._bufferService.resize(80,this._bufferService.rows),this._onRequestReset.fire());break;case 6:this._coreService.decPrivateModes.origin=!1,this._setCursor(0,0);break;case 7:this._coreService.decPrivateModes.wraparound=!1;break;case 12:this._optionsService.options.cursorBlink=!1;break;case 45:this._coreService.decPrivateModes.reverseWraparound=!1;break;case 66:this._logService.debug("Switching back to normal keypad."),this._coreService.decPrivateModes.applicationKeypad=!1,this._onRequestSyncScrollBar.fire();break;case 9:case 1e3:case 1002:case 1003:this._coreMouseService.activeProtocol="NONE";break;case 1004:this._coreService.decPrivateModes.sendFocus=!1;break;case 1005:this._logService.debug("DECRST 1005 not supported (see #2507)");break;case 1006:case 1016:this._coreMouseService.activeEncoding="DEFAULT";break;case 1015:this._logService.debug("DECRST 1015 not supported (see #2507)");break;case 25:this._coreService.isCursorHidden=!0;break;case 1048:this.restoreCursor();break;case 1049:case 47:case 1047:this._bufferService.buffers.activateNormalBuffer(),q.params[j]===1049&&this.restoreCursor(),this._coreService.isCursorInitialized=!0,this._onRequestRefreshRows.fire(0,this._bufferService.rows-1),this._onRequestSyncScrollBar.fire();break;case 2004:this._coreService.decPrivateModes.bracketedPasteMode=!1}return!0}requestMode(q,j){const H=this._coreService.decPrivateModes,{activeProtocol:G,activeEncoding:V}=this._coreMouseService,oe=this._coreService,{buffers:Z,cols:pe}=this._bufferService,{active:ce,alt:U}=Z,ye=this._optionsService.rawOptions,be=rt=>rt?1:2,Pe=q.params[0];return Oe=Pe,Ue=j?Pe===2?4:Pe===4?be(oe.modes.insertMode):Pe===12?3:Pe===20?be(ye.convertEol):0:Pe===1?be(H.applicationCursorKeys):Pe===3?ye.windowOptions.setWinLines?pe===80?2:pe===132?1:0:0:Pe===6?be(H.origin):Pe===7?be(H.wraparound):Pe===8?3:Pe===9?be(G==="X10"):Pe===12?be(ye.cursorBlink):Pe===25?be(!oe.isCursorHidden):Pe===45?be(H.reverseWraparound):Pe===66?be(H.applicationKeypad):Pe===67?4:Pe===1e3?be(G==="VT200"):Pe===1002?be(G==="DRAG"):Pe===1003?be(G==="ANY"):Pe===1004?be(H.sendFocus):Pe===1005?4:Pe===1006?be(V==="SGR"):Pe===1015?4:Pe===1016?be(V==="SGR_PIXELS"):Pe===1048?1:Pe===47||Pe===1047||Pe===1049?be(ce===U):Pe===2004?be(H.bracketedPasteMode):0,oe.triggerDataEvent(`${f.C0.ESC}[${j?"":"?"}${Oe};${Ue}$y`),!0;var Oe,Ue}_updateAttrColor(q,j,H,G,V){return j===2?(q|=50331648,q&=-16777216,q|=$.AttributeData.fromColorRGB([H,G,V])):j===5&&(q&=-50331904,q|=33554432|255&H),q}_extractColor(q,j,H){const G=[0,0,-1,0,0,0];let V=0,oe=0;do{if(G[oe+V]=q.params[j+oe],q.hasSubParams(j+oe)){const Z=q.getSubParams(j+oe);let pe=0;do G[1]===5&&(V=1),G[oe+pe+1+V]=Z[pe];while(++pe<Z.length&&pe+oe+1+V<G.length);break}if(G[1]===5&&oe+V>=2||G[1]===2&&oe+V>=5)break;G[1]&&(V=1)}while(++oe+j<q.length&&oe+V<G.length);for(let Z=2;Z<G.length;++Z)G[Z]===-1&&(G[Z]=0);switch(G[0]){case 38:H.fg=this._updateAttrColor(H.fg,G[1],G[3],G[4],G[5]);break;case 48:H.bg=this._updateAttrColor(H.bg,G[1],G[3],G[4],G[5]);break;case 58:H.extended=H.extended.clone(),H.extended.underlineColor=this._updateAttrColor(H.extended.underlineColor,G[1],G[3],G[4],G[5])}return oe}_processUnderline(q,j){j.extended=j.extended.clone(),(!~q||q>5)&&(q=1),j.extended.underlineStyle=q,j.fg|=268435456,q===0&&(j.fg&=-268435457),j.updateExtended()}_processSGR0(q){q.fg=w.DEFAULT_ATTR_DATA.fg,q.bg=w.DEFAULT_ATTR_DATA.bg,q.extended=q.extended.clone(),q.extended.underlineStyle=0,q.extended.underlineColor&=-67108864,q.updateExtended()}charAttributes(q){if(q.length===1&&q.params[0]===0)return this._processSGR0(this._curAttrData),!0;const j=q.length;let H;const G=this._curAttrData;for(let V=0;V<j;V++)H=q.params[V],H>=30&&H<=37?(G.fg&=-50331904,G.fg|=16777216|H-30):H>=40&&H<=47?(G.bg&=-50331904,G.bg|=16777216|H-40):H>=90&&H<=97?(G.fg&=-50331904,G.fg|=16777224|H-90):H>=100&&H<=107?(G.bg&=-50331904,G.bg|=16777224|H-100):H===0?this._processSGR0(G):H===1?G.fg|=134217728:H===3?G.bg|=67108864:H===4?(G.fg|=268435456,this._processUnderline(q.hasSubParams(V)?q.getSubParams(V)[0]:1,G)):H===5?G.fg|=536870912:H===7?G.fg|=67108864:H===8?G.fg|=1073741824:H===9?G.fg|=2147483648:H===2?G.bg|=134217728:H===21?this._processUnderline(2,G):H===22?(G.fg&=-134217729,G.bg&=-134217729):H===23?G.bg&=-67108865:H===24?(G.fg&=-268435457,this._processUnderline(0,G)):H===25?G.fg&=-536870913:H===27?G.fg&=-67108865:H===28?G.fg&=-1073741825:H===29?G.fg&=2147483647:H===39?(G.fg&=-67108864,G.fg|=16777215&w.DEFAULT_ATTR_DATA.fg):H===49?(G.bg&=-67108864,G.bg|=16777215&w.DEFAULT_ATTR_DATA.bg):H===38||H===48||H===58?V+=this._extractColor(q,V,G):H===53?G.bg|=1073741824:H===55?G.bg&=-1073741825:H===59?(G.extended=G.extended.clone(),G.extended.underlineColor=-1,G.updateExtended()):H===100?(G.fg&=-67108864,G.fg|=16777215&w.DEFAULT_ATTR_DATA.fg,G.bg&=-67108864,G.bg|=16777215&w.DEFAULT_ATTR_DATA.bg):this._logService.debug("Unknown SGR attribute: %d.",H);return!0}deviceStatus(q){switch(q.params[0]){case 5:this._coreService.triggerDataEvent(`${f.C0.ESC}[0n`);break;case 6:const j=this._activeBuffer.y+1,H=this._activeBuffer.x+1;this._coreService.triggerDataEvent(`${f.C0.ESC}[${j};${H}R`)}return!0}deviceStatusPrivate(q){if(q.params[0]===6){const j=this._activeBuffer.y+1,H=this._activeBuffer.x+1;this._coreService.triggerDataEvent(`${f.C0.ESC}[?${j};${H}R`)}return!0}softReset(q){return this._coreService.isCursorHidden=!1,this._onRequestSyncScrollBar.fire(),this._activeBuffer.scrollTop=0,this._activeBuffer.scrollBottom=this._bufferService.rows-1,this._curAttrData=w.DEFAULT_ATTR_DATA.clone(),this._coreService.reset(),this._charsetService.reset(),this._activeBuffer.savedX=0,this._activeBuffer.savedY=this._activeBuffer.ybase,this._activeBuffer.savedCurAttrData.fg=this._curAttrData.fg,this._activeBuffer.savedCurAttrData.bg=this._curAttrData.bg,this._activeBuffer.savedCharset=this._charsetService.charset,this._coreService.decPrivateModes.origin=!1,!0}setCursorStyle(q){const j=q.params[0]||1;switch(j){case 1:case 2:this._optionsService.options.cursorStyle="block";break;case 3:case 4:this._optionsService.options.cursorStyle="underline";break;case 5:case 6:this._optionsService.options.cursorStyle="bar"}const H=j%2==1;return this._optionsService.options.cursorBlink=H,!0}setScrollRegion(q){const j=q.params[0]||1;let H;return(q.length<2||(H=q.params[1])>this._bufferService.rows||H===0)&&(H=this._bufferService.rows),H>j&&(this._activeBuffer.scrollTop=j-1,this._activeBuffer.scrollBottom=H-1,this._setCursor(0,0)),!0}windowOptions(q){if(!W(q.params[0],this._optionsService.rawOptions.windowOptions))return!0;const j=q.length>1?q.params[1]:0;switch(q.params[0]){case 14:j!==2&&this._onRequestWindowsOptionsReport.fire(Y.GET_WIN_SIZE_PIXELS);break;case 16:this._onRequestWindowsOptionsReport.fire(Y.GET_CELL_SIZE_PIXELS);break;case 18:this._bufferService&&this._coreService.triggerDataEvent(`${f.C0.ESC}[8;${this._bufferService.rows};${this._bufferService.cols}t`);break;case 22:j!==0&&j!==2||(this._windowTitleStack.push(this._windowTitle),this._windowTitleStack.length>10&&this._windowTitleStack.shift()),j!==0&&j!==1||(this._iconNameStack.push(this._iconName),this._iconNameStack.length>10&&this._iconNameStack.shift());break;case 23:j!==0&&j!==2||this._windowTitleStack.length&&this.setTitle(this._windowTitleStack.pop()),j!==0&&j!==1||this._iconNameStack.length&&this.setIconName(this._iconNameStack.pop())}return!0}saveCursor(q){return this._activeBuffer.savedX=this._activeBuffer.x,this._activeBuffer.savedY=this._activeBuffer.ybase+this._activeBuffer.y,this._activeBuffer.savedCurAttrData.fg=this._curAttrData.fg,this._activeBuffer.savedCurAttrData.bg=this._curAttrData.bg,this._activeBuffer.savedCharset=this._charsetService.charset,!0}restoreCursor(q){return this._activeBuffer.x=this._activeBuffer.savedX||0,this._activeBuffer.y=Math.max(this._activeBuffer.savedY-this._activeBuffer.ybase,0),this._curAttrData.fg=this._activeBuffer.savedCurAttrData.fg,this._curAttrData.bg=this._activeBuffer.savedCurAttrData.bg,this._charsetService.charset=this._savedCharset,this._activeBuffer.savedCharset&&(this._charsetService.charset=this._activeBuffer.savedCharset),this._restrictCursor(),!0}setTitle(q){return this._windowTitle=q,this._onTitleChange.fire(q),!0}setIconName(q){return this._iconName=q,!0}setOrReportIndexedColor(q){const j=[],H=q.split(";");for(;H.length>1;){const G=H.shift(),V=H.shift();if(/^\d+$/.exec(G)){const oe=parseInt(G);if(xe(oe))if(V==="?")j.push({type:0,index:oe});else{const Z=(0,N.parseColor)(V);Z&&j.push({type:1,index:oe,color:Z})}}}return j.length&&this._onColor.fire(j),!0}setHyperlink(q){const j=q.split(";");return!(j.length<2)&&(j[1]?this._createHyperlink(j[0],j[1]):!j[0]&&this._finishHyperlink())}_createHyperlink(q,j){this._getCurrentLinkId()&&this._finishHyperlink();const H=q.split(":");let G;const V=H.findIndex((oe=>oe.startsWith("id=")));return V!==-1&&(G=H[V].slice(3)||void 0),this._curAttrData.extended=this._curAttrData.extended.clone(),this._curAttrData.extended.urlId=this._oscLinkService.registerLink({id:G,uri:j}),this._curAttrData.updateExtended(),!0}_finishHyperlink(){return this._curAttrData.extended=this._curAttrData.extended.clone(),this._curAttrData.extended.urlId=0,this._curAttrData.updateExtended(),!0}_setOrReportSpecialColor(q,j){const H=q.split(";");for(let G=0;G<H.length&&!(j>=this._specialColors.length);++G,++j)if(H[G]==="?")this._onColor.fire([{type:0,index:this._specialColors[j]}]);else{const V=(0,N.parseColor)(H[G]);V&&this._onColor.fire([{type:1,index:this._specialColors[j],color:V}])}return!0}setOrReportFgColor(q){return this._setOrReportSpecialColor(q,0)}setOrReportBgColor(q){return this._setOrReportSpecialColor(q,1)}setOrReportCursorColor(q){return this._setOrReportSpecialColor(q,2)}restoreIndexedColor(q){if(!q)return this._onColor.fire([{type:2}]),!0;const j=[],H=q.split(";");for(let G=0;G<H.length;++G)if(/^\d+$/.exec(H[G])){const V=parseInt(H[G]);xe(V)&&j.push({type:2,index:V})}return j.length&&this._onColor.fire(j),!0}restoreFgColor(q){return this._onColor.fire([{type:2,index:256}]),!0}restoreBgColor(q){return this._onColor.fire([{type:2,index:257}]),!0}restoreCursorColor(q){return this._onColor.fire([{type:2,index:258}]),!0}nextLine(){return this._activeBuffer.x=0,this.index(),!0}keypadApplicationMode(){return this._logService.debug("Serial port requested application keypad."),this._coreService.decPrivateModes.applicationKeypad=!0,this._onRequestSyncScrollBar.fire(),!0}keypadNumericMode(){return this._logService.debug("Switching back to normal keypad."),this._coreService.decPrivateModes.applicationKeypad=!1,this._onRequestSyncScrollBar.fire(),!0}selectDefaultCharset(){return this._charsetService.setgLevel(0),this._charsetService.setgCharset(0,p.DEFAULT_CHARSET),!0}selectCharset(q){return q.length!==2?(this.selectDefaultCharset(),!0):(q[0]==="/"||this._charsetService.setgCharset(J[q[0]],p.CHARSETS[q[1]]||p.DEFAULT_CHARSET),!0)}index(){return this._restrictCursor(),this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData())):this._activeBuffer.y>=this._bufferService.rows&&(this._activeBuffer.y=this._bufferService.rows-1),this._restrictCursor(),!0}tabSet(){return this._activeBuffer.tabs[this._activeBuffer.x]=!0,!0}reverseIndex(){if(this._restrictCursor(),this._activeBuffer.y===this._activeBuffer.scrollTop){const q=this._activeBuffer.scrollBottom-this._activeBuffer.scrollTop;this._activeBuffer.lines.shiftElements(this._activeBuffer.ybase+this._activeBuffer.y,q,1),this._activeBuffer.lines.set(this._activeBuffer.ybase+this._activeBuffer.y,this._activeBuffer.getBlankLine(this._eraseAttrData())),this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom)}else this._activeBuffer.y--,this._restrictCursor();return!0}fullReset(){return this._parser.reset(),this._onRequestReset.fire(),!0}reset(){this._curAttrData=w.DEFAULT_ATTR_DATA.clone(),this._eraseAttrDataInternal=w.DEFAULT_ATTR_DATA.clone()}_eraseAttrData(){return this._eraseAttrDataInternal.bg&=-67108864,this._eraseAttrDataInternal.bg|=67108863&this._curAttrData.bg,this._eraseAttrDataInternal}setgLevel(q){return this._charsetService.setgLevel(q),!0}screenAlignmentPattern(){const q=new m.CellData;q.content=4194373,q.fg=this._curAttrData.fg,q.bg=this._curAttrData.bg,this._setCursor(0,0);for(let j=0;j<this._bufferService.rows;++j){const H=this._activeBuffer.ybase+this._activeBuffer.y+j,G=this._activeBuffer.lines.get(H);G&&(G.fill(q),G.isWrapped=!1)}return this._dirtyRowTracker.markAllDirty(),this._setCursor(0,0),!0}requestStatusString(q,j){const H=this._bufferService.buffer,G=this._optionsService.rawOptions;return(V=>(this._coreService.triggerDataEvent(`${f.C0.ESC}${V}${f.C0.ESC}\\`),!0))(q==='"q'?`P1$r${this._curAttrData.isProtected()?1:0}"q`:q==='"p'?'P1$r61;1"p':q==="r"?`P1$r${H.scrollTop+1};${H.scrollBottom+1}r`:q==="m"?"P1$r0m":q===" q"?`P1$r${{block:2,underline:4,bar:6}[G.cursorStyle]-(G.cursorBlink?1:0)} q`:"P0$r")}markRangeDirty(q,j){this._dirtyRowTracker.markRangeDirty(q,j)}}o.InputHandler=Be;let je=class{constructor(ke){this._bufferService=ke,this.clearRange()}clearRange(){this.start=this._bufferService.buffer.y,this.end=this._bufferService.buffer.y}markDirty(ke){ke<this.start?this.start=ke:ke>this.end&&(this.end=ke)}markRangeDirty(ke,q){ke>q&&(ve=ke,ke=q,q=ve),ke<this.start&&(this.start=ke),q>this.end&&(this.end=q)}markAllDirty(){this.markRangeDirty(0,this._bufferService.rows-1)}};function xe(ke){return 0<=ke&&ke<256}je=d([l(0,I.IBufferService)],je)},844:(h,o)=>{function a(d){for(const l of d)l.dispose();d.length=0}Object.defineProperty(o,"__esModule",{value:!0}),o.getDisposeArrayDisposable=o.disposeArray=o.toDisposable=o.MutableDisposable=o.Disposable=void 0,o.Disposable=class{constructor(){this._disposables=[],this._isDisposed=!1}dispose(){this._isDisposed=!0;for(const d of this._disposables)d.dispose();this._disposables.length=0}register(d){return this._disposables.push(d),d}unregister(d){const l=this._disposables.indexOf(d);l!==-1&&this._disposables.splice(l,1)}},o.MutableDisposable=class{constructor(){this._isDisposed=!1}get value(){return this._isDisposed?void 0:this._value}set value(d){this._isDisposed||d===this._value||(this._value?.dispose(),this._value=d)}clear(){this.value=void 0}dispose(){this._isDisposed=!0,this._value?.dispose(),this._value=void 0}},o.toDisposable=function(d){return{dispose:d}},o.disposeArray=a,o.getDisposeArrayDisposable=function(d){return{dispose:()=>a(d)}}},1505:(h,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.FourKeyMap=o.TwoKeyMap=void 0;class a{constructor(){this._data={}}set(l,f,p){this._data[l]||(this._data[l]={}),this._data[l][f]=p}get(l,f){return this._data[l]?this._data[l][f]:void 0}clear(){this._data={}}}o.TwoKeyMap=a,o.FourKeyMap=class{constructor(){this._data=new a}set(d,l,f,p,S){this._data.get(d,l)||this._data.set(d,l,new a),this._data.get(d,l).set(f,p,S)}get(d,l,f,p){return this._data.get(d,l)?.get(f,p)}clear(){this._data.clear()}}},6114:(h,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.isChromeOS=o.isLinux=o.isWindows=o.isIphone=o.isIpad=o.isMac=o.getSafariVersion=o.isSafari=o.isLegacyEdge=o.isFirefox=o.isNode=void 0,o.isNode=typeof process$1<"u"&&"title"in process$1;const a=o.isNode?"node":navigator.userAgent,d=o.isNode?"node":navigator.platform;o.isFirefox=a.includes("Firefox"),o.isLegacyEdge=a.includes("Edge"),o.isSafari=/^((?!chrome|android).)*safari/i.test(a),o.getSafariVersion=function(){if(!o.isSafari)return 0;const l=a.match(/Version\/(\d+)/);return l===null||l.length<2?0:parseInt(l[1])},o.isMac=["Macintosh","MacIntel","MacPPC","Mac68K"].includes(d),o.isIpad=d==="iPad",o.isIphone=d==="iPhone",o.isWindows=["Windows","Win16","Win32","WinCE"].includes(d),o.isLinux=d.indexOf("Linux")>=0,o.isChromeOS=/\bCrOS\b/.test(a)},6106:(h,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.SortedList=void 0;let a=0;o.SortedList=class{constructor(d){this._getKey=d,this._array=[]}clear(){this._array.length=0}insert(d){this._array.length!==0?(a=this._search(this._getKey(d)),this._array.splice(a,0,d)):this._array.push(d)}delete(d){if(this._array.length===0)return!1;const l=this._getKey(d);if(l===void 0||(a=this._search(l),a===-1)||this._getKey(this._array[a])!==l)return!1;do if(this._array[a]===d)return this._array.splice(a,1),!0;while(++a<this._array.length&&this._getKey(this._array[a])===l);return!1}*getKeyIterator(d){if(this._array.length!==0&&(a=this._search(d),!(a<0||a>=this._array.length)&&this._getKey(this._array[a])===d))do yield this._array[a];while(++a<this._array.length&&this._getKey(this._array[a])===d)}forEachByKey(d,l){if(this._array.length!==0&&(a=this._search(d),!(a<0||a>=this._array.length)&&this._getKey(this._array[a])===d))do l(this._array[a]);while(++a<this._array.length&&this._getKey(this._array[a])===d)}values(){return[...this._array].values()}_search(d){let l=0,f=this._array.length-1;for(;f>=l;){let p=l+f>>1;const S=this._getKey(this._array[p]);if(S>d)f=p-1;else{if(!(S<d)){for(;p>0&&this._getKey(this._array[p-1])===d;)p--;return p}l=p+1}}return l}}},7226:(h,o,a)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.DebouncedIdleTask=o.IdleTaskQueue=o.PriorityTaskQueue=void 0;const d=a(6114);class l{constructor(){this._tasks=[],this._i=0}enqueue(S){this._tasks.push(S),this._start()}flush(){for(;this._i<this._tasks.length;)this._tasks[this._i]()||this._i++;this.clear()}clear(){this._idleCallback&&(this._cancelCallback(this._idleCallback),this._idleCallback=void 0),this._i=0,this._tasks.length=0}_start(){this._idleCallback||(this._idleCallback=this._requestCallback(this._process.bind(this)))}_process(S){this._idleCallback=void 0;let k=0,A=0,w=S.timeRemaining(),v=0;for(;this._i<this._tasks.length;){if(k=Date.now(),this._tasks[this._i]()||this._i++,k=Math.max(1,Date.now()-k),A=Math.max(k,A),v=S.timeRemaining(),1.5*A>v)return w-k<-20&&console.warn(`task queue exceeded allotted deadline by ${Math.abs(Math.round(w-k))}ms`),void this._start();w=v}this.clear()}}class f extends l{_requestCallback(S){return setTimeout((()=>S(this._createDeadline(16))))}_cancelCallback(S){clearTimeout(S)}_createDeadline(S){const k=Date.now()+S;return{timeRemaining:()=>Math.max(0,k-Date.now())}}}o.PriorityTaskQueue=f,o.IdleTaskQueue=!d.isNode&&"requestIdleCallback"in window?class extends l{_requestCallback(p){return requestIdleCallback(p)}_cancelCallback(p){cancelIdleCallback(p)}}:f,o.DebouncedIdleTask=class{constructor(){this._queue=new o.IdleTaskQueue}set(p){this._queue.clear(),this._queue.enqueue(p)}flush(){this._queue.flush()}}},9282:(h,o,a)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.updateWindowsModeWrappedState=void 0;const d=a(643);o.updateWindowsModeWrappedState=function(l){const f=l.buffer.lines.get(l.buffer.ybase+l.buffer.y-1),p=f?.get(l.cols-1),S=l.buffer.lines.get(l.buffer.ybase+l.buffer.y);S&&p&&(S.isWrapped=p[d.CHAR_DATA_CODE_INDEX]!==d.NULL_CELL_CODE&&p[d.CHAR_DATA_CODE_INDEX]!==d.WHITESPACE_CELL_CODE)}},3734:(h,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.ExtendedAttrs=o.AttributeData=void 0;class a{constructor(){this.fg=0,this.bg=0,this.extended=new d}static toColorRGB(f){return[f>>>16&255,f>>>8&255,255&f]}static fromColorRGB(f){return(255&f[0])<<16|(255&f[1])<<8|255&f[2]}clone(){const f=new a;return f.fg=this.fg,f.bg=this.bg,f.extended=this.extended.clone(),f}isInverse(){return 67108864&this.fg}isBold(){return 134217728&this.fg}isUnderline(){return this.hasExtendedAttrs()&&this.extended.underlineStyle!==0?1:268435456&this.fg}isBlink(){return 536870912&this.fg}isInvisible(){return 1073741824&this.fg}isItalic(){return 67108864&this.bg}isDim(){return 134217728&this.bg}isStrikethrough(){return 2147483648&this.fg}isProtected(){return 536870912&this.bg}isOverline(){return 1073741824&this.bg}getFgColorMode(){return 50331648&this.fg}getBgColorMode(){return 50331648&this.bg}isFgRGB(){return(50331648&this.fg)==50331648}isBgRGB(){return(50331648&this.bg)==50331648}isFgPalette(){return(50331648&this.fg)==16777216||(50331648&this.fg)==33554432}isBgPalette(){return(50331648&this.bg)==16777216||(50331648&this.bg)==33554432}isFgDefault(){return(50331648&this.fg)==0}isBgDefault(){return(50331648&this.bg)==0}isAttributeDefault(){return this.fg===0&&this.bg===0}getFgColor(){switch(50331648&this.fg){case 16777216:case 33554432:return 255&this.fg;case 50331648:return 16777215&this.fg;default:return-1}}getBgColor(){switch(50331648&this.bg){case 16777216:case 33554432:return 255&this.bg;case 50331648:return 16777215&this.bg;default:return-1}}hasExtendedAttrs(){return 268435456&this.bg}updateExtended(){this.extended.isEmpty()?this.bg&=-268435457:this.bg|=268435456}getUnderlineColor(){if(268435456&this.bg&&~this.extended.underlineColor)switch(50331648&this.extended.underlineColor){case 16777216:case 33554432:return 255&this.extended.underlineColor;case 50331648:return 16777215&this.extended.underlineColor;default:return this.getFgColor()}return this.getFgColor()}getUnderlineColorMode(){return 268435456&this.bg&&~this.extended.underlineColor?50331648&this.extended.underlineColor:this.getFgColorMode()}isUnderlineColorRGB(){return 268435456&this.bg&&~this.extended.underlineColor?(50331648&this.extended.underlineColor)==50331648:this.isFgRGB()}isUnderlineColorPalette(){return 268435456&this.bg&&~this.extended.underlineColor?(50331648&this.extended.underlineColor)==16777216||(50331648&this.extended.underlineColor)==33554432:this.isFgPalette()}isUnderlineColorDefault(){return 268435456&this.bg&&~this.extended.underlineColor?(50331648&this.extended.underlineColor)==0:this.isFgDefault()}getUnderlineStyle(){return 268435456&this.fg?268435456&this.bg?this.extended.underlineStyle:1:0}getUnderlineVariantOffset(){return this.extended.underlineVariantOffset}}o.AttributeData=a;class d{get ext(){return this._urlId?-469762049&this._ext|this.underlineStyle<<26:this._ext}set ext(f){this._ext=f}get underlineStyle(){return this._urlId?5:(469762048&this._ext)>>26}set underlineStyle(f){this._ext&=-469762049,this._ext|=f<<26&469762048}get underlineColor(){return 67108863&this._ext}set underlineColor(f){this._ext&=-67108864,this._ext|=67108863&f}get urlId(){return this._urlId}set urlId(f){this._urlId=f}get underlineVariantOffset(){const f=(3758096384&this._ext)>>29;return f<0?4294967288^f:f}set underlineVariantOffset(f){this._ext&=536870911,this._ext|=f<<29&3758096384}constructor(f=0,p=0){this._ext=0,this._urlId=0,this._ext=f,this._urlId=p}clone(){return new d(this._ext,this._urlId)}isEmpty(){return this.underlineStyle===0&&this._urlId===0}}o.ExtendedAttrs=d},9092:(h,o,a)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.Buffer=o.MAX_BUFFER_SIZE=void 0;const d=a(6349),l=a(7226),f=a(3734),p=a(8437),S=a(4634),k=a(511),A=a(643),w=a(4863),v=a(7116);o.MAX_BUFFER_SIZE=4294967295,o.Buffer=class{constructor(g,m,$){this._hasScrollback=g,this._optionsService=m,this._bufferService=$,this.ydisp=0,this.ybase=0,this.y=0,this.x=0,this.tabs={},this.savedY=0,this.savedX=0,this.savedCurAttrData=p.DEFAULT_ATTR_DATA.clone(),this.savedCharset=v.DEFAULT_CHARSET,this.markers=[],this._nullCell=k.CellData.fromCharData([0,A.NULL_CELL_CHAR,A.NULL_CELL_WIDTH,A.NULL_CELL_CODE]),this._whitespaceCell=k.CellData.fromCharData([0,A.WHITESPACE_CELL_CHAR,A.WHITESPACE_CELL_WIDTH,A.WHITESPACE_CELL_CODE]),this._isClearing=!1,this._memoryCleanupQueue=new l.IdleTaskQueue,this._memoryCleanupPosition=0,this._cols=this._bufferService.cols,this._rows=this._bufferService.rows,this.lines=new d.CircularList(this._getCorrectBufferLength(this._rows)),this.scrollTop=0,this.scrollBottom=this._rows-1,this.setupTabStops()}getNullCell(g){return g?(this._nullCell.fg=g.fg,this._nullCell.bg=g.bg,this._nullCell.extended=g.extended):(this._nullCell.fg=0,this._nullCell.bg=0,this._nullCell.extended=new f.ExtendedAttrs),this._nullCell}getWhitespaceCell(g){return g?(this._whitespaceCell.fg=g.fg,this._whitespaceCell.bg=g.bg,this._whitespaceCell.extended=g.extended):(this._whitespaceCell.fg=0,this._whitespaceCell.bg=0,this._whitespaceCell.extended=new f.ExtendedAttrs),this._whitespaceCell}getBlankLine(g,m){return new p.BufferLine(this._bufferService.cols,this.getNullCell(g),m)}get hasScrollback(){return this._hasScrollback&&this.lines.maxLength>this._rows}get isCursorInViewport(){const g=this.ybase+this.y-this.ydisp;return g>=0&&g<this._rows}_getCorrectBufferLength(g){if(!this._hasScrollback)return g;const m=g+this._optionsService.rawOptions.scrollback;return m>o.MAX_BUFFER_SIZE?o.MAX_BUFFER_SIZE:m}fillViewportRows(g){if(this.lines.length===0){g===void 0&&(g=p.DEFAULT_ATTR_DATA);let m=this._rows;for(;m--;)this.lines.push(this.getBlankLine(g))}}clear(){this.ydisp=0,this.ybase=0,this.y=0,this.x=0,this.lines=new d.CircularList(this._getCorrectBufferLength(this._rows)),this.scrollTop=0,this.scrollBottom=this._rows-1,this.setupTabStops()}resize(g,m){const $=this.getNullCell(p.DEFAULT_ATTR_DATA);let I=0;const B=this._getCorrectBufferLength(m);if(B>this.lines.maxLength&&(this.lines.maxLength=B),this.lines.length>0){if(this._cols<g)for(let x=0;x<this.lines.length;x++)I+=+this.lines.get(x).resize(g,$);let P=0;if(this._rows<m)for(let x=this._rows;x<m;x++)this.lines.length<m+this.ybase&&(this._optionsService.rawOptions.windowsMode||this._optionsService.rawOptions.windowsPty.backend!==void 0||this._optionsService.rawOptions.windowsPty.buildNumber!==void 0?this.lines.push(new p.BufferLine(g,$)):this.ybase>0&&this.lines.length<=this.ybase+this.y+P+1?(this.ybase--,P++,this.ydisp>0&&this.ydisp--):this.lines.push(new p.BufferLine(g,$)));else for(let x=this._rows;x>m;x--)this.lines.length>m+this.ybase&&(this.lines.length>this.ybase+this.y+1?this.lines.pop():(this.ybase++,this.ydisp++));if(B<this.lines.maxLength){const x=this.lines.length-B;x>0&&(this.lines.trimStart(x),this.ybase=Math.max(this.ybase-x,0),this.ydisp=Math.max(this.ydisp-x,0),this.savedY=Math.max(this.savedY-x,0)),this.lines.maxLength=B}this.x=Math.min(this.x,g-1),this.y=Math.min(this.y,m-1),P&&(this.y+=P),this.savedX=Math.min(this.savedX,g-1),this.scrollTop=0}if(this.scrollBottom=m-1,this._isReflowEnabled&&(this._reflow(g,m),this._cols>g))for(let P=0;P<this.lines.length;P++)I+=+this.lines.get(P).resize(g,$);this._cols=g,this._rows=m,this._memoryCleanupQueue.clear(),I>.1*this.lines.length&&(this._memoryCleanupPosition=0,this._memoryCleanupQueue.enqueue((()=>this._batchedMemoryCleanup())))}_batchedMemoryCleanup(){let g=!0;this._memoryCleanupPosition>=this.lines.length&&(this._memoryCleanupPosition=0,g=!1);let m=0;for(;this._memoryCleanupPosition<this.lines.length;)if(m+=this.lines.get(this._memoryCleanupPosition++).cleanupMemory(),m>100)return!0;return g}get _isReflowEnabled(){const g=this._optionsService.rawOptions.windowsPty;return g&&g.buildNumber?this._hasScrollback&&g.backend==="conpty"&&g.buildNumber>=21376:this._hasScrollback&&!this._optionsService.rawOptions.windowsMode}_reflow(g,m){this._cols!==g&&(g>this._cols?this._reflowLarger(g,m):this._reflowSmaller(g,m))}_reflowLarger(g,m){const $=(0,S.reflowLargerGetLinesToRemove)(this.lines,this._cols,g,this.ybase+this.y,this.getNullCell(p.DEFAULT_ATTR_DATA));if($.length>0){const I=(0,S.reflowLargerCreateNewLayout)(this.lines,$);(0,S.reflowLargerApplyNewLayout)(this.lines,I.layout),this._reflowLargerAdjustViewport(g,m,I.countRemoved)}}_reflowLargerAdjustViewport(g,m,$){const I=this.getNullCell(p.DEFAULT_ATTR_DATA);let B=$;for(;B-- >0;)this.ybase===0?(this.y>0&&this.y--,this.lines.length<m&&this.lines.push(new p.BufferLine(g,I))):(this.ydisp===this.ybase&&this.ydisp--,this.ybase--);this.savedY=Math.max(this.savedY-$,0)}_reflowSmaller(g,m){const $=this.getNullCell(p.DEFAULT_ATTR_DATA),I=[];let B=0;for(let P=this.lines.length-1;P>=0;P--){let x=this.lines.get(P);if(!x||!x.isWrapped&&x.getTrimmedLength()<=g)continue;const N=[x];for(;x.isWrapped&&P>0;)x=this.lines.get(--P),N.unshift(x);const J=this.ybase+this.y;if(J>=P&&J<P+N.length)continue;const Q=N[N.length-1].getTrimmedLength(),W=(0,S.reflowSmallerGetNewLineLengths)(N,this._cols,g),Y=W.length-N.length;let ve;ve=this.ybase===0&&this.y!==this.lines.length-1?Math.max(0,this.y-this.lines.maxLength+Y):Math.max(0,this.lines.length-this.lines.maxLength+Y);const Be=[];for(let H=0;H<Y;H++){const G=this.getBlankLine(p.DEFAULT_ATTR_DATA,!0);Be.push(G)}Be.length>0&&(I.push({start:P+N.length+B,newLines:Be}),B+=Be.length),N.push(...Be);let je=W.length-1,xe=W[je];xe===0&&(je--,xe=W[je]);let ke=N.length-Y-1,q=Q;for(;ke>=0;){const H=Math.min(q,xe);if(N[je]===void 0)break;if(N[je].copyCellsFrom(N[ke],q-H,xe-H,H,!0),xe-=H,xe===0&&(je--,xe=W[je]),q-=H,q===0){ke--;const G=Math.max(ke,0);q=(0,S.getWrappedLineTrimmedLength)(N,G,this._cols)}}for(let H=0;H<N.length;H++)W[H]<g&&N[H].setCell(W[H],$);let j=Y-ve;for(;j-- >0;)this.ybase===0?this.y<m-1?(this.y++,this.lines.pop()):(this.ybase++,this.ydisp++):this.ybase<Math.min(this.lines.maxLength,this.lines.length+B)-m&&(this.ybase===this.ydisp&&this.ydisp++,this.ybase++);this.savedY=Math.min(this.savedY+Y,this.ybase+m-1)}if(I.length>0){const P=[],x=[];for(let je=0;je<this.lines.length;je++)x.push(this.lines.get(je));const N=this.lines.length;let J=N-1,Q=0,W=I[Q];this.lines.length=Math.min(this.lines.maxLength,this.lines.length+B);let Y=0;for(let je=Math.min(this.lines.maxLength-1,N+B-1);je>=0;je--)if(W&&W.start>J+Y){for(let xe=W.newLines.length-1;xe>=0;xe--)this.lines.set(je--,W.newLines[xe]);je++,P.push({index:J+1,amount:W.newLines.length}),Y+=W.newLines.length,W=I[++Q]}else this.lines.set(je,x[J--]);let ve=0;for(let je=P.length-1;je>=0;je--)P[je].index+=ve,this.lines.onInsertEmitter.fire(P[je]),ve+=P[je].amount;const Be=Math.max(0,N+B-this.lines.maxLength);Be>0&&this.lines.onTrimEmitter.fire(Be)}}translateBufferLineToString(g,m,$=0,I){const B=this.lines.get(g);return B?B.translateToString(m,$,I):""}getWrappedRangeForLine(g){let m=g,$=g;for(;m>0&&this.lines.get(m).isWrapped;)m--;for(;$+1<this.lines.length&&this.lines.get($+1).isWrapped;)$++;return{first:m,last:$}}setupTabStops(g){for(g!=null?this.tabs[g]||(g=this.prevStop(g)):(this.tabs={},g=0);g<this._cols;g+=this._optionsService.rawOptions.tabStopWidth)this.tabs[g]=!0}prevStop(g){for(g==null&&(g=this.x);!this.tabs[--g]&&g>0;);return g>=this._cols?this._cols-1:g<0?0:g}nextStop(g){for(g==null&&(g=this.x);!this.tabs[++g]&&g<this._cols;);return g>=this._cols?this._cols-1:g<0?0:g}clearMarkers(g){this._isClearing=!0;for(let m=0;m<this.markers.length;m++)this.markers[m].line===g&&(this.markers[m].dispose(),this.markers.splice(m--,1));this._isClearing=!1}clearAllMarkers(){this._isClearing=!0;for(let g=0;g<this.markers.length;g++)this.markers[g].dispose(),this.markers.splice(g--,1);this._isClearing=!1}addMarker(g){const m=new w.Marker(g);return this.markers.push(m),m.register(this.lines.onTrim(($=>{m.line-=$,m.line<0&&m.dispose()}))),m.register(this.lines.onInsert(($=>{m.line>=$.index&&(m.line+=$.amount)}))),m.register(this.lines.onDelete(($=>{m.line>=$.index&&m.line<$.index+$.amount&&m.dispose(),m.line>$.index&&(m.line-=$.amount)}))),m.register(m.onDispose((()=>this._removeMarker(m)))),m}_removeMarker(g){this._isClearing||this.markers.splice(this.markers.indexOf(g),1)}}},8437:(h,o,a)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.BufferLine=o.DEFAULT_ATTR_DATA=void 0;const d=a(3734),l=a(511),f=a(643),p=a(482);o.DEFAULT_ATTR_DATA=Object.freeze(new d.AttributeData);let S=0;class k{constructor(w,v,g=!1){this.isWrapped=g,this._combined={},this._extendedAttrs={},this._data=new Uint32Array(3*w);const m=v||l.CellData.fromCharData([0,f.NULL_CELL_CHAR,f.NULL_CELL_WIDTH,f.NULL_CELL_CODE]);for(let $=0;$<w;++$)this.setCell($,m);this.length=w}get(w){const v=this._data[3*w+0],g=2097151&v;return[this._data[3*w+1],2097152&v?this._combined[w]:g?(0,p.stringFromCodePoint)(g):"",v>>22,2097152&v?this._combined[w].charCodeAt(this._combined[w].length-1):g]}set(w,v){this._data[3*w+1]=v[f.CHAR_DATA_ATTR_INDEX],v[f.CHAR_DATA_CHAR_INDEX].length>1?(this._combined[w]=v[1],this._data[3*w+0]=2097152|w|v[f.CHAR_DATA_WIDTH_INDEX]<<22):this._data[3*w+0]=v[f.CHAR_DATA_CHAR_INDEX].charCodeAt(0)|v[f.CHAR_DATA_WIDTH_INDEX]<<22}getWidth(w){return this._data[3*w+0]>>22}hasWidth(w){return 12582912&this._data[3*w+0]}getFg(w){return this._data[3*w+1]}getBg(w){return this._data[3*w+2]}hasContent(w){return 4194303&this._data[3*w+0]}getCodePoint(w){const v=this._data[3*w+0];return 2097152&v?this._combined[w].charCodeAt(this._combined[w].length-1):2097151&v}isCombined(w){return 2097152&this._data[3*w+0]}getString(w){const v=this._data[3*w+0];return 2097152&v?this._combined[w]:2097151&v?(0,p.stringFromCodePoint)(2097151&v):""}isProtected(w){return 536870912&this._data[3*w+2]}loadCell(w,v){return S=3*w,v.content=this._data[S+0],v.fg=this._data[S+1],v.bg=this._data[S+2],2097152&v.content&&(v.combinedData=this._combined[w]),268435456&v.bg&&(v.extended=this._extendedAttrs[w]),v}setCell(w,v){2097152&v.content&&(this._combined[w]=v.combinedData),268435456&v.bg&&(this._extendedAttrs[w]=v.extended),this._data[3*w+0]=v.content,this._data[3*w+1]=v.fg,this._data[3*w+2]=v.bg}setCellFromCodepoint(w,v,g,m){268435456&m.bg&&(this._extendedAttrs[w]=m.extended),this._data[3*w+0]=v|g<<22,this._data[3*w+1]=m.fg,this._data[3*w+2]=m.bg}addCodepointToCell(w,v,g){let m=this._data[3*w+0];2097152&m?this._combined[w]+=(0,p.stringFromCodePoint)(v):2097151&m?(this._combined[w]=(0,p.stringFromCodePoint)(2097151&m)+(0,p.stringFromCodePoint)(v),m&=-2097152,m|=2097152):m=v|4194304,g&&(m&=-12582913,m|=g<<22),this._data[3*w+0]=m}insertCells(w,v,g){if((w%=this.length)&&this.getWidth(w-1)===2&&this.setCellFromCodepoint(w-1,0,1,g),v<this.length-w){const m=new l.CellData;for(let $=this.length-w-v-1;$>=0;--$)this.setCell(w+v+$,this.loadCell(w+$,m));for(let $=0;$<v;++$)this.setCell(w+$,g)}else for(let m=w;m<this.length;++m)this.setCell(m,g);this.getWidth(this.length-1)===2&&this.setCellFromCodepoint(this.length-1,0,1,g)}deleteCells(w,v,g){if(w%=this.length,v<this.length-w){const m=new l.CellData;for(let $=0;$<this.length-w-v;++$)this.setCell(w+$,this.loadCell(w+v+$,m));for(let $=this.length-v;$<this.length;++$)this.setCell($,g)}else for(let m=w;m<this.length;++m)this.setCell(m,g);w&&this.getWidth(w-1)===2&&this.setCellFromCodepoint(w-1,0,1,g),this.getWidth(w)!==0||this.hasContent(w)||this.setCellFromCodepoint(w,0,1,g)}replaceCells(w,v,g,m=!1){if(m)for(w&&this.getWidth(w-1)===2&&!this.isProtected(w-1)&&this.setCellFromCodepoint(w-1,0,1,g),v<this.length&&this.getWidth(v-1)===2&&!this.isProtected(v)&&this.setCellFromCodepoint(v,0,1,g);w<v&&w<this.length;)this.isProtected(w)||this.setCell(w,g),w++;else for(w&&this.getWidth(w-1)===2&&this.setCellFromCodepoint(w-1,0,1,g),v<this.length&&this.getWidth(v-1)===2&&this.setCellFromCodepoint(v,0,1,g);w<v&&w<this.length;)this.setCell(w++,g)}resize(w,v){if(w===this.length)return 4*this._data.length*2<this._data.buffer.byteLength;const g=3*w;if(w>this.length){if(this._data.buffer.byteLength>=4*g)this._data=new Uint32Array(this._data.buffer,0,g);else{const m=new Uint32Array(g);m.set(this._data),this._data=m}for(let m=this.length;m<w;++m)this.setCell(m,v)}else{this._data=this._data.subarray(0,g);const m=Object.keys(this._combined);for(let I=0;I<m.length;I++){const B=parseInt(m[I],10);B>=w&&delete this._combined[B]}const $=Object.keys(this._extendedAttrs);for(let I=0;I<$.length;I++){const B=parseInt($[I],10);B>=w&&delete this._extendedAttrs[B]}}return this.length=w,4*g*2<this._data.buffer.byteLength}cleanupMemory(){if(4*this._data.length*2<this._data.buffer.byteLength){const w=new Uint32Array(this._data.length);return w.set(this._data),this._data=w,1}return 0}fill(w,v=!1){if(v)for(let g=0;g<this.length;++g)this.isProtected(g)||this.setCell(g,w);else{this._combined={},this._extendedAttrs={};for(let g=0;g<this.length;++g)this.setCell(g,w)}}copyFrom(w){this.length!==w.length?this._data=new Uint32Array(w._data):this._data.set(w._data),this.length=w.length,this._combined={};for(const v in w._combined)this._combined[v]=w._combined[v];this._extendedAttrs={};for(const v in w._extendedAttrs)this._extendedAttrs[v]=w._extendedAttrs[v];this.isWrapped=w.isWrapped}clone(){const w=new k(0);w._data=new Uint32Array(this._data),w.length=this.length;for(const v in this._combined)w._combined[v]=this._combined[v];for(const v in this._extendedAttrs)w._extendedAttrs[v]=this._extendedAttrs[v];return w.isWrapped=this.isWrapped,w}getTrimmedLength(){for(let w=this.length-1;w>=0;--w)if(4194303&this._data[3*w+0])return w+(this._data[3*w+0]>>22);return 0}getNoBgTrimmedLength(){for(let w=this.length-1;w>=0;--w)if(4194303&this._data[3*w+0]||50331648&this._data[3*w+2])return w+(this._data[3*w+0]>>22);return 0}copyCellsFrom(w,v,g,m,$){const I=w._data;if($)for(let P=m-1;P>=0;P--){for(let x=0;x<3;x++)this._data[3*(g+P)+x]=I[3*(v+P)+x];268435456&I[3*(v+P)+2]&&(this._extendedAttrs[g+P]=w._extendedAttrs[v+P])}else for(let P=0;P<m;P++){for(let x=0;x<3;x++)this._data[3*(g+P)+x]=I[3*(v+P)+x];268435456&I[3*(v+P)+2]&&(this._extendedAttrs[g+P]=w._extendedAttrs[v+P])}const B=Object.keys(w._combined);for(let P=0;P<B.length;P++){const x=parseInt(B[P],10);x>=v&&(this._combined[x-v+g]=w._combined[x])}}translateToString(w,v,g,m){v=v??0,g=g??this.length,w&&(g=Math.min(g,this.getTrimmedLength())),m&&(m.length=0);let $="";for(;v<g;){const I=this._data[3*v+0],B=2097151&I,P=2097152&I?this._combined[v]:B?(0,p.stringFromCodePoint)(B):f.WHITESPACE_CELL_CHAR;if($+=P,m)for(let x=0;x<P.length;++x)m.push(v);v+=I>>22||1}return m&&m.push(v),$}}o.BufferLine=k},4841:(h,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.getRangeLength=void 0,o.getRangeLength=function(a,d){if(a.start.y>a.end.y)throw new Error(`Buffer range end (${a.end.x}, ${a.end.y}) cannot be before start (${a.start.x}, ${a.start.y})`);return d*(a.end.y-a.start.y)+(a.end.x-a.start.x+1)}},4634:(h,o)=>{function a(d,l,f){if(l===d.length-1)return d[l].getTrimmedLength();const p=!d[l].hasContent(f-1)&&d[l].getWidth(f-1)===1,S=d[l+1].getWidth(0)===2;return p&&S?f-1:f}Object.defineProperty(o,"__esModule",{value:!0}),o.getWrappedLineTrimmedLength=o.reflowSmallerGetNewLineLengths=o.reflowLargerApplyNewLayout=o.reflowLargerCreateNewLayout=o.reflowLargerGetLinesToRemove=void 0,o.reflowLargerGetLinesToRemove=function(d,l,f,p,S){const k=[];for(let A=0;A<d.length-1;A++){let w=A,v=d.get(++w);if(!v.isWrapped)continue;const g=[d.get(A)];for(;w<d.length&&v.isWrapped;)g.push(v),v=d.get(++w);if(p>=A&&p<w){A+=g.length-1;continue}let m=0,$=a(g,m,l),I=1,B=0;for(;I<g.length;){const x=a(g,I,l),N=x-B,J=f-$,Q=Math.min(N,J);g[m].copyCellsFrom(g[I],B,$,Q,!1),$+=Q,$===f&&(m++,$=0),B+=Q,B===x&&(I++,B=0),$===0&&m!==0&&g[m-1].getWidth(f-1)===2&&(g[m].copyCellsFrom(g[m-1],f-1,$++,1,!1),g[m-1].setCell(f-1,S))}g[m].replaceCells($,f,S);let P=0;for(let x=g.length-1;x>0&&(x>m||g[x].getTrimmedLength()===0);x--)P++;P>0&&(k.push(A+g.length-P),k.push(P)),A+=g.length-1}return k},o.reflowLargerCreateNewLayout=function(d,l){const f=[];let p=0,S=l[p],k=0;for(let A=0;A<d.length;A++)if(S===A){const w=l[++p];d.onDeleteEmitter.fire({index:A-k,amount:w}),A+=w-1,k+=w,S=l[++p]}else f.push(A);return{layout:f,countRemoved:k}},o.reflowLargerApplyNewLayout=function(d,l){const f=[];for(let p=0;p<l.length;p++)f.push(d.get(l[p]));for(let p=0;p<f.length;p++)d.set(p,f[p]);d.length=l.length},o.reflowSmallerGetNewLineLengths=function(d,l,f){const p=[],S=d.map(((v,g)=>a(d,g,l))).reduce(((v,g)=>v+g));let k=0,A=0,w=0;for(;w<S;){if(S-w<f){p.push(S-w);break}k+=f;const v=a(d,A,l);k>v&&(k-=v,A++);const g=d[A].getWidth(k-1)===2;g&&k--;const m=g?f-1:f;p.push(m),w+=m}return p},o.getWrappedLineTrimmedLength=a},5295:(h,o,a)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.BufferSet=void 0;const d=a(8460),l=a(844),f=a(9092);class p extends l.Disposable{constructor(k,A){super(),this._optionsService=k,this._bufferService=A,this._onBufferActivate=this.register(new d.EventEmitter),this.onBufferActivate=this._onBufferActivate.event,this.reset(),this.register(this._optionsService.onSpecificOptionChange("scrollback",(()=>this.resize(this._bufferService.cols,this._bufferService.rows)))),this.register(this._optionsService.onSpecificOptionChange("tabStopWidth",(()=>this.setupTabStops())))}reset(){this._normal=new f.Buffer(!0,this._optionsService,this._bufferService),this._normal.fillViewportRows(),this._alt=new f.Buffer(!1,this._optionsService,this._bufferService),this._activeBuffer=this._normal,this._onBufferActivate.fire({activeBuffer:this._normal,inactiveBuffer:this._alt}),this.setupTabStops()}get alt(){return this._alt}get active(){return this._activeBuffer}get normal(){return this._normal}activateNormalBuffer(){this._activeBuffer!==this._normal&&(this._normal.x=this._alt.x,this._normal.y=this._alt.y,this._alt.clearAllMarkers(),this._alt.clear(),this._activeBuffer=this._normal,this._onBufferActivate.fire({activeBuffer:this._normal,inactiveBuffer:this._alt}))}activateAltBuffer(k){this._activeBuffer!==this._alt&&(this._alt.fillViewportRows(k),this._alt.x=this._normal.x,this._alt.y=this._normal.y,this._activeBuffer=this._alt,this._onBufferActivate.fire({activeBuffer:this._alt,inactiveBuffer:this._normal}))}resize(k,A){this._normal.resize(k,A),this._alt.resize(k,A),this.setupTabStops(k)}setupTabStops(k){this._normal.setupTabStops(k),this._alt.setupTabStops(k)}}o.BufferSet=p},511:(h,o,a)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.CellData=void 0;const d=a(482),l=a(643),f=a(3734);class p extends f.AttributeData{constructor(){super(...arguments),this.content=0,this.fg=0,this.bg=0,this.extended=new f.ExtendedAttrs,this.combinedData=""}static fromCharData(k){const A=new p;return A.setFromCharData(k),A}isCombined(){return 2097152&this.content}getWidth(){return this.content>>22}getChars(){return 2097152&this.content?this.combinedData:2097151&this.content?(0,d.stringFromCodePoint)(2097151&this.content):""}getCode(){return this.isCombined()?this.combinedData.charCodeAt(this.combinedData.length-1):2097151&this.content}setFromCharData(k){this.fg=k[l.CHAR_DATA_ATTR_INDEX],this.bg=0;let A=!1;if(k[l.CHAR_DATA_CHAR_INDEX].length>2)A=!0;else if(k[l.CHAR_DATA_CHAR_INDEX].length===2){const w=k[l.CHAR_DATA_CHAR_INDEX].charCodeAt(0);if(55296<=w&&w<=56319){const v=k[l.CHAR_DATA_CHAR_INDEX].charCodeAt(1);56320<=v&&v<=57343?this.content=1024*(w-55296)+v-56320+65536|k[l.CHAR_DATA_WIDTH_INDEX]<<22:A=!0}else A=!0}else this.content=k[l.CHAR_DATA_CHAR_INDEX].charCodeAt(0)|k[l.CHAR_DATA_WIDTH_INDEX]<<22;A&&(this.combinedData=k[l.CHAR_DATA_CHAR_INDEX],this.content=2097152|k[l.CHAR_DATA_WIDTH_INDEX]<<22)}getAsCharData(){return[this.fg,this.getChars(),this.getWidth(),this.getCode()]}}o.CellData=p},643:(h,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.WHITESPACE_CELL_CODE=o.WHITESPACE_CELL_WIDTH=o.WHITESPACE_CELL_CHAR=o.NULL_CELL_CODE=o.NULL_CELL_WIDTH=o.NULL_CELL_CHAR=o.CHAR_DATA_CODE_INDEX=o.CHAR_DATA_WIDTH_INDEX=o.CHAR_DATA_CHAR_INDEX=o.CHAR_DATA_ATTR_INDEX=o.DEFAULT_EXT=o.DEFAULT_ATTR=o.DEFAULT_COLOR=void 0,o.DEFAULT_COLOR=0,o.DEFAULT_ATTR=256|o.DEFAULT_COLOR<<9,o.DEFAULT_EXT=0,o.CHAR_DATA_ATTR_INDEX=0,o.CHAR_DATA_CHAR_INDEX=1,o.CHAR_DATA_WIDTH_INDEX=2,o.CHAR_DATA_CODE_INDEX=3,o.NULL_CELL_CHAR="",o.NULL_CELL_WIDTH=1,o.NULL_CELL_CODE=0,o.WHITESPACE_CELL_CHAR=" ",o.WHITESPACE_CELL_WIDTH=1,o.WHITESPACE_CELL_CODE=32},4863:(h,o,a)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.Marker=void 0;const d=a(8460),l=a(844);class f{get id(){return this._id}constructor(S){this.line=S,this.isDisposed=!1,this._disposables=[],this._id=f._nextId++,this._onDispose=this.register(new d.EventEmitter),this.onDispose=this._onDispose.event}dispose(){this.isDisposed||(this.isDisposed=!0,this.line=-1,this._onDispose.fire(),(0,l.disposeArray)(this._disposables),this._disposables.length=0)}register(S){return this._disposables.push(S),S}}o.Marker=f,f._nextId=1},7116:(h,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.DEFAULT_CHARSET=o.CHARSETS=void 0,o.CHARSETS={},o.DEFAULT_CHARSET=o.CHARSETS.B,o.CHARSETS[0]={"`":"",a:"",b:"",c:"",d:"",e:"",f:"",g:"",h:"",i:"",j:"",k:"",l:"",m:"",n:"",o:"",p:"",q:"",r:"",s:"",t:"",u:"",v:"",w:"",x:"",y:"",z:"","{":"","|":"","}":"","~":""},o.CHARSETS.A={"#":""},o.CHARSETS.B=void 0,o.CHARSETS[4]={"#":"","@":"","[":"ij","\\":"","]":"|","{":"","|":"f","}":"","~":""},o.CHARSETS.C=o.CHARSETS[5]={"[":"","\\":"","]":"","^":"","`":"","{":"","|":"","}":"","~":""},o.CHARSETS.R={"#":"","@":"","[":"","\\":"","]":"","{":"","|":"","}":"","~":""},o.CHARSETS.Q={"@":"","[":"","\\":"","]":"","^":"","`":"","{":"","|":"","}":"","~":""},o.CHARSETS.K={"@":"","[":"","\\":"","]":"","{":"","|":"","}":"","~":""},o.CHARSETS.Y={"#":"","@":"","[":"","\\":"","]":"","`":"","{":"","|":"","}":"","~":""},o.CHARSETS.E=o.CHARSETS[6]={"@":"","[":"","\\":"","]":"","^":"","`":"","{":"","|":"","}":"","~":""},o.CHARSETS.Z={"#":"","@":"","[":"","\\":"","]":"","{":"","|":"","}":""},o.CHARSETS.H=o.CHARSETS[7]={"@":"","[":"","\\":"","]":"","^":"","`":"","{":"","|":"","}":"","~":""},o.CHARSETS["="]={"#":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":""}},2584:(h,o)=>{var a,d,l;Object.defineProperty(o,"__esModule",{value:!0}),o.C1_ESCAPED=o.C1=o.C0=void 0,(function(f){f.NUL="\0",f.SOH="",f.STX="",f.ETX="",f.EOT="",f.ENQ="",f.ACK="",f.BEL="\x07",f.BS="\b",f.HT="	",f.LF=`
`,f.VT="\v",f.FF="\f",f.CR="\r",f.SO="",f.SI="",f.DLE="",f.DC1="",f.DC2="",f.DC3="",f.DC4="",f.NAK="",f.SYN="",f.ETB="",f.CAN="",f.EM="",f.SUB="",f.ESC="\x1B",f.FS="",f.GS="",f.RS="",f.US="",f.SP=" ",f.DEL=""})(a||(o.C0=a={})),(function(f){f.PAD="",f.HOP="",f.BPH="",f.NBH="",f.IND="",f.NEL="",f.SSA="",f.ESA="",f.HTS="",f.HTJ="",f.VTS="",f.PLD="",f.PLU="",f.RI="",f.SS2="",f.SS3="",f.DCS="",f.PU1="",f.PU2="",f.STS="",f.CCH="",f.MW="",f.SPA="",f.EPA="",f.SOS="",f.SGCI="",f.SCI="",f.CSI="",f.ST="",f.OSC="",f.PM="",f.APC=""})(d||(o.C1=d={})),(function(f){f.ST=`${a.ESC}\\`})(l||(o.C1_ESCAPED=l={}))},7399:(h,o,a)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.evaluateKeyboardEvent=void 0;const d=a(2584),l={48:["0",")"],49:["1","!"],50:["2","@"],51:["3","#"],52:["4","$"],53:["5","%"],54:["6","^"],55:["7","&"],56:["8","*"],57:["9","("],186:[";",":"],187:["=","+"],188:[",","<"],189:["-","_"],190:[".",">"],191:["/","?"],192:["`","~"],219:["[","{"],220:["\\","|"],221:["]","}"],222:["'",'"']};o.evaluateKeyboardEvent=function(f,p,S,k){const A={type:0,cancel:!1,key:void 0},w=(f.shiftKey?1:0)|(f.altKey?2:0)|(f.ctrlKey?4:0)|(f.metaKey?8:0);switch(f.keyCode){case 0:f.key==="UIKeyInputUpArrow"?A.key=p?d.C0.ESC+"OA":d.C0.ESC+"[A":f.key==="UIKeyInputLeftArrow"?A.key=p?d.C0.ESC+"OD":d.C0.ESC+"[D":f.key==="UIKeyInputRightArrow"?A.key=p?d.C0.ESC+"OC":d.C0.ESC+"[C":f.key==="UIKeyInputDownArrow"&&(A.key=p?d.C0.ESC+"OB":d.C0.ESC+"[B");break;case 8:A.key=f.ctrlKey?"\b":d.C0.DEL,f.altKey&&(A.key=d.C0.ESC+A.key);break;case 9:if(f.shiftKey){A.key=d.C0.ESC+"[Z";break}A.key=d.C0.HT,A.cancel=!0;break;case 13:A.key=f.altKey?d.C0.ESC+d.C0.CR:d.C0.CR,A.cancel=!0;break;case 27:A.key=d.C0.ESC,f.altKey&&(A.key=d.C0.ESC+d.C0.ESC),A.cancel=!0;break;case 37:if(f.metaKey)break;w?(A.key=d.C0.ESC+"[1;"+(w+1)+"D",A.key===d.C0.ESC+"[1;3D"&&(A.key=d.C0.ESC+(S?"b":"[1;5D"))):A.key=p?d.C0.ESC+"OD":d.C0.ESC+"[D";break;case 39:if(f.metaKey)break;w?(A.key=d.C0.ESC+"[1;"+(w+1)+"C",A.key===d.C0.ESC+"[1;3C"&&(A.key=d.C0.ESC+(S?"f":"[1;5C"))):A.key=p?d.C0.ESC+"OC":d.C0.ESC+"[C";break;case 38:if(f.metaKey)break;w?(A.key=d.C0.ESC+"[1;"+(w+1)+"A",S||A.key!==d.C0.ESC+"[1;3A"||(A.key=d.C0.ESC+"[1;5A")):A.key=p?d.C0.ESC+"OA":d.C0.ESC+"[A";break;case 40:if(f.metaKey)break;w?(A.key=d.C0.ESC+"[1;"+(w+1)+"B",S||A.key!==d.C0.ESC+"[1;3B"||(A.key=d.C0.ESC+"[1;5B")):A.key=p?d.C0.ESC+"OB":d.C0.ESC+"[B";break;case 45:f.shiftKey||f.ctrlKey||(A.key=d.C0.ESC+"[2~");break;case 46:A.key=w?d.C0.ESC+"[3;"+(w+1)+"~":d.C0.ESC+"[3~";break;case 36:A.key=w?d.C0.ESC+"[1;"+(w+1)+"H":p?d.C0.ESC+"OH":d.C0.ESC+"[H";break;case 35:A.key=w?d.C0.ESC+"[1;"+(w+1)+"F":p?d.C0.ESC+"OF":d.C0.ESC+"[F";break;case 33:f.shiftKey?A.type=2:f.ctrlKey?A.key=d.C0.ESC+"[5;"+(w+1)+"~":A.key=d.C0.ESC+"[5~";break;case 34:f.shiftKey?A.type=3:f.ctrlKey?A.key=d.C0.ESC+"[6;"+(w+1)+"~":A.key=d.C0.ESC+"[6~";break;case 112:A.key=w?d.C0.ESC+"[1;"+(w+1)+"P":d.C0.ESC+"OP";break;case 113:A.key=w?d.C0.ESC+"[1;"+(w+1)+"Q":d.C0.ESC+"OQ";break;case 114:A.key=w?d.C0.ESC+"[1;"+(w+1)+"R":d.C0.ESC+"OR";break;case 115:A.key=w?d.C0.ESC+"[1;"+(w+1)+"S":d.C0.ESC+"OS";break;case 116:A.key=w?d.C0.ESC+"[15;"+(w+1)+"~":d.C0.ESC+"[15~";break;case 117:A.key=w?d.C0.ESC+"[17;"+(w+1)+"~":d.C0.ESC+"[17~";break;case 118:A.key=w?d.C0.ESC+"[18;"+(w+1)+"~":d.C0.ESC+"[18~";break;case 119:A.key=w?d.C0.ESC+"[19;"+(w+1)+"~":d.C0.ESC+"[19~";break;case 120:A.key=w?d.C0.ESC+"[20;"+(w+1)+"~":d.C0.ESC+"[20~";break;case 121:A.key=w?d.C0.ESC+"[21;"+(w+1)+"~":d.C0.ESC+"[21~";break;case 122:A.key=w?d.C0.ESC+"[23;"+(w+1)+"~":d.C0.ESC+"[23~";break;case 123:A.key=w?d.C0.ESC+"[24;"+(w+1)+"~":d.C0.ESC+"[24~";break;default:if(!f.ctrlKey||f.shiftKey||f.altKey||f.metaKey)if(S&&!k||!f.altKey||f.metaKey)!S||f.altKey||f.ctrlKey||f.shiftKey||!f.metaKey?f.key&&!f.ctrlKey&&!f.altKey&&!f.metaKey&&f.keyCode>=48&&f.key.length===1?A.key=f.key:f.key&&f.ctrlKey&&(f.key==="_"&&(A.key=d.C0.US),f.key==="@"&&(A.key=d.C0.NUL)):f.keyCode===65&&(A.type=1);else{const v=l[f.keyCode],g=v?.[f.shiftKey?1:0];if(g)A.key=d.C0.ESC+g;else if(f.keyCode>=65&&f.keyCode<=90){const m=f.ctrlKey?f.keyCode-64:f.keyCode+32;let $=String.fromCharCode(m);f.shiftKey&&($=$.toUpperCase()),A.key=d.C0.ESC+$}else if(f.keyCode===32)A.key=d.C0.ESC+(f.ctrlKey?d.C0.NUL:" ");else if(f.key==="Dead"&&f.code.startsWith("Key")){let m=f.code.slice(3,4);f.shiftKey||(m=m.toLowerCase()),A.key=d.C0.ESC+m,A.cancel=!0}}else f.keyCode>=65&&f.keyCode<=90?A.key=String.fromCharCode(f.keyCode-64):f.keyCode===32?A.key=d.C0.NUL:f.keyCode>=51&&f.keyCode<=55?A.key=String.fromCharCode(f.keyCode-51+27):f.keyCode===56?A.key=d.C0.DEL:f.keyCode===219?A.key=d.C0.ESC:f.keyCode===220?A.key=d.C0.FS:f.keyCode===221&&(A.key=d.C0.GS)}return A}},482:(h,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.Utf8ToUtf32=o.StringToUtf32=o.utf32ToString=o.stringFromCodePoint=void 0,o.stringFromCodePoint=function(a){return a>65535?(a-=65536,String.fromCharCode(55296+(a>>10))+String.fromCharCode(a%1024+56320)):String.fromCharCode(a)},o.utf32ToString=function(a,d=0,l=a.length){let f="";for(let p=d;p<l;++p){let S=a[p];S>65535?(S-=65536,f+=String.fromCharCode(55296+(S>>10))+String.fromCharCode(S%1024+56320)):f+=String.fromCharCode(S)}return f},o.StringToUtf32=class{constructor(){this._interim=0}clear(){this._interim=0}decode(a,d){const l=a.length;if(!l)return 0;let f=0,p=0;if(this._interim){const S=a.charCodeAt(p++);56320<=S&&S<=57343?d[f++]=1024*(this._interim-55296)+S-56320+65536:(d[f++]=this._interim,d[f++]=S),this._interim=0}for(let S=p;S<l;++S){const k=a.charCodeAt(S);if(55296<=k&&k<=56319){if(++S>=l)return this._interim=k,f;const A=a.charCodeAt(S);56320<=A&&A<=57343?d[f++]=1024*(k-55296)+A-56320+65536:(d[f++]=k,d[f++]=A)}else k!==65279&&(d[f++]=k)}return f}},o.Utf8ToUtf32=class{constructor(){this.interim=new Uint8Array(3)}clear(){this.interim.fill(0)}decode(a,d){const l=a.length;if(!l)return 0;let f,p,S,k,A=0,w=0,v=0;if(this.interim[0]){let $=!1,I=this.interim[0];I&=(224&I)==192?31:(240&I)==224?15:7;let B,P=0;for(;(B=63&this.interim[++P])&&P<4;)I<<=6,I|=B;const x=(224&this.interim[0])==192?2:(240&this.interim[0])==224?3:4,N=x-P;for(;v<N;){if(v>=l)return 0;if(B=a[v++],(192&B)!=128){v--,$=!0;break}this.interim[P++]=B,I<<=6,I|=63&B}$||(x===2?I<128?v--:d[A++]=I:x===3?I<2048||I>=55296&&I<=57343||I===65279||(d[A++]=I):I<65536||I>1114111||(d[A++]=I)),this.interim.fill(0)}const g=l-4;let m=v;for(;m<l;){for(;!(!(m<g)||128&(f=a[m])||128&(p=a[m+1])||128&(S=a[m+2])||128&(k=a[m+3]));)d[A++]=f,d[A++]=p,d[A++]=S,d[A++]=k,m+=4;if(f=a[m++],f<128)d[A++]=f;else if((224&f)==192){if(m>=l)return this.interim[0]=f,A;if(p=a[m++],(192&p)!=128){m--;continue}if(w=(31&f)<<6|63&p,w<128){m--;continue}d[A++]=w}else if((240&f)==224){if(m>=l)return this.interim[0]=f,A;if(p=a[m++],(192&p)!=128){m--;continue}if(m>=l)return this.interim[0]=f,this.interim[1]=p,A;if(S=a[m++],(192&S)!=128){m--;continue}if(w=(15&f)<<12|(63&p)<<6|63&S,w<2048||w>=55296&&w<=57343||w===65279)continue;d[A++]=w}else if((248&f)==240){if(m>=l)return this.interim[0]=f,A;if(p=a[m++],(192&p)!=128){m--;continue}if(m>=l)return this.interim[0]=f,this.interim[1]=p,A;if(S=a[m++],(192&S)!=128){m--;continue}if(m>=l)return this.interim[0]=f,this.interim[1]=p,this.interim[2]=S,A;if(k=a[m++],(192&k)!=128){m--;continue}if(w=(7&f)<<18|(63&p)<<12|(63&S)<<6|63&k,w<65536||w>1114111)continue;d[A++]=w}}return A}}},225:(h,o,a)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.UnicodeV6=void 0;const d=a(1480),l=[[768,879],[1155,1158],[1160,1161],[1425,1469],[1471,1471],[1473,1474],[1476,1477],[1479,1479],[1536,1539],[1552,1557],[1611,1630],[1648,1648],[1750,1764],[1767,1768],[1770,1773],[1807,1807],[1809,1809],[1840,1866],[1958,1968],[2027,2035],[2305,2306],[2364,2364],[2369,2376],[2381,2381],[2385,2388],[2402,2403],[2433,2433],[2492,2492],[2497,2500],[2509,2509],[2530,2531],[2561,2562],[2620,2620],[2625,2626],[2631,2632],[2635,2637],[2672,2673],[2689,2690],[2748,2748],[2753,2757],[2759,2760],[2765,2765],[2786,2787],[2817,2817],[2876,2876],[2879,2879],[2881,2883],[2893,2893],[2902,2902],[2946,2946],[3008,3008],[3021,3021],[3134,3136],[3142,3144],[3146,3149],[3157,3158],[3260,3260],[3263,3263],[3270,3270],[3276,3277],[3298,3299],[3393,3395],[3405,3405],[3530,3530],[3538,3540],[3542,3542],[3633,3633],[3636,3642],[3655,3662],[3761,3761],[3764,3769],[3771,3772],[3784,3789],[3864,3865],[3893,3893],[3895,3895],[3897,3897],[3953,3966],[3968,3972],[3974,3975],[3984,3991],[3993,4028],[4038,4038],[4141,4144],[4146,4146],[4150,4151],[4153,4153],[4184,4185],[4448,4607],[4959,4959],[5906,5908],[5938,5940],[5970,5971],[6002,6003],[6068,6069],[6071,6077],[6086,6086],[6089,6099],[6109,6109],[6155,6157],[6313,6313],[6432,6434],[6439,6440],[6450,6450],[6457,6459],[6679,6680],[6912,6915],[6964,6964],[6966,6970],[6972,6972],[6978,6978],[7019,7027],[7616,7626],[7678,7679],[8203,8207],[8234,8238],[8288,8291],[8298,8303],[8400,8431],[12330,12335],[12441,12442],[43014,43014],[43019,43019],[43045,43046],[64286,64286],[65024,65039],[65056,65059],[65279,65279],[65529,65531]],f=[[68097,68099],[68101,68102],[68108,68111],[68152,68154],[68159,68159],[119143,119145],[119155,119170],[119173,119179],[119210,119213],[119362,119364],[917505,917505],[917536,917631],[917760,917999]];let p;o.UnicodeV6=class{constructor(){if(this.version="6",!p){p=new Uint8Array(65536),p.fill(1),p[0]=0,p.fill(0,1,32),p.fill(0,127,160),p.fill(2,4352,4448),p[9001]=2,p[9002]=2,p.fill(2,11904,42192),p[12351]=1,p.fill(2,44032,55204),p.fill(2,63744,64256),p.fill(2,65040,65050),p.fill(2,65072,65136),p.fill(2,65280,65377),p.fill(2,65504,65511);for(let S=0;S<l.length;++S)p.fill(0,l[S][0],l[S][1]+1)}}wcwidth(S){return S<32?0:S<127?1:S<65536?p[S]:(function(k,A){let w,v=0,g=A.length-1;if(k<A[0][0]||k>A[g][1])return!1;for(;g>=v;)if(w=v+g>>1,k>A[w][1])v=w+1;else{if(!(k<A[w][0]))return!0;g=w-1}return!1})(S,f)?0:S>=131072&&S<=196605||S>=196608&&S<=262141?2:1}charProperties(S,k){let A=this.wcwidth(S),w=A===0&&k!==0;if(w){const v=d.UnicodeService.extractWidth(k);v===0?w=!1:v>A&&(A=v)}return d.UnicodeService.createPropertyValue(0,A,w)}}},5981:(h,o,a)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.WriteBuffer=void 0;const d=a(8460),l=a(844);class f extends l.Disposable{constructor(S){super(),this._action=S,this._writeBuffer=[],this._callbacks=[],this._pendingData=0,this._bufferOffset=0,this._isSyncWriting=!1,this._syncCalls=0,this._didUserInput=!1,this._onWriteParsed=this.register(new d.EventEmitter),this.onWriteParsed=this._onWriteParsed.event}handleUserInput(){this._didUserInput=!0}writeSync(S,k){if(k!==void 0&&this._syncCalls>k)return void(this._syncCalls=0);if(this._pendingData+=S.length,this._writeBuffer.push(S),this._callbacks.push(void 0),this._syncCalls++,this._isSyncWriting)return;let A;for(this._isSyncWriting=!0;A=this._writeBuffer.shift();){this._action(A);const w=this._callbacks.shift();w&&w()}this._pendingData=0,this._bufferOffset=2147483647,this._isSyncWriting=!1,this._syncCalls=0}write(S,k){if(this._pendingData>5e7)throw new Error("write data discarded, use flow control to avoid losing data");if(!this._writeBuffer.length){if(this._bufferOffset=0,this._didUserInput)return this._didUserInput=!1,this._pendingData+=S.length,this._writeBuffer.push(S),this._callbacks.push(k),void this._innerWrite();setTimeout((()=>this._innerWrite()))}this._pendingData+=S.length,this._writeBuffer.push(S),this._callbacks.push(k)}_innerWrite(S=0,k=!0){const A=S||Date.now();for(;this._writeBuffer.length>this._bufferOffset;){const w=this._writeBuffer[this._bufferOffset],v=this._action(w,k);if(v){const m=$=>Date.now()-A>=12?setTimeout((()=>this._innerWrite(0,$))):this._innerWrite(A,$);return void v.catch(($=>(queueMicrotask((()=>{throw $})),Promise.resolve(!1)))).then(m)}const g=this._callbacks[this._bufferOffset];if(g&&g(),this._bufferOffset++,this._pendingData-=w.length,Date.now()-A>=12)break}this._writeBuffer.length>this._bufferOffset?(this._bufferOffset>50&&(this._writeBuffer=this._writeBuffer.slice(this._bufferOffset),this._callbacks=this._callbacks.slice(this._bufferOffset),this._bufferOffset=0),setTimeout((()=>this._innerWrite()))):(this._writeBuffer.length=0,this._callbacks.length=0,this._pendingData=0,this._bufferOffset=0),this._onWriteParsed.fire()}}o.WriteBuffer=f},5941:(h,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.toRgbString=o.parseColor=void 0;const a=/^([\da-f])\/([\da-f])\/([\da-f])$|^([\da-f]{2})\/([\da-f]{2})\/([\da-f]{2})$|^([\da-f]{3})\/([\da-f]{3})\/([\da-f]{3})$|^([\da-f]{4})\/([\da-f]{4})\/([\da-f]{4})$/,d=/^[\da-f]+$/;function l(f,p){const S=f.toString(16),k=S.length<2?"0"+S:S;switch(p){case 4:return S[0];case 8:return k;case 12:return(k+k).slice(0,3);default:return k+k}}o.parseColor=function(f){if(!f)return;let p=f.toLowerCase();if(p.indexOf("rgb:")===0){p=p.slice(4);const S=a.exec(p);if(S){const k=S[1]?15:S[4]?255:S[7]?4095:65535;return[Math.round(parseInt(S[1]||S[4]||S[7]||S[10],16)/k*255),Math.round(parseInt(S[2]||S[5]||S[8]||S[11],16)/k*255),Math.round(parseInt(S[3]||S[6]||S[9]||S[12],16)/k*255)]}}else if(p.indexOf("#")===0&&(p=p.slice(1),d.exec(p)&&[3,6,9,12].includes(p.length))){const S=p.length/3,k=[0,0,0];for(let A=0;A<3;++A){const w=parseInt(p.slice(S*A,S*A+S),16);k[A]=S===1?w<<4:S===2?w:S===3?w>>4:w>>8}return k}},o.toRgbString=function(f,p=16){const[S,k,A]=f;return`rgb:${l(S,p)}/${l(k,p)}/${l(A,p)}`}},5770:(h,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.PAYLOAD_LIMIT=void 0,o.PAYLOAD_LIMIT=1e7},6351:(h,o,a)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.DcsHandler=o.DcsParser=void 0;const d=a(482),l=a(8742),f=a(5770),p=[];o.DcsParser=class{constructor(){this._handlers=Object.create(null),this._active=p,this._ident=0,this._handlerFb=()=>{},this._stack={paused:!1,loopPosition:0,fallThrough:!1}}dispose(){this._handlers=Object.create(null),this._handlerFb=()=>{},this._active=p}registerHandler(k,A){this._handlers[k]===void 0&&(this._handlers[k]=[]);const w=this._handlers[k];return w.push(A),{dispose:()=>{const v=w.indexOf(A);v!==-1&&w.splice(v,1)}}}clearHandler(k){this._handlers[k]&&delete this._handlers[k]}setHandlerFallback(k){this._handlerFb=k}reset(){if(this._active.length)for(let k=this._stack.paused?this._stack.loopPosition-1:this._active.length-1;k>=0;--k)this._active[k].unhook(!1);this._stack.paused=!1,this._active=p,this._ident=0}hook(k,A){if(this.reset(),this._ident=k,this._active=this._handlers[k]||p,this._active.length)for(let w=this._active.length-1;w>=0;w--)this._active[w].hook(A);else this._handlerFb(this._ident,"HOOK",A)}put(k,A,w){if(this._active.length)for(let v=this._active.length-1;v>=0;v--)this._active[v].put(k,A,w);else this._handlerFb(this._ident,"PUT",(0,d.utf32ToString)(k,A,w))}unhook(k,A=!0){if(this._active.length){let w=!1,v=this._active.length-1,g=!1;if(this._stack.paused&&(v=this._stack.loopPosition-1,w=A,g=this._stack.fallThrough,this._stack.paused=!1),!g&&w===!1){for(;v>=0&&(w=this._active[v].unhook(k),w!==!0);v--)if(w instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=v,this._stack.fallThrough=!1,w;v--}for(;v>=0;v--)if(w=this._active[v].unhook(!1),w instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=v,this._stack.fallThrough=!0,w}else this._handlerFb(this._ident,"UNHOOK",k);this._active=p,this._ident=0}};const S=new l.Params;S.addParam(0),o.DcsHandler=class{constructor(k){this._handler=k,this._data="",this._params=S,this._hitLimit=!1}hook(k){this._params=k.length>1||k.params[0]?k.clone():S,this._data="",this._hitLimit=!1}put(k,A,w){this._hitLimit||(this._data+=(0,d.utf32ToString)(k,A,w),this._data.length>f.PAYLOAD_LIMIT&&(this._data="",this._hitLimit=!0))}unhook(k){let A=!1;if(this._hitLimit)A=!1;else if(k&&(A=this._handler(this._data,this._params),A instanceof Promise))return A.then((w=>(this._params=S,this._data="",this._hitLimit=!1,w)));return this._params=S,this._data="",this._hitLimit=!1,A}}},2015:(h,o,a)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.EscapeSequenceParser=o.VT500_TRANSITION_TABLE=o.TransitionTable=void 0;const d=a(844),l=a(8742),f=a(6242),p=a(6351);class S{constructor(v){this.table=new Uint8Array(v)}setDefault(v,g){this.table.fill(v<<4|g)}add(v,g,m,$){this.table[g<<8|v]=m<<4|$}addMany(v,g,m,$){for(let I=0;I<v.length;I++)this.table[g<<8|v[I]]=m<<4|$}}o.TransitionTable=S;const k=160;o.VT500_TRANSITION_TABLE=(function(){const w=new S(4095),v=Array.apply(null,Array(256)).map(((P,x)=>x)),g=(P,x)=>v.slice(P,x),m=g(32,127),$=g(0,24);$.push(25),$.push.apply($,g(28,32));const I=g(0,14);let B;for(B in w.setDefault(1,0),w.addMany(m,0,2,0),I)w.addMany([24,26,153,154],B,3,0),w.addMany(g(128,144),B,3,0),w.addMany(g(144,152),B,3,0),w.add(156,B,0,0),w.add(27,B,11,1),w.add(157,B,4,8),w.addMany([152,158,159],B,0,7),w.add(155,B,11,3),w.add(144,B,11,9);return w.addMany($,0,3,0),w.addMany($,1,3,1),w.add(127,1,0,1),w.addMany($,8,0,8),w.addMany($,3,3,3),w.add(127,3,0,3),w.addMany($,4,3,4),w.add(127,4,0,4),w.addMany($,6,3,6),w.addMany($,5,3,5),w.add(127,5,0,5),w.addMany($,2,3,2),w.add(127,2,0,2),w.add(93,1,4,8),w.addMany(m,8,5,8),w.add(127,8,5,8),w.addMany([156,27,24,26,7],8,6,0),w.addMany(g(28,32),8,0,8),w.addMany([88,94,95],1,0,7),w.addMany(m,7,0,7),w.addMany($,7,0,7),w.add(156,7,0,0),w.add(127,7,0,7),w.add(91,1,11,3),w.addMany(g(64,127),3,7,0),w.addMany(g(48,60),3,8,4),w.addMany([60,61,62,63],3,9,4),w.addMany(g(48,60),4,8,4),w.addMany(g(64,127),4,7,0),w.addMany([60,61,62,63],4,0,6),w.addMany(g(32,64),6,0,6),w.add(127,6,0,6),w.addMany(g(64,127),6,0,0),w.addMany(g(32,48),3,9,5),w.addMany(g(32,48),5,9,5),w.addMany(g(48,64),5,0,6),w.addMany(g(64,127),5,7,0),w.addMany(g(32,48),4,9,5),w.addMany(g(32,48),1,9,2),w.addMany(g(32,48),2,9,2),w.addMany(g(48,127),2,10,0),w.addMany(g(48,80),1,10,0),w.addMany(g(81,88),1,10,0),w.addMany([89,90,92],1,10,0),w.addMany(g(96,127),1,10,0),w.add(80,1,11,9),w.addMany($,9,0,9),w.add(127,9,0,9),w.addMany(g(28,32),9,0,9),w.addMany(g(32,48),9,9,12),w.addMany(g(48,60),9,8,10),w.addMany([60,61,62,63],9,9,10),w.addMany($,11,0,11),w.addMany(g(32,128),11,0,11),w.addMany(g(28,32),11,0,11),w.addMany($,10,0,10),w.add(127,10,0,10),w.addMany(g(28,32),10,0,10),w.addMany(g(48,60),10,8,10),w.addMany([60,61,62,63],10,0,11),w.addMany(g(32,48),10,9,12),w.addMany($,12,0,12),w.add(127,12,0,12),w.addMany(g(28,32),12,0,12),w.addMany(g(32,48),12,9,12),w.addMany(g(48,64),12,0,11),w.addMany(g(64,127),12,12,13),w.addMany(g(64,127),10,12,13),w.addMany(g(64,127),9,12,13),w.addMany($,13,13,13),w.addMany(m,13,13,13),w.add(127,13,0,13),w.addMany([27,156,24,26],13,14,0),w.add(k,0,2,0),w.add(k,8,5,8),w.add(k,6,0,6),w.add(k,11,0,11),w.add(k,13,13,13),w})();class A extends d.Disposable{constructor(v=o.VT500_TRANSITION_TABLE){super(),this._transitions=v,this._parseStack={state:0,handlers:[],handlerPos:0,transition:0,chunkPos:0},this.initialState=0,this.currentState=this.initialState,this._params=new l.Params,this._params.addParam(0),this._collect=0,this.precedingJoinState=0,this._printHandlerFb=(g,m,$)=>{},this._executeHandlerFb=g=>{},this._csiHandlerFb=(g,m)=>{},this._escHandlerFb=g=>{},this._errorHandlerFb=g=>g,this._printHandler=this._printHandlerFb,this._executeHandlers=Object.create(null),this._csiHandlers=Object.create(null),this._escHandlers=Object.create(null),this.register((0,d.toDisposable)((()=>{this._csiHandlers=Object.create(null),this._executeHandlers=Object.create(null),this._escHandlers=Object.create(null)}))),this._oscParser=this.register(new f.OscParser),this._dcsParser=this.register(new p.DcsParser),this._errorHandler=this._errorHandlerFb,this.registerEscHandler({final:"\\"},(()=>!0))}_identifier(v,g=[64,126]){let m=0;if(v.prefix){if(v.prefix.length>1)throw new Error("only one byte as prefix supported");if(m=v.prefix.charCodeAt(0),m&&60>m||m>63)throw new Error("prefix must be in range 0x3c .. 0x3f")}if(v.intermediates){if(v.intermediates.length>2)throw new Error("only two bytes as intermediates are supported");for(let I=0;I<v.intermediates.length;++I){const B=v.intermediates.charCodeAt(I);if(32>B||B>47)throw new Error("intermediate must be in range 0x20 .. 0x2f");m<<=8,m|=B}}if(v.final.length!==1)throw new Error("final must be a single byte");const $=v.final.charCodeAt(0);if(g[0]>$||$>g[1])throw new Error(`final must be in range ${g[0]} .. ${g[1]}`);return m<<=8,m|=$,m}identToString(v){const g=[];for(;v;)g.push(String.fromCharCode(255&v)),v>>=8;return g.reverse().join("")}setPrintHandler(v){this._printHandler=v}clearPrintHandler(){this._printHandler=this._printHandlerFb}registerEscHandler(v,g){const m=this._identifier(v,[48,126]);this._escHandlers[m]===void 0&&(this._escHandlers[m]=[]);const $=this._escHandlers[m];return $.push(g),{dispose:()=>{const I=$.indexOf(g);I!==-1&&$.splice(I,1)}}}clearEscHandler(v){this._escHandlers[this._identifier(v,[48,126])]&&delete this._escHandlers[this._identifier(v,[48,126])]}setEscHandlerFallback(v){this._escHandlerFb=v}setExecuteHandler(v,g){this._executeHandlers[v.charCodeAt(0)]=g}clearExecuteHandler(v){this._executeHandlers[v.charCodeAt(0)]&&delete this._executeHandlers[v.charCodeAt(0)]}setExecuteHandlerFallback(v){this._executeHandlerFb=v}registerCsiHandler(v,g){const m=this._identifier(v);this._csiHandlers[m]===void 0&&(this._csiHandlers[m]=[]);const $=this._csiHandlers[m];return $.push(g),{dispose:()=>{const I=$.indexOf(g);I!==-1&&$.splice(I,1)}}}clearCsiHandler(v){this._csiHandlers[this._identifier(v)]&&delete this._csiHandlers[this._identifier(v)]}setCsiHandlerFallback(v){this._csiHandlerFb=v}registerDcsHandler(v,g){return this._dcsParser.registerHandler(this._identifier(v),g)}clearDcsHandler(v){this._dcsParser.clearHandler(this._identifier(v))}setDcsHandlerFallback(v){this._dcsParser.setHandlerFallback(v)}registerOscHandler(v,g){return this._oscParser.registerHandler(v,g)}clearOscHandler(v){this._oscParser.clearHandler(v)}setOscHandlerFallback(v){this._oscParser.setHandlerFallback(v)}setErrorHandler(v){this._errorHandler=v}clearErrorHandler(){this._errorHandler=this._errorHandlerFb}reset(){this.currentState=this.initialState,this._oscParser.reset(),this._dcsParser.reset(),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingJoinState=0,this._parseStack.state!==0&&(this._parseStack.state=2,this._parseStack.handlers=[])}_preserveStack(v,g,m,$,I){this._parseStack.state=v,this._parseStack.handlers=g,this._parseStack.handlerPos=m,this._parseStack.transition=$,this._parseStack.chunkPos=I}parse(v,g,m){let $,I=0,B=0,P=0;if(this._parseStack.state)if(this._parseStack.state===2)this._parseStack.state=0,P=this._parseStack.chunkPos+1;else{if(m===void 0||this._parseStack.state===1)throw this._parseStack.state=1,new Error("improper continuation due to previous async handler, giving up parsing");const x=this._parseStack.handlers;let N=this._parseStack.handlerPos-1;switch(this._parseStack.state){case 3:if(m===!1&&N>-1){for(;N>=0&&($=x[N](this._params),$!==!0);N--)if($ instanceof Promise)return this._parseStack.handlerPos=N,$}this._parseStack.handlers=[];break;case 4:if(m===!1&&N>-1){for(;N>=0&&($=x[N](),$!==!0);N--)if($ instanceof Promise)return this._parseStack.handlerPos=N,$}this._parseStack.handlers=[];break;case 6:if(I=v[this._parseStack.chunkPos],$=this._dcsParser.unhook(I!==24&&I!==26,m),$)return $;I===27&&(this._parseStack.transition|=1),this._params.reset(),this._params.addParam(0),this._collect=0;break;case 5:if(I=v[this._parseStack.chunkPos],$=this._oscParser.end(I!==24&&I!==26,m),$)return $;I===27&&(this._parseStack.transition|=1),this._params.reset(),this._params.addParam(0),this._collect=0}this._parseStack.state=0,P=this._parseStack.chunkPos+1,this.precedingJoinState=0,this.currentState=15&this._parseStack.transition}for(let x=P;x<g;++x){switch(I=v[x],B=this._transitions.table[this.currentState<<8|(I<160?I:k)],B>>4){case 2:for(let Y=x+1;;++Y){if(Y>=g||(I=v[Y])<32||I>126&&I<k){this._printHandler(v,x,Y),x=Y-1;break}if(++Y>=g||(I=v[Y])<32||I>126&&I<k){this._printHandler(v,x,Y),x=Y-1;break}if(++Y>=g||(I=v[Y])<32||I>126&&I<k){this._printHandler(v,x,Y),x=Y-1;break}if(++Y>=g||(I=v[Y])<32||I>126&&I<k){this._printHandler(v,x,Y),x=Y-1;break}}break;case 3:this._executeHandlers[I]?this._executeHandlers[I]():this._executeHandlerFb(I),this.precedingJoinState=0;break;case 0:break;case 1:if(this._errorHandler({position:x,code:I,currentState:this.currentState,collect:this._collect,params:this._params,abort:!1}).abort)return;break;case 7:const N=this._csiHandlers[this._collect<<8|I];let J=N?N.length-1:-1;for(;J>=0&&($=N[J](this._params),$!==!0);J--)if($ instanceof Promise)return this._preserveStack(3,N,J,B,x),$;J<0&&this._csiHandlerFb(this._collect<<8|I,this._params),this.precedingJoinState=0;break;case 8:do switch(I){case 59:this._params.addParam(0);break;case 58:this._params.addSubParam(-1);break;default:this._params.addDigit(I-48)}while(++x<g&&(I=v[x])>47&&I<60);x--;break;case 9:this._collect<<=8,this._collect|=I;break;case 10:const Q=this._escHandlers[this._collect<<8|I];let W=Q?Q.length-1:-1;for(;W>=0&&($=Q[W](),$!==!0);W--)if($ instanceof Promise)return this._preserveStack(4,Q,W,B,x),$;W<0&&this._escHandlerFb(this._collect<<8|I),this.precedingJoinState=0;break;case 11:this._params.reset(),this._params.addParam(0),this._collect=0;break;case 12:this._dcsParser.hook(this._collect<<8|I,this._params);break;case 13:for(let Y=x+1;;++Y)if(Y>=g||(I=v[Y])===24||I===26||I===27||I>127&&I<k){this._dcsParser.put(v,x,Y),x=Y-1;break}break;case 14:if($=this._dcsParser.unhook(I!==24&&I!==26),$)return this._preserveStack(6,[],0,B,x),$;I===27&&(B|=1),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingJoinState=0;break;case 4:this._oscParser.start();break;case 5:for(let Y=x+1;;Y++)if(Y>=g||(I=v[Y])<32||I>127&&I<k){this._oscParser.put(v,x,Y),x=Y-1;break}break;case 6:if($=this._oscParser.end(I!==24&&I!==26),$)return this._preserveStack(5,[],0,B,x),$;I===27&&(B|=1),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingJoinState=0}this.currentState=15&B}}}o.EscapeSequenceParser=A},6242:(h,o,a)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.OscHandler=o.OscParser=void 0;const d=a(5770),l=a(482),f=[];o.OscParser=class{constructor(){this._state=0,this._active=f,this._id=-1,this._handlers=Object.create(null),this._handlerFb=()=>{},this._stack={paused:!1,loopPosition:0,fallThrough:!1}}registerHandler(p,S){this._handlers[p]===void 0&&(this._handlers[p]=[]);const k=this._handlers[p];return k.push(S),{dispose:()=>{const A=k.indexOf(S);A!==-1&&k.splice(A,1)}}}clearHandler(p){this._handlers[p]&&delete this._handlers[p]}setHandlerFallback(p){this._handlerFb=p}dispose(){this._handlers=Object.create(null),this._handlerFb=()=>{},this._active=f}reset(){if(this._state===2)for(let p=this._stack.paused?this._stack.loopPosition-1:this._active.length-1;p>=0;--p)this._active[p].end(!1);this._stack.paused=!1,this._active=f,this._id=-1,this._state=0}_start(){if(this._active=this._handlers[this._id]||f,this._active.length)for(let p=this._active.length-1;p>=0;p--)this._active[p].start();else this._handlerFb(this._id,"START")}_put(p,S,k){if(this._active.length)for(let A=this._active.length-1;A>=0;A--)this._active[A].put(p,S,k);else this._handlerFb(this._id,"PUT",(0,l.utf32ToString)(p,S,k))}start(){this.reset(),this._state=1}put(p,S,k){if(this._state!==3){if(this._state===1)for(;S<k;){const A=p[S++];if(A===59){this._state=2,this._start();break}if(A<48||57<A)return void(this._state=3);this._id===-1&&(this._id=0),this._id=10*this._id+A-48}this._state===2&&k-S>0&&this._put(p,S,k)}}end(p,S=!0){if(this._state!==0){if(this._state!==3)if(this._state===1&&this._start(),this._active.length){let k=!1,A=this._active.length-1,w=!1;if(this._stack.paused&&(A=this._stack.loopPosition-1,k=S,w=this._stack.fallThrough,this._stack.paused=!1),!w&&k===!1){for(;A>=0&&(k=this._active[A].end(p),k!==!0);A--)if(k instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=A,this._stack.fallThrough=!1,k;A--}for(;A>=0;A--)if(k=this._active[A].end(!1),k instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=A,this._stack.fallThrough=!0,k}else this._handlerFb(this._id,"END",p);this._active=f,this._id=-1,this._state=0}}},o.OscHandler=class{constructor(p){this._handler=p,this._data="",this._hitLimit=!1}start(){this._data="",this._hitLimit=!1}put(p,S,k){this._hitLimit||(this._data+=(0,l.utf32ToString)(p,S,k),this._data.length>d.PAYLOAD_LIMIT&&(this._data="",this._hitLimit=!0))}end(p){let S=!1;if(this._hitLimit)S=!1;else if(p&&(S=this._handler(this._data),S instanceof Promise))return S.then((k=>(this._data="",this._hitLimit=!1,k)));return this._data="",this._hitLimit=!1,S}}},8742:(h,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.Params=void 0;const a=2147483647;class d{static fromArray(f){const p=new d;if(!f.length)return p;for(let S=Array.isArray(f[0])?1:0;S<f.length;++S){const k=f[S];if(Array.isArray(k))for(let A=0;A<k.length;++A)p.addSubParam(k[A]);else p.addParam(k)}return p}constructor(f=32,p=32){if(this.maxLength=f,this.maxSubParamsLength=p,p>256)throw new Error("maxSubParamsLength must not be greater than 256");this.params=new Int32Array(f),this.length=0,this._subParams=new Int32Array(p),this._subParamsLength=0,this._subParamsIdx=new Uint16Array(f),this._rejectDigits=!1,this._rejectSubDigits=!1,this._digitIsSub=!1}clone(){const f=new d(this.maxLength,this.maxSubParamsLength);return f.params.set(this.params),f.length=this.length,f._subParams.set(this._subParams),f._subParamsLength=this._subParamsLength,f._subParamsIdx.set(this._subParamsIdx),f._rejectDigits=this._rejectDigits,f._rejectSubDigits=this._rejectSubDigits,f._digitIsSub=this._digitIsSub,f}toArray(){const f=[];for(let p=0;p<this.length;++p){f.push(this.params[p]);const S=this._subParamsIdx[p]>>8,k=255&this._subParamsIdx[p];k-S>0&&f.push(Array.prototype.slice.call(this._subParams,S,k))}return f}reset(){this.length=0,this._subParamsLength=0,this._rejectDigits=!1,this._rejectSubDigits=!1,this._digitIsSub=!1}addParam(f){if(this._digitIsSub=!1,this.length>=this.maxLength)this._rejectDigits=!0;else{if(f<-1)throw new Error("values lesser than -1 are not allowed");this._subParamsIdx[this.length]=this._subParamsLength<<8|this._subParamsLength,this.params[this.length++]=f>a?a:f}}addSubParam(f){if(this._digitIsSub=!0,this.length)if(this._rejectDigits||this._subParamsLength>=this.maxSubParamsLength)this._rejectSubDigits=!0;else{if(f<-1)throw new Error("values lesser than -1 are not allowed");this._subParams[this._subParamsLength++]=f>a?a:f,this._subParamsIdx[this.length-1]++}}hasSubParams(f){return(255&this._subParamsIdx[f])-(this._subParamsIdx[f]>>8)>0}getSubParams(f){const p=this._subParamsIdx[f]>>8,S=255&this._subParamsIdx[f];return S-p>0?this._subParams.subarray(p,S):null}getSubParamsAll(){const f={};for(let p=0;p<this.length;++p){const S=this._subParamsIdx[p]>>8,k=255&this._subParamsIdx[p];k-S>0&&(f[p]=this._subParams.slice(S,k))}return f}addDigit(f){let p;if(this._rejectDigits||!(p=this._digitIsSub?this._subParamsLength:this.length)||this._digitIsSub&&this._rejectSubDigits)return;const S=this._digitIsSub?this._subParams:this.params,k=S[p-1];S[p-1]=~k?Math.min(10*k+f,a):f}}o.Params=d},5741:(h,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.AddonManager=void 0,o.AddonManager=class{constructor(){this._addons=[]}dispose(){for(let a=this._addons.length-1;a>=0;a--)this._addons[a].instance.dispose()}loadAddon(a,d){const l={instance:d,dispose:d.dispose,isDisposed:!1};this._addons.push(l),d.dispose=()=>this._wrappedAddonDispose(l),d.activate(a)}_wrappedAddonDispose(a){if(a.isDisposed)return;let d=-1;for(let l=0;l<this._addons.length;l++)if(this._addons[l]===a){d=l;break}if(d===-1)throw new Error("Could not dispose an addon that has not been loaded");a.isDisposed=!0,a.dispose.apply(a.instance),this._addons.splice(d,1)}}},8771:(h,o,a)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.BufferApiView=void 0;const d=a(3785),l=a(511);o.BufferApiView=class{constructor(f,p){this._buffer=f,this.type=p}init(f){return this._buffer=f,this}get cursorY(){return this._buffer.y}get cursorX(){return this._buffer.x}get viewportY(){return this._buffer.ydisp}get baseY(){return this._buffer.ybase}get length(){return this._buffer.lines.length}getLine(f){const p=this._buffer.lines.get(f);if(p)return new d.BufferLineApiView(p)}getNullCell(){return new l.CellData}}},3785:(h,o,a)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.BufferLineApiView=void 0;const d=a(511);o.BufferLineApiView=class{constructor(l){this._line=l}get isWrapped(){return this._line.isWrapped}get length(){return this._line.length}getCell(l,f){if(!(l<0||l>=this._line.length))return f?(this._line.loadCell(l,f),f):this._line.loadCell(l,new d.CellData)}translateToString(l,f,p){return this._line.translateToString(l,f,p)}}},8285:(h,o,a)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.BufferNamespaceApi=void 0;const d=a(8771),l=a(8460),f=a(844);class p extends f.Disposable{constructor(k){super(),this._core=k,this._onBufferChange=this.register(new l.EventEmitter),this.onBufferChange=this._onBufferChange.event,this._normal=new d.BufferApiView(this._core.buffers.normal,"normal"),this._alternate=new d.BufferApiView(this._core.buffers.alt,"alternate"),this._core.buffers.onBufferActivate((()=>this._onBufferChange.fire(this.active)))}get active(){if(this._core.buffers.active===this._core.buffers.normal)return this.normal;if(this._core.buffers.active===this._core.buffers.alt)return this.alternate;throw new Error("Active buffer is neither normal nor alternate")}get normal(){return this._normal.init(this._core.buffers.normal)}get alternate(){return this._alternate.init(this._core.buffers.alt)}}o.BufferNamespaceApi=p},7975:(h,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.ParserApi=void 0,o.ParserApi=class{constructor(a){this._core=a}registerCsiHandler(a,d){return this._core.registerCsiHandler(a,(l=>d(l.toArray())))}addCsiHandler(a,d){return this.registerCsiHandler(a,d)}registerDcsHandler(a,d){return this._core.registerDcsHandler(a,((l,f)=>d(l,f.toArray())))}addDcsHandler(a,d){return this.registerDcsHandler(a,d)}registerEscHandler(a,d){return this._core.registerEscHandler(a,d)}addEscHandler(a,d){return this.registerEscHandler(a,d)}registerOscHandler(a,d){return this._core.registerOscHandler(a,d)}addOscHandler(a,d){return this.registerOscHandler(a,d)}}},7090:(h,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.UnicodeApi=void 0,o.UnicodeApi=class{constructor(a){this._core=a}register(a){this._core.unicodeService.register(a)}get versions(){return this._core.unicodeService.versions}get activeVersion(){return this._core.unicodeService.activeVersion}set activeVersion(a){this._core.unicodeService.activeVersion=a}}},744:function(h,o,a){var d=this&&this.__decorate||function(w,v,g,m){var $,I=arguments.length,B=I<3?v:m===null?m=Object.getOwnPropertyDescriptor(v,g):m;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(w,v,g,m);else for(var P=w.length-1;P>=0;P--)($=w[P])&&(B=(I<3?$(B):I>3?$(v,g,B):$(v,g))||B);return I>3&&B&&Object.defineProperty(v,g,B),B},l=this&&this.__param||function(w,v){return function(g,m){v(g,m,w)}};Object.defineProperty(o,"__esModule",{value:!0}),o.BufferService=o.MINIMUM_ROWS=o.MINIMUM_COLS=void 0;const f=a(8460),p=a(844),S=a(5295),k=a(2585);o.MINIMUM_COLS=2,o.MINIMUM_ROWS=1;let A=o.BufferService=class extends p.Disposable{get buffer(){return this.buffers.active}constructor(w){super(),this.isUserScrolling=!1,this._onResize=this.register(new f.EventEmitter),this.onResize=this._onResize.event,this._onScroll=this.register(new f.EventEmitter),this.onScroll=this._onScroll.event,this.cols=Math.max(w.rawOptions.cols||0,o.MINIMUM_COLS),this.rows=Math.max(w.rawOptions.rows||0,o.MINIMUM_ROWS),this.buffers=this.register(new S.BufferSet(w,this))}resize(w,v){this.cols=w,this.rows=v,this.buffers.resize(w,v),this._onResize.fire({cols:w,rows:v})}reset(){this.buffers.reset(),this.isUserScrolling=!1}scroll(w,v=!1){const g=this.buffer;let m;m=this._cachedBlankLine,m&&m.length===this.cols&&m.getFg(0)===w.fg&&m.getBg(0)===w.bg||(m=g.getBlankLine(w,v),this._cachedBlankLine=m),m.isWrapped=v;const $=g.ybase+g.scrollTop,I=g.ybase+g.scrollBottom;if(g.scrollTop===0){const B=g.lines.isFull;I===g.lines.length-1?B?g.lines.recycle().copyFrom(m):g.lines.push(m.clone()):g.lines.splice(I+1,0,m.clone()),B?this.isUserScrolling&&(g.ydisp=Math.max(g.ydisp-1,0)):(g.ybase++,this.isUserScrolling||g.ydisp++)}else{const B=I-$+1;g.lines.shiftElements($+1,B-1,-1),g.lines.set(I,m.clone())}this.isUserScrolling||(g.ydisp=g.ybase),this._onScroll.fire(g.ydisp)}scrollLines(w,v,g){const m=this.buffer;if(w<0){if(m.ydisp===0)return;this.isUserScrolling=!0}else w+m.ydisp>=m.ybase&&(this.isUserScrolling=!1);const $=m.ydisp;m.ydisp=Math.max(Math.min(m.ydisp+w,m.ybase),0),$!==m.ydisp&&(v||this._onScroll.fire(m.ydisp))}};o.BufferService=A=d([l(0,k.IOptionsService)],A)},7994:(h,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.CharsetService=void 0,o.CharsetService=class{constructor(){this.glevel=0,this._charsets=[]}reset(){this.charset=void 0,this._charsets=[],this.glevel=0}setgLevel(a){this.glevel=a,this.charset=this._charsets[a]}setgCharset(a,d){this._charsets[a]=d,this.glevel===a&&(this.charset=d)}}},1753:function(h,o,a){var d=this&&this.__decorate||function(m,$,I,B){var P,x=arguments.length,N=x<3?$:B===null?B=Object.getOwnPropertyDescriptor($,I):B;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")N=Reflect.decorate(m,$,I,B);else for(var J=m.length-1;J>=0;J--)(P=m[J])&&(N=(x<3?P(N):x>3?P($,I,N):P($,I))||N);return x>3&&N&&Object.defineProperty($,I,N),N},l=this&&this.__param||function(m,$){return function(I,B){$(I,B,m)}};Object.defineProperty(o,"__esModule",{value:!0}),o.CoreMouseService=void 0;const f=a(2585),p=a(8460),S=a(844),k={NONE:{events:0,restrict:()=>!1},X10:{events:1,restrict:m=>m.button!==4&&m.action===1&&(m.ctrl=!1,m.alt=!1,m.shift=!1,!0)},VT200:{events:19,restrict:m=>m.action!==32},DRAG:{events:23,restrict:m=>m.action!==32||m.button!==3},ANY:{events:31,restrict:m=>!0}};function A(m,$){let I=(m.ctrl?16:0)|(m.shift?4:0)|(m.alt?8:0);return m.button===4?(I|=64,I|=m.action):(I|=3&m.button,4&m.button&&(I|=64),8&m.button&&(I|=128),m.action===32?I|=32:m.action!==0||$||(I|=3)),I}const w=String.fromCharCode,v={DEFAULT:m=>{const $=[A(m,!1)+32,m.col+32,m.row+32];return $[0]>255||$[1]>255||$[2]>255?"":`\x1B[M${w($[0])}${w($[1])}${w($[2])}`},SGR:m=>{const $=m.action===0&&m.button!==4?"m":"M";return`\x1B[<${A(m,!0)};${m.col};${m.row}${$}`},SGR_PIXELS:m=>{const $=m.action===0&&m.button!==4?"m":"M";return`\x1B[<${A(m,!0)};${m.x};${m.y}${$}`}};let g=o.CoreMouseService=class extends S.Disposable{constructor(m,$){super(),this._bufferService=m,this._coreService=$,this._protocols={},this._encodings={},this._activeProtocol="",this._activeEncoding="",this._lastEvent=null,this._onProtocolChange=this.register(new p.EventEmitter),this.onProtocolChange=this._onProtocolChange.event;for(const I of Object.keys(k))this.addProtocol(I,k[I]);for(const I of Object.keys(v))this.addEncoding(I,v[I]);this.reset()}addProtocol(m,$){this._protocols[m]=$}addEncoding(m,$){this._encodings[m]=$}get activeProtocol(){return this._activeProtocol}get areMouseEventsActive(){return this._protocols[this._activeProtocol].events!==0}set activeProtocol(m){if(!this._protocols[m])throw new Error(`unknown protocol "${m}"`);this._activeProtocol=m,this._onProtocolChange.fire(this._protocols[m].events)}get activeEncoding(){return this._activeEncoding}set activeEncoding(m){if(!this._encodings[m])throw new Error(`unknown encoding "${m}"`);this._activeEncoding=m}reset(){this.activeProtocol="NONE",this.activeEncoding="DEFAULT",this._lastEvent=null}triggerMouseEvent(m){if(m.col<0||m.col>=this._bufferService.cols||m.row<0||m.row>=this._bufferService.rows||m.button===4&&m.action===32||m.button===3&&m.action!==32||m.button!==4&&(m.action===2||m.action===3)||(m.col++,m.row++,m.action===32&&this._lastEvent&&this._equalEvents(this._lastEvent,m,this._activeEncoding==="SGR_PIXELS"))||!this._protocols[this._activeProtocol].restrict(m))return!1;const $=this._encodings[this._activeEncoding](m);return $&&(this._activeEncoding==="DEFAULT"?this._coreService.triggerBinaryEvent($):this._coreService.triggerDataEvent($,!0)),this._lastEvent=m,!0}explainEvents(m){return{down:!!(1&m),up:!!(2&m),drag:!!(4&m),move:!!(8&m),wheel:!!(16&m)}}_equalEvents(m,$,I){if(I){if(m.x!==$.x||m.y!==$.y)return!1}else if(m.col!==$.col||m.row!==$.row)return!1;return m.button===$.button&&m.action===$.action&&m.ctrl===$.ctrl&&m.alt===$.alt&&m.shift===$.shift}};o.CoreMouseService=g=d([l(0,f.IBufferService),l(1,f.ICoreService)],g)},6975:function(h,o,a){var d=this&&this.__decorate||function(g,m,$,I){var B,P=arguments.length,x=P<3?m:I===null?I=Object.getOwnPropertyDescriptor(m,$):I;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")x=Reflect.decorate(g,m,$,I);else for(var N=g.length-1;N>=0;N--)(B=g[N])&&(x=(P<3?B(x):P>3?B(m,$,x):B(m,$))||x);return P>3&&x&&Object.defineProperty(m,$,x),x},l=this&&this.__param||function(g,m){return function($,I){m($,I,g)}};Object.defineProperty(o,"__esModule",{value:!0}),o.CoreService=void 0;const f=a(1439),p=a(8460),S=a(844),k=a(2585),A=Object.freeze({insertMode:!1}),w=Object.freeze({applicationCursorKeys:!1,applicationKeypad:!1,bracketedPasteMode:!1,origin:!1,reverseWraparound:!1,sendFocus:!1,wraparound:!0});let v=o.CoreService=class extends S.Disposable{constructor(g,m,$){super(),this._bufferService=g,this._logService=m,this._optionsService=$,this.isCursorInitialized=!1,this.isCursorHidden=!1,this._onData=this.register(new p.EventEmitter),this.onData=this._onData.event,this._onUserInput=this.register(new p.EventEmitter),this.onUserInput=this._onUserInput.event,this._onBinary=this.register(new p.EventEmitter),this.onBinary=this._onBinary.event,this._onRequestScrollToBottom=this.register(new p.EventEmitter),this.onRequestScrollToBottom=this._onRequestScrollToBottom.event,this.modes=(0,f.clone)(A),this.decPrivateModes=(0,f.clone)(w)}reset(){this.modes=(0,f.clone)(A),this.decPrivateModes=(0,f.clone)(w)}triggerDataEvent(g,m=!1){if(this._optionsService.rawOptions.disableStdin)return;const $=this._bufferService.buffer;m&&this._optionsService.rawOptions.scrollOnUserInput&&$.ybase!==$.ydisp&&this._onRequestScrollToBottom.fire(),m&&this._onUserInput.fire(),this._logService.debug(`sending data "${g}"`,(()=>g.split("").map((I=>I.charCodeAt(0))))),this._onData.fire(g)}triggerBinaryEvent(g){this._optionsService.rawOptions.disableStdin||(this._logService.debug(`sending binary "${g}"`,(()=>g.split("").map((m=>m.charCodeAt(0))))),this._onBinary.fire(g))}};o.CoreService=v=d([l(0,k.IBufferService),l(1,k.ILogService),l(2,k.IOptionsService)],v)},9074:(h,o,a)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.DecorationService=void 0;const d=a(8055),l=a(8460),f=a(844),p=a(6106);let S=0,k=0;class A extends f.Disposable{get decorations(){return this._decorations.values()}constructor(){super(),this._decorations=new p.SortedList((g=>g?.marker.line)),this._onDecorationRegistered=this.register(new l.EventEmitter),this.onDecorationRegistered=this._onDecorationRegistered.event,this._onDecorationRemoved=this.register(new l.EventEmitter),this.onDecorationRemoved=this._onDecorationRemoved.event,this.register((0,f.toDisposable)((()=>this.reset())))}registerDecoration(g){if(g.marker.isDisposed)return;const m=new w(g);if(m){const $=m.marker.onDispose((()=>m.dispose()));m.onDispose((()=>{m&&(this._decorations.delete(m)&&this._onDecorationRemoved.fire(m),$.dispose())})),this._decorations.insert(m),this._onDecorationRegistered.fire(m)}return m}reset(){for(const g of this._decorations.values())g.dispose();this._decorations.clear()}*getDecorationsAtCell(g,m,$){let I=0,B=0;for(const P of this._decorations.getKeyIterator(m))I=P.options.x??0,B=I+(P.options.width??1),g>=I&&g<B&&(!$||(P.options.layer??"bottom")===$)&&(yield P)}forEachDecorationAtCell(g,m,$,I){this._decorations.forEachByKey(m,(B=>{S=B.options.x??0,k=S+(B.options.width??1),g>=S&&g<k&&(!$||(B.options.layer??"bottom")===$)&&I(B)}))}}o.DecorationService=A;class w extends f.Disposable{get isDisposed(){return this._isDisposed}get backgroundColorRGB(){return this._cachedBg===null&&(this.options.backgroundColor?this._cachedBg=d.css.toColor(this.options.backgroundColor):this._cachedBg=void 0),this._cachedBg}get foregroundColorRGB(){return this._cachedFg===null&&(this.options.foregroundColor?this._cachedFg=d.css.toColor(this.options.foregroundColor):this._cachedFg=void 0),this._cachedFg}constructor(g){super(),this.options=g,this.onRenderEmitter=this.register(new l.EventEmitter),this.onRender=this.onRenderEmitter.event,this._onDispose=this.register(new l.EventEmitter),this.onDispose=this._onDispose.event,this._cachedBg=null,this._cachedFg=null,this.marker=g.marker,this.options.overviewRulerOptions&&!this.options.overviewRulerOptions.position&&(this.options.overviewRulerOptions.position="full")}dispose(){this._onDispose.fire(),super.dispose()}}},4348:(h,o,a)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.InstantiationService=o.ServiceCollection=void 0;const d=a(2585),l=a(8343);class f{constructor(...S){this._entries=new Map;for(const[k,A]of S)this.set(k,A)}set(S,k){const A=this._entries.get(S);return this._entries.set(S,k),A}forEach(S){for(const[k,A]of this._entries.entries())S(k,A)}has(S){return this._entries.has(S)}get(S){return this._entries.get(S)}}o.ServiceCollection=f,o.InstantiationService=class{constructor(){this._services=new f,this._services.set(d.IInstantiationService,this)}setService(p,S){this._services.set(p,S)}getService(p){return this._services.get(p)}createInstance(p,...S){const k=(0,l.getServiceDependencies)(p).sort(((v,g)=>v.index-g.index)),A=[];for(const v of k){const g=this._services.get(v.id);if(!g)throw new Error(`[createInstance] ${p.name} depends on UNKNOWN service ${v.id}.`);A.push(g)}const w=k.length>0?k[0].index:S.length;if(S.length!==w)throw new Error(`[createInstance] First service dependency of ${p.name} at position ${w+1} conflicts with ${S.length} static arguments`);return new p(...S,...A)}}},7866:function(h,o,a){var d=this&&this.__decorate||function(w,v,g,m){var $,I=arguments.length,B=I<3?v:m===null?m=Object.getOwnPropertyDescriptor(v,g):m;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(w,v,g,m);else for(var P=w.length-1;P>=0;P--)($=w[P])&&(B=(I<3?$(B):I>3?$(v,g,B):$(v,g))||B);return I>3&&B&&Object.defineProperty(v,g,B),B},l=this&&this.__param||function(w,v){return function(g,m){v(g,m,w)}};Object.defineProperty(o,"__esModule",{value:!0}),o.traceCall=o.setTraceLogger=o.LogService=void 0;const f=a(844),p=a(2585),S={trace:p.LogLevelEnum.TRACE,debug:p.LogLevelEnum.DEBUG,info:p.LogLevelEnum.INFO,warn:p.LogLevelEnum.WARN,error:p.LogLevelEnum.ERROR,off:p.LogLevelEnum.OFF};let k,A=o.LogService=class extends f.Disposable{get logLevel(){return this._logLevel}constructor(w){super(),this._optionsService=w,this._logLevel=p.LogLevelEnum.OFF,this._updateLogLevel(),this.register(this._optionsService.onSpecificOptionChange("logLevel",(()=>this._updateLogLevel()))),k=this}_updateLogLevel(){this._logLevel=S[this._optionsService.rawOptions.logLevel]}_evalLazyOptionalParams(w){for(let v=0;v<w.length;v++)typeof w[v]=="function"&&(w[v]=w[v]())}_log(w,v,g){this._evalLazyOptionalParams(g),w.call(console,(this._optionsService.options.logger?"":"xterm.js: ")+v,...g)}trace(w,...v){this._logLevel<=p.LogLevelEnum.TRACE&&this._log(this._optionsService.options.logger?.trace.bind(this._optionsService.options.logger)??console.log,w,v)}debug(w,...v){this._logLevel<=p.LogLevelEnum.DEBUG&&this._log(this._optionsService.options.logger?.debug.bind(this._optionsService.options.logger)??console.log,w,v)}info(w,...v){this._logLevel<=p.LogLevelEnum.INFO&&this._log(this._optionsService.options.logger?.info.bind(this._optionsService.options.logger)??console.info,w,v)}warn(w,...v){this._logLevel<=p.LogLevelEnum.WARN&&this._log(this._optionsService.options.logger?.warn.bind(this._optionsService.options.logger)??console.warn,w,v)}error(w,...v){this._logLevel<=p.LogLevelEnum.ERROR&&this._log(this._optionsService.options.logger?.error.bind(this._optionsService.options.logger)??console.error,w,v)}};o.LogService=A=d([l(0,p.IOptionsService)],A),o.setTraceLogger=function(w){k=w},o.traceCall=function(w,v,g){if(typeof g.value!="function")throw new Error("not supported");const m=g.value;g.value=function(...$){if(k.logLevel!==p.LogLevelEnum.TRACE)return m.apply(this,$);k.trace(`GlyphRenderer#${m.name}(${$.map((B=>JSON.stringify(B))).join(", ")})`);const I=m.apply(this,$);return k.trace(`GlyphRenderer#${m.name} return`,I),I}}},7302:(h,o,a)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.OptionsService=o.DEFAULT_OPTIONS=void 0;const d=a(8460),l=a(844),f=a(6114);o.DEFAULT_OPTIONS={cols:80,rows:24,cursorBlink:!1,cursorStyle:"block",cursorWidth:1,cursorInactiveStyle:"outline",customGlyphs:!0,drawBoldTextInBrightColors:!0,documentOverride:null,fastScrollModifier:"alt",fastScrollSensitivity:5,fontFamily:"courier-new, courier, monospace",fontSize:15,fontWeight:"normal",fontWeightBold:"bold",ignoreBracketedPasteMode:!1,lineHeight:1,letterSpacing:0,linkHandler:null,logLevel:"info",logger:null,scrollback:1e3,scrollOnUserInput:!0,scrollSensitivity:1,screenReaderMode:!1,smoothScrollDuration:0,macOptionIsMeta:!1,macOptionClickForcesSelection:!1,minimumContrastRatio:1,disableStdin:!1,allowProposedApi:!1,allowTransparency:!1,tabStopWidth:8,theme:{},rescaleOverlappingGlyphs:!1,rightClickSelectsWord:f.isMac,windowOptions:{},windowsMode:!1,windowsPty:{},wordSeparator:" ()[]{}',\"`",altClickMovesCursor:!0,convertEol:!1,termName:"xterm",cancelEvents:!1,overviewRulerWidth:0};const p=["normal","bold","100","200","300","400","500","600","700","800","900"];class S extends l.Disposable{constructor(A){super(),this._onOptionChange=this.register(new d.EventEmitter),this.onOptionChange=this._onOptionChange.event;const w={...o.DEFAULT_OPTIONS};for(const v in A)if(v in w)try{const g=A[v];w[v]=this._sanitizeAndValidateOption(v,g)}catch(g){console.error(g)}this.rawOptions=w,this.options={...w},this._setupOptions(),this.register((0,l.toDisposable)((()=>{this.rawOptions.linkHandler=null,this.rawOptions.documentOverride=null})))}onSpecificOptionChange(A,w){return this.onOptionChange((v=>{v===A&&w(this.rawOptions[A])}))}onMultipleOptionChange(A,w){return this.onOptionChange((v=>{A.indexOf(v)!==-1&&w()}))}_setupOptions(){const A=v=>{if(!(v in o.DEFAULT_OPTIONS))throw new Error(`No option with key "${v}"`);return this.rawOptions[v]},w=(v,g)=>{if(!(v in o.DEFAULT_OPTIONS))throw new Error(`No option with key "${v}"`);g=this._sanitizeAndValidateOption(v,g),this.rawOptions[v]!==g&&(this.rawOptions[v]=g,this._onOptionChange.fire(v))};for(const v in this.rawOptions){const g={get:A.bind(this,v),set:w.bind(this,v)};Object.defineProperty(this.options,v,g)}}_sanitizeAndValidateOption(A,w){switch(A){case"cursorStyle":if(w||(w=o.DEFAULT_OPTIONS[A]),!(function(v){return v==="block"||v==="underline"||v==="bar"})(w))throw new Error(`"${w}" is not a valid value for ${A}`);break;case"wordSeparator":w||(w=o.DEFAULT_OPTIONS[A]);break;case"fontWeight":case"fontWeightBold":if(typeof w=="number"&&1<=w&&w<=1e3)break;w=p.includes(w)?w:o.DEFAULT_OPTIONS[A];break;case"cursorWidth":w=Math.floor(w);case"lineHeight":case"tabStopWidth":if(w<1)throw new Error(`${A} cannot be less than 1, value: ${w}`);break;case"minimumContrastRatio":w=Math.max(1,Math.min(21,Math.round(10*w)/10));break;case"scrollback":if((w=Math.min(w,4294967295))<0)throw new Error(`${A} cannot be less than 0, value: ${w}`);break;case"fastScrollSensitivity":case"scrollSensitivity":if(w<=0)throw new Error(`${A} cannot be less than or equal to 0, value: ${w}`);break;case"rows":case"cols":if(!w&&w!==0)throw new Error(`${A} must be numeric, value: ${w}`);break;case"windowsPty":w=w??{}}return w}}o.OptionsService=S},2660:function(h,o,a){var d=this&&this.__decorate||function(S,k,A,w){var v,g=arguments.length,m=g<3?k:w===null?w=Object.getOwnPropertyDescriptor(k,A):w;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")m=Reflect.decorate(S,k,A,w);else for(var $=S.length-1;$>=0;$--)(v=S[$])&&(m=(g<3?v(m):g>3?v(k,A,m):v(k,A))||m);return g>3&&m&&Object.defineProperty(k,A,m),m},l=this&&this.__param||function(S,k){return function(A,w){k(A,w,S)}};Object.defineProperty(o,"__esModule",{value:!0}),o.OscLinkService=void 0;const f=a(2585);let p=o.OscLinkService=class{constructor(S){this._bufferService=S,this._nextId=1,this._entriesWithId=new Map,this._dataByLinkId=new Map}registerLink(S){const k=this._bufferService.buffer;if(S.id===void 0){const $=k.addMarker(k.ybase+k.y),I={data:S,id:this._nextId++,lines:[$]};return $.onDispose((()=>this._removeMarkerFromLink(I,$))),this._dataByLinkId.set(I.id,I),I.id}const A=S,w=this._getEntryIdKey(A),v=this._entriesWithId.get(w);if(v)return this.addLineToLink(v.id,k.ybase+k.y),v.id;const g=k.addMarker(k.ybase+k.y),m={id:this._nextId++,key:this._getEntryIdKey(A),data:A,lines:[g]};return g.onDispose((()=>this._removeMarkerFromLink(m,g))),this._entriesWithId.set(m.key,m),this._dataByLinkId.set(m.id,m),m.id}addLineToLink(S,k){const A=this._dataByLinkId.get(S);if(A&&A.lines.every((w=>w.line!==k))){const w=this._bufferService.buffer.addMarker(k);A.lines.push(w),w.onDispose((()=>this._removeMarkerFromLink(A,w)))}}getLinkData(S){return this._dataByLinkId.get(S)?.data}_getEntryIdKey(S){return`${S.id};;${S.uri}`}_removeMarkerFromLink(S,k){const A=S.lines.indexOf(k);A!==-1&&(S.lines.splice(A,1),S.lines.length===0&&(S.data.id!==void 0&&this._entriesWithId.delete(S.key),this._dataByLinkId.delete(S.id)))}};o.OscLinkService=p=d([l(0,f.IBufferService)],p)},8343:(h,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.createDecorator=o.getServiceDependencies=o.serviceRegistry=void 0;const a="di$target",d="di$dependencies";o.serviceRegistry=new Map,o.getServiceDependencies=function(l){return l[d]||[]},o.createDecorator=function(l){if(o.serviceRegistry.has(l))return o.serviceRegistry.get(l);const f=function(p,S,k){if(arguments.length!==3)throw new Error("@IServiceName-decorator can only be used to decorate a parameter");(function(A,w,v){w[a]===w?w[d].push({id:A,index:v}):(w[d]=[{id:A,index:v}],w[a]=w)})(f,p,k)};return f.toString=()=>l,o.serviceRegistry.set(l,f),f}},2585:(h,o,a)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.IDecorationService=o.IUnicodeService=o.IOscLinkService=o.IOptionsService=o.ILogService=o.LogLevelEnum=o.IInstantiationService=o.ICharsetService=o.ICoreService=o.ICoreMouseService=o.IBufferService=void 0;const d=a(8343);var l;o.IBufferService=(0,d.createDecorator)("BufferService"),o.ICoreMouseService=(0,d.createDecorator)("CoreMouseService"),o.ICoreService=(0,d.createDecorator)("CoreService"),o.ICharsetService=(0,d.createDecorator)("CharsetService"),o.IInstantiationService=(0,d.createDecorator)("InstantiationService"),(function(f){f[f.TRACE=0]="TRACE",f[f.DEBUG=1]="DEBUG",f[f.INFO=2]="INFO",f[f.WARN=3]="WARN",f[f.ERROR=4]="ERROR",f[f.OFF=5]="OFF"})(l||(o.LogLevelEnum=l={})),o.ILogService=(0,d.createDecorator)("LogService"),o.IOptionsService=(0,d.createDecorator)("OptionsService"),o.IOscLinkService=(0,d.createDecorator)("OscLinkService"),o.IUnicodeService=(0,d.createDecorator)("UnicodeService"),o.IDecorationService=(0,d.createDecorator)("DecorationService")},1480:(h,o,a)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.UnicodeService=void 0;const d=a(8460),l=a(225);class f{static extractShouldJoin(S){return(1&S)!=0}static extractWidth(S){return S>>1&3}static extractCharKind(S){return S>>3}static createPropertyValue(S,k,A=!1){return(16777215&S)<<3|(3&k)<<1|(A?1:0)}constructor(){this._providers=Object.create(null),this._active="",this._onChange=new d.EventEmitter,this.onChange=this._onChange.event;const S=new l.UnicodeV6;this.register(S),this._active=S.version,this._activeProvider=S}dispose(){this._onChange.dispose()}get versions(){return Object.keys(this._providers)}get activeVersion(){return this._active}set activeVersion(S){if(!this._providers[S])throw new Error(`unknown Unicode version "${S}"`);this._active=S,this._activeProvider=this._providers[S],this._onChange.fire(S)}register(S){this._providers[S.version]=S}wcwidth(S){return this._activeProvider.wcwidth(S)}getStringCellWidth(S){let k=0,A=0;const w=S.length;for(let v=0;v<w;++v){let g=S.charCodeAt(v);if(55296<=g&&g<=56319){if(++v>=w)return k+this.wcwidth(g);const I=S.charCodeAt(v);56320<=I&&I<=57343?g=1024*(g-55296)+I-56320+65536:k+=this.wcwidth(I)}const m=this.charProperties(g,A);let $=f.extractWidth(m);f.extractShouldJoin(m)&&($-=f.extractWidth(A)),k+=$,A=m}return k}charProperties(S,k){return this._activeProvider.charProperties(S,k)}}o.UnicodeService=f}},n={};function c(h){var o=n[h];if(o!==void 0)return o.exports;var a=n[h]={exports:{}};return r[h].call(a.exports,a,a.exports,c),a.exports}var s={};return(()=>{var h=s;Object.defineProperty(h,"__esModule",{value:!0}),h.Terminal=void 0;const o=c(9042),a=c(3236),d=c(844),l=c(5741),f=c(8285),p=c(7975),S=c(7090),k=["cols","rows"];class A extends d.Disposable{constructor(v){super(),this._core=this.register(new a.Terminal(v)),this._addonManager=this.register(new l.AddonManager),this._publicOptions={...this._core.options};const g=$=>this._core.options[$],m=($,I)=>{this._checkReadonlyOptions($),this._core.options[$]=I};for(const $ in this._core.options){const I={get:g.bind(this,$),set:m.bind(this,$)};Object.defineProperty(this._publicOptions,$,I)}}_checkReadonlyOptions(v){if(k.includes(v))throw new Error(`Option "${v}" can only be set in the constructor`)}_checkProposedApi(){if(!this._core.optionsService.rawOptions.allowProposedApi)throw new Error("You must set the allowProposedApi option to true to use proposed API")}get onBell(){return this._core.onBell}get onBinary(){return this._core.onBinary}get onCursorMove(){return this._core.onCursorMove}get onData(){return this._core.onData}get onKey(){return this._core.onKey}get onLineFeed(){return this._core.onLineFeed}get onRender(){return this._core.onRender}get onResize(){return this._core.onResize}get onScroll(){return this._core.onScroll}get onSelectionChange(){return this._core.onSelectionChange}get onTitleChange(){return this._core.onTitleChange}get onWriteParsed(){return this._core.onWriteParsed}get element(){return this._core.element}get parser(){return this._parser||(this._parser=new p.ParserApi(this._core)),this._parser}get unicode(){return this._checkProposedApi(),new S.UnicodeApi(this._core)}get textarea(){return this._core.textarea}get rows(){return this._core.rows}get cols(){return this._core.cols}get buffer(){return this._buffer||(this._buffer=this.register(new f.BufferNamespaceApi(this._core))),this._buffer}get markers(){return this._checkProposedApi(),this._core.markers}get modes(){const v=this._core.coreService.decPrivateModes;let g="none";switch(this._core.coreMouseService.activeProtocol){case"X10":g="x10";break;case"VT200":g="vt200";break;case"DRAG":g="drag";break;case"ANY":g="any"}return{applicationCursorKeysMode:v.applicationCursorKeys,applicationKeypadMode:v.applicationKeypad,bracketedPasteMode:v.bracketedPasteMode,insertMode:this._core.coreService.modes.insertMode,mouseTrackingMode:g,originMode:v.origin,reverseWraparoundMode:v.reverseWraparound,sendFocusMode:v.sendFocus,wraparoundMode:v.wraparound}}get options(){return this._publicOptions}set options(v){for(const g in v)this._publicOptions[g]=v[g]}blur(){this._core.blur()}focus(){this._core.focus()}input(v,g=!0){this._core.input(v,g)}resize(v,g){this._verifyIntegers(v,g),this._core.resize(v,g)}open(v){this._core.open(v)}attachCustomKeyEventHandler(v){this._core.attachCustomKeyEventHandler(v)}attachCustomWheelEventHandler(v){this._core.attachCustomWheelEventHandler(v)}registerLinkProvider(v){return this._core.registerLinkProvider(v)}registerCharacterJoiner(v){return this._checkProposedApi(),this._core.registerCharacterJoiner(v)}deregisterCharacterJoiner(v){this._checkProposedApi(),this._core.deregisterCharacterJoiner(v)}registerMarker(v=0){return this._verifyIntegers(v),this._core.registerMarker(v)}registerDecoration(v){return this._checkProposedApi(),this._verifyPositiveIntegers(v.x??0,v.width??0,v.height??0),this._core.registerDecoration(v)}hasSelection(){return this._core.hasSelection()}select(v,g,m){this._verifyIntegers(v,g,m),this._core.select(v,g,m)}getSelection(){return this._core.getSelection()}getSelectionPosition(){return this._core.getSelectionPosition()}clearSelection(){this._core.clearSelection()}selectAll(){this._core.selectAll()}selectLines(v,g){this._verifyIntegers(v,g),this._core.selectLines(v,g)}dispose(){super.dispose()}scrollLines(v){this._verifyIntegers(v),this._core.scrollLines(v)}scrollPages(v){this._verifyIntegers(v),this._core.scrollPages(v)}scrollToTop(){this._core.scrollToTop()}scrollToBottom(){this._core.scrollToBottom()}scrollToLine(v){this._verifyIntegers(v),this._core.scrollToLine(v)}clear(){this._core.clear()}write(v,g){this._core.write(v,g)}writeln(v,g){this._core.write(v),this._core.write(`\r
`,g)}paste(v){this._core.paste(v)}refresh(v,g){this._verifyIntegers(v,g),this._core.refresh(v,g)}reset(){this._core.reset()}clearTextureAtlas(){this._core.clearTextureAtlas()}loadAddon(v){this._addonManager.loadAddon(this,v)}static get strings(){return o}_verifyIntegers(...v){for(const g of v)if(g===1/0||isNaN(g)||g%1!=0)throw new Error("This API only accepts integers")}_verifyPositiveIntegers(...v){for(const g of v)if(g&&(g===1/0||isNaN(g)||g%1!=0||g<0))throw new Error("This API only accepts positive integers")}}h.Terminal=A})(),s})()))})(xterm)),xterm.exports}var xtermExports=requireXterm(),addonFit={exports:{}},hasRequiredAddonFit;function requireAddonFit(){return hasRequiredAddonFit||(hasRequiredAddonFit=1,(function(t,e){(function(r,n){t.exports=n()})(self,(()=>(()=>{var r={};return(()=>{var n=r;Object.defineProperty(n,"__esModule",{value:!0}),n.FitAddon=void 0,n.FitAddon=class{activate(c){this._terminal=c}dispose(){}fit(){const c=this.proposeDimensions();if(!c||!this._terminal||isNaN(c.cols)||isNaN(c.rows))return;const s=this._terminal._core;this._terminal.rows===c.rows&&this._terminal.cols===c.cols||(s._renderService.clear(),this._terminal.resize(c.cols,c.rows))}proposeDimensions(){if(!this._terminal||!this._terminal.element||!this._terminal.element.parentElement)return;const c=this._terminal._core,s=c._renderService.dimensions;if(s.css.cell.width===0||s.css.cell.height===0)return;const h=this._terminal.options.scrollback===0?0:c.viewport.scrollBarWidth,o=window.getComputedStyle(this._terminal.element.parentElement),a=parseInt(o.getPropertyValue("height")),d=Math.max(0,parseInt(o.getPropertyValue("width"))),l=window.getComputedStyle(this._terminal.element),f=a-(parseInt(l.getPropertyValue("padding-top"))+parseInt(l.getPropertyValue("padding-bottom"))),p=d-(parseInt(l.getPropertyValue("padding-right"))+parseInt(l.getPropertyValue("padding-left")))-h;return{cols:Math.max(2,Math.floor(p/s.css.cell.width)),rows:Math.max(1,Math.floor(f/s.css.cell.height))}}}})(),r})()))})(addonFit)),addonFit.exports}var addonFitExports=requireAddonFit();const buildNumber=`132
`;class ShiroTerminal{term;fitAddon;shell;lineBuffer="";cursorPos=0;historyIndex=-1;savedLine="";running=!1;userInputCallback=null;userInputBuffer="";userInputCursorPos=0;rawModeCallback=null;iframeContainer=null;reverseSearchMode=!1;reverseSearchQuery="";reverseSearchIndex=-1;constructor(e,r){this.shell=r,this.term=new xtermExports.Terminal({theme:{background:"#1a1a2e",foreground:"#e0e0e0",cursor:"#00d4ff",cursorAccent:"#1a1a2e",selectionBackground:"#3d3d5c",black:"#1a1a2e",red:"#ff6b6b",green:"#51cf66",yellow:"#ffd43b",blue:"#74c0fc",magenta:"#cc5de8",cyan:"#66d9e8",white:"#e0e0e0",brightBlack:"#4a4a6a",brightRed:"#ff8787",brightGreen:"#69db7c",brightYellow:"#ffe066",brightBlue:"#91d5ff",brightMagenta:"#e599f7",brightCyan:"#99e9f2",brightWhite:"#ffffff"},fontFamily:'"JetBrains Mono", "Fira Code", "Cascadia Code", monospace',fontSize:14,lineHeight:1.12,cursorBlink:!0,cursorStyle:"block",scrollback:1e4}),this.fitAddon=new addonFitExports.FitAddon,this.term.loadAddon(this.fitAddon),this.term.open(e),this.fitAddon.fit(),this.iframeContainer=document.createElement("div"),this.iframeContainer.id="shiro-iframes",this.iframeContainer.style.cssText=`
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      z-index: 1000;
      background: #1a1a2e;
      border-top: 2px solid #3d3d5c;
      display: none;
    `,document.body.appendChild(this.iframeContainer),window.addEventListener("resize",()=>this.fitAddon.fit()),this.term.onData(n=>this.handleInput(n))}writeOutput(e){this.term.write(e)}getIframeContainer(){return this.iframeContainer&&(this.iframeContainer.style.display="block"),this.iframeContainer}hideIframeContainer(){this.iframeContainer&&(this.iframeContainer.style.display="none",this.iframeContainer.innerHTML="")}getBufferContent(){const e=this.term.buffer.active,r=[];for(let n=0;n<e.length;n++){const c=e.getLine(n);c&&r.push(c.translateToString(!0))}for(;r.length>0&&r[r.length-1].trim()==="";)r.pop();return r.join(`
`)}enterRawMode(e){this.rawModeCallback=e}exitRawMode(){this.rawModeCallback=null}isRawMode(){return this.rawModeCallback!==null}getSize(){return{rows:this.term.rows,cols:this.term.cols}}waitForUserInput(){return new Promise(e=>{this.userInputBuffer="",this.userInputCursorPos=0,this.userInputCallback=e})}async start(){const e=buildNumber.trim().padStart(4,"0");this.term.writeln("\x1B[36m\x1B[0m"),this.term.writeln(`\x1B[36m\x1B[0m  \x1B[1;97mshiro\x1B[0m \x1B[95mv0.1.0\x1B[0m                   \x1B[95m#${e}\x1B[0m     \x1B[36m\x1B[0m`),this.term.writeln("\x1B[36m\x1B[0m  \x1B[92mbrowser-native cloud operating system\x1B[0m    \x1B[36m\x1B[0m"),this.term.writeln("\x1B[36m\x1B[0m                                           \x1B[36m\x1B[0m"),this.term.writeln("\x1B[36m\x1B[0m  \x1B[33mhelp\x1B[0m        \x1B[90m\x1B[0m list all commands          \x1B[36m\x1B[0m"),this.term.writeln("\x1B[36m\x1B[0m  \x1B[33mspirit\x1B[0m      \x1B[90m\x1B[0m AI coding agent            \x1B[36m\x1B[0m"),this.term.writeln("\x1B[36m\x1B[0m  \x1B[33mupload\x1B[0m      \x1B[90m\x1B[0m upload files from host     \x1B[36m\x1B[0m"),this.term.writeln("\x1B[36m\x1B[0m  \x1B[33mdownload\x1B[0m    \x1B[90m\x1B[0m download files to host     \x1B[36m\x1B[0m"),this.term.writeln("\x1B[36m\x1B[0m"),this.term.writeln(""),this.showPrompt()}showPrompt(){const e=this.shell.cwd,r=this.shell.env.HOME||"/home/user",n=e.startsWith(r)?"~"+e.slice(r.length):e,c=this.shell.env.USER||"user";this.term.write(`\x1B[32m${c}@shiro\x1B[0m:\x1B[34m${n}\x1B[0m$ `)}async handleInput(e){if(this.rawModeCallback){for(let r=0;r<e.length;r++){const n=e[r];if(n==="\x1B"&&e[r+1]==="["){const c=e[r+2];if(c==="A"){this.rawModeCallback("ArrowUp"),r+=2;continue}if(c==="B"){this.rawModeCallback("ArrowDown"),r+=2;continue}if(c==="C"){this.rawModeCallback("ArrowRight"),r+=2;continue}if(c==="D"){this.rawModeCallback("ArrowLeft"),r+=2;continue}if(c==="H"){this.rawModeCallback("Home"),r+=2;continue}if(c==="F"){this.rawModeCallback("End"),r+=2;continue}if(c==="3"&&e[r+3]==="~"){this.rawModeCallback("Delete"),r+=3;continue}r+=2;continue}if(n==="\x1B"){this.rawModeCallback("Escape");continue}if(n==="\r"||n===`
`){this.rawModeCallback("Enter");continue}if(n===""||n==="\b"){this.rawModeCallback("Backspace");continue}if(n==="	"){this.rawModeCallback("Tab");continue}if(n===""){this.rawModeCallback("Ctrl+C");continue}this.rawModeCallback(n)}return}if(this.running){this.userInputCallback&&this.handleUserInput(e);return}if(this.reverseSearchMode){this.handleReverseSearchInput(e);return}for(let r=0;r<e.length;r++){const n=e[r];if(n==="\r"||n===`
`){this.term.writeln(""),this.historyIndex=-1,this.savedLine="",this.lineBuffer.trim()&&(this.running=!0,await this.shell.execute(this.lineBuffer,c=>this.term.write(c)),this.running=!1),this.lineBuffer="",this.cursorPos=0,this.showPrompt();return}if(n===""||n==="\b"){if(this.cursorPos>0){const c=this.cursorPos===this.lineBuffer.length;this.lineBuffer=this.lineBuffer.slice(0,this.cursorPos-1)+this.lineBuffer.slice(this.cursorPos),this.cursorPos--,c?this.term.write("\b \b"):this.redrawLine()}continue}if(n==="\x1B"&&e[r+1]==="["){const c=e[r+2];if(c==="A"){r+=2,this.shell.history.length>0&&(this.historyIndex===-1?(this.savedLine=this.lineBuffer,this.historyIndex=this.shell.history.length-1):this.historyIndex>0&&this.historyIndex--,this.lineBuffer=this.shell.history[this.historyIndex],this.cursorPos=this.lineBuffer.length,this.redrawLine());continue}if(c==="B"){r+=2,this.historyIndex!==-1&&(this.historyIndex++,this.historyIndex>=this.shell.history.length?(this.historyIndex=-1,this.lineBuffer=this.savedLine):this.lineBuffer=this.shell.history[this.historyIndex],this.cursorPos=this.lineBuffer.length,this.redrawLine());continue}if(c==="C"){r+=2,this.cursorPos<this.lineBuffer.length&&(this.cursorPos++,this.term.write("\x1B[C"));continue}if(c==="D"){r+=2,this.cursorPos>0&&(this.cursorPos--,this.term.write("\x1B[D"));continue}if(c==="H"){r+=2,this.cursorPos=0,this.redrawLine();continue}if(c==="F"){r+=2,this.cursorPos=this.lineBuffer.length,this.redrawLine();continue}if(c==="3"&&e[r+3]==="~"){r+=3,this.cursorPos<this.lineBuffer.length&&(this.lineBuffer=this.lineBuffer.slice(0,this.cursorPos)+this.lineBuffer.slice(this.cursorPos+1),this.redrawLine());continue}r+=2;continue}if(n===""){this.term.writeln("^C"),this.lineBuffer="",this.cursorPos=0,this.showPrompt();return}if(n==="\f"){this.term.write("\x1B[2J\x1B[H"),this.showPrompt(),this.term.write(this.lineBuffer);continue}if(n===""){this.cursorPos=0,this.redrawLine();continue}if(n===""){this.cursorPos=this.lineBuffer.length,this.redrawLine();continue}if(n===""){this.lineBuffer="",this.cursorPos=0,this.redrawLine();continue}if(n==="\v"){this.lineBuffer=this.lineBuffer.slice(0,this.cursorPos),this.redrawLine();continue}if(n===""){const c=this.lineBuffer.slice(0,this.cursorPos),s=this.lineBuffer.slice(this.cursorPos),h=c.replace(/\S+\s*$/,"");this.lineBuffer=h+s,this.cursorPos=h.length,this.redrawLine();continue}if(n===""){this.startReverseSearch();continue}if(n==="	"){await this.tabComplete();continue}if(n>=" "){const c=this.cursorPos===this.lineBuffer.length;this.lineBuffer=this.lineBuffer.slice(0,this.cursorPos)+n+this.lineBuffer.slice(this.cursorPos),this.cursorPos++,c?this.term.write(n):this.redrawLine()}}}handleUserInput(e){for(let r=0;r<e.length;r++){const n=e[r];if(n==="\r"||n===`
`){this.term.writeln("");const c=this.userInputCallback,s=this.userInputBuffer;this.userInputCallback=null,this.userInputBuffer="",this.userInputCursorPos=0,c(s);return}if(n===""){this.term.writeln("^C");const c=this.userInputCallback;this.userInputCallback=null,this.userInputBuffer="",this.userInputCursorPos=0,c("");return}if(n===""||n==="\b"){this.userInputCursorPos>0&&(this.userInputBuffer=this.userInputBuffer.slice(0,this.userInputCursorPos-1)+this.userInputBuffer.slice(this.userInputCursorPos),this.userInputCursorPos--,this.term.write("\b \b"));continue}if(n==="\x1B"&&e[r+1]==="["){r+=2;continue}n>=" "&&(this.userInputBuffer=this.userInputBuffer.slice(0,this.userInputCursorPos)+n+this.userInputBuffer.slice(this.userInputCursorPos),this.userInputCursorPos++,this.term.write(n))}}redrawLine(){let e="\r\x1B[K";const r=this.shell.env.USER||"user",n=this.shell.env.HOME||"/home/user",c=this.shell.cwd.startsWith(n)?"~"+this.shell.cwd.slice(n.length):this.shell.cwd;e+=`\x1B[32m${r}@shiro\x1B[0m:\x1B[34m${c}\x1B[0m$ `,e+=this.lineBuffer;const s=this.lineBuffer.length-this.cursorPos;s>0&&(e+=`\x1B[${s}D`),this.term.write(e)}startReverseSearch(){this.reverseSearchMode=!0,this.reverseSearchQuery="",this.reverseSearchIndex=this.shell.history.length,this.redrawReverseSearchLine()}exitReverseSearch(e){this.reverseSearchMode=!1,e&&this.reverseSearchIndex>=0&&this.reverseSearchIndex<this.shell.history.length&&(this.lineBuffer=this.shell.history[this.reverseSearchIndex],this.cursorPos=this.lineBuffer.length),this.reverseSearchQuery="",this.reverseSearchIndex=-1,this.redrawLine()}findPreviousMatch(){if(this.reverseSearchQuery==="")return;const e=this.reverseSearchQuery.toLowerCase();for(let r=this.reverseSearchIndex-1;r>=0;r--)if(this.shell.history[r].toLowerCase().includes(e)){this.reverseSearchIndex=r;return}}findLatestMatch(){if(this.reverseSearchQuery===""){this.reverseSearchIndex=this.shell.history.length;return}const e=this.reverseSearchQuery.toLowerCase();for(let r=Math.min(this.reverseSearchIndex,this.shell.history.length-1);r>=0;r--)if(this.shell.history[r].toLowerCase().includes(e)){this.reverseSearchIndex=r;return}this.reverseSearchIndex=-1}redrawReverseSearchLine(){const e=this.term.cols,r=this.reverseSearchIndex>=0&&this.reverseSearchIndex<this.shell.history.length?this.shell.history[this.reverseSearchIndex]:"",c=`${this.reverseSearchIndex>=0?"(reverse-i-search)":"(failing reverse-i-search)"}\`${this.reverseSearchQuery}': ${r}`;let s="\r";s+=" ".repeat(e),s+="\r",s+=c.slice(0,e-1),this.term.write(s)}handleReverseSearchInput(e){for(let r=0;r<e.length;r++){const n=e[r];if(n==="\r"||n===`
`){this.exitReverseSearch(!0),this.term.writeln(""),this.lineBuffer.trim()?(this.running=!0,this.shell.execute(this.lineBuffer,c=>this.term.write(c)).then(()=>{this.running=!1,this.lineBuffer="",this.cursorPos=0,this.showPrompt()})):(this.lineBuffer="",this.cursorPos=0,this.showPrompt());return}if(n==="\x1B"||n==="\x07"){this.exitReverseSearch(!1);return}if(n===""){this.exitReverseSearch(!1),this.term.writeln("^C"),this.lineBuffer="",this.cursorPos=0,this.showPrompt();return}if(n===""){this.findPreviousMatch(),this.redrawReverseSearchLine();continue}if(n===""||n==="\b"){this.reverseSearchQuery.length>0&&(this.reverseSearchQuery=this.reverseSearchQuery.slice(0,-1),this.reverseSearchIndex=this.shell.history.length,this.findLatestMatch()),this.redrawReverseSearchLine();continue}if(n>=" "){this.reverseSearchQuery+=n,this.findLatestMatch(),this.redrawReverseSearchLine();continue}}}findCommonPrefix(e){if(e.length===0)return"";if(e.length===1)return e[0];let r=e[0];for(let n=1;n<e.length;n++)for(;!e[n].startsWith(r);)if(r=r.slice(0,-1),r==="")return"";return r}async getBinExecutables(){const e=[];let r=this.shell.cwd;for(;r!=="/";){const n=`${r}/node_modules/.bin`;try{const s=await this.shell.fs.readdir(n);e.push(...s)}catch{}const c=r.substring(0,r.lastIndexOf("/"))||"/";if(c===r)break;r=c}try{const n=await this.shell.fs.readdir("/node_modules/.bin");e.push(...n)}catch{}return[...new Set(e)]}static GIT_SUBCOMMANDS=["add","branch","checkout","clone","commit","diff","fetch","init","log","merge","pull","push","rebase","remote","reset","restore","rm","show","stash","status","switch","tag"];static NPM_SUBCOMMANDS=["cache","i","init","install","list","ls","remove","rm","run","test","uninstall","--version"];static SHIRO_SUBCOMMANDS=["config"];static SHIRO_CONFIG_SUBCOMMANDS=["get","list","set"];async tabComplete(){const r=this.lineBuffer.slice(0,this.cursorPos).split(/\s+/).filter(o=>o.length>0),n=r[r.length-1]||"",c=r.length<=1,s=(o,a=" ")=>{const d=o+a;this.lineBuffer=this.lineBuffer.slice(0,this.cursorPos)+d+this.lineBuffer.slice(this.cursorPos),this.cursorPos+=d.length,this.redrawLine()},h=o=>{if(o.length!==0)if(o.length===1)s(o[0].slice(n.length));else{const a=this.findCommonPrefix(o);a.length>n.length?s(a.slice(n.length),""):(this.term.writeln(""),this.term.writeln(o.join("  ")),this.showPrompt(),this.term.write(this.lineBuffer))}};if(!c){const o=r[0];if(o==="git"&&r.length===2){const a=ShiroTerminal.GIT_SUBCOMMANDS.filter(d=>d.startsWith(n));if(a.length>0){h(a);return}}if(o==="npm"&&r.length===2){const a=ShiroTerminal.NPM_SUBCOMMANDS.filter(d=>d.startsWith(n));if(a.length>0){h(a);return}}if(o==="shiro"){if(r.length===2){const a=ShiroTerminal.SHIRO_SUBCOMMANDS.filter(d=>d.startsWith(n));if(a.length>0){h(a);return}}else if(r.length===3&&r[1]==="config"){const a=ShiroTerminal.SHIRO_CONFIG_SUBCOMMANDS.filter(d=>d.startsWith(n));if(a.length>0){h(a);return}}else if(r.length===4&&r[1]==="config"&&(r[2]==="get"||r[2]==="set")){const d=["api_key","github_token"].filter(l=>l.startsWith(n));if(d.length>0){h(d);return}}}if(n.startsWith("$")){const a=n.slice(1),d=Object.keys(this.shell.env).filter(l=>l.startsWith(a));if(d.length>0){const l=d.map(f=>"$"+f);h(l);return}}}if(c){const o=this.shell.commands.list().map(f=>f.name),a=await this.getBinExecutables(),l=[...new Set([...o,...a])].sort().filter(f=>f.startsWith(n));h(l)}else{let o,a;if(n.includes("/")){const d=n.lastIndexOf("/");o=this.shell.fs.resolvePath(n.slice(0,d)||"/",this.shell.cwd),a=n.slice(d+1)}else o=this.shell.cwd,a=n;try{const l=(await this.shell.fs.readdir(o)).filter(f=>f.startsWith(a));if(l.length===1){const f=l[0].slice(a.length),p=this.shell.fs.resolvePath((n.includes("/")?n.slice(0,n.lastIndexOf("/")+1):"")+l[0],this.shell.cwd),k=(await this.shell.fs.stat(p).catch(()=>null))?.isDirectory()?"/":" ";s(f,k)}else if(l.length>1){const f=this.findCommonPrefix(l);f.length>a.length?s(f.slice(a.length),""):(this.term.writeln(""),this.term.writeln(l.join("  ")),this.showPrompt(),this.term.write(this.lineBuffer))}}catch{}}}}class ShiroProvider{constructor(e,r,n){this.userInputResolver=null,this.fs=e,this.shell=r,this.terminal=n}async readFile(e){const r=this.resolvePath(e),n=await this.fs.readFile(r,"utf8");return typeof n=="string"?n:new TextDecoder().decode(n)}async writeFile(e,r){const n=this.resolvePath(e);await this.fs.writeFile(n,r)}async mkdir(e,r){const n=this.resolvePath(e);await this.fs.mkdir(n,r)}async readdir(e){const r=this.resolvePath(e),n=await this.fs.readdir(r),c=[];for(const s of n){const h=r==="/"?"/"+s:r+"/"+s,o=await this.fs.stat(h);c.push({name:s,path:h,type:o.type,size:o.size,mtime:o.mtime.getTime()})}return c}async stat(e){const r=this.resolvePath(e),n=await this.fs.stat(r);return{type:n.type,size:n.size,mtime:n.mtime.getTime(),isFile:()=>n.isFile(),isDirectory:()=>n.isDirectory()}}async exists(e){const r=this.resolvePath(e);return this.fs.exists(r)}async unlink(e){const r=this.resolvePath(e);await this.fs.unlink(r)}async rename(e,r){const n=this.resolvePath(e),c=this.resolvePath(r);await this.fs.rename(n,c)}resolvePath(e){return this.fs.resolvePath(e,this.shell.cwd)}getCwd(){return this.shell.cwd}setCwd(e){this.shell.cwd=this.resolvePath(e)}getEnv(){return{...this.shell.env}}async glob(e,r){const n=r??this.shell.cwd;return this.fs.glob(e,n)}async exec(e){let r="",n="";const c=await this.shell.execute(e,s=>{r+=s},s=>{n+=s});return{stdout:r,stderr:n,exitCode:c}}writeToTerminal(e){this.terminal.writeOutput(e)}readFromUser(e){return this.terminal.writeOutput(e+" "),this.terminal.waitForUserInput()}resolveUserInput(e){if(this.userInputResolver){const r=this.userInputResolver;this.userInputResolver=null,r(e)}}getHostInfo(){return{name:"Shiro",version:"0.1.0",capabilities:{runtimes:["node"],buildTools:["build","make"],packageManagers:["npm"],git:!0,extraCommands:["curl","fetch","tar","vi","awk","sed","gcc"],fsRoots:["/"],notes:["Node.js and npm are available  use them for running scripts and installing packages."]}}}}const capturedMessages=[],seenMessages=new Set,originalError=console.error,originalWarn=console.warn;console.error=(...t)=>{const e=t.map(r=>typeof r=="string"?r:r?.message||String(r)).join(" ").slice(0,200);seenMessages.has(e)||(seenMessages.add(e),capturedMessages.push({type:"error",message:e,timestamp:Date.now()})),originalError.apply(console,t)};console.warn=(...t)=>{const e=t.map(r=>typeof r=="string"?r:r?.message||String(r)).slice(0,200).join(" ");seenMessages.has(e)||(seenMessages.add(e),capturedMessages.push({type:"warn",message:e,timestamp:Date.now()})),originalWarn.apply(console,t)};window.addEventListener("error",t=>{const e=`${t.message} at ${t.filename}:${t.lineno}`.slice(0,200);seenMessages.has(e)||(seenMessages.add(e),capturedMessages.push({type:"error",message:e,timestamp:Date.now()}))});window.addEventListener("unhandledrejection",t=>{const e=`Unhandled rejection: ${t.reason?.message||t.reason}`.slice(0,200);seenMessages.has(e)||(seenMessages.add(e),capturedMessages.push({type:"error",message:e,timestamp:Date.now()}))});window.__shiroCapturedMessages=capturedMessages;window.__shiroClearMessages=()=>{capturedMessages.length=0,seenMessages.clear()};function registerCommand(t,e,r){t.register(e),registry.register(`commands/${e.name}`,e,r)}async function main(){const t=new FileSystem;await t.init();const e=new CommandRegistry;for(const h of Object.values(allCommands))e.register(wrapFluffyCommand(h));e.registerAll(shiroOnlyCommands),registerCommand(e,gitCmd,"src/commands/git.ts"),registerCommand(e,fetchCmd,"src/commands/fetch.ts"),registerCommand(e,curlCmd,"src/commands/fetch.ts"),registerCommand(e,globCmd,"src/commands/glob.ts"),registerCommand(e,spiritCmd,"src/commands/spirit.ts"),registerCommand(e,jsEvalCmd,"src/commands/jseval.ts"),registerCommand(e,nodeCmd,"src/commands/jseval.ts"),registerCommand(e,npmCmd,"src/commands/npm.ts"),registerCommand(e,buildCmd,"src/commands/build.ts"),registerCommand(e,viCmd,"src/commands/vi.ts"),registerCommand(e,nanoCmd,"src/commands/nano.ts"),registerCommand(e,uploadCmd,"src/commands/upload.ts"),registerCommand(e,downloadCmd,"src/commands/upload.ts"),registerCommand(e,shiroConfigCmd,"src/commands/upload.ts"),registerCommand(e,sourceCmd,"src/commands/source.ts"),registerCommand(e,jobsCmd,"src/commands/jobs.ts"),registerCommand(e,fgCmd,"src/commands/jobs.ts"),registerCommand(e,bgCmd,"src/commands/jobs.ts"),registerCommand(e,waitCmd,"src/commands/jobs.ts"),registerCommand(e,hcCmd,"src/commands/hc.ts"),registerCommand(e,testCmd,"src/commands/test.ts"),registerCommand(e,reloadCmd,"src/commands/reload.ts"),registerCommand(e,termcastCmd,"src/commands/termcast.ts"),registerCommand(e,serveCmd,"src/commands/serve.ts"),registerCommand(e,serversCmd,"src/commands/serve.ts"),registerCommand(e,imageCmd,"src/commands/image.ts"),registerCommand(e,clipReportCmd,"src/commands/clip-report.ts"),registry.subscribe((h,o,a)=>{if(h.startsWith("commands/")&&o){const d=o;e.register(d),console.log(`[HotReload] Updated command: ${d.name}`)}});const r=new Shell(t,e),n=document.getElementById("terminal"),c=new ShiroTerminal(n,r);r.setTerminal(c);const s=new ShiroProvider(t,r,c);r._spiritProvider=s,window.__shiro={fs:t,shell:r,terminal:c,provider:s,commands:e,registry,iframeServer},window.addEventListener("beforeunload",()=>{iframeServer.cleanup()}),await c.start()}main().catch(console.error);
