<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Shiro Terminal Recording Player</title>
  <link rel="stylesheet" type="text/css" href="https://unpkg.com/asciinema-player@3.8.2/dist/bundle/asciinema-player.css" />
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #1a1a2e;
      color: #eee;
      min-height: 100vh;
      padding: 20px;
    }

    .container {
      max-width: 1000px;
      margin: 0 auto;
    }

    h1 {
      text-align: center;
      margin-bottom: 10px;
      color: #00d9ff;
    }

    .subtitle {
      text-align: center;
      color: #888;
      margin-bottom: 30px;
    }

    .player-container {
      background: #0d0d1a;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 20px;
    }

    #player {
      margin: 0 auto;
    }

    .controls {
      display: flex;
      gap: 10px;
      justify-content: center;
      margin-top: 20px;
      flex-wrap: wrap;
    }

    button {
      background: #00d9ff;
      color: #000;
      border: none;
      padding: 10px 20px;
      border-radius: 5px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 600;
    }

    button:hover {
      background: #00b8d9;
    }

    button:disabled {
      background: #444;
      color: #888;
      cursor: not-allowed;
    }

    .upload-area {
      border: 2px dashed #444;
      border-radius: 8px;
      padding: 40px;
      text-align: center;
      margin-bottom: 20px;
      cursor: pointer;
      transition: border-color 0.3s;
    }

    .upload-area:hover {
      border-color: #00d9ff;
    }

    .upload-area.drag-over {
      border-color: #00d9ff;
      background: rgba(0, 217, 255, 0.1);
    }

    input[type="file"] {
      display: none;
    }

    .info {
      background: #0d0d1a;
      border-radius: 8px;
      padding: 20px;
      margin-top: 20px;
    }

    .info h3 {
      color: #00d9ff;
      margin-bottom: 10px;
    }

    .info pre {
      background: #1a1a2e;
      padding: 10px;
      border-radius: 4px;
      overflow-x: auto;
      font-size: 12px;
    }

    .features {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-top: 20px;
    }

    .feature {
      background: #0d0d1a;
      padding: 15px;
      border-radius: 8px;
    }

    .feature h4 {
      color: #00d9ff;
      margin-bottom: 5px;
    }

    .feature p {
      color: #888;
      font-size: 14px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üé¨ Shiro Terminal Recording Player</h1>
    <p class="subtitle">Play asciicast recordings from Shiro's termcast command</p>

    <div class="upload-area" id="uploadArea">
      <p>üìÅ Drop a .cast file here or click to upload</p>
      <p style="color: #666; font-size: 12px; margin-top: 10px;">Supports asciicast v2 format</p>
      <input type="file" id="fileInput" accept=".cast,.json">
    </div>

    <div class="player-container">
      <div id="player"></div>
    </div>

    <div class="controls">
      <button id="playBtn" disabled>‚ñ∂Ô∏è Play</button>
      <button id="pauseBtn" disabled>‚è∏Ô∏è Pause</button>
      <button id="restartBtn" disabled>üîÑ Restart</button>
    </div>

    <div class="info">
      <h3>About Terminal Recordings</h3>
      <p style="margin-bottom: 15px;">
        Terminal recordings captured with Shiro's <code>termcast</code> command use the
        <a href="https://docs.asciinema.org/manual/asciicast/v2/" style="color: #00d9ff;">asciicast v2 format</a>,
        which is compatible with asciinema and various other tools.
      </p>

      <h4 style="color: #00d9ff; margin-bottom: 10px;">Recording in Shiro:</h4>
      <pre>
# Start recording
termcast start my-demo.cast

# Run your commands
git clone https://github.com/williamsharkey/shiro /tmp/shiro
ls /tmp/shiro
reload commands/ls /tmp/shiro/src/commands/coreutils.ts

# Stop and save
termcast stop

# Play back
termcast play my-demo.cast</pre>
    </div>

    <div class="features">
      <div class="feature">
        <h4>üîÑ Hot-Reload Demo</h4>
        <p>Watch Shiro modify itself at runtime without page refresh</p>
      </div>
      <div class="feature">
        <h4>üì¶ Self-Build</h4>
        <p>See Shiro clone and compile its own source code</p>
      </div>
      <div class="feature">
        <h4>üíæ State Migration</h4>
        <p>Observe how state is preserved through hot-reloads</p>
      </div>
      <div class="feature">
        <h4>üéØ Zero Server</h4>
        <p>Everything runs in the browser - no backend needed</p>
      </div>
    </div>
  </div>

  <script src="https://unpkg.com/asciinema-player@3.8.2/dist/bundle/asciinema-player.min.js"></script>
  <script>
    let player = null;

    const uploadArea = document.getElementById('uploadArea');
    const fileInput = document.getElementById('fileInput');
    const playerDiv = document.getElementById('player');
    const playBtn = document.getElementById('playBtn');
    const pauseBtn = document.getElementById('pauseBtn');
    const restartBtn = document.getElementById('restartBtn');

    // Drag and drop handling
    uploadArea.addEventListener('click', () => fileInput.click());

    uploadArea.addEventListener('dragover', (e) => {
      e.preventDefault();
      uploadArea.classList.add('drag-over');
    });

    uploadArea.addEventListener('dragleave', () => {
      uploadArea.classList.remove('drag-over');
    });

    uploadArea.addEventListener('drop', (e) => {
      e.preventDefault();
      uploadArea.classList.remove('drag-over');
      const file = e.dataTransfer.files[0];
      if (file) loadFile(file);
    });

    fileInput.addEventListener('change', (e) => {
      const file = e.target.files[0];
      if (file) loadFile(file);
    });

    function loadFile(file) {
      const reader = new FileReader();
      reader.onload = (e) => {
        const content = e.target.result;
        createPlayer(content, file.name);
      };
      reader.readAsText(file);
    }

    function createPlayer(content, filename) {
      // Clear previous player
      playerDiv.innerHTML = '';

      // Create blob URL for the content
      const blob = new Blob([content], { type: 'text/plain' });
      const url = URL.createObjectURL(blob);

      // Create new player
      player = AsciinemaPlayer.create(url, playerDiv, {
        fit: 'width',
        theme: 'asciinema',
        idleTimeLimit: 2,
        speed: 1,
        autoPlay: true,
      });

      // Enable controls
      playBtn.disabled = false;
      pauseBtn.disabled = false;
      restartBtn.disabled = false;

      uploadArea.innerHTML = `<p>üìπ Playing: ${filename}</p><p style="color: #666; font-size: 12px; margin-top: 10px;">Drop another file to replace</p>`;
    }

    playBtn.addEventListener('click', () => {
      if (player) player.play();
    });

    pauseBtn.addEventListener('click', () => {
      if (player) player.pause();
    });

    restartBtn.addEventListener('click', () => {
      if (player) player.seek(0);
      if (player) player.play();
    });

    // Load demo recording from URL parameter if present
    const params = new URLSearchParams(window.location.search);
    const demoUrl = params.get('recording');
    if (demoUrl) {
      fetch(demoUrl)
        .then(r => r.text())
        .then(content => createPlayer(content, demoUrl.split('/').pop()))
        .catch(err => console.error('Failed to load demo:', err));
    }
  </script>
</body>
</html>
